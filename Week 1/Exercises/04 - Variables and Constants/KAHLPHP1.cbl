       IDENTIFICATION DIVISION.                                                 
      *****************************************************************         
      * PROGRAMA PROPIEDAD DE GRUPO NACIONAL PROVINCIAL               *         
      *****************************************************************         
      *    NOMBRE DEL PROGRAMA.................  KAHLPHP1           *           
      *    MODULO..............................  HISTORIFICACION      *         
      *    BREVE DESCRIPCION...................  SE HISTORIFICAN POLI-*         
      *    ....................................  ZAS PERSONALES.      *         
      *    DISE,ADO POR........................  IBM MEXICO           *         
      *    PROGRAMADO POR......................  IBM                  *         
      *    FECHA CREACION......................  21/05/2012           *         
      *    FREQUENCIA DE USO...................  DIARIOL              *         
      *    APLICACION..........................  HISTORIFICACION      *         
      *    TIPO................................  BATCH                *         
      *---------------------------------------------------------------*         
      *---------------------------------------------------------------*         
      *     HISTORICO DE CAMBIOS                                      *         
      *     ----------------------------------------------------------*         
      *     FECHA       COD.CAMBIO  AUTOR  DSN  DESCRIPCION           *         
      *     ----------  --------    -----  ---  ----------------------*         
      *     MM/DD/YYYY  XXX-9999     XXX   XXX  XXXXXXXXXXXXXXXXXXX   *         
      *                                         XXXXXXXXXXXXXXXXXXX   *         
      *                                         XXXXXXXXXXXXXXXXXXX   *         
      *****************************************************************         
      *     FECHA       COD.CAMBIO  AUTOR  DSN  DESCRIPCION           *         
      *     ----------  ----------  -----  ---  ----------------------*         
      *     10/24/2014  GNPSR64655   IBM   IBM  SE AGREGA VALIDACION  *         
      *                                         PARA SINIESTROS DE AU *         
      *                                         QUE SEAN ROBO, SI EL  *         
      *                                         SINIESTRO ES MAYOR A  *         
      *                                         6 ANIOS SE HISTORIFICA*         
      *****************************************************************         
      *     FECHA       COD.CAMBIO  AUTOR  DSN  DESCRIPCION           *         
      *     ----------  ----------  -----  ---  ----------------------*         
      *     02/05/2019  DMND0026465 SERVITECQ   SE REEMPLAZAN QUERIES *         
      *                             (HPH)       DINAMICOS POR QUERIES *         
      *                                         ESTATICOS PARA CADA U-*         
      *                                         NA DE LAS 109 TABLAS  *         
      *                                         QUE PROCESA ESTE PRO- *         
      *                                         GRAMA CON EL OBJETO DE*         
      *                                         OPTIMIZAR EL PERFOR-  *         
      *                                         MANCE.                *         
      *****************************************************************         
      * ARCHIVO  TIPO       DESCRIPCION                               *         
      * -------  -------    ------------------------------------------*         
      *****************************************************************         
       PROGRAM-ID. KAHLPHP1 INITIAL.                                            
       AUTHOR.  IBM (MEX).                                                      
       DATE-WRITTEN.                                                            
       DATE-COMPILED.                                                           
      *****************************************************************         
       ENVIRONMENT DIVISION.                                                    
      *****************************************************************         
       CONFIGURATION SECTION.                                                   
       SPECIAL-NAMES.                                                           
      *SOURCE-COMPUTER.  IBM-390 WITH DEBUGGING MODE.                           
       INPUT-OUTPUT SECTION.                                                    
       FILE-CONTROL.                                                            
                                                                                
      *ARCHIVO DE ENTRADA DEL ARCHIVO DE SIMULACION                             
           SELECT KAHSIMUL                                                      
                  ASSIGN TO KAHSIMUL                                            
                  ORGANIZATION IS SEQUENTIAL                                    
                  ACCESS MODE  IS SEQUENTIAL                                    
                  FILE STATUS IS WS-STATSIMUL.                                  
                                                                                
      *ARCHIVOS DE ERRORES                                                      
           SELECT ERPOLIZA                                                      
                  ASSIGN TO ERPOLIZA                                            
                  ORGANIZATION IS SEQUENTIAL                                    
                  ACCESS MODE  IS SEQUENTIAL                                    
                  FILE STATUS IS WS-ERPOLIZA.                                   
                                                                                
                                                                                
      *****************************************************************         
       DATA DIVISION.                                                           
      *****************************************************************         
       FILE SECTION.                                                            
      *****************************************************************         
                                                                                
       FD    KAHSIMUL                                                           
             LABEL RECORDS ARE STANDARD                                         
             BLOCK CONTAINS 0 RECORDS                                           
             RECORD CONTAINS 120 CHARACTERS                                     
             DATA RECORD IS INPUT-REC.                                          
       01    INPUT-REC                        PIC X(120).                       
                                                                                
       FD    ERPOLIZA                                                           
             LABEL RECORDS ARE STANDARD                                         
             BLOCK CONTAINS 0 RECORDS                                           
             RECORD CONTAINS 118 CHARACTERS                                     
             DATA RECORD IS OUT-ERPOL.                                          
       01    OUT-ERPOL                        PIC X(118).                       
                                                                                
       WORKING-STORAGE SECTION.                                                 
      *****************************************************************         
      * DEFINICION DE VARIABLES DE TRABAJO                            *         
      *****************************************************************         
       01 WS-CONTADORES.                                                        
         05 WS-ERR-PREPA                PIC 9(2)   VALUE ZEROS.                 
         05 WS-CONT-LEIDOS              PIC 9(9)   VALUE ZEROS.                 
         05 WS-CONT-FINALIZA            PIC 9(4)   VALUE ZEROS.                 
         05 WS-CONT-GRAB                PIC 9(12)  VALUE ZEROS.                 
         05 WS-CONT-ROLLBACK            PIC  9(09) VALUE ZEROES.                
         05 WS-CONT-COMMIT              PIC  9(09) VALUE ZEROES.                
         05 WS-NUM-SINIES               PIC S9(09) VALUE ZEROES.                
         05 WS-REG-AU                   PIC S9(09) VALUE ZEROES.                
         05 WS-PROCESADAS-AU            PIC S9(09) VALUE ZEROES.                
         05 WS-REG-DA                   PIC S9(09) VALUE ZEROES.                
         05 WS-PROCESADAS-DA            PIC S9(09) VALUE ZEROES.                
         05 WS-REG-SA                   PIC S9(09) VALUE ZEROES.                
         05 WS-PROCESADAS-SA            PIC S9(09) VALUE ZEROES.                
         05 WS-REG-RECHAZADOS           PIC S9(09) VALUE ZEROES.                
       01 WC-CONSTANTES.                                                        
          05 WC-VENCIDA             PIC X(07)         VALUE "VENCIDA".          
          05 WC-CLAVE-UNO           PIC X(05)         VALUE "B".                
          05 WC-CLAVE-DOS           PIC X(05)         VALUE "A".                
          05 WC-KCIM25T             PIC X(07)         VALUE "KCIM25T".          
          05 WC-KCIM06T             PIC X(07)         VALUE "KCIM06T".          
          05 WC-KRBM10T             PIC X(07)         VALUE "KRBM10T".          
          05 WC-SIN-DATO            PIC X(07)         VALUE SPACES.             
          05 WC-PROGRAMA            PIC X(08)         VALUE "KAHLPHP1".         
          05 WC-KAHLMHP1            PIC X(08)         VALUE "KAHLMHP1".         
          05 W-KMCLMCCB             PIC  X(08)        VALUE "KMCLMCCB".         
          05 WC-BATCH               PIC X(05)         VALUE "BATCH".            
          05 WC-USUA                PIC X(8)          VALUE "KCDLMSUB".         
          05 WC-MOD                 PIC X(1)          VALUE "B".                
          05 WC-U                   PIC X(1)          VALUE "U".                
          05 WC-P                   PIC X(1)          VALUE "P".                
          05 WC-L                   PIC X(1)          VALUE "L".                
          05 WC-E                   PIC X(1)          VALUE "E".                
          05 WC-ESP                 PIC X(1)          VALUE ' '.                
          05 WC-S                   PIC X(2)          VALUE "SI".               
          05 WC-N                   PIC X(2)          VALUE "NO".               
          05 WC-CH1                 PIC X(2)          VALUE "01".               
ALPOP1*   05 WC-MAX-SINIES          PIC 9(3)          VALUE  87.                
ALPOP1    05 WC-MAX-SINIES          PIC 9(3)          VALUE  93.                
          05 WC-MAX-RECIBO          PIC 9(3)          VALUE  12.                
          05 WC-MAX-COASEG          PIC 9(3)          VALUE  04.                
          05 WC-VERSION-CERO        PIC S9(05)V COMP-3 VALUE 0.                 
          05 WC-USER-HITORIA       PIC X(10)          VALUE 'ENDNOECO'.         
      *IBM-INI                                                                  
          05 WC-T                   PIC X(01)         VALUE 'T'.                
          05 WC-A                   PIC X(01)         VALUE 'A'.                
          05 WC-SI                  PIC X(02)         VALUE 'SI'.               
          05 WC-AU                  PIC X(02)         VALUE 'AU'.               
          05 WC-KSIM10T             PIC X(07)         VALUE 'KSIM10T'.          
          05 WC-N-1                 PIC 9(01)         VALUE 1.                  
          05 WC-N-6                 PIC 9(01)         VALUE 6.                  
          05 WC-N-12                PIC 9(02)         VALUE 12.                 
      *IBM-FIN                                                                  
       01 WC-NUMERICOS.                                                         
          05 WS-NUM-HISTORI         PIC 9(01)     VALUE 0.                      
          05 WC-MAX-TBLS            PIC 9(3)          VALUE 1.                  
          05 WC-UNO                 PIC S9(9)V        USAGE COMP-3              
                                                      VALUE +1.                 
          05 WC-1                   PIC  9(1)         VALUE  1.                 
H P H     05 WC-77                  PIC  9(2)         VALUE  77.                
          05 WC-10                  PIC 9(2)          VALUE 10.                 
          05 WC-29                  PIC X(02)         VALUE '29'.               
          05 WC-COD                 PIC 9(4)          VALUE 5007.               
          05 WC-DIA                 PIC 9(01)         VALUE 1.                  
          05 WC-2                   PIC 9(01)         VALUE 2.                  
          05 SW-TERMINA             PIC 9(01)         VALUE 0.                  
          05 SW-911                 PIC X(01)         VALUE ' '.                
          05 SW-911-911             PIC X(01)         VALUE ' '.                
                                                                                
       01 WC-DESCRIPCIONES-INCIDENCIAS.                                         
          05 WC-DESCRP38            PIC X(38)         VALUE                     
             "ERROR AL LLAMAR A PROG. KCVLMF0T ".                               
          05 WC-DESCRP39            PIC X(38)         VALUE                     
             "ERROR AL LLAMAR A PROG. KCVLM031 ".                               
          05 WC-DES01               PIC X(38)         VALUE                     
             "ERROR AL CONSULTAR TABLA KCDA02T ".                               
          05 WC-DES02               PIC X(38)         VALUE                     
             "ERROR AL ABRIR ARCHIVO DE ENTRADA".                               
          05 WC-DES03               PIC X(38)         VALUE                     
             "ERROR AL ABRIR ARCHIVO DE SALIDA ".                               
          05 WC-DES04               PIC X(40)         VALUE                     
             "ERROR AL LEER DEL ARCHIVO DE ENTRADA".                            
          05 WC-DES05               PIC X(40)         VALUE                     
             "ERROR AL ESCRIBIR EN ARCHIVO DE SALIDA".                          
                                                                                
       01 WS-CIFRASCONTROL                 PIC  X(2000).                        
       01 WS-VARIABLES.                                                         
          05 WS-TOTN-PRIMAS       PIC 9(12)V9(3) VALUE 0.                       
          05 WS-TOTV-PRIMAS       PIC ZZZ,ZZZ,ZZZ,ZZZ.ZZZ.                      
          05 WS-TOT-PRIMAS        PIC S9(12)V9(3) COMP-3 VALUE 0.               
          05 WS-ATTRVAR             PIC X(23)  VALUE SPACES.                    
          05 WS-SINOREC             PIC X(12)  VALUE SPACES.                    
          05 WS-I-TBLS              PIC 9(3)          VALUE 0.                  
          05 WS-IERR                PIC 9(3)          VALUE 0.                  
          05 WS-CAMPOPOL            PIC X(30)     VALUE SPACES.                 
          05 WS-ITBLS               PIC 9(03)     VALUE 0.                      
          05 WS-TBL-SINOREC         PIC X(12)     VALUE SPACES.                 
ALPOP1    05 WS-TBL-CDSINIES        PIC X(10)     VALUE SPACES.                 
          05 WS-TBL-CDNUMPOL        PIC X(14)     VALUE SPACES.                 
ALPOP1    05 WS-TIPO-TABLA          PIC X(07)     VALUE SPACES.                 
ALPOP1       88 TAB-ESP-SR          VALUE  "KREM24T",                           
ALPOP1                                     "KCDARST",                           
ALPOP1                                     "KREM44T",                           
ALPOP1                                     "KSIMB4T",                           
ALPOP1                                     "KREMB9T",                           
ALPOP1                                     "KREMD7T",                           
ALPOP1                                     "KREMB6T",                           
ALPOP1                                     "KREMB8T",                           
ALPOP1                                     "KREMB7T",                           
ALPOP1                                     "KREMC1T",                           
ALPOP1                                     "KREMC3T",                           
ALPOP1                                     "KREMC2T",                           
ALPOP1                                     "KREM25T",                           
ALPOP1                                     "KREMC4T",                           
ALPOP1                                     "KREMB0T",                           
ALPOP1                                     "KREMC0T",                           
ALPOP1                                     "KREMD0T".                           
          05 WS-INDSALV             PIC X(02)     VALUE SPACES.                 
          05 WS-TABLA-T             PIC X(07)     VALUE SPACES.                 
          05 WS-TABLA-H             PIC X(07)     VALUE SPACES.                 
          05 WS-LEE-NUMPOL          PIC X(14)     VALUE SPACES.                 
          05 WS-FECHA-PROCESO       PIC 9(08)     VALUE 0.                      
          05 WS-FECHA-PROCRED REDEFINES WS-FECHA-PROCESO.                       
             10 WS-ANIO-PROCESO     PIC 9(04).                                  
             10 WS-MESS-PROCESO     PIC 9(02).                                  
             10 WS-DIAS-PROCESO     PIC 9(02).                                  
          05 WS-FECHA-BATCH10.                                                  
             10 WS-ANIO-BATCH       PIC 9(04).                                  
             10 FILLER              PIC X(01) VALUE '/'.                        
             10 WS-MESS-BATCH       PIC 9(02).                                  
             10 FILLER              PIC X(01) VALUE '/'.                        
             10 WS-DIAS-BATCH       PIC 9(02).                                  
          05 WS-FECHA-BATCH REDEFINES WS-FECHA-BATCH10 PIC X(10).               
          05 WS-DIAS                PIC S9(7)V  USAGE COMP-3   VALUE +0.        
          05 WS-FEC-CANCEL          PIC S9(8)V  USAGE COMP-3   VALUE +0.        
          05 WS-FECALCON            PIC S9(8)V  USAGE COMP-3   VALUE +0.        
CCM       05 WS-FECHA-SISTEMA             PIC  X(08) VALUE ALL SPACES.          
CCM       05 WS-FECHA-SIST REDEFINES WS-FECHA-SISTEMA.                          
CCM          10 WS-FECHA-ANY              PIC  9(04).                           
CCM          10 WS-FECHA-MES              PIC  9(02).                           
CCM          10 WS-FECHA-DIA              PIC  9(02).                           
                                                                                
CCM       05 WS-HORA-SISTEMA              PIC  X(06) VALUE ALL SPACES.          
CCM       05 WS-HORA-SIST REDEFINES WS-HORA-SISTEMA.                            
CCM          10 WS-HORA                   PIC  9(02).                           
CCM          10 WS-MINUTO                 PIC  9(02).                           
CCM          10 WS-SEGUNDO                PIC  9(02).                           
CCM       05 WS-HORA-SYS.                                                       
CCM          10 WS-HORAY                  PIC  9(02).                           
CCM          10 FILLER                    PIC  X(01) VALUE ':'.                 
CCM          10 WS-MINUTOY                PIC  9(02).                           
CCM          10 FILLER                    PIC  X(01) VALUE ':'.                 
CCM          10 WS-SEGUNDOY               PIC  9(02).                           
          05 WC-MES                 PIC X(2)       VALUE SPACES.                
          05 WS-POLIZA-ANT-WT       PIC X(14)        VALUE SPACES.              
          05 WS-POLIZA-ANT          PIC X(14)        VALUE SPACES.              
          05 WS-POLIZA-ANT-AD       PIC X(14)        VALUE SPACES.              
          05 WS-POLIZA-ACT          PIC X(14)        VALUE SPACES.              
          05 WS-CLREFLIB-T          PIC X(20)        VALUE SPACES.              
          05 A-CDNUMPOL-TMP         PIC X(14)        VALUE SPACES.              
          05 A-COMPLEME-TMP         PIC X(239)       VALUE SPACES.              
          05 WS-REG-BLANCO          PIC 9(9)         COMP-3 VALUE ZEROS.        
          05 WS-REG-SIN-CODINT      PIC 9(9)         COMP-3 VALUE ZEROS.        
          05 WS-NUM-SQLCODE         PIC 9(4)         VALUE ZEROS.               
          05 WS-REG-ERRONEOS        PIC 9(5)         COMP-3 VALUE ZEROS.        
          05 WS-REG-NO-KCDA02T      PIC 9(9)         COMP-3 VALUE ZEROS.        
          05 WS-NUM-CODINT          PIC 9(9)         COMP-3 VALUE ZEROS.        
          05 WS-POSI                PIC 9(2)         COMP-3 VALUE ZEROS.        
          05 WS-J                   PIC S9(9)V       USAGE COMP-3               
                                                            VALUE +0.           
          05 WS-Z                   PIC S9(9)V       USAGE COMP-3               
                                                            VALUE +0.           
          05 WS-FON                 PIC S9(9)V       USAGE COMP-3               
                                                            VALUE +0.           
          05 WS-ENT                 PIC S9(5)V       USAGE COMP-3               
                                                            VALUE +0.           
          05 WS-L                   PIC S9(5)V       USAGE COMP-3               
                                                            VALUE +0.           
          05 WS-K                   PIC S9(5)V       USAGE COMP-3               
                                                            VALUE +0.           
          05 WS-LIN                 PIC 9(2)         COMP-3 VALUE ZEROS.        
          05 WS-VAR-AUX             PIC X(40)        VALUE SPACES.              
          05 WS-VAR-NOMBRE          PIC X(35)        VALUE SPACES.              
          05 WS-5-ESPACIOS          PIC X(05)        VALUE SPACES.              
         05 WS-FECHA-VIG-AP             PIC S9(08)V COMP-3 VALUE 0.             
         05 WS-FECHA-VIG-DA             PIC S9(08)V COMP-3 VALUE 0.             
         05 WS-FECHA-VIG-SP             PIC S9(08)V COMP-3 VALUE 0.             
         05 WS-FECVIG                   PIC S9(08)V COMP   VALUE 0.             
         05 WS-FECHA-NTU-AP             PIC S9(08)V COMP-3 VALUE 0.             
         05 WS-FECHA-NTU-DA             PIC S9(08)V COMP-3 VALUE 0.             
         05 WS-FECHA-NTU-SP             PIC S9(08)V COMP-3 VALUE 0.             
         05 WS-FECNTU                   PIC S9(08)V COMP   VALUE 0.             
         05 WS-FECHA-LIQ-AP             PIC S9(08)V COMP-3 VALUE 0.             
         05 WS-FECHA-LIQ-DA             PIC S9(08)V COMP-3 VALUE 0.             
         05 WS-FECHA-LIQ-SP             PIC S9(08)V COMP-3 VALUE 0.             
         05 WS-FNTULIQ                  PIC S9(08)V COMP   VALUE 0.             
         05 WS-MAX-FECMVTO              PIC S9(08)V COMP-3 VALUE 0.             
         05 WS-CANT-RECIBOS             PIC  9(04) VALUE 0.                     
         05 WS-CANT-COASEGU             PIC  9(04) VALUE 0.                     
         05 WS-INDHIST                  PIC  X(02) VALUE SPACES.                
         05 WS-TCESREC                  PIC  X(01) VALUE SPACES.                
         05 WS-FECPROC-AP               PIC  X(10) VALUE SPACES.                
         05 WS-FECPROC-DA               PIC  X(10) VALUE SPACES.                
         05 WS-FECPROC-SP               PIC  X(10) VALUE SPACES.                
         05 WS-FECPROC                  PIC  X(10) VALUE SPACES.                
         05 WS-FECPROCA.                                                        
             10 WS-ANIO-PROC        PIC 9(04).                                  
             10 FILLER              PIC X(01) VALUE '/'.                        
             10 WS-MESS-PROC        PIC 9(02).                                  
             10 FILLER              PIC X(01) VALUE '/'.                        
             10 WS-DIAS-PROC        PIC 9(02).                                  
         05 WS-TVUMSTRP-LI              PIC  9(04) VALUE 0.                     
         05 WS-RESTO-LI                 PIC  9(04) VALUE 0.                     
         05 WS-TVUMSTRP-AP              PIC S9(09) USAGE COMP VALUE 0.          
         05 WS-TVUMSTRP-DA              PIC S9(09) USAGE COMP VALUE 0.          
         05 WS-TVUMSTRP-SP              PIC S9(09) USAGE COMP VALUE 0.          
         05 WS-TVUMSTRP                 PIC  9(09) VALUE ZEROES.                
JNB01    05 WS-TCANTU-VA                PIC S9(09) USAGE COMP VALUE 0.          
         05 WS-TCANTU-AP                PIC S9(09) USAGE COMP VALUE 0.          
         05 WS-TCANTU-DA                PIC S9(09) USAGE COMP VALUE 0.          
         05 WS-TCANTU-SP                PIC S9(09) USAGE COMP VALUE 0.          
         05 WS-TCANTU                   PIC  9(09) VALUE ZEROES.                
         05 WS-TDEPHIST-AP              PIC S9(09) USAGE COMP VALUE 0.          
         05 WS-TDEPHIST-DA              PIC S9(09) USAGE COMP VALUE 0.          
         05 WS-TDEPHIST-SP              PIC S9(09) USAGE COMP VALUE 0.          
         05 WS-TDEPHIST                 PIC  9(09) VALUE ZEROES.                
      *IBM-INI                                                                  
         05 WS-FECHA-PASO-N             PIC S9(8)V COMP-3 VALUE 0.              
         05 WS-FECHA-PASO-RA            PIC 9(8)   VALUE ZEROES.                
         05 WS-FECHA-PASO.                                                      
            10 WS-FECHA-PASO-AAAA       PIC 9(04)  VALUE ZEROES.                
            10 WS-FECHA-PASO-MM         PIC 9(02)  VALUE ZEROES.                
            10 WS-FECHA-PASO-DD         PIC 9(02)  VALUE ZEROES.                
      *                                                                         
         05 WS-FECHA-AUX.                                                       
            10 WS-FECHA-AUX-AAAA        PIC 9(04)  VALUE ZEROES.                
            10 WS-FECHA-AUX-MM          PIC 9(02)  VALUE ZEROES.                
            10 WS-FECHA-AUX-DD          PIC 9(02)  VALUE ZEROES.                
      *                                                                         
      *  05 WS-NUMSESRR                 PIC 9(02)  VALUE ZEROES.                
         05 WS-NUMSESRR                 PIC S9(4)  USAGE COMP                   
                                                   VALUE ZEROES.                
         05 WS-ANIO-DIF                 PIC 9(04)  VALUE ZEROES.                
         05 WS-NUM-ANIO                 PIC 9(04)  VALUE ZEROES.                
      *  05 WS-NUM-MESES                PIC 9(02)  VALUE ZEROES.                
         05 WS-NUM-MESES                PIC S9(4)  USAGE COMP                   
                                                   VALUE ZEROES.                
      *  05 WS-MES-DIF                  PIC 9(04)  VALUE ZEROES.                
         05 WS-MES-DIF                  PIC S9(4)  USAGE COMP                   
                                                   VALUE ZEROES.                
      *  05 WS-NUMM-DIF                 PIC 9(04)  VALUE ZEROES.                
         05 WS-NUMM-DIF                 PIC S9(4)  USAGE COMP                   
                                                   VALUE ZEROES.                
      *IBM-FIN                                                                  
       01 WC-TBLS-SECSINIES.                                                    
        05 WS-TBL-001  PIC X(24) VALUE 'KACA50T KACA50H CDSINIES'.              
        05 WS-TBL-002  PIC X(24) VALUE 'KACA52T KACA52H CDSINIES'.              
        05 WS-TBL-003  PIC X(24) VALUE 'KACA53T KACA53H CDSINIES'.              
        05 WS-TBL-004  PIC X(24) VALUE 'KACA60T KACA60H CDSINIES'.              
        05 WS-TBL-005  PIC X(24) VALUE 'KACA61T KACA61H CDSINIES'.              
        05 WS-TBL-006  PIC X(24) VALUE 'KACA63T KACA63H CDSINIES'.              
        05 WS-TBL-007  PIC X(24) VALUE 'KACA68T KACA68H CDSINIES'.              
        05 WS-TBL-008  PIC X(24) VALUE 'KACA71T KACA71H CDSINIES'.              
        05 WS-TBL-009  PIC X(24) VALUE 'KACM50T KACM50H CDSINIES'.              
        05 WS-TBL-010  PIC X(24) VALUE 'KACM51T KACM51H CDSINIES'.              
        05 WS-TBL-011  PIC X(24) VALUE 'KACM52T KACM52H CDSINIES'.              
        05 WS-TBL-012  PIC X(24) VALUE 'KACM53T KACM53H CDSINIES'.              
        05 WS-TBL-013  PIC X(24) VALUE 'KACM54T KACM54H CDSINIES'.              
        05 WS-TBL-014  PIC X(24) VALUE 'KACM55T KACM55H CDSINIES'.              
        05 WS-TBL-015  PIC X(24) VALUE 'KACM56T KACM56H CDSINIES'.              
        05 WS-TBL-016  PIC X(24) VALUE 'KACM57T KACM57H CDSINIES'.              
        05 WS-TBL-017  PIC X(24) VALUE 'KACM71T KACM71H CDSINIES'.              
        05 WS-TBL-018  PIC X(24) VALUE 'KACM72T KACM72H CDSINIES'.              
        05 WS-TBL-019  PIC X(24) VALUE 'KACM73T KACM73H CDSINIES'.              
        05 WS-TBL-020  PIC X(24) VALUE 'KACN58T KACN58H CDSINIES'.              
        05 WS-TBL-021  PIC X(24) VALUE 'KACTEIT KACTEIH CDSINIES'.              
        05 WS-TBL-022  PIC X(24) VALUE 'KACTEPT KACTEPH CDSINIES'.              
        05 WS-TBL-023  PIC X(24) VALUE 'KACTSAT KACTSAH CDSINIES'.              
        05 WS-TBL-024  PIC X(24) VALUE 'KREM48T KREM48H CDSINIES'.              
        05 WS-TBL-025  PIC X(24) VALUE 'KREM49T KREM49H CDSINIES'.              
        05 WS-TBL-026  PIC X(24) VALUE 'KRETAST KRETASH CDSINIES'.              
        05 WS-TBL-027  PIC X(24) VALUE 'KRETSNT KRETSNH CDSINIES'.              
        05 WS-TBL-028  PIC X(24) VALUE 'KSIA04T KSIA04H CDSINIES'.              
        05 WS-TBL-029  PIC X(24) VALUE 'KSIA12T KSIA12H CDSINIES'.              
        05 WS-TBL-030  PIC X(24) VALUE 'KSIA1BT KSIA1BH CDSINIES'.              
        05 WS-TBL-031  PIC X(24) VALUE 'KSIA22T KSIA22H CDSINIES'.              
        05 WS-TBL-032  PIC X(24) VALUE 'KSIA24T KSIA24H CDSINIES'.              
        05 WS-TBL-033  PIC X(24) VALUE 'KSIA25T KSIA25H CDSINIES'.              
        05 WS-TBL-034  PIC X(24) VALUE 'KSIA2BT KSIA2BH CDSINIES'.              
        05 WS-TBL-035  PIC X(24) VALUE 'KSIA30T KSIA30H CDSINIES'.              
        05 WS-TBL-036  PIC X(24) VALUE 'KSIA3AT KSIA3AH CDSINIES'.              
        05 WS-TBL-037  PIC X(24) VALUE 'KSIA3BT KSIA3BH CDSINIES'.              
        05 WS-TBL-038  PIC X(24) VALUE 'KSIA4BT KSIA4BH CDSINIES'.              
        05 WS-TBL-039  PIC X(24) VALUE 'KSIA5AT KSIA5AH CDSINIES'.              
        05 WS-TBL-040  PIC X(24) VALUE 'KSIA6BT KSIA6BH CDSINIES'.              
        05 WS-TBL-041  PIC X(24) VALUE 'KSIM12T KSIM12H CDSINIES'.              
        05 WS-TBL-042  PIC X(24) VALUE 'KSIM20T KSIM20H CDSINIES'.              
        05 WS-TBL-043  PIC X(24) VALUE 'KSIM30T KSIM30H CDSINIES'.              
        05 WS-TBL-044  PIC X(24) VALUE 'KSIM3AT KSIM3AH CDSINIES'.              
        05 WS-TBL-045  PIC X(24) VALUE 'KSIM4AT KSIM4AH CDSINIES'.              
        05 WS-TBL-046  PIC X(24) VALUE 'KSIM5AT KSIM5AH CDSINIES'.              
        05 WS-TBL-047  PIC X(24) VALUE 'KSIM61T KSIM61H CDSINIES'.              
        05 WS-TBL-048  PIC X(24) VALUE 'KSIM62T KSIM62H CDSINIES'.              
        05 WS-TBL-049  PIC X(24) VALUE 'KSIM63T KSIM63H CDSINIES'.              
        05 WS-TBL-050  PIC X(24) VALUE 'KSIM64T KSIM64H CDSINIES'.              
        05 WS-TBL-051  PIC X(24) VALUE 'KSIM65T KSIM65H CDSINIES'.              
        05 WS-TBL-052  PIC X(24) VALUE 'KSIM66T KSIM66H CDSINIES'.              
        05 WS-TBL-053  PIC X(24) VALUE 'KSIM7AT KSIM7AH CDSINIES'.              
        05 WS-TBL-054  PIC X(24) VALUE 'KSIM86T KSIM86H CDSINIES'.              
        05 WS-TBL-055  PIC X(24) VALUE 'KSIM87T KSIM87H CDSINIES'.              
        05 WS-TBL-056  PIC X(24) VALUE 'KSIM88T KSIM88H CDSINIES'.              
        05 WS-TBL-057  PIC X(24) VALUE 'KSIM8AT KSIM8AH CDSINIES'.              
        05 WS-TBL-058  PIC X(24) VALUE 'KSIM9AT KSIM9AH CDSINIES'.              
        05 WS-TBL-059  PIC X(24) VALUE 'KSIMA0T KSIMA0H CDSINIES'.              
        05 WS-TBL-060  PIC X(24) VALUE 'KSIN11T KSIN11H CDSINIES'.              
        05 WS-TBL-061  PIC X(24) VALUE 'KSIN30T KSIN30H CDSINIES'.              
        05 WS-TBL-062  PIC X(24) VALUE 'KSIN31T KSIN31H CDSINIES'.              
        05 WS-TBL-063  PIC X(24) VALUE 'KSITART KSITARH CDSINIES'.              
        05 WS-TBL-064  PIC X(24) VALUE 'KSITCRT KSITCRH CDSINIES'.              
        05 WS-TBL-065  PIC X(24) VALUE 'KSITDPT KSITDPH CDSINIES'.              
        05 WS-TBL-066  PIC X(24) VALUE 'KSITPET KSITPEH CDSINIES'.              
        05 WS-TBL-067  PIC X(24) VALUE 'KSITRET KSITREH CDSINIES'.              
        05 WS-TBL-068  PIC X(24) VALUE 'KSITRNT KSITRNH CDSINIES'.              
        05 WS-TBL-069  PIC X(24) VALUE 'KSVTBRT KSVTBRH CDSINIES'.              
        05 WS-TBL-070  PIC X(24) VALUE 'KSVTCCT KSVTCCH CDSINIES'.              
        05 WS-TBL-071  PIC X(24) VALUE 'KSVTCPT KSVTCPH CDSINIES'.              
        05 WS-TBL-072  PIC X(24) VALUE 'KSVTRAT KSVTRAH CDSINIES'.              
        05 WS-TBL-073  PIC X(24) VALUE 'KSVTRPT KSVTRPH CDSINIES'.              
        05 WS-TBL-074  PIC X(24) VALUE 'KTOA49T KTOA49H CDSINIES'.              
        05 WS-TBL-075  PIC X(24) VALUE 'KTOM49T KTOM49H CDSINIES'.              
        05 WS-TBL-076  PIC X(24) VALUE 'KSINSRT KSINSRH CDSINIES'.              
alpop1*                                                                         
XSP     05 WS-TBL-077  PIC X(24) VALUE 'KREM24T KREM24H CDSINIES'.              
XSP     05 WS-TBL-078  PIC X(24) VALUE 'KCDARST KCDARSH CDSINIES'.              
XSP     05 WS-TBL-079  PIC X(24) VALUE 'KREM44T KREM44H CDSINIES'.              
XSP     05 WS-TBL-080  PIC X(24) VALUE 'KSIMB4T KSIMB4H CDSINIES'.              
XSP     05 WS-TBL-081  PIC X(24) VALUE 'KREMB9T KREMB9H CDSINIES'.              
        05 WS-TBL-082  PIC X(24) VALUE 'KREMD7T KREMD7H CDSINIES'.              
        05 WS-TBL-083  PIC X(24) VALUE 'KREMB6T KREMB6H CDSINIES'.              
        05 WS-TBL-084  PIC X(24) VALUE 'KREMB8T KREMB8H CDSINIES'.              
        05 WS-TBL-085  PIC X(24) VALUE 'KREMB7T KREMB7H CDSINIES'.              
        05 WS-TBL-086  PIC X(24) VALUE 'KREMC1T KREMC1H CDSINIES'.              
        05 WS-TBL-087  PIC X(24) VALUE 'KREMC3T KREMC3H CDSINIES'.              
        05 WS-TBL-088  PIC X(24) VALUE 'KREMC2T KREMC2H CDSINIES'.              
        05 WS-TBL-089  PIC X(24) VALUE 'KREM25T KREM25H CDSINIES'.              
        05 WS-TBL-090  PIC X(24) VALUE 'KREMC4T KREMC4H CDSINIES'.              
        05 WS-TBL-091  PIC X(24) VALUE 'KREMB0T KREMB0H CDSINIES'.              
        05 WS-TBL-092  PIC X(24) VALUE 'KREMC0T KREMC0H CDSINIES'.              
        05 WS-TBL-093  PIC X(24) VALUE 'KREMD0T KREMD0H CDSINIES'.              
ALPOP1* SE MUVEN A PGM KAHLMHP1                                                 
mp    * 05 WS-TBL-018  PIC X(24) VALUE 'KACM70T KACM70H CDSINIES'.              
mps   * 05 WS-TBL-027  PIC X(24) VALUE 'KCITK3T KCITK3H CDSINIES'.              
mp    * 05 WS-TBL-028  PIC X(24) VALUE 'KCVTIBT KCVTIBH CDSINIES'.              
mps   * 05 WS-TBL-047  PIC X(24) VALUE 'KSIAW1T KSIAW1H CDSINIES'.              
mps   * 05 WS-TBL-067  PIC X(24) VALUE 'KSIMA7T KSIMA7H CDSINIES'.              
mps   * 05 WS-TBL-069  PIC X(24) VALUE 'KSIMB5T KSIMB5H CDSINIES'.              
alpop1*                                                                         
       01 WC-ARR-TBSINIES REDEFINES WC-TBLS-SECSINIES.                          
        05 WC-TBLS-HIST     OCCURS  93 TIMES.                                   
           10 WC-TBLSIN-T      PIC X(07).                                       
           10 FILLER           PIC X(01).                                       
           10 WC-TBLSIN-H      PIC X(07).                                       
           10 FILLER           PIC X(01).                                       
           10 WC-CDSINIES      PIC X(08).                                       
       01 WC-TBLS-SECNUMREC.                                                    
        05 WS-TBL-001  PIC X(24) VALUE 'KRBM20T KRBM20H CDNUMREC'.              
        05 WS-TBL-002  PIC X(24) VALUE 'KRBM30T KRBM30H CDNUMREC'.              
        05 WS-TBL-003  PIC X(24) VALUE 'KRBN50T KRBN50H CDNUMREC'.              
        05 WS-TBL-004  PIC X(24) VALUE 'KRBA61T KRBA61H CDNUMREC'.              
        05 WS-TBL-005  PIC X(24) VALUE 'KRBA62T KRBA62H CDNUMREC'.              
        05 WS-TBL-006  PIC X(24) VALUE 'KRBA64T KRBA64H CDNUMREC'.              
        05 WS-TBL-007  PIC X(24) VALUE 'KRBA66T KRBA66H CDNUMREC'.              
        05 WS-TBL-008  PIC X(24) VALUE 'KRBA67T KRBA67H CDNUMREC'.              
        05 WS-TBL-009  PIC X(24) VALUE 'KRBA68T KRBA68H CDNUMREC'.              
        05 WS-TBL-010  PIC X(24) VALUE 'KRBMRRT KRBMRRH CDNUMREC'.              
        05 WS-TBL-011  PIC X(24) VALUE 'KRBA41T KRBA41H CDRECFAC'.              
        05 WS-TBL-012  PIC X(24) VALUE 'KCIA43T KCIA43H CDNUMREC'.              
       01 WC-ARR-TBNUMREC REDEFINES WC-TBLS-SECNUMREC.                          
        05 WC-TBLS-HIST     OCCURS  12 TIMES.                                   
           10 WC-TBLREC-T      PIC X(07).                                       
           10 FILLER           PIC X(01).                                       
           10 WC-TBLREC-H      PIC X(07).                                       
           10 FILLER           PIC X(01).                                       
           10 WC-CDNUMREC      PIC X(08).                                       
       01 WC-TBLS-SECCOASEG.                                                    
        05 WS-TBL-001  PIC X(24) VALUE 'KCGM22T KCGM22H CDRECCOA'.              
        05 WS-TBL-002  PIC X(24) VALUE 'KCGM23T KCGM23H CDRECCOA'.              
        05 WS-TBL-003  PIC X(24) VALUE 'KCGM24T KCGM24H CDRECCOA'.              
        05 WS-TBL-004  PIC X(24) VALUE 'KCGM26T KCGM26H CDRECCOA'.              
       01 WC-ARR-TBCOASGU REDEFINES WC-TBLS-SECCOASEG.                          
        05 WC-TBLS-HIST     OCCURS  04 TIMES.                                   
           10 WC-TBLCOA-T      PIC X(07).                                       
           10 FILLER           PIC X(01).                                       
           10 WC-TBLCOA-H      PIC X(07).                                       
           10 FILLER           PIC X(01).                                       
           10 WC-CDRECCOA      PIC X(08).                                       
       01 WC-TBLS-PREPAR.                                                       
        05 FILLER      PIC X(08) VALUE ' PREPARE'.                              
        05 FILLER      PIC X(08) VALUE ' DECLARE'.                              
        05 FILLER      PIC X(08) VALUE ' OPEN   '.                              
        05 FILLER      PIC X(08) VALUE ' FETCH  '.                              
        05 FILLER      PIC X(08) VALUE ' CLOSE  '.                              
       01 WC-ARR-PREPAR   REDEFINES WC-TBLS-PREPAR.                             
        05 WC-TBLS-PREP     OCCURS  05 TIMES.                                   
           10 WS-ERPREPA       PIC X(08).                                       
       01  APUNTADORES.                                                         
           05 WK-PTR                   PIC S9(04) COMP VALUE ZEROS.             
      ******************************************************************        
      *                   QUERIES DE SQL DINAMICO                      *        
      ******************************************************************        
       01  W-QUERY.                                                             
           49 W-QUERY-LONG            PIC S9(04) COMP.                          
           49 W-QUERY-TEXT            PIC  X(200).                              
       01 FS-STATUS.                                                            
          05 WS-STATSIMUL           PIC X(2)          VALUE ZEROS.              
          05 WS-ERPOLIZA            PIC X(2)          VALUE ZEROS.              
          05 WS-ERTABLA             PIC X(2)          VALUE ZEROS.              
          05 EA-BASDATGG            PIC X(2)          VALUE ZEROS.              
          05 EA-CIFRCTRL            PIC X(2)          VALUE ZEROS.              
          05 WS-AGENTE-ANT          PIC X(10)         VALUE SPACES.             
          05 WS-TIPOHO-ANT          PIC X(2)          VALUE SPACES.             
          05 T-TIPOHO               PIC X(2)          VALUE SPACES.             
                                                                                
       01 WS-VARIABLES-TMP.                                                     
          05 WS-IDX-A               PIC 9(9)         COMP-3 VALUE ZEROS.        
          05 WS-IDX-V               PIC 9(9)         COMP-3 VALUE ZEROS.        
          05 WS-CONT-A              PIC 9(9)         COMP-3 VALUE ZEROS.        
          05 WS-CONT-V              PIC 9(9)         COMP-3 VALUE ZEROS.        
          05 WS-TMP-A               PIC 9(9)         COMP-3 VALUE ZEROS.        
          05 WS-TMP-V               PIC 9(9)         COMP-3 VALUE ZEROS.        
          05 WS-BSQ                 PIC 9(9)         COMP-3 VALUE ZEROS.        
          05 WS-TMP-IMPRICON-WS  PIC S9(14)V9(3) USAGE COMP-3 VALUE +0.         
          05 WS-TMP-IMPRICON-WSB PIC S9(14)V9(3) USAGE COMP-3 VALUE +0.         
          05 WS-TMP-ESFINCON        PIC X(2)         VALUE SPACES.              
          05 WS-BSQA                PIC 9(9)         COMP-3 VALUE ZEROS.        
          05 WS-IDPLAN-A            PIC X(10)     VALUE SPACES.                 
          05 WS-IDPLAN-B            PIC X(10)     VALUE SPACES.                 
                                                                                
                                                                                
       01 SWITCHES.                                                             
          05 WS-HAY-DUPLICADOS      PIC X(1)          VALUE "N".                
             88 WS-NO-DUPLICADOS                      VALUE "N".                
             88 WS-DUPLICADOS                         VALUE "Y".                
          05 WS-PASA-ERROR          PIC X(1)          VALUE "N".                
             88 WS-NO-BYPASS                          VALUE "N".                
             88 WS-BYPASS                             VALUE "Y".                
          05 WS-ESCRIBE-ARCH        PIC X(1)          VALUE "N".                
             88 WS-NO-WRITE                           VALUE "N".                
             88 WS-WRITE                              VALUE "Y".                
          05 WS-SI-INSERTA          PIC X(1)          VALUE "N".                
             88 WS-NO-PARA-INSERT                     VALUE "N".                
             88 WS-PARA-INSERT                        VALUE "Y".                
          05 WS-SI-EXISTE-COASEGU   PIC X(1)          VALUE "Y".                
             88 WS-HAY-COASEGU                        VALUE "Y".                
             88 WS-NO-HAY-COASEGU                     VALUE "N".                
          05 WS-ABRIR-COASEG        PIC X(1)          VALUE "Y".                
             88 WS-OPEN-CUR-COASEG                    VALUE "Y".                
             88 WS-CLOSE-CUR-COASEG                    VALUE "N".               
          05 WS-FINALIZAR           PIC X(1)          VALUE "N".                
             88 WS-FINAL                              VALUE "Y".                
             88 WS-NO-FINAL                           VALUE "N".                
          05 WS-HAY-ERROR-RUTINA    PIC X(1)          VALUE "Y".                
             88 WS-ERR-REP                            VALUE "Y".                
             88 WS-NO-ERR-REP                         VALUE "N".                
          05 WS-EXISTE-MAX-FECMVTO  PIC X(1)          VALUE "Y".                
             88 WS-HAY-MAX-FECMVTO                    VALUE "Y".                
             88 WS-NO-HAY-MAX-FECMVTO                 VALUE "N".                
          05 WS-CICLO-SALIR         PIC X(1)          VALUE "Y".                
             88 WS-SALIR                              VALUE "Y".                
             88 WS-NO-SALIR                            VALUE "N".               
          05 WS-ABRIR-RECIBO        PIC X(1)          VALUE "Y".                
             88 WS-OPEN-CUR-RECIBO                    VALUE "Y".                
             88 WS-CLOSE-CUR-RECIBO                    VALUE "N".               
          05 WS-ABRIR-SINIESTROS    PIC X(1)          VALUE "Y".                
             88 WS-OPEN-CUR-SINIES                    VALUE "Y".                
             88 WS-CLOSE-CUR-SINIES                    VALUE "N".               
          05 WS-EXISTE-KSIN30T      PIC X(1)          VALUE "Y".                
             88 WS-HAY-KSIN30T                        VALUE "Y".                
             88 WS-NO-HAY-KSIN30T                     VALUE "N".                
          05 WS-VALIDEZ-RECIBO      PIC X(1)          VALUE "Y".                
             88 WS-RECIBO-VALIDO                      VALUE "Y".                
             88 WS-NO-RECIBO-VALIDO                   VALUE "N".                
          05 WS-VALIDEZ-SINIESTR0   PIC X(1)          VALUE "Y".                
             88 WS-SINIESTRO-VALIDO                   VALUE "Y".                
             88 WS-NO-SINIESTRO-VALIDO                VALUE "N".                
          05 WS-SI-EXISTE-RECIBOS   PIC X(1)          VALUE "Y".                
             88 WS-HAY-RECIBOS                        VALUE "Y".                
             88 WS-NO-HAY-RECIBOS                     VALUE "N".                
          05 WS-SI-EXISTE-SINIES    PIC X(1)          VALUE "Y".                
             88 WS-HAY-SINIESTROS                     VALUE "Y".                
             88 WS-NO-HAY-SINIESTROS                  VALUE "N".                
          05 WS-VALIDEZ-POLIZAS     PIC X(1)          VALUE "Y".                
             88 WS-POLIZA-VALIDA                      VALUE "Y".                
             88 WS-NO-POLIZA-VALIDA                   VALUE "N".                
                                                                                
          05 WS-LLAMADAO-RUTINA     PIC X(1)          VALUE "Y".                
             88 WS-LLAMA-RUT                          VALUE "Y".                
             88 WS-NO-LLAMA-RUT                       VALUE "N".                
                                                                                
          05 WS-FINAL-ARCHIVO       PIC X(1)          VALUE "N".                
             88 WS-NO-FIN-ARCHIVO                     VALUE "N".                
             88 WS-FIN-ARCHIVO                        VALUE "Y".                
                                                                                
          05 WS-FINAL-ARCHIVO-A     PIC X(1)          VALUE "Y".                
             88 WS-NO-FIN-ARCHIVO-A                   VALUE "Y".                
             88 WS-FIN-ARCHIVO-A                      VALUE "N".                
                                                                                
                                                                                
          05 WS-LECTURA-ARCH-BSCOS  PIC X(1)          VALUE "Y".                
             88 WS-SI-LECTURA-BSCOS                   VALUE "Y".                
             88 WS-NO-LECTURA-BSCOS                   VALUE "N".                
                                                                                
          05 WS-LECTURA-ARCH-ADINL  PIC X(1)          VALUE "Y".                
             88 WS-SI-LECTURA-ADINL                   VALUE "Y".                
             88 WS-NO-LECTURA-ADINL                   VALUE "N".                
                                                                                
                                                                                
          05 WS-LECTURA-DAT-ADCION  PIC X(1)          VALUE "Y".                
             88 WS-SI-ESCR-DAT-ANT                    VALUE "Y".                
             88 WS-NO-ESCR-DAT-ANT                    VALUE "N".                
                                                                                
          05 WS-LECTURA-DAT-EXTR    PIC X(1)          VALUE "Y".                
             88 WS-SI-FIN-EXTR                        VALUE "Y".                
             88 WS-NO-FIN-EXTR                        VALUE "N".                
                                                                                
                                                                                
          05 WS-LECTURA-ITERACION   PIC X(1)          VALUE "Y".                
             88 WS-SI-PRIMERA-ITER                    VALUE "Y".                
             88 WS-NO-PRIMERA-ITER                    VALUE "N".                
                                                                                
          05 WS-PROCESA-DATOS       PIC X(1)          VALUE "Y".                
             88 WS-SI-FIN-PROCESA                     VALUE "Y".                
             88 WS-NO-FIN-PROCESA                     VALUE "N".                
                                                                                
          05 WS-PROCESA-RX          PIC X(1)          VALUE "Y".                
             88 WS-SI-FIN-RX                          VALUE "Y".                
             88 WS-NO-FIN-RX                          VALUE "N".                
                                                                                
          05 WS-FILTRO              PIC 9(2)          VALUE 1.                  
             88 WS-FILTRO-1                           VALUE 1.                  
             88 WS-FILTRO-2                           VALUE 2.                  
             88 WS-FILTRO-3                           VALUE 3.                  
             88 WS-FILTRO-4                           VALUE 4.                  
             88 WS-FILTRO-5                           VALUE 5.                  
             88 WS-FILTRO-6                           VALUE 6.                  
             88 WS-FILTRO-7                           VALUE 7.                  
             88 WS-FILTRO-8                           VALUE 8.                  
             88 WS-FILTRO-9                           VALUE 9.                  
             88 WS-FILTRO-10                          VALUE 10.                 
             88 WS-FILTRO-11                          VALUE 11.                 
      *IBM-INI                                                                  
          05 WS-KSITRST             PIC X(1)          VALUE "Y".                
             88 WS-EXISTE-KSITRST                     VALUE "Y".                
             88 WS-NO-EXISTE-KSITRST                  VALUE "N".                
      *                                                                         
          05 WS-KSITRCT             PIC X(1)          VALUE "Y".                
             88 WS-EXISTE-KSITRCT                     VALUE "Y".                
             88 WS-NO-EXISTE-KSITRCT                  VALUE "N".                
      *                                                                         
          05 WS-HISTORIFICA         PIC X(1)          VALUE "Y".                
             88 WS-SI-HISTORIFICA                     VALUE "Y".                
             88 WS-NO-HISTORIFICA                     VALUE "N".                
      *IBM-FIN                                                                  
                                                                                
      *****************************************************************         
      * ARCHIVO ENTRADA  DE LA SIMULACION                             *         
      *****************************************************************         
       01 WS-REG-ENTRADA.                                                       
         05 WS-LEE-CDNUMPOL             PIC  X(14) VALUE SPACES.                
         05 WS-LEE-FECHA                PIC  X(10) VALUE SPACES.                
         05 WS-LEE-CDCIAGRU             PIC  X(02) VALUE SPACES.                
         05 WS-LEE-MESES-RECIBO         PIC  9(03) VALUE ZEROES.                
         05 WS-LEE-MESES-VIGENCIA       PIC  9(03) VALUE ZEROES.                
         05 WS-LEE-IND-NTU              PIC  X(01) VALUE SPACES.                
         05 WS-LEE-IND-POL-IND-PDR      PIC  X(10) VALUE SPACES.                
         05 WS-LEE-FEFINEFE             PIC  X(10) VALUE ZEROES.                
         05 WS-LEE-FEEFTOMO             PIC  X(10) VALUE ZEROES.                
         05 WS-LEE-RECIBO               PIC  X(12) VALUE SPACES.                
         05 WS-LEE-FECHA-RECIBO         PIC  X(10) VALUE SPACES.                
         05 WS-LEE-NUM-SINIESTRO        PIC  X(10) VALUE SPACES.                
         05 WS-LEE-FECHA-SINIESTRO      PIC  X(10) VALUE ZEROES.                
         05 WS-LEE-CLIENTE              PIC  X(10) VALUE SPACES.                
         05 WS-LEE-CDNUMCON             PIC  X(05) VALUE SPACES.                
      *                                                                         
                                                                                
      *****************************************************************         
      * RECORD LAYOUT DE errores                                      *         
      *****************************************************************         
       01 OUT-POLIZAS.                                                          
           05 WS-OUT-POLIZA          PIC X(14)   VALUE SPACES.                  
           05 FILLER                 PIC X(01)   VALUE ']'.                     
           05 WS-OUT-FEC-SYS         PIC X(10)   VALUE SPACES.                  
           05 FILLER                 PIC X(01)   VALUE ']'.                     
           05 WS-OUT-FEC-HIST        PIC X(10)   VALUE SPACES.                  
           05 FILLER                 PIC X(01)   VALUE ']'.                     
           05 WS-OUT-SQLCODE         PIC 9(10)   VALUE 0.                       
           05 FILLER                 PIC X(01)   VALUE ']'.                     
           05 WS-OUT-TABLA           PIC X(08)   VALUE SPACES.                  
           05 FILLER                 PIC X(01)   VALUE ']'.                     
           05 WS-OUT-PARRAFO         PIC X(20)   VALUE SPACES.                  
           05 FILLER                 PIC X(01)   VALUE ']'.                     
           05 WS-OUT-DESC            PIC X(40)   VALUE SPACES.                  
                                                                                
      *****************************************************************         
      *      PARA HISTORIFICAR LAS TABLAS POR COBOL                             
      *ESTE LAYOUT SIRVE PARA RECIBIR TODOS LOS MENSAJES DE TABLAS TRA-         
      *TADAS POR LA RUTINA QUE HISTORIFICA POR NUMERO DE POLIZA                 
      *****************************************************************         
       01 KAHLCCTR.                                                             
           05 WS-IDA-POLIZA          PIC X(14).                                 
           05 WS-AMBIENTE            PIC X(04).                                 
           05 WS-CANT-ERRORES        PIC 9(3).                                  
           05 WS-ROLLBACK            PIC X(2).                                  
           05 WS-COMM-CONTR OCCURS 200 TIMES.                                   
             15 WS-REG-SQLCODE         PIC S9(04).                              
             15 WS-REG-TABLA           PIC X(08).                               
             15 WS-REG-DESCRIPCION     PIC X(20).                               
                                                                                
                                                                                
       01  WS-VARS-18-24.                                                       
           05 WS-INPROREG           PIC X(01)   VALUE ' '.                      
           05 WS-INPROREG1          PIC X(01)   VALUE 'N'.                      
           05 WS-FEPROREA           PIC S9(08)V COMP-3 VALUE 0.                 
           05 WS-FEMOVIMI           PIC S9(08)V COMP-3 VALUE 0.                 
           05 WS-CDCIAGRU-RS        PIC X(02)   VALUE '  '.                     
           05 WS-SAL-REAS           PIC X(01)   VALUE ' '.                      
      *----------------------------------------------------------------*        
      * ARQUITECTURA Y TABLAS CORPORATIVAS. *                                   
      *----------------------------------------------------------------*        
      * COMUN DE TRABAJO VIDA                                                   
      *    COPY KCVLCWRK.                                                       
           EXEC SQL                                                             
                INCLUDE KCVLCWRK                                                
           END-EXEC.                                                            
      * GESTION ERRORES                                                         
           EXEC SQL                                                             
                INCLUDE KAELCWEZ                                                
           END-EXEC.                                                            
      * LOG OPERACIONES                                                         
           EXEC SQL                                                             
                INCLUDE KAELCWLO                                                
           END-EXEC.                                                            
                                                                                
      * ARQUITECTURA I/V.                                                       
       01  MENSAJE-ENTRADA.                                                     
            EXEC SQL                                                            
                 INCLUDE KAELIC00                                               
            END-EXEC.                                                           
                                                                                
       01  MENSAJE-SALIDA.                                                      
            EXEC SQL                                                            
                 INCLUDE KAELVC00                                               
            END-EXEC.                                                           
      ************************************************************              
      * AREA DE INCLUDES: CODIGOS DE RETORNO SQL Y DESCRIPCIONES *              
      * DE LAS TABLAS PARA SER USADAS COMO CAMPOS DE TRABAJO     *              
      ************************************************************              
           EXEC SQL                                                             
                INCLUDE SQLCA                                                   
           END-EXEC.                                                            
      *KCIM06T: TABLA DE POLIZA OBJETO.                                         
           EXEC SQL INCLUDE KCIM06T END-EXEC.                                   
           EXEC SQL INCLUDE KCIM06H END-EXEC.                                   
           EXEC SQL INCLUDE KSIM10T END-EXEC.                                   
           EXEC SQL INCLUDE KSIM10H END-EXEC.                                   
           EXEC SQL INCLUDE KRBM10T END-EXEC.                                   
           EXEC SQL INCLUDE KRBM10H END-EXEC.                                   
           EXEC SQL                                                             
                INCLUDE KAHTPET                                                 
           END-EXEC.                                                            
      ************************************************************              
      * INCLUDES DE LAS TABLAS OPERATIVAS SINIESTROS                            
      ************************************************************              
           EXEC SQL INCLUDE KACA50T END-EXEC.                                   
           EXEC SQL INCLUDE KACA52T END-EXEC.                                   
           EXEC SQL INCLUDE KACA53T END-EXEC.                                   
           EXEC SQL INCLUDE KACA60T END-EXEC.                                   
           EXEC SQL INCLUDE KACA61T END-EXEC.                                   
           EXEC SQL INCLUDE KACA62T END-EXEC.                                   
           EXEC SQL INCLUDE KACA63T END-EXEC.                                   
           EXEC SQL INCLUDE KACA68T END-EXEC.                                   
           EXEC SQL INCLUDE KACA71T END-EXEC.                                   
           EXEC SQL INCLUDE KACM50T END-EXEC.                                   
           EXEC SQL INCLUDE KACM51T END-EXEC.                                   
           EXEC SQL INCLUDE KACM52T END-EXEC.                                   
           EXEC SQL INCLUDE KACM53T END-EXEC.                                   
           EXEC SQL INCLUDE KACM54T END-EXEC.                                   
           EXEC SQL INCLUDE KACM55T END-EXEC.                                   
           EXEC SQL INCLUDE KACM56T END-EXEC.                                   
           EXEC SQL INCLUDE KACM57T END-EXEC.                                   
           EXEC SQL INCLUDE KACM70T END-EXEC.                                   
           EXEC SQL INCLUDE KACM71T END-EXEC.                                   
           EXEC SQL INCLUDE KACM72T END-EXEC.                                   
           EXEC SQL INCLUDE KACM73T END-EXEC.                                   
           EXEC SQL INCLUDE KACN58T END-EXEC.                                   
           EXEC SQL INCLUDE KACTEIT END-EXEC.                                   
           EXEC SQL INCLUDE KACTEPT END-EXEC.                                   
           EXEC SQL INCLUDE KACTSAT END-EXEC.                                   
           EXEC SQL INCLUDE KCDARST END-EXEC.                                   
           EXEC SQL INCLUDE KCITK3T END-EXEC.                                   
           EXEC SQL INCLUDE KCVTIBT END-EXEC.                                   
           EXEC SQL INCLUDE KREM44T END-EXEC.                                   
           EXEC SQL INCLUDE KREM48T END-EXEC.                                   
           EXEC SQL INCLUDE KREM49T END-EXEC.                                   
           EXEC SQL INCLUDE KRETAST END-EXEC.                                   
           EXEC SQL INCLUDE KRETSNT END-EXEC.                                   
           EXEC SQL INCLUDE KSIA04T END-EXEC.                                   
           EXEC SQL INCLUDE KSIA12T END-EXEC.                                   
           EXEC SQL INCLUDE KSIA1BT END-EXEC.                                   
           EXEC SQL INCLUDE KSIA22T END-EXEC.                                   
           EXEC SQL INCLUDE KSIA24T END-EXEC.                                   
           EXEC SQL INCLUDE KSIA25T END-EXEC.                                   
           EXEC SQL INCLUDE KSIA2BT END-EXEC.                                   
           EXEC SQL INCLUDE KSIA30T END-EXEC.                                   
           EXEC SQL INCLUDE KSIA3AT END-EXEC.                                   
           EXEC SQL INCLUDE KSIA3BT END-EXEC.                                   
           EXEC SQL INCLUDE KSIA4BT END-EXEC.                                   
           EXEC SQL INCLUDE KSIA5AT END-EXEC.                                   
           EXEC SQL INCLUDE KSIA6BT END-EXEC.                                   
           EXEC SQL INCLUDE KSIAW1T END-EXEC.                                   
           EXEC SQL INCLUDE KSIM12T END-EXEC.                                   
           EXEC SQL INCLUDE KSIM20T END-EXEC.                                   
           EXEC SQL INCLUDE KSIM30T END-EXEC.                                   
           EXEC SQL INCLUDE KSIM3AT END-EXEC.                                   
           EXEC SQL INCLUDE KSIM4AT END-EXEC.                                   
           EXEC SQL INCLUDE KSIM5AT END-EXEC.                                   
           EXEC SQL INCLUDE KSIM61T END-EXEC.                                   
           EXEC SQL INCLUDE KSIM62T END-EXEC.                                   
           EXEC SQL INCLUDE KSIM63T END-EXEC.                                   
           EXEC SQL INCLUDE KSIM64T END-EXEC.                                   
           EXEC SQL INCLUDE KSIM65T END-EXEC.                                   
           EXEC SQL INCLUDE KSIM66T END-EXEC.                                   
           EXEC SQL INCLUDE KSIM7AT END-EXEC.                                   
           EXEC SQL INCLUDE KSIM86T END-EXEC.                                   
           EXEC SQL INCLUDE KSIM87T END-EXEC.                                   
           EXEC SQL INCLUDE KSIM88T END-EXEC.                                   
           EXEC SQL INCLUDE KSIM8AT END-EXEC.                                   
           EXEC SQL INCLUDE KSIM9AT END-EXEC.                                   
           EXEC SQL INCLUDE KSIMA0T END-EXEC.                                   
           EXEC SQL INCLUDE KSIMA7T END-EXEC.                                   
           EXEC SQL INCLUDE KSIMB4T END-EXEC.                                   
           EXEC SQL INCLUDE KSIMB5T END-EXEC.                                   
           EXEC SQL INCLUDE KSIN11T END-EXEC.                                   
           EXEC SQL INCLUDE KSIN30T END-EXEC.                                   
           EXEC SQL INCLUDE KSIN31T END-EXEC.                                   
           EXEC SQL INCLUDE KSINSRT END-EXEC.                                   
           EXEC SQL INCLUDE KSITART END-EXEC.                                   
           EXEC SQL INCLUDE KSITCRT END-EXEC.                                   
           EXEC SQL INCLUDE KSITDPT END-EXEC.                                   
           EXEC SQL INCLUDE KSITPET END-EXEC.                                   
           EXEC SQL INCLUDE KSITRET END-EXEC.                                   
           EXEC SQL INCLUDE KSITRNT END-EXEC.                                   
           EXEC SQL INCLUDE KSVTBRT END-EXEC.                                   
           EXEC SQL INCLUDE KSVTCCT END-EXEC.                                   
           EXEC SQL INCLUDE KSVTCPT END-EXEC.                                   
           EXEC SQL INCLUDE KSVTRAT END-EXEC.                                   
           EXEC SQL INCLUDE KSVTRPT END-EXEC.                                   
           EXEC SQL INCLUDE KTOA49T END-EXEC.                                   
           EXEC SQL INCLUDE KTOM49T END-EXEC.                                   
           EXEC SQL INCLUDE KCIA43T END-EXEC.                                   
           EXEC SQL INCLUDE KCIA43H END-EXEC.                                   
                                                                                
      ************************************************************              
      * INCLUDES DE LAS TABLAS OPERATIVAS RECIBOS                               
      ************************************************************              
      *     ESTAS DEBEN ACCESARSE POR NUMERO DE RECIBO                          
           EXEC SQL INCLUDE KRBN50T END-EXEC.                                   
           EXEC SQL INCLUDE KRBA61T END-EXEC.                                   
           EXEC SQL INCLUDE KRBA62T END-EXEC.                                   
           EXEC SQL INCLUDE KRBA64T END-EXEC.                                   
           EXEC SQL INCLUDE KRBA66T END-EXEC.                                   
           EXEC SQL INCLUDE KRBA67T END-EXEC.                                   
           EXEC SQL INCLUDE KRBA68T END-EXEC.                                   
           EXEC SQL INCLUDE KRBMRRT END-EXEC.                                   
           EXEC SQL INCLUDE KRBA41T END-EXEC.                                   
      * INCLUDES DE LAS TABLAS OPERATIVAS COASEGURO                             
           EXEC SQL INCLUDE KCGM22T END-EXEC.                                   
           EXEC SQL INCLUDE KCGM23T END-EXEC.                                   
           EXEC SQL INCLUDE KCGM24T END-EXEC.                                   
           EXEC SQL INCLUDE KREM24T END-EXEC.                                   
           EXEC SQL INCLUDE KREM18T END-EXEC.                                   
           EXEC SQL INCLUDE KREMB9T END-EXEC.                                   
           EXEC SQL INCLUDE KCGM26T END-EXEC.                                   
           EXEC SQL INCLUDE KCGM15T END-EXEC.                                   
      *+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++          
      *+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++          
      ************************************************************              
      * INCLUDES DE LAS TABLAS HISTORICAS SINIESTROS                            
      ************************************************************              
           EXEC SQL INCLUDE KACA50H END-EXEC.                                   
           EXEC SQL INCLUDE KACA52H END-EXEC.                                   
           EXEC SQL INCLUDE KACA53H END-EXEC.                                   
           EXEC SQL INCLUDE KACA60H END-EXEC.                                   
           EXEC SQL INCLUDE KACA61H END-EXEC.                                   
           EXEC SQL INCLUDE KACA62H END-EXEC.                                   
           EXEC SQL INCLUDE KACA63H END-EXEC.                                   
           EXEC SQL INCLUDE KACA68H END-EXEC.                                   
           EXEC SQL INCLUDE KACA71H END-EXEC.                                   
           EXEC SQL INCLUDE KACM50H END-EXEC.                                   
           EXEC SQL INCLUDE KACM51H END-EXEC.                                   
           EXEC SQL INCLUDE KACM52H END-EXEC.                                   
           EXEC SQL INCLUDE KACM53H END-EXEC.                                   
           EXEC SQL INCLUDE KACM54H END-EXEC.                                   
           EXEC SQL INCLUDE KACM55H END-EXEC.                                   
           EXEC SQL INCLUDE KACM56H END-EXEC.                                   
           EXEC SQL INCLUDE KACM57H END-EXEC.                                   
           EXEC SQL INCLUDE KACM70H END-EXEC.                                   
           EXEC SQL INCLUDE KACM71H END-EXEC.                                   
           EXEC SQL INCLUDE KACM72H END-EXEC.                                   
           EXEC SQL INCLUDE KACM73H END-EXEC.                                   
           EXEC SQL INCLUDE KACN58H END-EXEC.                                   
           EXEC SQL INCLUDE KACTEIH END-EXEC.                                   
           EXEC SQL INCLUDE KACTEPH END-EXEC.                                   
           EXEC SQL INCLUDE KACTSAH END-EXEC.                                   
           EXEC SQL INCLUDE KCDARSH END-EXEC.                                   
           EXEC SQL INCLUDE KCITK3H END-EXEC.                                   
           EXEC SQL INCLUDE KCVTIBH END-EXEC.                                   
           EXEC SQL INCLUDE KREM44H END-EXEC.                                   
           EXEC SQL INCLUDE KREM48H END-EXEC.                                   
           EXEC SQL INCLUDE KREM49H END-EXEC.                                   
           EXEC SQL INCLUDE KRETASH END-EXEC.                                   
           EXEC SQL INCLUDE KRETSNH END-EXEC.                                   
           EXEC SQL INCLUDE KSIA04H END-EXEC.                                   
           EXEC SQL INCLUDE KSIA12H END-EXEC.                                   
           EXEC SQL INCLUDE KSIA1BH END-EXEC.                                   
           EXEC SQL INCLUDE KSIA22H END-EXEC.                                   
           EXEC SQL INCLUDE KSIA24H END-EXEC.                                   
           EXEC SQL INCLUDE KSIA25H END-EXEC.                                   
           EXEC SQL INCLUDE KSIA2BH END-EXEC.                                   
           EXEC SQL INCLUDE KSIA30H END-EXEC.                                   
           EXEC SQL INCLUDE KSIA3AH END-EXEC.                                   
           EXEC SQL INCLUDE KSIA3BH END-EXEC.                                   
           EXEC SQL INCLUDE KSIA4BH END-EXEC.                                   
           EXEC SQL INCLUDE KSIA5AH END-EXEC.                                   
           EXEC SQL INCLUDE KSIA6BH END-EXEC.                                   
           EXEC SQL INCLUDE KSIAW1H END-EXEC.                                   
           EXEC SQL INCLUDE KSIM12H END-EXEC.                                   
           EXEC SQL INCLUDE KSIM20H END-EXEC.                                   
           EXEC SQL INCLUDE KSIM30H END-EXEC.                                   
           EXEC SQL INCLUDE KSIM3AH END-EXEC.                                   
           EXEC SQL INCLUDE KSIM4AH END-EXEC.                                   
           EXEC SQL INCLUDE KSIM5AH END-EXEC.                                   
           EXEC SQL INCLUDE KSIM61H END-EXEC.                                   
           EXEC SQL INCLUDE KSIM62H END-EXEC.                                   
           EXEC SQL INCLUDE KSIM63H END-EXEC.                                   
           EXEC SQL INCLUDE KSIM64H END-EXEC.                                   
           EXEC SQL INCLUDE KSIM65H END-EXEC.                                   
           EXEC SQL INCLUDE KSIM66H END-EXEC.                                   
           EXEC SQL INCLUDE KSIM7AH END-EXEC.                                   
           EXEC SQL INCLUDE KSIM86H END-EXEC.                                   
           EXEC SQL INCLUDE KSIM87H END-EXEC.                                   
           EXEC SQL INCLUDE KSIM88H END-EXEC.                                   
           EXEC SQL INCLUDE KSIM8AH END-EXEC.                                   
           EXEC SQL INCLUDE KSIM9AH END-EXEC.                                   
           EXEC SQL INCLUDE KSIMA0H END-EXEC.                                   
           EXEC SQL INCLUDE KSIMA7H END-EXEC.                                   
           EXEC SQL INCLUDE KSIMB4H END-EXEC.                                   
           EXEC SQL INCLUDE KSIMB5H END-EXEC.                                   
           EXEC SQL INCLUDE KSIN11H END-EXEC.                                   
           EXEC SQL INCLUDE KSIN30H END-EXEC.                                   
           EXEC SQL INCLUDE KSIN31H END-EXEC.                                   
           EXEC SQL INCLUDE KSINSRH END-EXEC.                                   
           EXEC SQL INCLUDE KSITARH END-EXEC.                                   
           EXEC SQL INCLUDE KSITCRH END-EXEC.                                   
           EXEC SQL INCLUDE KSITDPH END-EXEC.                                   
           EXEC SQL INCLUDE KSITPEH END-EXEC.                                   
           EXEC SQL INCLUDE KSITREH END-EXEC.                                   
           EXEC SQL INCLUDE KSITRNH END-EXEC.                                   
           EXEC SQL INCLUDE KSVTBRH END-EXEC.                                   
           EXEC SQL INCLUDE KSVTCCH END-EXEC.                                   
           EXEC SQL INCLUDE KSVTCPH END-EXEC.                                   
           EXEC SQL INCLUDE KSVTRAH END-EXEC.                                   
           EXEC SQL INCLUDE KSVTRPH END-EXEC.                                   
           EXEC SQL INCLUDE KTOA49H END-EXEC.                                   
           EXEC SQL INCLUDE KTOM49H END-EXEC.                                   
      ************************************************************              
      * INCLUDES DE LAS TABLAS HISTORICAS RECIBOS                               
      ************************************************************              
      *    ACCESO POR NUMERO DE RECIBOS                                         
           EXEC SQL INCLUDE KRBN50H END-EXEC.                                   
           EXEC SQL INCLUDE KRBA61H END-EXEC.                                   
           EXEC SQL INCLUDE KRBA62H END-EXEC.                                   
           EXEC SQL INCLUDE KRBA64H END-EXEC.                                   
           EXEC SQL INCLUDE KRBA66H END-EXEC.                                   
           EXEC SQL INCLUDE KRBA67H END-EXEC.                                   
           EXEC SQL INCLUDE KRBA68H END-EXEC.                                   
           EXEC SQL INCLUDE KRBMRRH END-EXEC.                                   
           EXEC SQL INCLUDE KRBA41H END-EXEC.                                   
      * INCLUDES DE LAS TABLAS HISTORICAS COASEGURO                             
           EXEC SQL INCLUDE KCGM22H END-EXEC.                                   
           EXEC SQL INCLUDE KCGM23H END-EXEC.                                   
           EXEC SQL INCLUDE KCGM24H END-EXEC.                                   
           EXEC SQL INCLUDE KREM24H END-EXEC.                                   
           EXEC SQL INCLUDE KREMB9H END-EXEC.                                   
           EXEC SQL INCLUDE KCGM26H END-EXEC.                                   
           EXEC SQL INCLUDE KCGM15H END-EXEC.                                   
      *IBM-INI                                                                  
           EXEC SQL INCLUDE KSITRST END-EXEC.                                   
           EXEC SQL INCLUDE KSITRCT END-EXEC.                                   
      *IBM-FIN                                                                  
                                                                                
      ******************************************************************        
      *LINKAGE SECTION.                                                *        
      *VARIABLES DE COMUNICACION CON LOS PROGRAMAS QUE EFECTUAN        *        
      *LLAMADAS A ESTE SERVICIO.                                       *        
      ******************************************************************        
       LINKAGE SECTION.                                                         
       01  PARAM-ENT.                                                           
           05 REG-LON                PIC 9(04) COMP.                            
           05 REG-AMBIENTE           PIC X(4).                                  
           05 REG-FINAL              PIC 9(3).                                  
           05 REG-ESCR               PIC X(1).                                  
                                                                                
      ******************************************************************        
      *PROCEDURE DIVISION USING PARAM-IDA PARAM-VUELTA.                *        
      ******************************************************************        
       PROCEDURE DIVISION USING PARAM-ENT.                                      
       0000-PROCESO-PRINCIPAL.                                                  
                                                                                
           PERFORM 0100-INICIO                                                  
           PERFORM 1000-PROCESO                                                 
           PERFORM 9000-FINAL                                                   
           .                                                                    
       0000-PROCESO-PRINICPAL-EXIT.                                             
           EXIT.                                                                
                                                                                
      ******************************************************************        
      *0100-INICIO                                                     *        
      * -------------------------------------------------------------- *        
      *SE INVOCAN LOS PARRAFOS UTILIZADOS PARA INICIALIZACION DE       *        
      *VARIABLES, Y VALIDACION DE DATOS ENVIADOS A TRAVES DE LA        *        
      *ARQUITECTURA DE ENTRADA.                                        *        
      ******************************************************************        
       0100-INICIO.                                                             
                                                                                
           MOVE FUNCTION CURRENT-DATE (1:08) TO WS-FECHA-SISTEMA.               
           MOVE FUNCTION CURRENT-DATE (9:06) TO WS-HORA-SISTEMA.                
           MOVE WS-HORA    TO WS-HORAY                                          
           MOVE WS-MINUTO  TO WS-MINUTOY                                        
           MOVE WS-SEGUNDO TO WS-SEGUNDOY                                       
           STRING                                                               
              '===============================================' '\N'            
              ' NOMBRE DEL PROGRAMA  : ' WC-PROGRAMA            '\N'            
              '        INICIO A LAS  : ' WS-HORA-SYS            '\N'            
              '===============================================' '\N'            
           DELIMITED BY SIZE                                                    
           INTO WS-CIFRASCONTROL                                                
           CALL W-KMCLMCCB USING WS-CIFRASCONTROL                               
           PERFORM 0200-INICIALIZA                                              
              THRU 0200-INICIALIZA-EXIT.                                        
           EXEC SQL                                                             
               SAVEPOINT A ON ROLLBACK RETAIN CURSORS                           
           END-EXEC                                                             
           MOVE 'FETCH FIRST 1 ROWS ONLY' TO WS-ATTRVAR                         
           PERFORM 0260-OBTENER-FECHAS.                                         
           PERFORM 1210-DECLARA-CURSORES                                        
           .                                                                    
      ******************************************************************        
      * 0200-INICIALIZA.                                               *        
      * -------------------------------------------------------------- *        
      * INCIALIZACION DE VARIABLES UTILIZADAS PARA EL PROCESAMIENTO    *        
      * DE DATOS.                                                      *        
      ******************************************************************        
       0200-INICIALIZA.                                                         
                                                                                
           PERFORM 0210-APERTURA-ARCHIVOS                                       
              THRU 0210-APERTURA-ARCHIVOS-EXIT.                                 
           IF REG-ESCR = 'W'                                                    
              SET WS-WRITE       TO TRUE                                        
           ELSE                                                                 
              SET WS-NO-WRITE    TO TRUE                                        
           END-IF                                                               
           IF REG-ESCR = 'B'                                                    
              SET WS-BYPASS      TO TRUE                                        
           ELSE                                                                 
              SET WS-NO-BYPASS   TO TRUE                                        
           END-IF                                                               
           SET WS-NO-FIN-ARCHIVO TO TRUE.                                       
           SET WS-NO-FIN-ARCHIVO-A TO TRUE.                                     
                                                                                
           INITIALIZE KAELCWEZ                                                  
           REPLACING  ALPHANUMERIC DATA BY SPACES                               
                      NUMERIC      DATA BY ZERO.                                
                                                                                
           MOVE WC-PROGRAMA        TO CDSVCO  OF KAELCWEZ.                      
           MOVE WC-BATCH           TO CDUSUAR OF KAELCWEZ.                      
           MOVE WC-INDICADOR-BATCH TO INBO    OF KAELCWEZ.                      
                                                                                
JNB01      PERFORM 0280-OBTENER-PARAM-VALID.                                    
                                                                                
       0200-INICIALIZA-EXIT.                                                    
           EXIT.                                                                
                                                                                
                                                                                
                                                                                
      ******************************************************************        
      * 0210-APERTURA-ARCHIVOS                                         *        
      * -------------------------------------------------------------- *        
      ******************************************************************        
       0210-APERTURA-ARCHIVOS.                                                  
                                                                                
           OPEN INPUT KAHSIMUL                                                  
           IF  WS-STATSIMUL NOT = ZEROS                                         
               STRING                                                           
                '===============================================' '\N'          
                   ' ERROR AL ABRIR ARCH  :   KAHSIMUL '            '\N'        
                   ' ESTATUS DEL ARCHIVO  : ' WS-STATSIMUL          '\N'        
                '===============================================' '\N'          
               DELIMITED BY SIZE                                                
               INTO WS-CIFRASCONTROL                                            
               CALL W-KMCLMCCB USING WS-CIFRASCONTROL                           
               MOVE WC-COD                   TO CDERR    OF KAELCWEZ            
               MOVE WC-DES02                 TO DSARGU1  OF KAELCWEZ            
               MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ            
               MOVE WS-STATSIMUL             TO DSARGU3  OF KAELCWEZ            
               MOVE '0210-APERTURA-ARCHIVOS' TO CDPARRAF OF KAELCWEZ            
                                                                                
               PERFORM 9999-GESTION-ERRORES                                     
                                                                                
                                                                                
           END-IF.                                                              
                                                                                
                                                                                
           OPEN OUTPUT ERPOLIZA                                                 
           IF  WS-ERPOLIZA NOT = ZEROS                                          
               STRING                                                           
                '===============================================' '\N'          
                   ' ERROR AL ABRIR ARCH  :   ERPOLIZA '            '\N'        
                   ' ESTATUS DEL ARCHIVO  : ' WS-ERPOLIZA           '\N'        
                '===============================================' '\N'          
               DELIMITED BY SIZE                                                
               INTO WS-CIFRASCONTROL                                            
               CALL W-KMCLMCCB USING WS-CIFRASCONTROL                           
               MOVE WC-COD                   TO CDERR    OF KAELCWEZ            
               MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ            
               MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ            
               MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ            
               MOVE '0210-APERTURA-ARCHIVOS' TO CDPARRAF OF KAELCWEZ            
                                                                                
               PERFORM 9999-GESTION-ERRORES                                     
                                                                                
                                                                                
           END-IF.                                                              
                                                                                
           SET WS-NO-FIN-ARCHIVO-A TO TRUE.                                     
                                                                                
       0210-APERTURA-ARCHIVOS-EXIT.                                             
           EXIT.                                                                
                                                                                
      *****************************************************************         
      * OBTIENE EL NUMERO DE REGISTROS A PROCESAR PARA FINALIZAR LA  *          
      * EJECUCION DEL PROGRAMA                                       *          
      *****************************************************************         
       0250-OBTEN-FINALIZA.                                                     
           EXEC SQL                                                             
                SELECT   TVUMSTRP                                               
                 INTO  :KAHTPET.TVUMSTRP                                        
                  FROM KAHTPET                                                  
                 WHERE LINEGOCO = "LI"                                          
                WITH UR                                                         
           END-EXEC.                                                            
              EVALUATE SQLCODE                                                  
                 WHEN WN-SQLCODE-OK                                             
                      MOVE TVUMSTRP OF KAHTPET TO WS-TVUMSTRP-LI                
                      SET WS-NO-FINAL TO TRUE                                   
                 WHEN WN-SQLCODE-NOT-FOUND                                      
                      MOVE 5                   TO WS-TVUMSTRP-LI                
                      SET WS-NO-FINAL TO TRUE                                   
                 WHEN OTHER                                                     
                   MOVE 0 TO WS-TVUMSTRP-LI                                     
                   MOVE SQLCODE TO WS-NUM-SQLCODE                               
                   STRING                                                       
                 '===============================================' '\N'         
                   ' ERROR KAHTPET CON LI : ' WS-NUM-SQLCODE        '\N'        
                 '===============================================' '\N'         
                   DELIMITED BY SIZE                                            
                   INTO WS-CIFRASCONTROL                                        
                   CALL W-KMCLMCCB USING WS-CIFRASCONTROL                       
                      MOVE "0250-OBTEN-FINALIZA"                                
                                             TO CDPARRAF OF KAELCWEZ            
                      MOVE WC-ERROR-EN-SQL   TO CDERR    OF KAELCWEZ            
                      MOVE "TABLA KAHTPET"   TO DSARGU1  OF KAELCWEZ            
                      MOVE "SELECT"          TO DSARGU2  OF KAELCWEZ            
                      MOVE SQLCODE           TO DSARGU3  OF KAELCWEZ            
                      PERFORM 9999-GESTION-ERRORES                              
              END-EVALUATE.                                                     
      *****************************************************************         
      * 260-OBTENER-FECHAS                                           *          
      *****************************************************************         
       0260-OBTENER-FECHAS.                                                     
           EXEC SQL                                                             
                SELECT                                                          
                DEC(SUBSTR(CHAR(FECPROC - TVUMSTRP MONTHS),7,4)]]               
                    SUBSTR(CHAR(FECPROC - TVUMSTRP MONTHS),4,2)]]               
                    "01"),                                                      
                DEC(SUBSTR(CHAR(FECPROC - TCANTU MONTHS),7,4)]]                 
                    SUBSTR(CHAR(FECPROC - TCANTU MONTHS),4,2)]]                 
                    "01"),                                                      
                DEC(SUBSTR(CHAR(FECPROC - TDEPHIST MONTHS),7,4)]]               
                    SUBSTR(CHAR(FECPROC - TDEPHIST MONTHS),4,2)]]               
                    "01"),                                                      
                    FECPROC, TVUMSTRP, TCANTU, TDEPHIST                         
                 INTO  :WS-FECHA-VIG-AP,                                        
                       :WS-FECHA-NTU-AP,                                        
                       :WS-FECHA-LIQ-AP,                                        
                       :WS-FECPROC-AP,                                          
                       :WS-TVUMSTRP-AP,                                         
                       :WS-TCANTU-AP,                                           
                       :WS-TDEPHIST-AP                                          
                  FROM KAHTPET A                                                
                 WHERE LINEGOCO = "AP"                                          
                WITH UR                                                         
           END-EXEC.                                                            
              EVALUATE SQLCODE                                                  
                 WHEN WN-SQLCODE-OK                                             
                      CONTINUE                                                  
                 WHEN OTHER                                                     
                      MOVE "1300-OBTENER-FECHAS"                                
                                             TO CDPARRAF OF KAELCWEZ            
                      MOVE WC-ERROR-EN-SQL   TO CDERR    OF KAELCWEZ            
                      MOVE "TABLA KAHTPET"   TO DSARGU1  OF KAELCWEZ            
                      MOVE "SELECT"          TO DSARGU2  OF KAELCWEZ            
                      MOVE SQLCODE           TO DSARGU3  OF KAELCWEZ            
                      PERFORM 9999-GESTION-ERRORES                              
              END-EVALUATE.                                                     
                                                                                
           EXEC SQL                                                             
                SELECT                                                          
                DEC(SUBSTR(CHAR(FECPROC - TVUMSTRP MONTHS),7,4)]]               
                    SUBSTR(CHAR(FECPROC - TVUMSTRP MONTHS),4,2)]]               
                    "01"),                                                      
                DEC(SUBSTR(CHAR(FECPROC - TCANTU MONTHS),7,4)]]                 
                    SUBSTR(CHAR(FECPROC - TCANTU MONTHS),4,2)]]                 
                    "01"),                                                      
                DEC(SUBSTR(CHAR(FECPROC - TDEPHIST MONTHS),7,4)]]               
                    SUBSTR(CHAR(FECPROC - TDEPHIST MONTHS),4,2)]]               
                    "01"),                                                      
                    FECPROC, TVUMSTRP, TCANTU, TDEPHIST                         
                  INTO :WS-FECHA-VIG-SP,                                        
                       :WS-FECHA-NTU-SP,                                        
                       :WS-FECHA-LIQ-SP,                                        
                       :WS-FECPROC-SP,                                          
                       :WS-TVUMSTRP-SP,                                         
                       :WS-TCANTU-SP,                                           
                       :WS-TDEPHIST-SP                                          
                  FROM KAHTPET                                                  
                 WHERE LINEGOCO = "SP"                                          
                WITH UR                                                         
           END-EXEC.                                                            
                                                                                
              EVALUATE SQLCODE                                                  
                 WHEN WN-SQLCODE-OK                                             
                      CONTINUE                                                  
                 WHEN OTHER                                                     
                      MOVE "1300-OBTENER-FECHAS"                                
                                             TO CDPARRAF OF KAELCWEZ            
                      MOVE WC-ERROR-EN-SQL   TO CDERR    OF KAELCWEZ            
                      MOVE "TABLA KAHTPET"   TO DSARGU1  OF KAELCWEZ            
                      MOVE "SELECT"          TO DSARGU2  OF KAELCWEZ            
                      MOVE SQLCODE           TO DSARGU3  OF KAELCWEZ            
                      PERFORM 9999-GESTION-ERRORES                              
              END-EVALUATE.                                                     
                                                                                
           EXEC SQL                                                             
                SELECT                                                          
                DEC(SUBSTR(CHAR(FECPROC - TVUMSTRP MONTHS),7,4)]]               
                    SUBSTR(CHAR(FECPROC - TVUMSTRP MONTHS),4,2)]]               
                    "01"),                                                      
                DEC(SUBSTR(CHAR(FECPROC - TCANTU MONTHS),7,4)]]                 
                    SUBSTR(CHAR(FECPROC - TCANTU MONTHS),4,2)]]                 
                    "01"),                                                      
                DEC(SUBSTR(CHAR(FECPROC - TDEPHIST MONTHS),7,4)]]               
                    SUBSTR(CHAR(FECPROC - TDEPHIST MONTHS),4,2)]]               
                    "01"),                                                      
                    FECPROC, TVUMSTRP, TCANTU, TDEPHIST                         
                  INTO :WS-FECHA-VIG-DA,                                        
                       :WS-FECHA-NTU-DA,                                        
                       :WS-FECHA-LIQ-DA,                                        
                       :WS-FECPROC-DA,                                          
                       :WS-TVUMSTRP-DA,                                         
                       :WS-TCANTU-DA,                                           
                       :WS-TDEPHIST-DA                                          
                  FROM KAHTPET                                                  
                 WHERE LINEGOCO = "DA"                                          
                WITH UR                                                         
           END-EXEC.                                                            
                                                                                
              EVALUATE SQLCODE                                                  
                 WHEN WN-SQLCODE-OK                                             
                      CONTINUE                                                  
                 WHEN OTHER                                                     
                      MOVE "1300-OBTENER-FECHAS"                                
                                             TO CDPARRAF OF KAELCWEZ            
                      MOVE WC-ERROR-EN-SQL   TO CDERR    OF KAELCWEZ            
                      MOVE "TABLA KAHTPET"   TO DSARGU1  OF KAELCWEZ            
                      MOVE "SELECT"          TO DSARGU2  OF KAELCWEZ            
                      MOVE SQLCODE           TO DSARGU3  OF KAELCWEZ            
                      PERFORM 9999-GESTION-ERRORES                              
              END-EVALUATE.                                                     
                                                                                
035500     CALL WC-RUT-RECUP-FECHA USING KAELCR11                               
035600     END-CALL                                                             
035700*                                                                         
035800     MOVE FECHA-EST2      TO WS-FECHA-PROCESO.                            
035800     MOVE WS-ANIO-PROCESO TO WS-ANIO-BATCH.                               
035800     MOVE WS-MESS-PROCESO TO WS-MESS-BATCH.                               
035800     MOVE WS-DIAS-PROCESO TO WS-DIAS-BATCH.                               
JNB01 *****************************************************************         
      * 280-OBTENER-PARAMETRO DE VALIDACION                          *          
      *****************************************************************         
       0280-OBTENER-PARAM-VALID.                                                
           EXEC SQL                                                             
                SELECT                                                          
                     TCANTU                                                     
                 INTO  :WS-TCANTU-VA                                            
                  FROM KAHTPET A                                                
                 WHERE LINEGOCO = "HI"                                          
                 AND   TVUMSTRP = 1                                             
                WITH UR                                                         
           END-EXEC.                                                            
              EVALUATE SQLCODE                                                  
                 WHEN WN-SQLCODE-OK                                             
                      CONTINUE                                                  
                 WHEN OTHER                                                     
                      MOVE "0280-OBTENER-PARAM-VALID"                           
                                             TO CDPARRAF OF KAELCWEZ            
                      MOVE WC-ERROR-EN-SQL   TO CDERR    OF KAELCWEZ            
                      MOVE "TABLA KAHTPET"   TO DSARGU1  OF KAELCWEZ            
                      MOVE "SELECT"          TO DSARGU2  OF KAELCWEZ            
                      MOVE SQLCODE           TO DSARGU3  OF KAELCWEZ            
                      PERFORM 9999-GESTION-ERRORES                              
              END-EVALUATE.                                                     
      ******************************************************************        
      * LEE EL SIGUIENTE REGISTRO DEL ARCHIVO SECUENCIAL .             *        
      ******************************************************************        
       1100-LEE-KAHSIMUL.                                                       
                                                                                
           INITIALIZE WS-REG-ENTRADA.                                           
           READ KAHSIMUL INTO WS-REG-ENTRADA                                    
           AT END                                                               
              SET WS-FIN-ARCHIVO TO TRUE.                                       
           IF  WS-STATSIMUL = ZEROS                                             
              ADD WC-1 TO  WS-CONT-LEIDOS WS-CONT-FINALIZA                      
              PERFORM 1200-MUEVE-FECHAS                                         
              IF WS-CONT-FINALIZA = REG-FINAL                                   
                 PERFORM 0250-OBTEN-FINALIZA                                    
                 IF WS-TVUMSTRP-LI <= WS-CONT-FINALIZA                          
                    MOVE 0 TO WS-CONT-FINALIZA                                  
                 ELSE                                                           
                   SUBTRACT WS-CONT-FINALIZA FROM WS-TVUMSTRP-LI                
                   GIVING WS-RESTO-LI                                           
                   STRING                                                       
                 '-----------------------------------------------' '\N'         
                   ' DETENER PROC EN  ' WS-RESTO-LI ' POLIZAS'     '\N'         
                 '-----------------------------------------------' '\N'         
                   DELIMITED BY SIZE                                            
                   INTO WS-CIFRASCONTROL                                        
                   CALL W-KMCLMCCB USING WS-CIFRASCONTROL                       
                    SET WS-FINAL TO TRUE                                        
                 END-IF                                                         
              END-IF                                                            
           ELSE                                                                 
              IF  WS-STATSIMUL = WC-10                                          
                  CONTINUE                                                      
              ELSE                                                              
                    MOVE WC-COD         TO CDERR    OF KAELCWEZ                 
                    MOVE WC-DES04       TO DSARGU1  OF KAELCWEZ                 
                    MOVE WC-PROGRAMA    TO DSARGU2  OF KAELCWEZ                 
                    MOVE 'LEE -ARCHIVO' TO DSARGU3  OF KAELCWEZ                 
                    MOVE '1100-LEE-KAHSIMUL' TO CDPARRAF OF KAELCWEZ            
                    PERFORM 9999-GESTION-ERRORES                                
                                                                                
              END-IF                                                            
           END-IF.                                                              
                                                                                
      *****************************************************************         
      * 1200-MUEVE-FECHAS                                             *         
      *****************************************************************         
       1200-MUEVE-FECHAS.                                                       
                                                                                
           EVALUATE WS-LEE-CDCIAGRU OF WS-REG-ENTRADA                           
               WHEN "AU"                                                        
                   ADD 1                     TO WS-REG-AU                       
                   MOVE WS-FECHA-VIG-AP      TO WS-FECVIG                       
                   MOVE WS-FECHA-NTU-AP      TO WS-FECNTU                       
                   MOVE WS-FECHA-LIQ-AP      TO WS-FNTULIQ                      
                   MOVE WS-FECPROC-AP        TO WS-FECPROC                      
                   MOVE WS-TVUMSTRP-AP       TO WS-TVUMSTRP                     
                   MOVE WS-TCANTU-AP         TO WS-TCANTU                       
                   MOVE WS-TDEPHIST-AP       TO WS-TDEPHIST                     
               WHEN "DA"                                                        
                   ADD 1                     TO WS-REG-DA                       
                   MOVE WS-FECHA-VIG-DA      TO WS-FECVIG                       
                   MOVE WS-FECHA-NTU-DA      TO WS-FECNTU                       
                   MOVE WS-FECHA-LIQ-DA      TO WS-FNTULIQ                      
                   MOVE WS-FECPROC-DA        TO WS-FECPROC                      
                   MOVE WS-TVUMSTRP-DA       TO WS-TVUMSTRP                     
                   MOVE WS-TCANTU-DA         TO WS-TCANTU                       
                   MOVE WS-TDEPHIST-DA       TO WS-TDEPHIST                     
               WHEN "SA"                                                        
                   ADD 1                     TO WS-REG-SA                       
                   MOVE WS-FECHA-VIG-SP      TO WS-FECVIG                       
                   MOVE WS-FECHA-NTU-SP      TO WS-FECNTU                       
                   MOVE WS-FECHA-LIQ-SP      TO WS-FNTULIQ                      
                   MOVE WS-FECPROC-SP        TO WS-FECPROC                      
                   MOVE WS-TVUMSTRP-SP       TO WS-TVUMSTRP                     
                   MOVE WS-TCANTU-SP         TO WS-TCANTU                       
                   MOVE WS-TDEPHIST-SP       TO WS-TDEPHIST                     
           END-EVALUATE.                                                        
                                                                                
                MOVE WS-FECPROC(1:2) TO WS-DIAS-PROC                            
                MOVE WS-FECPROC(4:2) TO WS-MESS-PROC                            
                MOVE WS-FECPROC(7:4) TO WS-ANIO-PROC                            
           .                                                                    
      ******************************************************************        
      * 1000-PROCESO.                                                  *        
      * -------------------------------------------------------------  *        
      *SE LLEVA A CABO LA LECTURA DE LOS REGISTROS OBTENIDOS, DE VALI- *        
      *DAN LAS POLIZAS Y FINALMENTE SE PROCESA EL HISTORICO A TABLAS   *        
      *NUEVAS.                                                                  
      ******************************************************************        
       1000-PROCESO.                                                            
           PERFORM 1100-LEE-KAHSIMUL                                            
           PERFORM UNTIL  WS-FIN-ARCHIVO OR (WS-FINAL AND                       
                          WS-CONT-FINALIZA = WS-TVUMSTRP-LI)                    
            PERFORM 1110-VALIDA-KCIM06T                                         
            IF WS-POLIZA-VALIDA                                                 
********************                                                            
JNB01         IF WS-TCANTU-VA = 0                                               
JNB01           MOVE WC-1  TO WS-I-TBLS                                         
JNB01           PERFORM 1500-INSERTA-EN-TABLAS                                  
JNB01         ELSE                                                              
********************                                                            
                PERFORM 1200-CHECA-SINIESTROS                                   
                IF WS-SINIESTRO-VALIDO                                          
                   PERFORM 1300-CHECA-RECIBOS                                   
                   MOVE WC-1  TO WS-I-TBLS                                      
                   IF WS-RECIBO-VALIDO                                          
                      PERFORM 1500-INSERTA-EN-TABLAS                            
                   END-IF                                                       
                END-IF                                                          
JNB01         END-IF                                                            
            ELSE                                                                
              PERFORM 1570-ESCRIBE-DESCARTADA                                   
            END-IF                                                              
ALPTER      IF SW-TERMINA = 1                                                   
ALPTER        SET WS-FIN-ARCHIVO TO TRUE                                        
           STRING                                                               
           ' TERMINA X SW TERMINA : ' WS-LEE-CDNUMPOL       '\N'                
           DELIMITED BY SIZE                                                    
           INTO WS-CIFRASCONTROL                                                
           CALL W-KMCLMCCB USING WS-CIFRASCONTROL                               
ALPTER        ELSE                                                              
           STRING                                                               
           ' CONTINUA LEER        : ' WS-LEE-CDNUMPOL       '\N'                
           DELIMITED BY SIZE                                                    
           INTO WS-CIFRASCONTROL                                                
           CALL W-KMCLMCCB USING WS-CIFRASCONTROL                               
ALPTEO        PERFORM 1100-LEE-KAHSIMUL                                         
ALPTEO      END-IF                                                              
           END-PERFORM                                                          
           .                                                                    
       1000-PROCESO-EXIT.                                                       
           EXIT.                                                                
                                                                                
      *****************************************************************         
      * SE LEE LA TABLA KCIM06T PARA REALIZAR LA PRIMERA VALIDACIlN             
      * QUE SEAN NTU'S CON FECHA VALIDA O QUE SEAN VIGENTES, QUE SEA UNA        
      * POLIZA PERSONAL Y QUE NO SEA CASH FLOW                                  
      *****************************************************************         
       1110-VALIDA-KCIM06T.                                                     
           MOVE WS-LEE-CDNUMPOL TO CDNUMPOL OF KCIM06T                          
           MOVE WS-FECVIG       TO FEFINEFE OF KCIM06T                          
           MOVE WS-FECNTU       TO FEEFTOMO OF KCIM06T                          
           EXEC SQL                                                             
            SELECT                                                              
            CDNUMPOL,CDCIAGRU,FEFINEFE,FEEFTOMO,CDNUMCON,CDPOLPAD,              
            CLFILTOM,TCTIMOVP,TCMOMOVP                                          
            INTO :KCIM06T.CDNUMPOL,:KCIM06T.CDCIAGRU,:KCIM06T.FEFINEFE,         
            :KCIM06T.FEEFTOMO,:KCIM06T.CDNUMCON,:KCIM06T.CDPOLPAD,              
            :KCIM06T.CLFILTOM,:KCIM06T.TCTIMOVP,:KCIM06T.TCMOMOVP               
            FROM KCIM06T                                                        
            WHERE ( (     FEEFTOMO <= :KCIM06T.FEEFTOMO                         
                      AND TCTIMOVP  = "3"                                       
                      AND TCMOMOVP  = "105")                                    
                   OR(    FEFINEFE < :KCIM06T.FEFINEFE                          
                      AND FEEFTOMO < :KCIM06T.FEFINEFE)                         
                  )                                                             
              AND CDNUMCON = " "                                                
              AND CDNUMPOL = :KCIM06T.CDNUMPOL                                  
              AND INULTSIT = "U"                                                
              AND CDPRODTE NOT IN("G0300ESP","D0000COAST","G0300CFLOW")         
              WITH UR                                                           
           END-EXEC                                                             
           SET WS-FILTRO-1 TO TRUE                                              
           EVALUATE SQLCODE                                                     
             WHEN  WN-SQLCODE-OK                                                
                   SET WS-POLIZA-VALIDA TO TRUE                                 
             WHEN  WN-SQLCODE-MAS-DE-UNA-FILA                                   
                   SET WS-NO-POLIZA-VALIDA    TO TRUE                           
                   MOVE SQLCODE               TO WS-OUT-SQLCODE                 
                   MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
                   MOVE 'KCIM06T'             TO WS-OUT-TABLA                   
                   MOVE '1110-VALIDA-KCIM06F1' TO WS-OUT-PARRAFO                
                   MOVE 'TABLA  INCONGRUENTE' TO WS-OUT-DESC                    
             WHEN  WN-SQLCODE-NOT-FOUND                                         
                   SET WS-NO-POLIZA-VALIDA    TO TRUE                           
                   MOVE SQLCODE               TO WS-OUT-SQLCODE                 
                   MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
                   MOVE 'KCIM06T'             TO WS-OUT-TABLA                   
                   MOVE '1110-VALIDA-KCIM06F1' TO WS-OUT-PARRAFO                
                   MOVE 'POLIZA NO CORRECTA' TO WS-OUT-DESC                     
             WHEN OTHER                                                         
                   SET WS-NO-POLIZA-VALIDA TO TRUE                              
                   MOVE SQLCODE               TO WS-OUT-SQLCODE                 
                   MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
                   MOVE 'KCIM06T'             TO WS-OUT-TABLA                   
                   MOVE '1110-VALIDA-KCIM06F1' TO WS-OUT-PARRAFO                
                   MOVE 'TABLA PROBLEMA     ' TO WS-OUT-DESC                    
           END-EVALUATE.                                                        
ALPHIS*                                                                         
ALPHIS*    VALIDA KREM24T Y KREM18T                                             
ALPHIS*                                                                         
ALPHIS     MOVE ' ' TO WS-SAL-REAS.                                             
ALPHIS*    MOVE WS-LEE-CDCIAGRU.             TO WS-CDCIAGRU-RS                  
ALPHIS*    EXEC SQL                                                             
ALPHIS*       SELECT INPROREG  INTO                                             
ALPHIS*          :WS-INPROREG                                                   
ALPHIS*         FROM KREM18T                                                    
ALPHIS*               WHERE INPROREG = :WS-INPROREG1    AND                     
ALPHIS*                     FEPROREA > :WS-FEPROREA     AND                     
ALPHIS*                     CDCIAGRU = :WS-CDCIAGRU-RS  AND                     
ALPHIS*                     CDNUMPOL = :KCIM06T.CDNUMPOL                        
ALPHIS*         WITH UR                                                         
ALPHIS*    END-EXEC                                                             
ALPHIS*    EVALUATE SQLCODE                                                     
ALPHIS*       WHEN 0                                                            
ALPHIS*            MOVE 'X' TO WS-SAL-REAS                                      
ALPHIS*            SET WS-NO-POLIZA-VALIDA    TO TRUE                           
ALPHIS*            MOVE SQLCODE               TO WS-OUT-SQLCODE                 
ALPHIS*            MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
ALPHIS*            MOVE 'KREM18T'             TO WS-OUT-TABLA                   
ALPHIS*            MOVE '1110-VALIDA-KCIM06F1' TO WS-OUT-PARRAFO                
ALPHIS*            MOVE 'TABLA  INCONGRUENTE' TO WS-OUT-DESC                    
ALPHIS*       WHEN -811                                                         
ALPHIS*            MOVE 'X' TO WS-SAL-REAS                                      
ALPHIS*            SET WS-NO-POLIZA-VALIDA    TO TRUE                           
ALPHIS*            MOVE SQLCODE               TO WS-OUT-SQLCODE                 
ALPHIS*            MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
ALPHIS*            MOVE 'KREM18T'             TO WS-OUT-TABLA                   
ALPHIS*            MOVE '1110-VALIDA-KCIM06F1' TO WS-OUT-PARRAFO                
ALPHIS*            MOVE 'TABLA  INCONGRUENTE' TO WS-OUT-DESC                    
ALPHIS*       WHEN 100                                                          
ALPHIS*           MOVE SPACES TO WS-SAL-REAS                                    
ALPHIS*       WHEN OTHER                                                        
ALPHIS*            MOVE "21110-VALIDA-KCIM06T   "                               
ALPHIS*                                  TO CDPARRAF OF KAELCWEZ                
ALPHIS*            MOVE WC-ERROR-EN-SQL   TO CDERR    OF KAELCWEZ               
ALPHIS*            MOVE "TABLA KREM18T"   TO DSARGU1  OF KAELCWEZ               
ALPHIS*            MOVE "SELECT"          TO DSARGU2  OF KAELCWEZ               
ALPHIS*            MOVE SQLCODE           TO DSARGU3  OF KAELCWEZ               
ALPHIS*            PERFORM 9999-GESTION-ERRORES                                 
ALPHIS*    END-EVALUATE.                                                        
ALPHIS*                                                                         
ALPHIS*    EXEC SQL                                                             
ALPHIS*       SELECT INPROREG  INTO                                             
ALPHIS*          :WS-INPROREG                                                   
ALPHIS*         FROM KREM24T                                                    
ALPHIS*               WHERE INPROREG = :WS-INPROREG1    AND                     
ALPHIS*                     FEMOVIMI > :WS-FEMOVIMI     AND                     
ALPHIS*                     CDCIAGRU = :WS-CDCIAGRU-RS  AND                     
ALPHIS*                     CDNUMPOL = :KCIM06T.CDNUMPOL                        
ALPHIS*         WITH UR                                                         
ALPHIS*    END-EXEC                                                             
ALPHIS*    EVALUATE SQLCODE                                                     
ALPHIS*       WHEN 0                                                            
ALPHIS*            MOVE 'X' TO WS-SAL-REAS                                      
ALPHIS*            SET WS-NO-POLIZA-VALIDA    TO TRUE                           
ALPHIS*            MOVE SQLCODE               TO WS-OUT-SQLCODE                 
ALPHIS*            MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
ALPHIS*            MOVE 'KREM24T'             TO WS-OUT-TABLA                   
ALPHIS*            MOVE '1110-VALIDA-KCIM06F1' TO WS-OUT-PARRAFO                
ALPHIS*            MOVE 'TABLA  INCONGRUENTE' TO WS-OUT-DESC                    
ALPHIS*       WHEN -811                                                         
ALPHIS*            MOVE 'X' TO WS-SAL-REAS                                      
ALPHIS*            SET WS-NO-POLIZA-VALIDA    TO TRUE                           
ALPHIS*            MOVE SQLCODE               TO WS-OUT-SQLCODE                 
ALPHIS*            MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
ALPHIS*            MOVE 'KREM24T'             TO WS-OUT-TABLA                   
ALPHIS*            MOVE '1110-VALIDA-KCIM06F1' TO WS-OUT-PARRAFO                
ALPHIS*            MOVE 'TABLA  INCONGRUENTE' TO WS-OUT-DESC                    
ALPHIS*       WHEN 100                                                          
ALPHIS*           MOVE SPACES TO WS-SAL-REAS                                    
ALPHIS*       WHEN OTHER                                                        
ALPHIS*            MOVE "1110-VALIDA-KCIM06T    "                               
ALPHIS*                                  TO CDPARRAF OF KAELCWEZ                
ALPHIS*            MOVE WC-ERROR-EN-SQL   TO CDERR    OF KAELCWEZ               
ALPHIS*            MOVE "TABLA KREM24T"   TO DSARGU1  OF KAELCWEZ               
ALPHIS*            MOVE "SELECT"          TO DSARGU2  OF KAELCWEZ               
ALPHIS*            MOVE SQLCODE           TO DSARGU3  OF KAELCWEZ               
ALPHIS*            PERFORM 9999-GESTION-ERRORES                                 
ALPHIS*    END-EVALUATE.                                                        
ALPHIS*                                                                         
      ***************************************************************           
      *DECLARA, ABRE Y ACCESA SINIESTROS PARA VALIDAR SU CONTINUIDAD*           
      ***************************************************************           
       1200-CHECA-SINIESTROS.                                                   
      *                                                                         
                MOVE WS-LEE-CDNUMPOL TO CDNUMPOL OF KSIM10T                     
                PERFORM 1220-ABRE-CUR-SINIES                                    
                MOVE '  ' TO WS-INDSALV                                         
                MOVE 0   TO WS-NUM-SINIES                                       
                SET WS-NO-SINIESTRO-VALIDO TO TRUE                              
FLSIN1          PERFORM 1240-LEE-CUR-SINIES                                     
                PERFORM UNTIL WS-NO-HAY-SINIESTROS                              
                          OR WS-INDSALV = 'NP'                                  
                  IF TCSITSIN OF KSIM10T = 'T'                                  
                     IF FETERMIN OF KSIM10T < WS-FECVIG                         
                         IF INSALVAM OF KSIM10T NOT = 'S'                       
                         AND WS-INDSALV  NOT = 'SP'                             
                            MOVE 'NO' TO WS-INDSALV                             
                         ELSE                                                   
                          IF INSALVAM OF KSIM10T = 'S'                          
                            IF WS-INDSALV NOT = 'SP'                            
                               MOVE 'SI' TO WS-INDSALV                          
                            END-IF                                              
                            PERFORM 1270-CHECA-KSIN30T                          
                            IF WS-HAY-KSIN30T                                   
                              MOVE 'SP' TO WS-INDSALV                           
                            ELSE                                                
                              MOVE 'NP' TO WS-INDSALV                           
                            END-IF                                              
                          END-IF                                                
                         END-IF                                                 
                     ELSE                                                       
                         MOVE 'NP'         TO WS-INDSALV                        
                         MOVE '1200-CHECA-SINIESTF2' TO WS-OUT-PARRAFO          
                         MOVE 'FETERMIN<FECVIG;SIN:'                            
                                           TO WS-OUT-DESC(1:20)                 
                         MOVE WS-TBL-SINOREC(1:10)                              
                                           TO WS-OUT-DESC(21:20)                
                     END-IF                                                     
                  ELSE                                                          
      *IBM-INI                                                                  
BAHA  *              ADD WC-1              TO WS-CANT-ERRORES                   
      *IBM-FIN                                                                  
                     MOVE '1200-CHECA-SINIESTF4' TO WS-OUT-PARRAFO              
                     MOVE 'TCSITSIN NOT=T;SIN:'                                 
                                           TO WS-OUT-DESC(1:19)                 
                              MOVE WS-TBL-SINOREC(1:10)                         
                                           TO WS-OUT-DESC(21:20)                
                     MOVE 'NP'             TO WS-INDSALV                        
                  END-IF                                                        
      *IBM-INI                                                                  
      *           IF WS-CANT-ERRORES = 0                                        
      *              LEER TABLA KSITRST                                         
      *              PERFORM 3100-CONSULTA-KSITRST                              
      *              IF WS-EXISTE-KSITRST                                       
      *                 LEER TABLA KSITRCT                                      
      *                 PERFORM 3200-CONSULTA-KSITRCT                           
      *                 IF WS-NO-EXISTE-KSITRCT                                 
      *              SI NO EXISTE EN LA TABLA SE MANDA A DESCARTADAS            
      *                    SET WS-NO-POLIZA-VALIDA TO TRUE                      
      *                    MOVE SQLCODE            TO WS-OUT-SQLCODE            
      *                    MOVE WS-LEE-CDNUMPOL    TO WS-OUT-POLIZA             
      *                    MOVE 'KSITRCT'          TO WS-OUT-TABLA              
      *                    MOVE '3000-COPIA-SINIESTRO'                          
      *                                            TO WS-OUT-PARRAFO            
      *                    MOVE 'SIN NO EXIS KSITRCT'                           
      *                                            TO WS-OUT-DESC               
      *                    PERFORM 1570-ESCRIBE-DESCARTADA                      
      *                 ELSE                                                    
      *                 SI EXISTE EN LA TABLA KSITRCT Y CDTIPREC = A            
      *                 SE HISTORIFICA                                          
      *                    IF CDTIPREC OF KSITRCT = WC-A                        
BAHA  *                    SE HISTORIFICA                                       
      *                       PERFORM 3300-INICIA-HISTORIFICA                   
      *                    ELSE                                                 
      *SE VALIDA LA FECHA DE ROBO                                               
BAHA  *                       PERFORM 3300-VALIDA-FECHA-ROBO                    
AQUI  *                       IF WS-SI-HISTORIFICA                              
      *                          PERFORM 3300-INICIA-HISTORIFICA                
      *                       ELSE                                              
      *                          RECHAZAR (MANDAR A DESCRTADAS)                 
      *                        SET WS-NO-POLIZA-VALIDA TO TRUE                  
      *                        MOVE SQLCODE          TO WS-OUT-SQLCODE          
      *                        MOVE WS-LEE-CDNUMPOL  TO WS-OUT-POLIZA           
      *                        MOVE 'KSITRCT'        TO WS-OUT-TABLA            
      *                        MOVE '3000-COPIA-SINIESTRO'                      
      *                                              TO WS-OUT-PARRAFO          
      *                        MOVE 'SIN NO EXIS KSITRCT'                       
      *                                              TO WS-OUT-DESC             
      *                        PERFORM 1570-ESCRIBE-DESCARTADA                  
      *                       END-IF                                            
      *                    END-IF                                               
      *                 END-IF                                                  
      *              END-IF                                                     
      *           END-IF                                                        
      *IBM-FIN                                                                  
                  IF WS-INDSALV NOT = 'NP'                                      
FLSIN2               PERFORM 1240-LEE-CUR-SINIES                                
                  END-IF                                                        
                END-PERFORM                                                     
                PERFORM 1260-CIERRA-CUR-SINIES                                  
      *        EN EL SIGUIENTE  IF, LA VARIABLE WS-INDSALV = '  '  EN           
      *        DONDE LOS ESPACIOS INDICAN QUE NO HUBO SINIESTROS,  EL           
      *        'NO' INDICA HUBO SINIESTROS PERO NINGUNO CON SALVAMENTO          
      *        POR LO TANTO TODOS LOS SINIESTROS PASAN                          
                IF WS-INDSALV = 'SP' OR WS-INDSALV = 'NO'                       
                OR WS-INDSALV = '  '                                            
                   SET WS-SINIESTRO-VALIDO TO TRUE                              
                ELSE                                                            
                   IF WS-INDSALV = 'SI' OR WS-INDSALV = 'NP'                    
                     SET WS-NO-SINIESTRO-VALIDO TO TRUE                         
                     MOVE ZEROES                  TO WS-OUT-SQLCODE             
                     MOVE WS-LEE-CDNUMPOL         TO WS-OUT-POLIZA              
                     MOVE 'KSIM10T'               TO WS-OUT-TABLA               
                     PERFORM 1570-ESCRIBE-DESCARTADA                            
                   END-IF                                                       
                END-IF                                                          
           .                                                                    
      ***************************************************************           
      *DECLARA EL  CURSORES                                         *           
      ***************************************************************           
       1210-DECLARA-CURSORES.                                                   
                                                                                
            EXEC SQL                                                            
              DECLARE CUR-SINIES CURSOR FOR                                     
               SELECT CDSINIES,TCSITSIN,FETERMIN,CDNUMPOL,INSALVAM              
                 FROM  KSIM10T                                                  
               WHERE CDNUMPOL = :KSIM10T.CDNUMPOL                               
               WITH UR                                                          
            END-EXEC.                                                           
                                                                                
            EXEC SQL                                                            
              DECLARE CUR-RECIBO CURSOR FOR                                     
               SELECT CDNUMREC,TCSBRECA, TCESREC, FEVALRBR                      
                 FROM KRBM10T                                                   
                WHERE CDNUMCON = "    "                                         
                  AND CDNUMPOL = :KRBM10T.CDNUMPOL                              
               WITH UR                                                          
            END-EXEC.                                                           
            EXEC SQL                                                            
              DECLARE CUR-COASEGURO CURSOR FOR                                  
               SELECT CDRECCOA                                                  
                 FROM KCGM15T                                                   
                WHERE                                                           
                      CDNUMPOL = :KCGM15T.CDNUMPOL                              
               WITH UR                                                          
            END-EXEC.                                                           
      ***************************************************************           
      *ABRE EL CURSOR DE SINIESTROS                                 *           
      ***************************************************************           
       1220-ABRE-CUR-SINIES.                                                    
                EXEC SQL                                                        
                  OPEN CUR-SINIES                                               
                END-EXEC                                                        
                                                                                
                IF SQLCODE = WN-SQLCODE-OK THEN                                 
                   SET WS-OPEN-CUR-SINIES TO TRUE                               
                ELSE                                                            
                   SET WS-NO-HAY-SINIESTROS  TO TRUE                            
                  SET WS-CLOSE-CUR-SINIES       TO TRUE                         
                  MOVE    WC-ERR-OPEN-CURSOR    TO   CDERR                      
                  MOVE    'KSIM10T'             TO DSARGU1 OF ENTRADA           
                  MOVE    'ABRE CURSOR'         TO DSARGU2 OF ENTRADA           
                  MOVE    'SQLCODE:'            TO DSARGU3 OF ENTRADA           
                  MOVE    '1220-ABRE-CUR-SINIE' TO   CDPARRAF                   
                  PERFORM 9999-GESTION-ERRORES                                  
                                                                                
                END-IF.                                                         
      *****************************************************************         
      * LEE EL CURSOR DE SINIESTROS                                   *         
      *****************************************************************         
       1240-LEE-CUR-SINIES.                                                     
             EXEC SQL                                                           
               FETCH CUR-SINIES                                                 
               INTO                                                             
               :KSIM10T.CDSINIES,:KSIM10T.TCSITSIN,:KSIM10T.FETERMIN,           
               :KSIM10T.CDNUMPOL,:KSIM10T.INSALVAM                              
             END-EXEC                                                           
               MOVE SPACES TO WS-TBL-SINOREC                                    
               EVALUATE SQLCODE                                                 
                  WHEN  WN-SQLCODE-OK                                           
                     ADD WC-1 TO WS-NUM-SINIES                                  
                     MOVE CDSINIES OF KSIM10T  TO WS-TBL-SINOREC(1:10)          
ALPOP1               MOVE CDSINIES OF KSIM10T  TO WS-TBL-CDSINIES               
ALPOP1               MOVE CDNUMPOL OF KSIM10T  TO WS-TBL-CDNUMPOL               
                     SET  WS-HAY-SINIESTROS    TO   TRUE                        
                  WHEN WN-SQLCODE-NOT-FOUND                                     
                     MOVE SPACES               TO WS-TBL-SINOREC                
ALPOP1               MOVE SPACES               TO WS-TBL-CDSINIES               
                     SET  WS-NO-HAY-SINIESTROS TO TRUE                          
                     IF WS-NUM-SINIES = 0 AND WS-WRITE                          
                       MOVE SQLCODE               TO WS-OUT-SQLCODE             
                       MOVE 'KSIM10T'             TO WS-OUT-TABLA               
                       MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA              
                       MOVE '1240-LEE-CUR-SINIES' TO WS-OUT-PARRAFO             
                       MOVE 'POLIZA SIN SINIESTROS' TO WS-OUT-DESC              
                      PERFORM 1570-ESCRIBE-DESCARTADA                           
                     END-IF                                                     
                  WHEN OTHER                                                    
                        SET WS-NO-HAY-SINIESTROS  TO TRUE                       
                        MOVE SPACES               TO WS-TBL-SINOREC             
                        MOVE SPACES               TO WS-TBL-CDSINIES            
                        MOVE SQLCODE              TO WS-OUT-SQLCODE             
                        MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA             
                        MOVE 'KSIM10T'             TO WS-OUT-TABLA              
                        MOVE '1240-LEE-CUR-SINIES ' TO WS-OUT-PARRAFO           
                        MOVE 'TABLA C/PROBLEMAS    ' TO WS-OUT-DESC             
                        PERFORM 1570-ESCRIBE-DESCARTADA                         
                        MOVE WC-ERROR-FETCH        TO CDERR                     
                        MOVE 'FETCH '              TO DSARGU1 OF ENTRADA        
                        MOVE 'KSIM10T'             TO DSARGU2 OF ENTRADA        
                        MOVE 'FETCH-ERROR '        TO DSARGU3 OF ENTRADA        
                        MOVE '1240-LEE-CUR-SINIES' TO CDPARRAF                  
                                                                                
                        IF SQLCODE = -911                                       
                           MOVE 'S' TO SW-911                                   
                           MOVE 'S' TO SW-911-911                               
                           ADD 1 TO WS-CANT-ERRORES                             
                        ELSE                                                    
                           PERFORM 9999-GESTION-ERRORES                         
                        END-IF                                                  
                                                                                
                                                                                
               END-EVALUATE.                                                    
      *****************************************************************         
      * CIERRA EL CURSOR DE SINIESTROS                                *         
      *****************************************************************         
       1260-CIERRA-CUR-SINIES.                                                  
             IF WS-OPEN-CUR-SINIES                                              
                EXEC SQL                                                        
                  CLOSE CUR-SINIES                                              
                END-EXEC                                                        
                                                                                
                IF SQLCODE = WN-SQLCODE-OK THEN                                 
                   SET WS-CLOSE-CUR-SINIES  TO TRUE                             
                ELSE                                                            
                  MOVE    WC-ERR-CLOSE-CURSOR    TO   CDERR                     
                  MOVE    'CLOS CUR'            TO DSARGU1 OF ENTRADA           
                  MOVE    'KSIM10T'             TO DSARGU2 OF ENTRADA           
                  MOVE    'SQLCODE:'            TO DSARGU3 OF ENTRADA           
                  MOVE    '1260-CIERRA-CUR-SIN' TO   CDPARRAF                   
                  PERFORM 9999-GESTION-ERRORES                                  
                                                                                
                END-IF                                                          
             END-IF.                                                            
      ***************************************************************           
      *ACCESA TABLA KSIN30T PARA VALIDAR EXISTENCIA DE SINIESTROS   *           
      ***************************************************************           
       1270-CHECA-KSIN30T.                                                      
            EXEC SQL                                                            
              SELECT TCCDPAG                                                    
              INTO :KSIN30T.TCCDPAG                                             
              FROM KSIN30T A                                                    
              WHERE CDSINIES = :KSIM10T.CDSINIES                                
              AND TCCDPAG  IN ("ICI", "IVC", "ISF", "ISM")                      
              FETCH FIRST 1 ROWS ONLY                                           
               WITH UR                                                          
            END-EXEC.                                                           
                                                                                
             SET WS-FILTRO-3 TO TRUE                                            
               EVALUATE SQLCODE                                                 
                  WHEN  WN-SQLCODE-OK                                           
                     SET WS-HAY-KSIN30T            TO TRUE                      
                  WHEN WN-SQLCODE-NOT-FOUND                                     
                     SET  WS-NO-HAY-KSIN30T        TO TRUE                      
                     MOVE SQLCODE               TO WS-OUT-SQLCODE               
                     MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                
                     MOVE 'KSIN30T'             TO WS-OUT-TABLA                 
                     MOVE '1270-CHECA-KSIN30TF3' TO WS-OUT-PARRAFO              
                     MOVE 'NO EN KSIN30T;SIN:'                                  
                                    TO WS-OUT-DESC(1:20)                        
                     MOVE WS-TBL-SINOREC(1:10)                                  
                                    TO WS-OUT-DESC(21:19)                       
                  WHEN OTHER                                                    
                        SET WS-NO-HAY-KSIN30T      TO TRUE                      
                        MOVE SQLCODE               TO WS-OUT-SQLCODE            
                        MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA             
                        MOVE 'KSIN30T'             TO WS-OUT-TABLA              
                        MOVE '1270-CHECA-KSIN30T  ' TO WS-OUT-PARRAFO           
                        MOVE 'TABLA C/PROBLEMAS   ' TO WS-OUT-DESC              
                        PERFORM 1570-ESCRIBE-DESCARTADA                         
                        MOVE WC-ERROR-FETCH        TO CDERR                     
                        MOVE 'SELECT'              TO DSARGU1 OF ENTRADA        
                        MOVE 'KSIN30T'             TO DSARGU2 OF ENTRADA        
                        MOVE 'SELECT ERROR'        TO DSARGU3 OF ENTRADA        
                        MOVE '1270-CHECA-KSIN30T ' TO CDPARRAF                  
                                                                                
                        IF SQLCODE = -911                                       
                           MOVE 'S' TO SW-911                                   
                           MOVE 'S' TO SW-911-911                               
                           ADD 1 TO WS-CANT-ERRORES                             
                        ELSE                                                    
                           PERFORM 9999-GESTION-ERRORES                         
                        END-IF                                                  
                                                                                
                                                                                
               END-EVALUATE.                                                    
                                                                                
      ******************************************************************        
      * SE VERIFICAN TODOS LOS RECIBOS DE CADA POLIZA INDIVIDUAL     *          
      ******************************************************************        
       1300-CHECA-RECIBOS.                                                      
      *                                                                         
           MOVE WS-LEE-CDNUMPOL       TO CDNUMPOL OF KRBM10T                    
           PERFORM 1320-ABRE-CUR-RECIBO                                         
           MOVE 0                     TO WS-MAX-FECMVTO WS-CANT-RECIBOS         
           SET WS-NO-SALIR            TO TRUE                                   
           SET WS-NO-RECIBO-VALIDO    TO TRUE                                   
           MOVE SPACES                TO WS-INDHIST WS-TCESREC                  
           PERFORM 1340-LEE-CUR-RECIBO                                          
           PERFORM UNTIL WS-NO-HAY-RECIBOS OR WS-SALIR                          
              IF  TCSBRECA OF KRBM10T  NOT = 'EB'                               
              AND TCSBRECA OF KRBM10T  NOT = 'BB'                               
              AND TCSBRECA OF KRBM10T  NOT = 'BT'                               
                IF  TCTIMOVP OF KCIM06T = '3'                                   
                AND TCMOMOVP OF KCIM06T = '105'                                 
                  IF TCESREC OF KRBM10T NOT = 'L'                               
                    IF WS-TCESREC = ' '                                         
                       MOVE 'X' TO WS-TCESREC                                   
                    END-IF                                                      
                  ELSE                                                          
                    IF WS-TCESREC NOT = 'L'                                     
                       PERFORM 1305-FECHA-KRBN50T                               
                       IF WS-HAY-MAX-FECMVTO                                    
                          MOVE 'L'     TO WS-TCESREC                            
                       ELSE                                                     
                          MOVE 'N'     TO WS-TCESREC                            
                          MOVE 'NP'    TO WS-INDHIST                            
                          SET WS-SALIR TO TRUE                                  
                       END-IF                                                   
                    END-IF                                                      
                  END-IF                                                        
                ELSE                                                            
                  MOVE 'SP'            TO WS-INDHIST                            
                END-IF                                                          
              ELSE                                                              
                IF TCESREC OF KRBM10T = 'L'                                     
                   PERFORM 1301-LIQ-EB                                          
                ELSE                                                            
                   MOVE 'NP'     TO WS-INDHIST                                  
                   SET WS-SALIR TO TRUE                                         
                   MOVE 'TCSBRECA CON EB,BB,BT' TO WS-OUT-DESC                  
                END-IF                                                          
              END-IF                                                            
              IF WS-INDHIST NOT = 'NP'  AND WS-NO-SALIR                         
                 PERFORM 1340-LEE-CUR-RECIBO                                    
              END-IF                                                            
           END-PERFORM.                                                         
           PERFORM 1360-CIERRA-CUR-RECIBO                                       
                                                                                
      *    IF WS-INDHIST =  '  ' AND WS-CANT-RECIBOS > 0                        
      * SI WS-INDHIST =  '  ' => NO HAY RECIBOS O RECIBOS SON VALIDOS           
           IF WS-INDHIST =  '  '                                                
             IF WS-CANT-RECIBOS > 0                                             
               IF WS-TCESREC = 'X'                                              
                 IF FEEFTOMO OF KCIM06T < WS-FECNTU                             
      *             SEIS MESES A HISTORIFICAR                                   
                    SET WS-RECIBO-VALIDO TO TRUE                                
                 ELSE                                                           
                    SET WS-NO-RECIBO-VALIDO  TO TRUE                            
                    MOVE 0                     TO WS-OUT-SQLCODE                
                    MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                 
                    MOVE '       '             TO WS-OUT-TABLA                  
                    MOVE '1300-CHECA-RECIBOSF5' TO WS-OUT-PARRAFO               
                    MOVE 'FEEFTOMO > 6 MESES  ' TO WS-OUT-DESC                  
                    PERFORM 1570-ESCRIBE-DESCARTADA                             
                 END-IF                                                         
               ELSE                                                             
      *           IF WS-TCESREC = 'L'                                           
                     IF WS-MAX-FECMVTO  < WS-FNTULIQ                            
      *                DOCE MESES A HISTORIFICAR                                
                       SET WS-RECIBO-VALIDO TO TRUE                             
                     ELSE                                                       
                      SET WS-NO-RECIBO-VALIDO      TO TRUE                      
                      MOVE 0                       TO WS-OUT-SQLCODE            
                      MOVE WS-LEE-CDNUMPOL         TO WS-OUT-POLIZA             
                      MOVE '       '               TO WS-OUT-TABLA              
                      MOVE '1300-CHECA-RECIBOSF6'   TO WS-OUT-PARRAFO           
                      MOVE 'MAX(FECMVTO)>12 MESES' TO WS-OUT-DESC               
                      PERFORM 1570-ESCRIBE-DESCARTADA                           
                     END-IF                                                     
      *           ELSE                                                          
      *              SET WS-NO-RECIBO-VALIDO  TO TRUE                           
      *              PERFORM 1570-ESCRIBE-DESCARTADA                            
      *           END-IF                                                        
               END-IF                                                           
             ELSE                                                               
                SET WS-RECIBO-VALIDO TO TRUE                                    
             END-IF                                                             
           ELSE                                                                 
              IF WS-INDHIST =  'SP'                                             
                 IF FEEFTOMO OF KCIM06T < WS-FECVIG                             
      *             TREINTA Y SEIS MESES A HISTORIFICAR                         
                    SET WS-RECIBO-VALIDO TO TRUE                                
                 ELSE                                                           
                    SET WS-NO-RECIBO-VALIDO  TO TRUE                            
                    MOVE 0                     TO WS-OUT-SQLCODE                
                    MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                 
                    MOVE '       '             TO WS-OUT-TABLA                  
                    MOVE '1300-CHECA-RECIBOSF7' TO WS-OUT-PARRAFO               
                    MOVE 'FEEFTOMO > 36 MESES ' TO WS-OUT-DESC                  
                    PERFORM 1570-ESCRIBE-DESCARTADA                             
                 END-IF                                                         
              ELSE                                                              
                SET WS-NO-RECIBO-VALIDO    TO TRUE                              
                MOVE 0                     TO WS-OUT-SQLCODE                    
                MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                     
                MOVE '       '             TO WS-OUT-TABLA                      
                MOVE '1300-CHECA-RECIBOSF8' TO WS-OUT-PARRAFO                   
                PERFORM 1570-ESCRIBE-DESCARTADA                                 
              END-IF                                                            
           END-IF                                                               
           .                                                                    
       1301-LIQ-EB.                                                             
           IF  TCTIMOVP OF KCIM06T = '3'   AND                                  
               TCMOMOVP OF KCIM06T = '105'                                      
               IF WS-TCESREC NOT = 'L'                                          
                  PERFORM 1305-FECHA-KRBN50T                                    
                  IF WS-HAY-MAX-FECMVTO                                         
                     MOVE 'L'     TO WS-TCESREC                                 
                  ELSE                                                          
                     MOVE 'N'     TO WS-TCESREC                                 
                     MOVE 'NP'    TO WS-INDHIST                                 
                     SET WS-SALIR TO TRUE                                       
                  END-IF                                                        
               END-IF                                                           
           ELSE                                                                 
              MOVE 'SP'            TO WS-INDHIST                                
           END-IF.                                                              
       1301-LIQ-EB-FIN.                                                         
                                                                                
      ***************************************************************           
      *OBTIENE LA FECHA MAS RECIENTE DEL ULTIMO PAGO REALIZADO      *           
      ***************************************************************           
       1305-FECHA-KRBN50T.                                                      
           MOVE WS-LEE-CDNUMPOL TO CDNUMPOL OF KRBM10T                          
           MOVE 0  TO FECMVTO OF KRBN50T                                        
           EXEC SQL                                                             
               SELECT MAX(A.FECMVTO)                                            
               INTO :KRBN50T.FECMVTO                                            
               FROM KRBN50T A                                                   
               WHERE TCCDMVTO = "004"                                           
                 AND A.CDNUMREC IN (SELECT B.CDNUMREC                           
                        FROM KRBM10T B                                          
                       WHERE B.CDNUMPOL = :KRBM10T.CDNUMPOL                     
                           AND B.TCESREC  = "L")                                
               WITH UR                                                          
           END-EXEC                                                             
                                                                                
               EVALUATE SQLCODE                                                 
                  WHEN  WN-SQLCODE-OK                                           
                     MOVE FECMVTO OF KRBN50T TO WS-MAX-FECMVTO                  
                     SET WS-HAY-MAX-FECMVTO TO TRUE                             
                  WHEN WN-SQLCODE-NOT-FOUND                                     
                     SET WS-NO-HAY-MAX-FECMVTO TO TRUE                          
                     ADD WC-1                   TO WS-CANT-ERRORES              
                     MOVE 'SI'                  TO WS-ROLLBACK                  
                     MOVE SQLCODE               TO WS-OUT-SQLCODE               
                     MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                
                     MOVE 'KRBN50T'             TO WS-OUT-TABLA                 
                     MOVE '1305-FECHA-KRBN50TF9' TO WS-OUT-PARRAFO              
                    MOVE 'POLIZA NO CUMPLE NO-REC-LIQ   ' TO WS-OUT-DESC        
      *              PERFORM 1570-ESCRIBE-DESCARTADA                            
                  WHEN -305                                                     
                     SET WS-NO-HAY-MAX-FECMVTO TO TRUE                          
                     ADD WC-1                   TO WS-CANT-ERRORES              
                     MOVE 'SI'                  TO WS-ROLLBACK                  
                     MOVE SQLCODE               TO WS-OUT-SQLCODE               
                     MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                
                     MOVE 'KRBN50T'             TO WS-OUT-TABLA                 
                     MOVE '1305-FECHA-KRBN50TF9' TO WS-OUT-PARRAFO              
                    MOVE 'POLIZA NO CUMPLE NO-REC-LIQ   ' TO WS-OUT-DESC        
      *              PERFORM 1570-ESCRIBE-DESCARTADA                            
                  WHEN OTHER                                                    
                     SET WS-NO-HAY-MAX-FECMVTO TO TRUE                          
                     MOVE SQLCODE               TO WS-OUT-SQLCODE               
                     MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                
                     MOVE 'KRBN50T'             TO WS-OUT-TABLA                 
                     MOVE '1305-FECHA-KRBN50T  ' TO WS-OUT-PARRAFO              
                     MOVE 'REVISAR TABLA     ' TO WS-OUT-DESC                   
                     PERFORM 1570-ESCRIBE-DESCARTADA                            
                        MOVE WC-ERROR-FETCH         TO CDERR                    
                        MOVE 'SELECT'              TO DSARGU1 OF ENTRADA        
                        MOVE 'KRBN50T'             TO DSARGU2 OF ENTRADA        
                        MOVE 'SELECT-ERROR'        TO DSARGU3 OF ENTRADA        
                        MOVE '1305-FECHA-KRBN50T '  TO CDPARRAF                 
                                                                                
                        IF SQLCODE = -911                                       
                           MOVE 'S' TO SW-911                                   
                           MOVE 'S' TO SW-911-911                               
                           ADD 1 TO WS-CANT-ERRORES                             
                        ELSE                                                    
                          PERFORM 9999-GESTION-ERRORES                          
                        END-IF                                                  
                                                                                
               END-EVALUATE.                                                    
      ***************************************************************           
      *ABRE EL CURSOR DE RECIBOS                                    *           
      ***************************************************************           
       1320-ABRE-CUR-RECIBO.                                                    
                EXEC SQL                                                        
                  OPEN CUR-RECIBO                                               
                END-EXEC                                                        
                                                                                
                IF SQLCODE = WN-SQLCODE-OK THEN                                 
                   SET WS-OPEN-CUR-RECIBO TO TRUE                               
                ELSE                                                            
                  SET WS-CLOSE-CUR-RECIBO       TO TRUE                         
                  MOVE SQLCODE               TO WS-OUT-SQLCODE                  
                  MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                   
                  MOVE 'KRBM10T'             TO WS-OUT-TABLA                    
                  MOVE '1320-ABRE-CUR-RECIBO' TO WS-OUT-PARRAFO                 
                  MOVE 'NO HABRE CURSOR     ' TO WS-OUT-DESC                    
                  PERFORM 1570-ESCRIBE-DESCARTADA                               
                  MOVE    WC-ERR-OPEN-CURSOR    TO   CDERR                      
                  MOVE    'KRBM10T'             TO DSARGU1 OF ENTRADA           
                  MOVE    'ABRE CURSOR'         TO DSARGU2 OF ENTRADA           
                  MOVE    'SQLCODE:'            TO DSARGU3 OF ENTRADA           
                  MOVE    '1320-ABRE-CUR-RECIB' TO   CDPARRAF                   
                  PERFORM 9999-GESTION-ERRORES                                  
                                                                                
                END-IF.                                                         
      *****************************************************************         
      * LEE EL CURSOR DE RECIBOS                                      *         
      *****************************************************************         
       1340-LEE-CUR-RECIBO.                                                     
             EXEC SQL                                                           
               FETCH CUR-RECIBO                                                 
               INTO                                                             
               :KRBM10T.CDNUMREC,:KRBM10T.TCSBRECA,:KRBM10T.TCESREC,            
               :KRBM10T.FEVALRBR                                                
             END-EXEC                                                           
             MOVE SPACES TO WS-TBL-SINOREC                                      
             SET WS-FILTRO-4 TO TRUE                                            
               EVALUATE SQLCODE                                                 
                  WHEN  WN-SQLCODE-OK                                           
                     MOVE CDNUMREC OF KRBM10T TO WS-TBL-SINOREC                 
                     SET WS-HAY-RECIBOS     TO TRUE                             
                     ADD WC-1               TO WS-CANT-RECIBOS                  
                  WHEN WN-SQLCODE-NOT-FOUND                                     
                     MOVE SPACES               TO WS-TBL-SINOREC                
                     SET  WS-NO-HAY-RECIBOS    TO TRUE                          
JNB01                MOVE 0 TO IMTOTREC OF KRBM10T                              
      *              ADD WC-1                   TO WS-CANT-ERRORES              
      *              MOVE 'SI'                  TO WS-ROLLBACK                  
                     IF WS-INDHIST =  '  ' AND WS-CANT-RECIBOS = 0              
                        MOVE SQLCODE               TO WS-OUT-SQLCODE            
                        MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA             
                        MOVE 'KRBM10T'             TO WS-OUT-TABLA              
                        MOVE '1340-LEE-CUR-RECIBF0' TO WS-OUT-PARRAFO           
                        MOVE 'POLIZA SIN RECIBOS ' TO WS-OUT-DESC               
                        PERFORM 1570-ESCRIBE-DESCARTADA                         
                     END-IF                                                     
                  WHEN OTHER                                                    
      *                 MOVE SQLCODE TO WS-EDIT-SQL                             
                        MOVE SPACES               TO WS-TBL-SINOREC             
                        SET WS-NO-HAY-RECIBOS       TO TRUE                     
                        MOVE WC-ERROR-FETCH         TO CDERR                    
                        MOVE SQLCODE               TO WS-OUT-SQLCODE            
                        MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA             
                        MOVE 'KRBM10T'             TO WS-OUT-TABLA              
                        MOVE '1340-LEE-CUR-RECIBO ' TO WS-OUT-PARRAFO           
                        MOVE 'TABLA CON PROBLEMAS' TO WS-OUT-DESC               
                        PERFORM 1570-ESCRIBE-DESCARTADA                         
                        MOVE 'FETCH '             TO DSARGU1 OF ENTRADA         
                        MOVE 'KRBM10T'            TO DSARGU2 OF ENTRADA         
                        MOVE 'FECTCH-ERROR'       TO DSARGU3 OF ENTRADA         
                        MOVE '1340-LEE-CUR-RECIBO'  TO CDPARRAF                 
                                                                                
                        IF SQLCODE = -911                                       
                           MOVE 'S' TO SW-911                                   
                           MOVE 'S' TO SW-911-911                               
                           ADD 1 TO WS-CANT-ERRORES                             
                        ELSE                                                    
                           PERFORM 9999-GESTION-ERRORES                         
                        END-IF                                                  
               END-EVALUATE.                                                    
      *****************************************************************         
      * CIERRA EL CURSOR DE RECIBOS                                   *         
       1360-CIERRA-CUR-RECIBO.                                                  
      *****************************************************************         
                EXEC SQL                                                        
                  CLOSE CUR-RECIBO                                              
                END-EXEC                                                        
                                                                                
                IF SQLCODE = WN-SQLCODE-OK THEN                                 
                   SET WS-CLOSE-CUR-RECIBO      TO TRUE                         
                ELSE                                                            
                  SET WS-CLOSE-CUR-RECIBO       TO TRUE                         
                  MOVE    WC-ERR-CLOSE-CURSOR   TO   CDERR                      
                  MOVE    'CLOS CUR'            TO DSARGU1 OF ENTRADA           
                  MOVE    'KRBM10T'             TO DSARGU2 OF ENTRADA           
                  MOVE    'SQLCODE:'            TO DSARGU3 OF ENTRADA           
                  MOVE    '1360-CIERRA-CUR-REC' TO   CDPARRAF                   
                  PERFORM 9999-GESTION-ERRORES                                  
                                                                                
                END-IF.                                                         
      ******************************************************************        
      * SE INERTAN CADA POLIZA EN 500 TABLAS APROXIMADAMENTE           *        
      ******************************************************************        
       1500-INSERTA-EN-TABLAS.                                                  
           MOVE ' ' TO SW-911                                                   
           MOVE ' ' TO SW-911-911                                               
           STRING                                                               
           ' LLAMANDO RUTINAS HIST: ' WS-LEE-CDNUMPOL       '\N'                
           DELIMITED BY SIZE                                                    
           INTO WS-CIFRASCONTROL                                                
           CALL W-KMCLMCCB USING WS-CIFRASCONTROL                               
           MOVE WS-LEE-CDNUMPOL TO WS-IDA-POLIZA                                
           MOVE 0  TO WS-CANT-ERRORES                                           
           SET WS-NO-DUPLICADOS TO TRUE                                         
           MOVE 'NO' TO WS-ROLLBACK                                             
           SET WS-NO-ERR-REP TO TRUE                                            
                                                                                
      *    COPIA CONTRATACION Y REASEGURO                                       
           MOVE REG-AMBIENTE       TO WS-AMBIENTE.                              
           CALL  WC-KAHLMHP1 USING KAHLCCTR.                                    
           MOVE 1 TO WS-NUM-HISTORI                                             
           MOVE 1  TO WS-IERR                                                   
           PERFORM 1510-EVALUA-ERRORES                                          
      *    CHECA Y COPIA  SINIESTROS                                            
JNB01      IF WS-TCANTU-VA = 0                                                  
JNB01        MOVE WS-LEE-CDNUMPOL TO CDNUMPOL OF KSIM10T                        
JNB01        PERFORM 3000-COPIA-SINIESTROS                                      
JNB01        MOVE WS-LEE-CDNUMPOL       TO CDNUMPOL OF KRBM10T                  
JNB01        PERFORM 4000-COPIA-RECIBOS                                         
JNBXX        IF WS-CANT-RECIBOS = 0                                             
JNB01          MOVE 0 TO IMTOTREC OF KRBM10T                                    
JNB01        END-IF                                                             
             MOVE WS-LEE-CDNUMPOL  TO CDNUMPOL OF KCGM15T                       
JNB01        PERFORM 5000-COPIA-COASEGURO                                       
JNB01      ELSE                                                                 
             IF SW-911-911 = ' '                                                
               IF WS-CANT-ERRORES = 0 AND WS-NUM-SINIES > 0                     
                 AND WS-SINIESTRO-VALIDO                                        
                 PERFORM 3000-COPIA-SINIESTROS                                  
               END-IF                                                           
             END-IF                                                             
      *      CHECA Y COPIA RECIBOS                                              
             IF SW-911-911 = ' '                                                
                IF WS-CANT-ERRORES = 0 AND WS-CANT-RECIBOS > 0                  
                AND WS-RECIBO-VALIDO                                            
                    PERFORM 4000-COPIA-RECIBOS                                  
                END-IF                                                          
             END-IF                                                             
      *      CHECA Y COPIA COASEGURO                                            
             IF SW-911-911 = ' '                                                
                IF WS-CANT-ERRORES = 0                                          
                   MOVE WS-LEE-CDNUMPOL  TO CDNUMPOL OF KCGM15T                 
                   PERFORM 5000-COPIA-COASEGURO                                 
                END-IF                                                          
             END-IF                                                             
JNB01      END-IF                                                               
           IF WS-ROLLBACK = 'SI' OR SW-911-911 = 'S'                            
              CONTINUE                                                          
JNB02      ELSE                                                                 
              IF WS-CANT-ERRORES = 0                                            
                 MOVE 'KCIM06T' TO WS-TABLA-T                                   
                 MOVE 'KCIM06H' TO WS-TABLA-H                                   
                 PERFORM 4700-COPIA-RAIZ                                        
              END-IF                                                            
           END-IF                                                               
           IF WS-ROLLBACK = 'SI' OR SW-911-911 = 'S'                            
                 STRING                                                         
                 'A1111 VA HACER ROLLBACK                        ' '\N'         
                 ' 4000-COPIA-RECIBOS    :' W-QUERY-TEXT   '\N'                 
                 'A1111??????????????????????????????????????????' '\N'         
                 DELIMITED BY SIZE                                              
                 INTO WS-CIFRASCONTROL                                          
                 CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
                 PERFORM 2500-ROLLBACK                                          
           ELSE                                                                 
              IF SW-911-911 = 'S'                                               
                 STRING                                                         
                 'A2222 VA HACER ROLLBACK                        ' '\N'         
                 ' 4001-COPIA-RECIBOS    :' W-QUERY-TEXT   '\N'                 
                 'A2222??????????????????????????????????????????' '\N'         
                 DELIMITED BY SIZE                                              
                 INTO WS-CIFRASCONTROL                                          
                 CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
                 PERFORM 2500-ROLLBACK                                          
              ELSE                                                              
                 IF WS-CANT-ERRORES = 0 AND                                     
                     SW-911          = ' '                                      
                    PERFORM 2000-COMMIT                                         
                 ELSE                                                           
                 STRING                                                         
                 'A3333 VA HACER ROLLBACK                        ' '\N'         
                 ' 4ZZZ-COPIA-RECIBOS    :' W-QUERY-TEXT   '\N'                 
                 'A3333??????????????????????????????????????????' '\N'         
                 DELIMITED BY SIZE                                              
                 INTO WS-CIFRASCONTROL                                          
                 CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
                 PERFORM 2500-ROLLBACK                                          
                 END-IF                                                         
              END-IF                                                            
           END-IF                                                               
           .                                                                    
123500*****************************************************************         
123510*SE ESCRIBEN LOS ERRORES GENERADOS AL VALIDAR LOS INSERT PERO             
123510*SOLO EN LOS CASOS DE ERROR GRAVE EN LAS TABLAS SE CONSERVA LA            
123510*BANDERA DE ROLLBACK.                                                     
 23520*****************************************************************         
123530 1510-EVALUA-ERRORES.                                                     
123510*                                                                         
           IF WS-CANT-ERRORES NOT NUMERIC                                       
              MOVE 0 TO WS-CANT-ERRORES                                         
           END-IF                                                               
           IF WS-IERR NOT NUMERIC                                               
              MOVE 999 TO WS-IERR                                               
              MOVE 0 TO WS-CANT-ERRORES                                         
           ELSE                                                                 
              IF WS-CANT-ERRORES NOT = 0                                        
                 PERFORM UNTIL WS-IERR > WS-CANT-ERRORES                        
                   IF WS-REG-SQLCODE(WS-IERR) NOT = 100 OR WS-WRITE             
                      PERFORM 1560-ERR-INSERT                                   
                   END-IF                                                       
                   ADD WC-1 TO WS-IERR                                          
                 END-PERFORM                                                    
                 IF WS-ROLLBACK = 'NO'                                          
                    MOVE 0 TO WS-CANT-ERRORES                                   
                 END-IF                                                         
              END-IF                                                            
           END-IF.                                                              
123520*****************************************************************         
123530 1560-ERR-INSERT.                                                         
              MOVE WS-LEE-CDNUMPOL             TO WS-OUT-POLIZA                 
              MOVE WS-REG-SQLCODE(WS-IERR)     TO WS-OUT-SQLCODE                
              MOVE WS-REG-TABLA(WS-IERR)       TO WS-OUT-TABLA                  
              IF WS-REG-SQLCODE(WS-IERR) = -803                                 
                 MOVE 'KAHLMHP1 DUPLICADO  '      TO WS-OUT-PARRAFO             
                 SET WS-DUPLICADOS   TO TRUE                                    
              ELSE                                                              
                 IF WS-REG-SQLCODE(WS-IERR) = -911                              
                    MOVE 'KAHLMHP1 CONTENCION '      TO WS-OUT-PARRAFO          
                    MOVE 'CONTENCION TABLA   '       TO WS-OUT-DESC             
                    SET WS-DUPLICADOS   TO TRUE                                 
                    MOVE 'S' TO SW-911                                          
                    ADD 1 TO WS-CANT-ERRORES                                    
                 ELSE                                                           
                    IF WS-REG-SQLCODE(WS-IERR) = 0                              
                       CONTINUE                                                 
                    ELSE                                                        
                       MOVE 'KAHLMHP1 ERR TBLS   '  TO WS-OUT-PARRAFO           
ALPTER                 MOVE 1 TO SW-TERMINA                                     
                    END-IF                                                      
                 END-IF                                                         
              END-IF                                                            
              IF WS-REG-SQLCODE(WS-IERR) = 0                                    
                 CONTINUE                                                       
              ELSE                                                              
                 MOVE WS-REG-DESCRIPCION(WS-IERR) TO WS-OUT-DESC                
                 PERFORM 1570-ESCRIBE-DESCARTADA                                
                 MOVE 0      TO WS-REG-SQLCODE(WS-IERR)                         
                 MOVE SPACES TO WS-REG-TABLA(WS-IERR)                           
                 MOVE SPACES TO WS-REG-DESCRIPCION(WS-IERR)                     
              END-IF                                                            
           .                                                                    
      ******************************************************************        
      * SE ESCRIBEN LOS ERRORES YA SEA POR DESCARTAR O POR ERRORES DE *         
      * ACCESOS A LAS TABLAS                                      *             
      ******************************************************************        
       1570-ESCRIBE-DESCARTADA.                                                 
           MOVE SPACES TO WS-ERPOLIZA                                           
           MOVE WS-FECPROCA    TO WS-OUT-FEC-HIST.                              
           MOVE WS-FECHA-BATCH TO WS-OUT-FEC-SYS.                               
           WRITE OUT-ERPOL  FROM OUT-POLIZAS                                    
           IF  WS-ERPOLIZA = ZEROS                                              
              ADD WC-1 TO WS-CONT-GRAB                                          
           ELSE                                                                 
               STRING                                                           
               '===============================================' '\N'           
               'ERROR ARCHIVO erpoliza: ' WS-ERPOLIZA           '\N'            
               '===============================================' '\N'           
               DELIMITED BY SIZE                                                
               INTO WS-CIFRASCONTROL                                            
               CALL W-KMCLMCCB USING WS-CIFRASCONTROL                           
               MOVE WC-COD                   TO CDERR    OF KAELCWEZ            
               MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ            
               MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ            
               MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ            
               MOVE '1570-ESCRIBE-DESCARTAD' TO CDPARRAF OF KAELCWEZ            
                                                                                
               PERFORM 9999-GESTION-ERRORES                                     
                                                                                
                                                                                
           END-IF.                                                              
                INITIALIZE OUT-ERPOL OUT-POLIZAS                                
                                                                                
                                                                                
           .                                                                    
123520*****************************************************************         
123530 3000-COPIA-SINIESTROS.                                                   
123520*****************************************************************         
123540     MOVE "3000-COPIA-SINIESTROS " TO CDPARRAF OF KAELCWEZ.               
           PERFORM 1220-ABRE-CUR-SINIES                                         
           MOVE 0   TO WS-NUM-SINIES                                            
FLSIN3     PERFORM 1240-LEE-CUR-SINIES.                                         
           PERFORM  UNTIL WS-NO-HAY-SINIESTROS                                  
      *IBM-INI                                                                  
               IF TCSITSIN OF KSIM10T NOT = WC-T                                
                   ADD  WC-1                  TO WS-CANT-ERRORES                
                   MOVE WC-SI                 TO WS-ROLLBACK                    
                   MOVE SQLCODE               TO WS-OUT-SQLCODE                 
                   MOVE WC-KSIM10T            TO WS-OUT-TABLA                   
                   MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
                   MOVE '3000-COPIA-SINIESTR' TO WS-OUT-PARRAFO                 
                   MOVE 'POLIZA SIN NO TERMINA' TO WS-OUT-DESC                  
                   PERFORM 1570-ESCRIBE-DESCARTADA                              
               END-IF                                                           
               IF WS-CANT-ERRORES = 0                                           
      *           LEER TABLA KSITRST                                            
                  PERFORM 3100-CONSULTA-KSITRST                                 
                  IF WS-EXISTE-KSITRST                                          
      *              LEER TABLA KSITRCT                                         
                     PERFORM 3200-CONSULTA-KSITRCT                              
                     IF WS-NO-EXISTE-KSITRCT                                    
      *           SI NO EXISTE EN LA TABLA SE MANDA A DESCARTADAS               
                        SET WS-NO-POLIZA-VALIDA TO TRUE                         
                        MOVE SQLCODE            TO WS-OUT-SQLCODE               
                        MOVE WS-LEE-CDNUMPOL    TO WS-OUT-POLIZA                
                        MOVE 'KSITRCT'          TO WS-OUT-TABLA                 
                        MOVE '3000-COPIA-SINIESTRO'                             
                                                TO WS-OUT-PARRAFO               
                        MOVE 'SIN NO EXIS KSITRCT'                              
                                                TO WS-OUT-DESC                  
                        PERFORM 1570-ESCRIBE-DESCARTADA                         
                     ELSE                                                       
      *              SI EXISTE EN LA TABLA KSITRCT SE HISTORIFICA               
      *                 IF CDTIPREC OF KSITRCT = WC-A                           
BAHA  *                 SE HISTORIFICA                                          
      *                    PERFORM 3300-INSERTA-EN-TABLAS                       
      *                 ELSE                                                    
      *    SE VALIDA LA FECHA DE ROBO                                           
                           PERFORM 3300-VALIDA-FECHA-ROBO                       
                           IF WS-SI-HISTORIFICA                                 
BAHA  *                       PERFORM 3300-INSERTA-EN-TABLAS                    
                              CONTINUE                                          
                           ELSE                                                 
      *                       RECHAZAR (MANDAR A DESCRTADAS)                    
                            SET WS-NO-POLIZA-VALIDA TO TRUE                     
                            MOVE SQLCODE          TO WS-OUT-SQLCODE             
                            MOVE WS-LEE-CDNUMPOL  TO WS-OUT-POLIZA              
                            MOVE 'KSITRCT'        TO WS-OUT-TABLA               
                            MOVE '3000-COPIA-SINIESTRO'                         
                                                  TO WS-OUT-PARRAFO             
                            MOVE 'NO HAN PASADO 6 ANI'                          
                                                  TO WS-OUT-DESC                
                            PERFORM 1570-ESCRIBE-DESCARTADA                     
                           END-IF                                               
      *                 END-IF                                                  
                     END-IF                                                     
                  END-IF                                                        
               END-IF                                                           
      *IBM-FIN                                                                  
H P H          PERFORM 3001-PROCESA-KACA50T                                     
H P H          PERFORM 3002-PROCESA-KACA52T                                     
H P H          PERFORM 3003-PROCESA-KACA53T                                     
H P H          PERFORM 3004-PROCESA-KACA60T                                     
H P H          PERFORM 3005-PROCESA-KACA61T                                     
H P H          PERFORM 3006-PROCESA-KACA63T                                     
H P H          PERFORM 3007-PROCESA-KACA68T                                     
H P H          PERFORM 3008-PROCESA-KACA71T                                     
H P H          PERFORM 3009-PROCESA-KACM50T                                     
H P H          PERFORM 3010-PROCESA-KACM51T                                     
H P H          PERFORM 3011-PROCESA-KACM52T                                     
H P H          PERFORM 3012-PROCESA-KACM53T                                     
H P H          PERFORM 3013-PROCESA-KACM54T                                     
H P H          PERFORM 3014-PROCESA-KACM55T                                     
H P H          PERFORM 3015-PROCESA-KACM56T                                     
H P H          PERFORM 3016-PROCESA-KACM57T                                     
H P H          PERFORM 3017-PROCESA-KACM71T                                     
H P H          PERFORM 3018-PROCESA-KACM72T                                     
H P H          PERFORM 3019-PROCESA-KACM73T                                     
H P H          PERFORM 3020-PROCESA-KACN58T                                     
H P H          PERFORM 3021-PROCESA-KACTEIT                                     
H P H          PERFORM 3022-PROCESA-KACTEPT                                     
H P H          PERFORM 3023-PROCESA-KACTSAT                                     
H P H          PERFORM 3024-PROCESA-KREM48T                                     
H P H          PERFORM 3025-PROCESA-KREM49T                                     
H P H          PERFORM 3026-PROCESA-KRETAST                                     
H P H          PERFORM 3027-PROCESA-KRETSNT                                     
H P H          PERFORM 3028-PROCESA-KSIA04T                                     
H P H          PERFORM 3029-PROCESA-KSIA12T                                     
H P H          PERFORM 3030-PROCESA-KSIA1BT                                     
H P H          PERFORM 3031-PROCESA-KSIA22T                                     
H P H          PERFORM 3032-PROCESA-KSIA24T                                     
H P H          PERFORM 3033-PROCESA-KSIA25T                                     
H P H          PERFORM 3034-PROCESA-KSIA2BT                                     
H P H          PERFORM 3035-PROCESA-KSIA30T                                     
H P H          PERFORM 3036-PROCESA-KSIA3AT                                     
H P H          PERFORM 3037-PROCESA-KSIA3BT                                     
H P H          PERFORM 3038-PROCESA-KSIA4BT                                     
H P H          PERFORM 3039-PROCESA-KSIA5AT                                     
H P H          PERFORM 3040-PROCESA-KSIA6BT                                     
H P H          PERFORM 3041-PROCESA-KSIM12T                                     
H P H          PERFORM 3042-PROCESA-KSIM20T                                     
H P H          PERFORM 3043-PROCESA-KSIM30T                                     
H P H          PERFORM 3044-PROCESA-KSIM3AT                                     
H P H          PERFORM 3045-PROCESA-KSIM4AT                                     
H P H          PERFORM 3046-PROCESA-KSIM5AT                                     
H P H          PERFORM 3047-PROCESA-KSIM61T                                     
H P H          PERFORM 3048-PROCESA-KSIM62T                                     
H P H          PERFORM 3049-PROCESA-KSIM63T                                     
H P H          PERFORM 3050-PROCESA-KSIM64T                                     
H P H          PERFORM 3051-PROCESA-KSIM65T                                     
H P H          PERFORM 3052-PROCESA-KSIM66T                                     
H P H          PERFORM 3053-PROCESA-KSIM7AT                                     
H P H          PERFORM 3054-PROCESA-KSIM86T                                     
H P H          PERFORM 3055-PROCESA-KSIM87T                                     
H P H          PERFORM 3056-PROCESA-KSIM88T                                     
H P H          PERFORM 3057-PROCESA-KSIM8AT                                     
H P H          PERFORM 3058-PROCESA-KSIM9AT                                     
H P H          PERFORM 3059-PROCESA-KSIMA0T                                     
H P H          PERFORM 3060-PROCESA-KSIN11T                                     
H P H          PERFORM 3061-PROCESA-KSIN30T                                     
H P H          PERFORM 3062-PROCESA-KSIN31T                                     
H P H          PERFORM 3063-PROCESA-KSITART                                     
H P H          PERFORM 3064-PROCESA-KSITCRT                                     
H P H          PERFORM 3065-PROCESA-KSITDPT                                     
H P H          PERFORM 3066-PROCESA-KSITPET                                     
H P H          PERFORM 3067-PROCESA-KSITRET                                     
H P H          PERFORM 3068-PROCESA-KSITRNT                                     
H P H          PERFORM 3069-PROCESA-KSVTBRT                                     
H P H          PERFORM 3070-PROCESA-KSVTCCT                                     
H P H          PERFORM 3071-PROCESA-KSVTCPT                                     
H P H          PERFORM 3072-PROCESA-KSVTRAT                                     
H P H          PERFORM 3073-PROCESA-KSVTRPT                                     
H P H          PERFORM 3074-PROCESA-KTOA49T                                     
H P H          PERFORM 3075-PROCESA-KTOM49T                                     
H P H          PERFORM 3076-PROCESA-KSINSRT                                     
H P H                                                                           
H P H *        MOVE WC-1 TO WS-ITBLS                                            
H P H          MOVE WC-77 TO WS-ITBLS                                           
               PERFORM  UNTIL WS-ITBLS > WC-MAX-SINIES                          
                   MOVE WC-TBLSIN-T(WS-ITBLS) TO WS-TABLA-T                     
                   MOVE WC-TBLSIN-H(WS-ITBLS) TO WS-TABLA-H                     
                                                                                
ALPOP1             MOVE WC-TBLSIN-T(WS-ITBLS) TO WS-TIPO-TABLA                  
                   MOVE WC-CDSINIES(WS-ITBLS) TO WS-CAMPOPOL                    
ALPOP1                                                                          
ALPOP1             IF TAB-ESP-SR                                                
      *IBM-INI                                                                  
                    IF WS-SI-HISTORIFICA                                        
      *IBM-FIN                                                                  
ALPOP1                PERFORM 3300-INSERTA-ESP-SIN                              
      *IBM-INI                                                                  
                    END-IF                                                      
      *IBM-FIN                                                                  
AAPOP1             ELSE                                                         
      *IBM-INI                                                                  
                    IF WS-SI-HISTORIFICA                                        
      *IBM-FIN                                                                  
ALPOP1                PERFORM 3300-INSERTA-EN-TABLAS                            
ALPOP1                IF  SQLCODE = WN-SQLCODE-OK                               
ALPOP1                AND WS-PARA-INSERT                                        
ALPOP1                   PERFORM 3400-DELETE-EN-TABLAS                          
ALPOP1                END-IF                                                    
      *IBM-INI                                                                  
                    END-IF                                                      
      *IBM-FIN                                                                  
ALPOP1             END-IF                                                       
                   IF WS-ROLLBACK = 'SI'                                        
                      SET WS-NO-HAY-SINIESTROS TO TRUE                          
                      MOVE 98 TO WS-ITBLS                                       
                   END-IF                                                       
                   ADD WC-1 TO WS-ITBLS                                         
               END-PERFORM                                                      
               IF WS-HAY-SINIESTROS                                             
FLSIN4             PERFORM 1240-LEE-CUR-SINIES                                  
               END-IF                                                           
           END-PERFORM                                                          
           IF WS-ROLLBACK = 'SI'                                                
              CONTINUE                                                          
           ELSE                                                                 
              PERFORM 1260-CIERRA-CUR-SINIES                                    
              IF WS-NUM-SINIES > 0 AND WS-CANT-ERRORES = 0                      
                 MOVE 'KSIM10T' TO WS-TABLA-T                                   
                 MOVE 'KSIM10H' TO WS-TABLA-H                                   
H P H *          PERFORM 4700-COPIA-RAIZ                                        
H P H            PERFORM 4710-COPIA-RAIZ-SI                                     
              END-IF                                                            
           END-IF                                                               
           .                                                                    
                                                                                
      ******************************************************************        
      * SE verifica que haya datos en la tabla y de existir al menos   *        
      * un registro se realiza la instruccion del insert, de otra forma         
      * no se realiza un insert y se pasa para ir por otra poliza               
      ******************************************************************        
       3300-INSERTA-EN-TABLAS.                                                  
           MOVE 1                    TO WK-PTR                                  
           MOVE 0                    TO W-QUERY-LONG                            
           MOVE SPACES               TO W-QUERY-TEXT                            
           STRING                                                               
             'SELECT '                               DELIMITED BY SIZE          
              WS-CAMPOPOL                            DELIMITED BY ' '           
             ' FROM '                                DELIMITED BY SIZE          
              WS-AMBIENTE                            DELIMITED BY SIZE          
              WS-TABLA-T                             DELIMITED BY SIZE          
             ' WHERE '                               DELIMITED BY SIZE          
             WS-CAMPOPOL                             DELIMITED BY ' '           
             ' = '''                                 DELIMITED BY SIZE          
              WS-TBL-SINOREC                         DELIMITED BY ' '           
             ''''    DELIMITED BY SIZE                                          
           INTO W-QUERY-TEXT WITH POINTER WK-PTR                                
           END-STRING                                                           
           SUBTRACT 1 FROM WK-PTR                                               
           MOVE WK-PTR                  TO W-QUERY-LONG                         
OXXX       PERFORM 3305-EJEC-QUERY                                              
           .                                                                    
      ******************************************************************        
      * SE CHECA LA POLIZA PARA DECIDIR SI SE COPIAN LOS REGISTROS     *        
      ******************************************************************        
       3305-EJEC-QUERY.                                                         
           MOVE 0  TO WS-ERR-PREPA                                              
           EXEC SQL                                                             
              PREPARE SENTEN1 ATTRIBUTES :WS-ATTRVAR FROM :W-QUERY              
           END-EXEC.                                                            
           PERFORM 3306-VALIDA-CODIGO.                                          
             EXEC SQL                                                           
               DECLARE CURSOR-C1 CURSOR FOR SENTEN1                             
           END-EXEC.                                                            
           PERFORM 3306-VALIDA-CODIGO.                                          
           EXEC SQL                                                             
               OPEN CURSOR-C1                                                   
           END-EXEC.                                                            
           PERFORM 3306-VALIDA-CODIGO.                                          
           EXEC SQL                                                             
               FETCH CURSOR-C1                                                  
               INTO                                                             
               :WS-SINOREC                                                      
           END-EXEC.                                                            
                                                                                
           EVALUATE SQLCODE                                                     
             WHEN  WN-SQLCODE-OK                                                
                  EXEC SQL                                                      
                     CLOSE CURSOR-C1                                            
                  END-EXEC                                                      
                  SET WS-PARA-INSERT TO TRUE                                    
aui               PERFORM 3330-INSERTA-EN-TABLAS                                
             WHEN  WN-SQLCODE-NOT-FOUND                                         
                 SET WS-NO-PARA-INSERT      TO TRUE                             
                 IF WS-WRITE                                                    
                   ADD  WC-1                  TO WS-IERR                        
                   MOVE SQLCODE               TO WS-OUT-SQLCODE                 
                   MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
                   MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
                   MOVE '3305-EJEC-QUERY    ' TO WS-OUT-PARRAFO                 
                   STRING                                                       
                      'NOHAY '                DELIMITED BY SIZE                 
                      WS-CAMPOPOL             DELIMITED BY ' '                  
                      '='                     DELIMITED BY SIZE                 
                      WS-TBL-SINOREC          DELIMITED BY SIZE                 
                     INTO WS-OUT-DESC                                           
                   END-STRING                                                   
                   PERFORM 1570-ESCRIBE-DESCARTADA                              
                 END-IF                                                         
                 EXEC SQL                                                       
                     CLOSE CURSOR-C1                                            
                 END-EXEC                                                       
             WHEN OTHER                                                         
                   SET WS-NO-PARA-INSERT      TO TRUE                           
                   ADD  WC-1                  TO WS-CANT-ERRORES                
                   MOVE 'SI'       TO WS-ROLLBACK                               
                   MOVE SQLCODE               TO WS-OUT-SQLCODE                 
                   MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
                   MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
                   MOVE '3305-EJEC-QUERY    ' TO WS-OUT-PARRAFO                 
                   STRING                                                       
                      'ERRDB2:'               DELIMITED BY SIZE                 
                      WS-CAMPOPOL             DELIMITED BY ' '                  
                      '='                     DELIMITED BY SIZE                 
                      WS-TBL-SINOREC          DELIMITED BY SIZE                 
                     INTO WS-OUT-DESC                                           
                   END-STRING                                                   
                   PERFORM 1570-ESCRIBE-DESCARTADA                              
                 STRING                                                         
                 '???????????????????????????????????????????????' '\N'         
                 ' ERROR EN SQL :' W-QUERY-TEXT                    '\N'         
                 '???????????????????????????????????????????????' '\N'         
                 DELIMITED BY SIZE                                              
                 INTO WS-CIFRASCONTROL                                          
                 CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
ALPXXX*           EXEC SQL                                                      
ALPXXX*              CLOSE CURSOR-C1                                            
ALPXXX*           END-EXEC                                                      
               MOVE WC-COD                   TO CDERR    OF KAELCWEZ            
               MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ            
               MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ            
               MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ            
               MOVE '3305-EJEC-QUERY       ' TO CDPARRAF OF KAELCWEZ            
                                                                                
               IF SQLCODE = -911                                                
                   MOVE 'S' TO SW-911                                           
                   MOVE 'S' TO SW-911-911                                       
                   ADD 1 TO WS-CANT-ERRORES                                     
               ELSE                                                             
                  PERFORM 9999-GESTION-ERRORES                                  
               END-IF                                                           
                                                                                
           END-EVALUATE.                                                        
      ******************************************************************        
      * VERIFICA EL VALOR DEL CODIGO DE RETORNO DEL PREPARE            *        
      ******************************************************************        
       3306-VALIDA-CODIGO.                                                      
           ADD WC-1 TO WS-ERR-PREPA                                             
           IF SQLCODE NOT = WN-SQLCODE-OK                                       
                   ADD  WC-1                  TO WS-CANT-ERRORES                
                   MOVE 'SI'       TO WS-ROLLBACK                               
                   MOVE SQLCODE               TO WS-OUT-SQLCODE                 
                   MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
                   MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
                   MOVE '3306-EJEC-QUERY    ' TO WS-OUT-PARRAFO                 
                   STRING                                                       
                      'ERRDB2:'               DELIMITED BY SIZE                 
                      WS-CAMPOPOL             DELIMITED BY ' '                  
                      '='                     DELIMITED BY SIZE                 
                      WS-TBL-SINOREC          DELIMITED BY SIZE                 
                      WS-ERPREPA(WS-ERR-PREPA) DELIMITED BY SIZE                
                     INTO WS-OUT-DESC                                           
                   END-STRING                                                   
                   PERFORM 1570-ESCRIBE-DESCARTADA                              
                 STRING                                                         
                 '???????????????????????????????????????????????' '\N'         
                 ' ERROR EN SQL :' W-QUERY-TEXT                    '\N'         
                 ' INSTRUCCION  :' WS-ERPREPA(WS-ERR-PREPA)        '\N'         
                 '???????????????????????????????????????????????' '\N'         
                 DELIMITED BY SIZE                                              
                 INTO WS-CIFRASCONTROL                                          
                 CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
               MOVE WC-COD                   TO CDERR    OF KAELCWEZ            
               MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ            
               MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ            
               MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ            
               MOVE '3306-VALIDA-CODIGO    ' TO CDPARRAF OF KAELCWEZ            
               IF SQLCODE = -911                                                
                   MOVE 'S' TO SW-911                                           
                   MOVE 'S' TO SW-911-911                                       
                   ADD 1 TO WS-CANT-ERRORES                                     
               ELSE                                                             
                                                                                
               PERFORM 9999-GESTION-ERRORES                                     
               END-IF                                                           
                                                                                
           END-IF.                                                              
      ******************************************************************        
      * SE INSERTAN LAS POLIZAS EN LAS TABLAS OPERATIVAS               *        
      ******************************************************************        
       3330-INSERTA-EN-TABLAS.                                                  
           MOVE 1                    TO WK-PTR                                  
           MOVE 0                    TO W-QUERY-LONG                            
           MOVE SPACES               TO W-QUERY-TEXT                            
           STRING                                                               
             'INSERT INTO '                          DELIMITED BY SIZE          
              WS-AMBIENTE                            DELIMITED BY SIZE          
              WS-TABLA-H                             DELIMITED BY SIZE          
             '(SELECT * FROM '                       DELIMITED BY SIZE          
              WS-AMBIENTE                            DELIMITED BY SIZE          
              WS-TABLA-T                             DELIMITED BY SIZE          
             ' WHERE '                               DELIMITED BY SIZE          
             WS-CAMPOPOL                             DELIMITED BY ' '           
             ' = '''                                 DELIMITED BY SIZE          
              WS-TBL-SINOREC                         DELIMITED BY ' '           
             ''')'                                   DELIMITED BY SIZE          
           INTO W-QUERY-TEXT WITH POINTER WK-PTR                                
           END-STRING                                                           
           SUBTRACT 1 FROM WK-PTR                                               
           MOVE WK-PTR                  TO W-QUERY-LONG                         
           PERFORM 3350-EJEC-QUERY                                              
           .                                                                    
      ******************************************************************        
      * SE COPIAN REGISTROS                                                     
      ******************************************************************        
       3350-EJEC-QUERY.                                                         
                                                                                
           EXEC SQL                                                             
              EXECUTE IMMEDIATE :W-QUERY                                        
           END-EXEC.                                                            
                                                                                
           EVALUATE SQLCODE                                                     
             WHEN  WN-SQLCODE-OK                                                
                 IF WS-WRITE                                                    
                   MOVE SQLCODE               TO WS-OUT-SQLCODE                 
                   MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
                   MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
                   MOVE '3350-EJEC-QUERY    ' TO WS-OUT-PARRAFO                 
                   MOVE 'INSERT CORRECTO '    TO WS-OUT-DESC                    
                   MOVE WS-TBL-SINOREC        TO WS-OUT-DESC(18:12)             
                   PERFORM 1570-ESCRIBE-DESCARTADA                              
                 END-IF                                                         
             WHEN  WN-SQLCODE-CLAVE-DUPLICADA                                   
                   SET WS-DUPLICADOS   TO TRUE                                  
                   MOVE 'SI'                  TO WS-ROLLBACK                    
                   MOVE SQLCODE               TO WS-OUT-SQLCODE                 
                   MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
                   MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
                   MOVE '3350-EJEC-QUERY   FD' TO WS-OUT-PARRAFO                
                   STRING                                                       
                     'DUPLICADO:'             DELIMITED BY SIZE                 
                      WS-CAMPOPOL             DELIMITED BY ' '                  
                      '='                     DELIMITED BY SIZE                 
                      WS-TBL-SINOREC          DELIMITED BY SIZE                 
                   INTO WS-OUT-DESC                                             
                   END-STRING                                                   
                   PERFORM 1570-ESCRIBE-DESCARTADA                              
             WHEN  WN-SQLCODE-NOT-FOUND                                         
                 IF WS-WRITE                                                    
                   ADD  WC-1                  TO WS-IERR                        
                   MOVE SQLCODE               TO WS-OUT-SQLCODE                 
                   MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
                   MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
                   MOVE '3350-EJEC-QUERY   FD' TO WS-OUT-PARRAFO                
                   STRING                                                       
                      'SIN '                  DELIMITED BY SIZE                 
                      WS-CAMPOPOL             DELIMITED BY ' '                  
                      '='                     DELIMITED BY SIZE                 
                      WS-TBL-SINOREC          DELIMITED BY SIZE                 
                     INTO WS-OUT-DESC                                           
                   END-STRING                                                   
                   PERFORM 1570-ESCRIBE-DESCARTADA                              
                 END-IF                                                         
             WHEN OTHER                                                         
                   IF SQLCODE = -911                                            
                      MOVE 'S' TO SW-911                                        
                      ADD 1 TO WS-CANT-ERRORES                                  
                          SET WS-DUPLICADOS   TO TRUE                           
                          MOVE 'SI'                  TO WS-ROLLBACK             
                          MOVE SQLCODE               TO WS-OUT-SQLCODE          
                          MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA           
                          MOVE WS-TABLA-H            TO WS-OUT-TABLA            
                          MOVE '3350-EJEX-QUERY     ' TO WS-OUT-PARRAFO         
                          STRING                                                
                           'CONTENCIO:'             DELIMITED BY SIZE           
                            WS-CAMPOPOL             DELIMITED BY ' '            
                            '='                     DELIMITED BY SIZE           
                            WS-LEE-CDNUMPOL         DELIMITED BY SIZE           
                            INTO WS-OUT-DESC                                    
                            END-STRING                                          
                          PERFORM 1570-ESCRIBE-DESCARTADA                       
                   ELSE                                                         
                   ADD  WC-1                  TO WS-CANT-ERRORES                
                   MOVE 'SI'       TO WS-ROLLBACK                               
                   MOVE SQLCODE               TO WS-OUT-SQLCODE                 
                   MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
                   MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
                   MOVE '3350-EJEC-QUERY    ' TO WS-OUT-PARRAFO                 
                   STRING                                                       
                      'ERRDB2:'               DELIMITED BY SIZE                 
                      WS-CAMPOPOL             DELIMITED BY ' '                  
                      '='                     DELIMITED BY SIZE                 
                      WS-TBL-SINOREC          DELIMITED BY SIZE                 
                     INTO WS-OUT-DESC                                           
                   END-STRING                                                   
                   PERFORM 1570-ESCRIBE-DESCARTADA                              
                   MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
                   MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
                   MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
                   MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
                   MOVE '3350-EJEC-QUERY       ' TO CDPARRAF OF KAELCWEZ        
                                                                                
                   IF SQLCODE = -911                                            
                      MOVE 'S' TO SW-911                                        
                      MOVE 'S' TO SW-911-911                                    
                      ADD 1 TO WS-CANT-ERRORES                                  
                   ELSE                                                         
                      PERFORM 9999-GESTION-ERRORES                              
                   END-IF                                                       
               END-IF                                                           
                                                                                
           END-EVALUATE.                                                        
                                                                                
      ******************************************************************        
      * SE BORRAN  CADA SINIESTRO     TABLAS OPERATIVAS                *        
      ******************************************************************        
       3400-DELETE-EN-TABLAS.                                                   
           MOVE 1                    TO WK-PTR                                  
           MOVE 0                    TO W-QUERY-LONG                            
           MOVE SPACES               TO W-QUERY-TEXT                            
           STRING                                                               
             'DELETE FROM '                          DELIMITED BY SIZE          
              WS-AMBIENTE                            DELIMITED BY SIZE          
              WS-TABLA-T                             DELIMITED BY SIZE          
             ' WHERE '                               DELIMITED BY SIZE          
             WS-CAMPOPOL                             DELIMITED BY ' '           
             ' = '''                                 DELIMITED BY SIZE          
              WS-TBL-SINOREC                         DELIMITED BY ' '           
             ''''                                  DELIMITED BY SIZE            
           INTO W-QUERY-TEXT WITH POINTER WK-PTR                                
           END-STRING                                                           
           SUBTRACT 1 FROM WK-PTR                                               
           MOVE WK-PTR                  TO W-QUERY-LONG                         
           PERFORM 3450-EJEC-QUERY                                              
           .                                                                    
      ******************************************************************        
      * SE BORRA   EL REGISTRO                                                  
      ******************************************************************        
       3450-EJEC-QUERY.                                                         
                                                                                
           EXEC SQL                                                             
              EXECUTE IMMEDIATE :W-QUERY                                        
           END-EXEC.                                                            
                                                                                
           EVALUATE SQLCODE                                                     
             WHEN  WN-SQLCODE-OK                                                
                 IF WS-WRITE                                                    
                   MOVE SQLCODE               TO WS-OUT-SQLCODE                 
                   MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
                   MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
                   MOVE '3450-EJEC-QUERY    ' TO WS-OUT-PARRAFO                 
                   MOVE 'BORRAR CORRECTO    ' TO WS-OUT-DESC                    
                   PERFORM 1570-ESCRIBE-DESCARTADA                              
                 END-IF                                                         
             WHEN  WN-SQLCODE-NOT-FOUND                                         
                   ADD  WC-1                  TO WS-CANT-ERRORES                
                   MOVE 'SI'       TO WS-ROLLBACK                               
                   MOVE SQLCODE               TO WS-OUT-SQLCODE                 
                   MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
                   MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
                   MOVE '3450-EJEC-QUERY   FE' TO WS-OUT-PARRAFO                
                   MOVE 'NO EXISTE BORRAR   ' TO WS-OUT-DESC                    
                   PERFORM 1570-ESCRIBE-DESCARTADA                              
                   MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
                   MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
                   MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
                   MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
                   MOVE '3450-EJEC-QUERY       ' TO CDPARRAF OF KAELCWEZ        
                                                                                
                   PERFORM 9999-GESTION-ERRORES                                 
                                                                                
             WHEN OTHER                                                         
                   ADD  WC-1                  TO WS-CANT-ERRORES                
                   MOVE 'SI'       TO WS-ROLLBACK                               
                   MOVE SQLCODE               TO WS-OUT-SQLCODE                 
                   MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
                   MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
                   MOVE '3450-EJEC-QUERY    ' TO WS-OUT-PARRAFO                 
                   MOVE 'ERR BORRAR DB2     ' TO WS-OUT-DESC                    
                   IF SQLCODE  = -911                                           
                      MOVE '3450-EJEC-QUERYC    '  TO WS-OUT-PARRAFO            
                      MOVE 'CONTENCION TABLA   '   TO WS-OUT-DESC               
                      SET WS-DUPLICADOS   TO TRUE                               
                      mOVE 'S' TO SW-911                                        
                      MOVE 'S' TO SW-911-911                                    
                      ADD 1 TO WS-CANT-ERRORES                                  
                      SET WS-DUPLICADOS   TO TRUE                               
                      MOVE 'SI'                  TO WS-ROLLBACK                 
                      MOVE SQLCODE               TO WS-OUT-SQLCODE              
                      MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA               
                      MOVE WS-TABLA-H            TO WS-OUT-TABLA                
                      MOVE '3450-EJECXQUERYZ    ' TO WS-OUT-PARRAFO             
                         STRING                                                 
                        'CONTENCIO:'             DELIMITED BY SIZE              
                         WS-CAMPOPOL             DELIMITED BY ' '               
                         '='                     DELIMITED BY SIZE              
                         WS-LEE-CDNUMPOL         DELIMITED BY SIZE              
                         INTO WS-OUT-DESC                                       
                      END-STRING                                                
                      PERFORM 1570-ESCRIBE-DESCARTADA                           
                 STRING                                                         
                 'Z8883??????????????????????????????????????????' '\N'         
                 ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
                 'Z8881??????????????????????????????????????????' '\N'         
                 DELIMITED BY SIZE                                              
                 INTO WS-CIFRASCONTROL                                          
                 CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
                   ELSE                                                         
                      MOVE WC-COD              TO CDERR    OF KAELCWEZ          
                      MOVE WC-DES01            TO DSARGU1  OF KAELCWEZ          
                      MOVE WC-PROGRAMA         TO DSARGU2  OF KAELCWEZ          
                      MOVE WS-ERPOLIZA         TO DSARGU3  OF KAELCWEZ          
                      MOVE '3450-EJEC-QUERY  ' TO CDPARRAF OF KAELCWEZ          
                      PERFORM 1570-ESCRIBE-DESCARTADA                           
                      IF SQLCODE = -911                                         
                         MOVE 'S' TO SW-911                                     
                         MOVE 'S' TO SW-911-911                                 
                         ADD 1 TO WS-CANT-ERRORES                               
                      ELSE                                                      
                 STRING                                                         
                 'X9999??????????????????????????????????????????' '\N'         
                 ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
                 'X9999??????????????????????????????????????????' '\N'         
                 DELIMITED BY SIZE                                              
                 INTO WS-CIFRASCONTROL                                          
                 CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
                      PERFORM 9999-GESTION-ERRORES                              
                      END-IF                                                    
                   END-IF                                                       
                                                                                
           END-EVALUATE.                                                        
                                                                                
123520*****************************************************************         
123520*                                                                         
123520*****************************************************************         
123530 3720-INSERTA-EN-PAPA.                                                    
ALPENC     IF WS-TABLA-T = 'KCIM06T' AND                                        
ALPENC        WS-TABLA-H = 'KCIM05H'                                            
ALPENC        PERFORM 3745-INSERTA-KACIM06H                                     
           ELSE                                                                 
              MOVE 1                    TO WK-PTR                               
              MOVE 0                    TO W-QUERY-LONG                         
              MOVE SPACES               TO W-QUERY-TEXT                         
              STRING                                                            
              'INSERT INTO '                      DELIMITED BY SIZE             
               WS-AMBIENTE                        DELIMITED BY SIZE             
               WS-TABLA-H                         DELIMITED BY SIZE             
              '(SELECT * FROM '                   DELIMITED BY SIZE             
               WS-AMBIENTE                        DELIMITED BY SIZE             
               WS-TABLA-T                         DELIMITED BY SIZE             
              ' WHERE CDNUMPOL'                   DELIMITED BY SIZE             
              ' = '''                             DELIMITED BY SIZE             
               WS-LEE-CDNUMPOL                    DELIMITED BY SIZE             
              ''')'                               DELIMITED BY SIZE             
              INTO W-QUERY-TEXT WITH POINTER WK-PTR                             
              END-STRING                                                        
              SUBTRACT 1 FROM WK-PTR                                            
              MOVE WK-PTR                  TO W-QUERY-LONG                      
              PERFORM 3740-EJEC-QUERY                                           
ALPENC     END-IF                                                               
           .                                                                    
      ******************************************************************        
      * SE COPIAN REGOSTROS                                                     
      ******************************************************************        
       3740-EJEC-QUERY.                                                         
                                                                                
           EXEC SQL                                                             
              EXECUTE IMMEDIATE :W-QUERY                                        
           END-EXEC.                                                            
                                                                                
           EVALUATE SQLCODE                                                     
             WHEN  WN-SQLCODE-OK                                                
                IF WS-TABLA-T = WC-KRBM10T                                      
                   PERFORM 4500-OBTEN-PRIMAS                                    
                END-IF                                                          
                IF WS-TABLA-T = WC-KCIM06T AND WS-WRITE                         
                   MOVE SQLCODE                TO WS-OUT-SQLCODE                
                   MOVE WS-LEE-CDNUMPOL        TO WS-OUT-POLIZA                 
                   MOVE WS-TABLA-H             TO WS-OUT-TABLA                  
                   MOVE '3740-EJEC-QUERY   FB' TO WS-OUT-PARRAFO                
                   MOVE 'INSERT PRINCIPAL OK ' TO WS-OUT-DESC                   
                   PERFORM 1570-ESCRIBE-DESCARTADA                              
                END-IF                                                          
             WHEN  WN-SQLCODE-CLAVE-DUPLICADA                                   
                   SET WS-DUPLICADOS   TO TRUE                                  
                   MOVE 'SI'                  TO WS-ROLLBACK                    
                   ADD  WC-1                  TO WS-CANT-ERRORES                
                   MOVE SQLCODE               TO WS-OUT-SQLCODE                 
                   MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
                   MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
                   MOVE '3740-EJEC-QUERY   FB' TO WS-OUT-PARRAFO                
                   MOVE 'POLIZA DUPLICADA   ' TO WS-OUT-DESC                    
                   PERFORM 1570-ESCRIBE-DESCARTADA                              
             WHEN  WN-SQLCODE-NOT-FOUND                                         
                   MOVE 'SI'                  TO WS-ROLLBACK                    
                   ADD  WC-1                  TO WS-CANT-ERRORES                
                   MOVE SQLCODE               TO WS-OUT-SQLCODE                 
                   MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
                   MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
                   MOVE '3740-EJEC-QUERY   FB' TO WS-OUT-PARRAFO                
                   MOVE 'POLIZA NO EXISTE   ' TO WS-OUT-DESC                    
                   PERFORM 1570-ESCRIBE-DESCARTADA                              
             WHEN OTHER                                                         
                   IF SQLCODE = -911                                            
                      MOVE 'S' TO SW-911                                        
                      ADD 1 TO WS-CANT-ERRORES                                  
                      SET WS-DUPLICADOS   TO TRUE                               
                      MOVE 'SI'                  TO WS-ROLLBACK                 
                      MOVE SQLCODE               TO WS-OUT-SQLCODE              
                      MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA               
                      MOVE WS-TABLA-H            TO WS-OUT-TABLA                
                      MOVE '3740-EJEC-QUERY     ' TO WS-OUT-PARRAFO             
                      STRING                                                    
                        'CONTENCIO:'             DELIMITED BY SIZE              
                         WS-CAMPOPOL             DELIMITED BY ' '               
                         '='                     DELIMITED BY SIZE              
                         WS-LEE-CDNUMPOL         DELIMITED BY SIZE              
                      INTO WS-OUT-DESC                                          
                      END-STRING                                                
                      PERFORM 1570-ESCRIBE-DESCARTADA                           
                   ELSE                                                         
                   ADD  WC-1                  TO WS-CANT-ERRORES                
                   MOVE 'SI'                  TO WS-ROLLBACK                    
                   MOVE SQLCODE               TO WS-OUT-SQLCODE                 
                   MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
                   MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
                   MOVE '3740-EJEC-QUERY     ' TO WS-OUT-PARRAFO                
                   MOVE 'ERROR TBL DB2      ' TO WS-OUT-DESC                    
                   PERFORM 1570-ESCRIBE-DESCARTADA                              
                 STRING                                                         
                 '???????????????????????????????????????????????' '\N'         
                 ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
                 '???????????????????????????????????????????????' '\N'         
                 DELIMITED BY SIZE                                              
                 INTO WS-CIFRASCONTROL                                          
                 CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
               MOVE WC-COD                   TO CDERR    OF KAELCWEZ            
               MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ            
               MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ            
               MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ            
               MOVE '3740-EJEC-QUERY       ' TO CDPARRAF OF KAELCWEZ            
                                                                                
               IF SQLCODE = -911                                                
                  MOVE 'S' TO SW-911                                            
                  MOVE 'S' TO SW-911-911                                        
                  ADD 1 TO WS-CANT-ERRORES                                      
               ELSE                                                             
               PERFORM 9999-GESTION-ERRORES                                     
               END-IF                                                           
           END-IF                                                               
           END-EVALUATE.                                                        
                                                                                
ALPENC 3745-INSERTA-KACIM06H.                                                   
ALPENC     EXEC SQL                                                             
ALPENC        INSERT INTO KCIM06H                                               
ALPENC         (SELECT * FROM KCIM06T                                           
ALPENC          WHERE CDNUMPOL =  :WS-LEE-CDNUMPOL                              
ALPENC          AND   CTVRSPOL <> :WC-VERSION-CERO                              
ALPENC          AND   CDUSUARI <> :WC-USER-HITORIA)                             
ALPENC     END-EXEC.                                                            
ALPENC     EVALUATE SQLCODE                                                     
ALPENC       WHEN  WN-SQLCODE-OK                                                
ALPENC          IF WS-TABLA-T = WC-KRBM10T                                      
ALPENC             PERFORM 4500-OBTEN-PRIMAS                                    
ALPENC          END-IF                                                          
ALPENC          IF WS-TABLA-T = WC-KCIM06T AND WS-WRITE                         
ALPENC             MOVE SQLCODE                TO WS-OUT-SQLCODE                
ALPENC             MOVE WS-LEE-CDNUMPOL        TO WS-OUT-POLIZA                 
ALPENC             MOVE WS-TABLA-H             TO WS-OUT-TABLA                  
ALPENC             MOVE '3745-ALTA-KCIM06T FB' TO WS-OUT-PARRAFO                
ALPENC             MOVE 'INSERT PRINCIPAL OK ' TO WS-OUT-DESC                   
ALPENC             PERFORM 1570-ESCRIBE-DESCARTADA                              
ALPENC          END-IF                                                          
ALPENC       WHEN  WN-SQLCODE-CLAVE-DUPLICADA                                   
ALPENC             SET WS-DUPLICADOS   TO TRUE                                  
ALPENC             MOVE 'SI'                  TO WS-ROLLBACK                    
ALPENC             ADD  WC-1                  TO WS-CANT-ERRORES                
ALPENC             MOVE SQLCODE               TO WS-OUT-SQLCODE                 
ALPENC             MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
ALPENC             MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
ALPENC             MOVE '3745-ALTA-KCIM06T FB' TO WS-OUT-PARRAFO                
ALPENC             MOVE 'POLIZA DUPLICADA   ' TO WS-OUT-DESC                    
ALPENC             PERFORM 1570-ESCRIBE-DESCARTADA                              
ALPENC       WHEN  WN-SQLCODE-NOT-FOUND                                         
ALPENC             MOVE 'SI'                  TO WS-ROLLBACK                    
ALPENC             ADD  WC-1                  TO WS-CANT-ERRORES                
ALPENC             MOVE SQLCODE               TO WS-OUT-SQLCODE                 
ALPENC             MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
ALPENC             MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
ALPENC             MOVE '3745-ALTA-KCIM06T FB' TO WS-OUT-PARRAFO                
ALPENC             MOVE 'POLIZA NO EXISTE   ' TO WS-OUT-DESC                    
ALPENC             PERFORM 1570-ESCRIBE-DESCARTADA                              
ALPENC       WHEN OTHER                                                         
                   IF SQLCODE = -911                                            
                      MOVE 'S' TO SW-911                                        
                      ADD 1 TO WS-CANT-ERRORES                                  
                      SET WS-DUPLICADOS   TO TRUE                               
                      MOVE 'SI'                  TO WS-ROLLBACK                 
                      MOVE SQLCODE               TO WS-OUT-SQLCODE              
                      MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA               
                      MOVE WS-TABLA-H            TO WS-OUT-TABLA                
                      MOVE '3745-ALTA-KCIM06T   ' TO WS-OUT-PARRAFO             
                      STRING                                                    
                        'CONTENCIO:'             DELIMITED BY SIZE              
                         WS-CAMPOPOL             DELIMITED BY ' '               
                         '='                     DELIMITED BY SIZE              
                         WS-LEE-CDNUMPOL         DELIMITED BY SIZE              
                      INTO WS-OUT-DESC                                          
                      END-STRING                                                
                      PERFORM 1570-ESCRIBE-DESCARTADA                           
                   ELSE                                                         
ALPENC             ADD  WC-1                  TO WS-CANT-ERRORES                
ALPENC             MOVE 'SI'                  TO WS-ROLLBACK                    
ALPENC             MOVE SQLCODE               TO WS-OUT-SQLCODE                 
ALPENC             MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
ALPENC             MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
ALPENC             MOVE '3745-ALTA-KCIM06T   ' TO WS-OUT-PARRAFO                
ALPENC             MOVE 'ERROR TBL DB2      ' TO WS-OUT-DESC                    
ALPENC             PERFORM 1570-ESCRIBE-DESCARTADA                              
ALPENC           STRING                                                         
ALPENC           '???????????????????????????????????????????????' '\N'         
ALPENC           ' 3745-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
ALPENC           '???????????????????????????????????????????????' '\N'         
ALPENC           DELIMITED BY SIZE                                              
ALPENC           INTO WS-CIFRASCONTROL                                          
ALPENC           CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
ALPENC         MOVE WC-COD                   TO CDERR    OF KAELCWEZ            
ALPENC         MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ            
ALPENC         MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ            
ALPENC         MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ            
ALPENC         MOVE '3745-ALTA-KCIM06T     ' TO CDPARRAF OF KAELCWEZ            
ALPENC                                                                          
               IF SQLCODE = -911                                                
                  MOVE 'S' TO SW-911                                            
                  MOVE 'S' TO SW-911-911                                        
                  ADD 1 TO WS-CANT-ERRORES                                      
               ELSE                                                             
ALPENC         PERFORM 9999-GESTION-ERRORES                                     
               END-IF                                                           
               END-IF                                                           
ALPENC     END-EVALUATE.                                                        
ALPENC 3745-INSERTA-KACIM06H-FIN.                                               
                                                                                
123520*****************************************************************         
123520*                                                                         
123520*****************************************************************         
123530 3750-DELETE-PAPA.                                                        
           MOVE 1                    TO WK-PTR                                  
           MOVE 0                    TO W-QUERY-LONG                            
           MOVE SPACES               TO W-QUERY-TEXT                            
           STRING                                                               
             'DELETE FROM '                          DELIMITED BY SIZE          
              WS-AMBIENTE                            DELIMITED BY SIZE          
              WS-TABLA-T                             DELIMITED BY SIZE          
             ' WHERE CDNUMPOL'                       DELIMITED BY SIZE          
             ' = '''                                 DELIMITED BY SIZE          
              WS-LEE-CDNUMPOL                        DELIMITED BY SIZE          
             ''''                                  DELIMITED BY SIZE            
           INTO W-QUERY-TEXT WITH POINTER WK-PTR                                
           END-STRING                                                           
           SUBTRACT 1 FROM WK-PTR                                               
           MOVE WK-PTR                  TO W-QUERY-LONG                         
           PERFORM 3780-EJEC-QUERY                                              
           .                                                                    
      ******************************************************************        
      * SE BORRAN REGISTROS                                                     
      ******************************************************************        
       3780-EJEC-QUERY.                                                         
                                                                                
           EXEC SQL                                                             
              EXECUTE IMMEDIATE :W-QUERY                                        
           END-EXEC.                                                            
                                                                                
           EVALUATE SQLCODE                                                     
             WHEN  WN-SQLCODE-OK                                                
                 IF WS-WRITE                                                    
                   MOVE SQLCODE               TO WS-OUT-SQLCODE                 
                   MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
                   MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
                   MOVE '3780-EJEC-QUERY    ' TO WS-OUT-PARRAFO                 
                   MOVE 'BORRA PRINCIPAL OK ' TO WS-OUT-DESC                    
                   PERFORM 1570-ESCRIBE-DESCARTADA                              
                 END-IF                                                         
             WHEN  WN-SQLCODE-NOT-FOUND                                         
                   ADD  WC-1       TO WS-IERR                                   
                   MOVE 'SI'       TO WS-ROLLBACK                               
                   ADD  WC-1                  TO WS-CANT-ERRORES                
                   MOVE SQLCODE               TO WS-OUT-SQLCODE                 
                   MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
                   MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
                   MOVE '3780-EJEC-QUERY    ' TO WS-OUT-PARRAFO                 
                   MOVE 'NO EXISTE BORRAR   ' TO WS-OUT-DESC                    
                   PERFORM 1570-ESCRIBE-DESCARTADA                              
               MOVE WC-COD                   TO CDERR    OF KAELCWEZ            
               MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ            
               MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ            
               MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ            
               MOVE '3780-EJEC-QUERY       ' TO CDPARRAF OF KAELCWEZ            
                                                                                
               PERFORM 9999-GESTION-ERRORES                                     
                                                                                
             WHEN OTHER                                                         
                   ADD  WC-1                  TO WS-CANT-ERRORES                
                   MOVE 'SI'       TO WS-ROLLBACK                               
                   MOVE SQLCODE               TO WS-OUT-SQLCODE                 
                   MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
                   MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
                   MOVE '3780-EJEC-QUERY    ' TO WS-OUT-PARRAFO                 
                   MOVE 'ERR BORRAR DB2     ' TO WS-OUT-DESC                    
                   PERFORM 1570-ESCRIBE-DESCARTADA                              
                 STRING                                                         
                 '???????????????????????????????????????????????' '\N'         
                 ' 3780-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
                 '???????????????????????????????????????????????' '\N'         
                 DELIMITED BY SIZE                                              
                 INTO WS-CIFRASCONTROL                                          
                 CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
               MOVE WC-COD                   TO CDERR    OF KAELCWEZ            
               MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ            
               MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ            
               MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ            
               MOVE '3780-EJEC-QUERY       ' TO CDPARRAF OF KAELCWEZ            
                                                                                
               IF SQLCODE = -911                                                
                  MOVE 'S' TO SW-911                                            
                  MOVE 'S' TO SW-911-911                                        
                  ADD 1 TO WS-CANT-ERRORES                                      
               ELSE                                                             
               PERFORM 9999-GESTION-ERRORES                                     
               END-IF                                                           
                                                                                
           END-EVALUATE.                                                        
                                                                                
      ******************************************************************        
      * SE PROCESAN LOS RECIBOS                                                 
      ******************************************************************        
JNB03  4000-COPIA-RECIBOS.                                                      
           MOVE "4000-COPIA-RECIBOS    " TO CDPARRAF OF KAELCWEZ.               
           PERFORM 1320-ABRE-CUR-RECIBO                                         
           MOVE 0   TO WS-CANT-RECIBOS                                          
           PERFORM 1340-LEE-CUR-RECIBO                                          
             PERFORM  UNTIL WS-NO-HAY-RECIBOS                                   
               MOVE WC-1 TO WS-ITBLS                                            
               PERFORM  UNTIL WS-ITBLS > WC-MAX-RECIBO                          
                   MOVE WC-TBLREC-T(WS-ITBLS) TO WS-TABLA-T                     
                   MOVE WC-TBLREC-H(WS-ITBLS) TO WS-TABLA-H                     
ALPOP1             MOVE WC-CDNUMREC(WS-ITBLS) TO WS-CAMPOPOL                    
                   PERFORM 3300-INSERTA-EN-TABLAS                               
                   IF  SQLCODE = WN-SQLCODE-OK                                  
                   AND WS-PARA-INSERT                                           
                      PERFORM 3400-DELETE-EN-TABLAS                             
                   END-IF                                                       
                   IF WS-ROLLBACK = 'SI' OR SW-911-911 = 'S'                    
                      SET WS-NO-HAY-RECIBOS TO TRUE                             
                      MOVE 98 TO WS-ITBLS                                       
                 STRING                                                         
                 'A4444 SI 911     4000                          ' '\N'         
                 ' 4000-COPIA-RECIBOS    :' W-QUERY-TEXT   '\N'                 
                 'A4444??????????????????????????????????????????' '\N'         
                 DELIMITED BY SIZE                                              
                 INTO WS-CIFRASCONTROL                                          
                 CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
                                                                                
                   END-IF                                                       
                   ADD WC-1 TO WS-ITBLS                                         
               END-PERFORM                                                      
               IF WS-ROLLBACK = 'SI' OR SW-911-911 = 'S'                        
                  SET WS-NO-HAY-RECIBOS    TO TRUE                              
                  CONTINUE                                                      
               ELSE                                                             
                  IF WS-HAY-RECIBOS                                             
                     PERFORM 1340-LEE-CUR-RECIBO                                
                  END-IF                                                        
               END-IF                                                           
             END-PERFORM                                                        
             IF WS-ROLLBACK = 'SI' OR SW-911-911 = 'S'                          
                CONTINUE                                                        
             ELSE                                                               
                PERFORM 1360-CIERRA-CUR-RECIBO                                  
             END-IF                                                             
             IF WS-ROLLBACK = 'SI' OR SW-911-911 = 'S'                          
                CONTINUE                                                        
             ELSE                                                               
                IF WS-CANT-RECIBOS > 0  AND WS-CANT-ERRORES = 0                 
                   MOVE 'KRBM10T' TO WS-TABLA-T                                 
                   MOVE 'KRBM10H' TO WS-TABLA-H                                 
                   PERFORM 4700-COPIA-RAIZ                                      
                END-IF                                                          
             END-IF                                                             
           .                                                                    
123520*****************************************************************         
123520*                                                                         
123520*****************************************************************         
123530 4500-OBTEN-PRIMAS.                                                       
123520*****************************************************************         
123520*                                                                         
           EXEC SQL                                                             
              SELECT SUM(IMTOTREC)                                              
              INTO :KRBM10T.IMTOTREC                                            
              FROM KRBM10T                                                      
              WHERE CDNUMPOL = :KRBM10T.CDNUMPOL                                
              WITH UR                                                           
           END-EXEC                                                             
               EVALUATE SQLCODE                                                 
                  WHEN  WN-SQLCODE-OK                                           
                     CONTINUE                                                   
                  WHEN OTHER                                                    
                        MOVE SPACES               TO WS-TBL-SINOREC             
                        MOVE WC-ERROR-FETCH         TO CDERR                    
                        MOVE SQLCODE               TO WS-OUT-SQLCODE            
                        MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA             
                        MOVE 'KRBM10T'             TO WS-OUT-TABLA              
                        MOVE '4500-OBTEN-PRIMAS   ' TO WS-OUT-PARRAFO           
                        MOVE 'TABLA CON PROBLEMAS' TO WS-OUT-DESC               
                        PERFORM 1570-ESCRIBE-DESCARTADA                         
                        MOVE 'SELECT'             TO DSARGU1 OF ENTRADA         
                        MOVE 'KRBM10T'            TO DSARGU2 OF ENTRADA         
                        MOVE 'SELECT-ERROR'       TO DSARGU3 OF ENTRADA         
                        MOVE '4500-OBTEN-PRIMAS  '  TO CDPARRAF                 
                                                                                
               IF SQLCODE = -911                                                
                  MOVE 'S' TO SW-911                                            
                  MOVE 'S' TO SW-911-911                                        
                  ADD 1 TO WS-CANT-ERRORES                                      
               ELSE                                                             
                  PERFORM 9999-GESTION-ERRORES                                  
               END-IF                                                           
                                                                                
                                                                                
               END-EVALUATE.                                                    
123520*****************************************************************         
123530 4700-COPIA-RAIZ.                                                         
           MOVE SPACES    TO WS-CAMPOPOL                                        
           PERFORM 3720-INSERTA-EN-PAPA                                         
           IF SQLCODE = WN-SQLCODE-OK                                           
      *    OR SQLCODE = WN-SQLCODE-CLAVE-DUPLICADA                              
              PERFORM 3750-DELETE-PAPA                                          
           END-IF.                                                              
      ******************************************************************        
      * SE PROCESAN COASGURO                                                    
      ******************************************************************        
       5000-COPIA-COASEGURO.                                                    
123540     MOVE "5000-COPIA-COASEGURO. " TO CDPARRAF OF KAELCWEZ.               
           PERFORM 5320-ABRE-CUR-COASEGURO                                      
           MOVE 0 TO WS-CANT-COASEGU                                            
           PERFORM 5340-LEE-CUR-COASEGURO                                       
             PERFORM  UNTIL WS-NO-HAY-COASEGU                                   
               MOVE WC-1 TO WS-ITBLS                                            
               PERFORM  UNTIL WS-ITBLS > WC-MAX-COASEG                          
                   MOVE WC-TBLCOA-T(WS-ITBLS) TO WS-TABLA-T                     
                   MOVE WC-TBLCOA-H(WS-ITBLS) TO WS-TABLA-H                     
ALPOP1*            IF WC-CDRECCOA(WS-ITBLS) = 'CDRECCOA'                        
ALPOP1*               MOVE WC-CDRECCOA(WS-ITBLS) TO WS-CAMPOPOL                 
ALPOP1             MOVE WC-CDRECCOA(WS-ITBLS) TO WS-CAMPOPOL                    
ALPOP1*            ELSE                                                         
ALPOP1*               STRING                                                    
ALPOP1*                 'SUBSTR('              DELIMITED BY SIZE                
ALPOP1*                 WC-CDRECCOA(WS-ITBLS)  DELIMITED BY SIZE                
ALPOP1*                 ',1,12)'               DELIMITED BY SIZE                
ALPOP1*                 INTO WS-CAMPOPOL                                        
ALPOP1*               END-STRING                                                
ALPOP1*            END-IF                                                       
                   PERFORM 3300-INSERTA-EN-TABLAS                               
                   IF  SQLCODE = WN-SQLCODE-OK                                  
                   AND WS-PARA-INSERT                                           
                      PERFORM 3400-DELETE-EN-TABLAS                             
                   END-IF                                                       
                   IF WS-ROLLBACK = 'SI'                                        
                      MOVE 98 TO WS-ITBLS                                       
                   END-IF                                                       
                   ADD WC-1 TO WS-ITBLS                                         
               END-PERFORM                                                      
               PERFORM 5340-LEE-CUR-COASEGURO                                   
             END-PERFORM                                                        
             PERFORM 5360-CIERRA-CUR-COASEGURO                                  
             IF WS-CANT-COASEGU > 0  AND WS-CANT-ERRORES = 0                    
                MOVE 'KCGM15T' TO WS-TABLA-T                                    
                MOVE 'KCGM15H' TO WS-TABLA-H                                    
                PERFORM 4700-COPIA-RAIZ                                         
             END-IF                                                             
           .                                                                    
      ***************************************************************           
      *ABRE EL CURSOR DE COASEGURO                                  *           
      ***************************************************************           
       5320-ABRE-CUR-COASEGURO.                                                 
                EXEC SQL                                                        
                  OPEN CUR-COASEGURO                                            
                END-EXEC                                                        
                                                                                
                IF SQLCODE = 0 THEN                                             
                   SET WS-OPEN-CUR-COASEG TO TRUE                               
                ELSE                                                            
                  SET WS-OPEN-CUR-COASEG       TO TRUE                          
                  MOVE SQLCODE               TO WS-OUT-SQLCODE                  
                  MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                   
                  MOVE 'KCGM15T'             TO WS-OUT-TABLA                    
                  MOVE '5320-ABRE-CUR-COASEG' TO  WS-OUT-PARRAFO                
                  MOVE 'NO HABRE CURSOR     ' TO WS-OUT-DESC                    
                  PERFORM 1570-ESCRIBE-DESCARTADA                               
                  MOVE    WC-ERR-OPEN-CURSOR    TO   CDERR                      
                  MOVE    'KCGM15T'             TO DSARGU1 OF ENTRADA           
                  MOVE    'ABRE CURSOR'         TO DSARGU2 OF ENTRADA           
                  MOVE    'SQLCODE:'            TO DSARGU3 OF ENTRADA           
                  MOVE  '5320-ABRE-CUR-COASEG'  TO   CDPARRAF                   
                  PERFORM 9999-GESTION-ERRORES                                  
                                                                                
                END-IF.                                                         
      *****************************************************************         
      * LEE EL CURSOR DE RECIBOS                                      *         
      *****************************************************************         
       5340-LEE-CUR-COASEGURO.                                                  
             EXEC SQL                                                           
               FETCH CUR-COASEGURO                                              
               INTO                                                             
               :KCGM15T.CDRECCOA                                                
             END-EXEC                                                           
             MOVE SPACES TO WS-TBL-SINOREC                                      
             SET WS-FILTRO-6 TO TRUE                                            
               EVALUATE SQLCODE                                                 
                  WHEN  WN-SQLCODE-OK                                           
                     MOVE CDRECCOA OF KCGM15T TO WS-TBL-SINOREC                 
                     SET WS-HAY-COASEGU     TO TRUE                             
                     ADD WC-1               TO WS-CANT-COASEGU                  
                  WHEN WN-SQLCODE-NOT-FOUND                                     
                     MOVE SPACES               TO WS-TBL-SINOREC                
                     SET  WS-NO-HAY-COASEGU    TO TRUE                          
                     IF WS-CANT-COASEGU = 0 AND WS-WRITE                        
                        MOVE SQLCODE               TO WS-OUT-SQLCODE            
                        MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA             
                        MOVE 'KCGM15T'             TO WS-OUT-TABLA              
                        MOVE '5340-LEE-CUR-COASEGU' TO WS-OUT-PARRAFO           
                        MOVE 'POLIZA SIN COASEGUROS' TO WS-OUT-DESC             
                        PERFORM 1570-ESCRIBE-DESCARTADA                         
                     END-IF                                                     
                  WHEN OTHER                                                    
      *                 MOVE SQLCODE TO WS-EDIT-SQL                             
                        MOVE SPACES               TO WS-TBL-SINOREC             
                        SET WS-NO-HAY-COASEGU       TO TRUE                     
                        MOVE WC-ERROR-FETCH         TO CDERR                    
                        MOVE SQLCODE               TO WS-OUT-SQLCODE            
                        MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA             
                        MOVE 'KCGM15T'             TO WS-OUT-TABLA              
                        MOVE '5340-LEE-CUR-COASEGU' TO WS-OUT-PARRAFO           
                        MOVE 'TABLA CON PROBLEMAS' TO WS-OUT-DESC               
                        PERFORM 1570-ESCRIBE-DESCARTADA                         
                        MOVE 'FETCH '             TO DSARGU1 OF ENTRADA         
                        MOVE 'KCGM15T'            TO DSARGU2 OF ENTRADA         
                        MOVE 'FECTCH-ERROR'       TO DSARGU3 OF ENTRADA         
                        MOVE '5340-LEE-CUR-COASEGURO' TO CDPARRAF               
                                                                                
               IF SQLCODE = -911                                                
                  MOVE 'S' TO SW-911                                            
                  MOVE 'S' TO SW-911-911                                        
                  ADD 1 TO WS-CANT-ERRORES                                      
               ELSE                                                             
                  PERFORM 9999-GESTION-ERRORES                                  
               END-IF                                                           
                                                                                
                                                                                
               END-EVALUATE.                                                    
      *****************************************************************         
      * CIERRA EL CURSOR DE RECIBOS                                   *         
      *****************************************************************         
       5360-CIERRA-CUR-COASEGURO.                                               
                EXEC SQL                                                        
                  CLOSE CUR-COASEGURO                                           
                END-EXEC                                                        
                                                                                
                IF SQLCODE = WN-SQLCODE-OK THEN                                 
                   SET WS-CLOSE-CUR-COASEG      TO TRUE                         
                ELSE                                                            
                  SET WS-CLOSE-CUR-COASEG       TO TRUE                         
                  MOVE    WC-ERR-CLOSE-CURSOR   TO   CDERR                      
                  MOVE    'CLOS CUR'            TO DSARGU1 OF ENTRADA           
                  MOVE    'KCGM15T'             TO DSARGU2 OF ENTRADA           
                  MOVE    'SQLCODE:'            TO DSARGU3 OF ENTRADA           
                  MOVE    '5360-CIERRA-CUR-COASEG' TO CDPARRAF                  
                  PERFORM 9999-GESTION-ERRORES                                  
                                                                                
                END-IF.                                                         
ALPOP1                                                                          
       3300-INSERTA-ESP-SIN.                                                    
           EVALUATE WS-TIPO-TABLA                                               
           WHEN 'KREM24T'                                                       
              EXEC SQL                                                          
                   INSERT INTO KREM24H (SELECT * FROM  KREM24T                  
                                 WHERE  CDNUMPOL = :WS-TBL-CDNUMPOL AND         
                                        CDSINIES = :WS-TBL-CDSINIES)            
              END-EXEC                                                          
                                                                                
           WHEN 'KCDARST'                                                       
              EXEC SQL                                                          
                INSERT INTO KCDARSH (SELECT * FROM  KCDARST                     
                              WHERE  CDNUMPOL = :WS-TBL-CDNUMPOL AND            
                                     CDSINIES = :WS-TBL-CDSINIES)               
              END-EXEC                                                          
                                                                                
           WHEN 'KREM44T'                                                       
              EXEC SQL                                                          
                INSERT INTO KREM44H (SELECT * FROM  KREM44T                     
                              WHERE  CDNUMPOL = :WS-TBL-CDNUMPOL AND            
                                     CDSINIES = :WS-TBL-CDSINIES)               
              END-EXEC                                                          
                                                                                
           WHEN 'KSIMB4T'                                                       
              EXEC SQL                                                          
                INSERT INTO KSIMB4H (SELECT * FROM  KSIMB4T                     
                              WHERE  CDNUMPOL = :WS-TBL-CDNUMPOL AND            
                                     CDSINIES = :WS-TBL-CDSINIES)               
              END-EXEC                                                          
                                                                                
           WHEN 'KREMB9T'                                                       
              EXEC SQL                                                          
                INSERT INTO KREMB9H (SELECT * FROM  KREMB9T                     
                              WHERE  CDNUMPOL = :WS-TBL-CDNUMPOL AND            
                                     CDSINIES = :WS-TBL-CDSINIES)               
              END-EXEC                                                          
                                                                                
           WHEN 'KREMD7T'                                                       
              EXEC SQL                                                          
                INSERT INTO KREMD7H (SELECT * FROM  KREMD7T                     
                              WHERE  CDNUMPOL = :WS-TBL-CDNUMPOL AND            
                                     CDSINIES = :WS-TBL-CDSINIES)               
              END-EXEC                                                          
                                                                                
           WHEN 'KREMB6T'                                                       
              EXEC SQL                                                          
                INSERT INTO KREMB6H (SELECT * FROM  KREMB6T                     
                              WHERE  CDNUMPOL = :WS-TBL-CDNUMPOL AND            
                                     CDSINIES = :WS-TBL-CDSINIES)               
              END-EXEC                                                          
                                                                                
           WHEN 'KREMB8T'                                                       
              EXEC SQL                                                          
                INSERT INTO KREMB8H (SELECT * FROM  KREMB8T                     
                              WHERE  CDNUMPOL = :WS-TBL-CDNUMPOL AND            
                                     CDSINIES = :WS-TBL-CDSINIES)               
              END-EXEC                                                          
                                                                                
           WHEN 'KREMB7T'                                                       
              EXEC SQL                                                          
                INSERT INTO KREMB7H (SELECT * FROM  KREMB7T                     
                              WHERE  CDNUMPOL = :WS-TBL-CDNUMPOL AND            
                                     CDSINIES = :WS-TBL-CDSINIES)               
              END-EXEC                                                          
                                                                                
           WHEN 'KREMC1T'                                                       
              EXEC SQL                                                          
                INSERT INTO KREMC1H (SELECT * FROM  KREMC1T                     
                              WHERE  CDNUMPOL = :WS-TBL-CDNUMPOL AND            
                                     CDSINIES = :WS-TBL-CDSINIES)               
              END-EXEC                                                          
                                                                                
           WHEN 'KREMC3T'                                                       
              EXEC SQL                                                          
                INSERT INTO KREMC3H (SELECT * FROM  KREMC3T                     
                              WHERE  CDNUMPOL = :WS-TBL-CDNUMPOL AND            
                                     CDSINIES = :WS-TBL-CDSINIES)               
              END-EXEC                                                          
                                                                                
           WHEN 'KREMC2T'                                                       
              EXEC SQL                                                          
                INSERT INTO KREMC2H (SELECT * FROM  KREMC2T                     
                              WHERE  CDNUMPOL = :WS-TBL-CDNUMPOL AND            
                                     CDSINIES = :WS-TBL-CDSINIES)               
              END-EXEC                                                          
                                                                                
           WHEN 'KREM25T'                                                       
              EXEC SQL                                                          
                INSERT INTO KREM25H (SELECT * FROM  KREM25T                     
                              WHERE  CDNUMPOL = :WS-TBL-CDNUMPOL AND            
                                     CDSINIES = :WS-TBL-CDSINIES)               
              END-EXEC                                                          
                                                                                
           WHEN 'KREMC4T'                                                       
              EXEC SQL                                                          
                INSERT INTO KREMC4H (SELECT * FROM  KREMC4T                     
                              WHERE  CDNUMPOL = :WS-TBL-CDNUMPOL AND            
                                     CDSINIES = :WS-TBL-CDSINIES)               
              END-EXEC                                                          
                                                                                
           WHEN 'KREMB0T'                                                       
              EXEC SQL                                                          
                INSERT INTO KREMB0H (SELECT * FROM  KREMB0T                     
                              WHERE  CDNUMPOL = :WS-TBL-CDNUMPOL AND            
                                     CDSINIES = :WS-TBL-CDSINIES)               
              END-EXEC                                                          
                                                                                
           WHEN 'KREMC0T'                                                       
              EXEC SQL                                                          
                INSERT INTO KREMC0H (SELECT * FROM  KREMC0T                     
                              WHERE  CDNUMPOL = :WS-TBL-CDNUMPOL AND            
                                     CDSINIES = :WS-TBL-CDSINIES)               
              END-EXEC                                                          
                                                                                
           WHEN 'KREMD0T'                                                       
              EXEC SQL                                                          
                INSERT INTO KREMD0H (SELECT * FROM  KREMD0T                     
                              WHERE  CDNUMPOL = :WS-TBL-CDNUMPOL AND            
                                     CDSINIES = :WS-TBL-CDSINIES)               
              END-EXEC                                                          
                                                                                
           END-EVALUATE                                                         
                                                                                
           PERFORM 3300-CHECA-ESPI.                                             
                                                                                
      *                                                                         
      *     borra especial                                                      
      *                                                                         
                                                                                
           EVALUATE WS-TIPO-TABLA                                               
           WHEN 'KREM24T'                                                       
              EXEC SQL                                                          
                DELETE FROM KREM24T                                             
                              WHERE  CDNUMPOL = :WS-TBL-CDNUMPOL AND            
                                     CDSINIES = :WS-TBL-CDSINIES                
                END-EXEC                                                        
                                                                                
           WHEN 'KCDARST'                                                       
              EXEC SQL                                                          
                DELETE FROM KCDARST                                             
                              WHERE  CDNUMPOL = :WS-TBL-CDNUMPOL AND            
                                     CDSINIES = :WS-TBL-CDSINIES                
                END-EXEC                                                        
                                                                                
           WHEN 'KREM44T'                                                       
              EXEC SQL                                                          
                DELETE FROM KREM44T                                             
                              WHERE  CDNUMPOL = :WS-TBL-CDNUMPOL AND            
                                     CDSINIES = :WS-TBL-CDSINIES                
                END-EXEC                                                        
                                                                                
           WHEN 'KSIMB4T'                                                       
              EXEC SQL                                                          
                DELETE FROM KSIMB4T                                             
                              WHERE  CDNUMPOL = :WS-TBL-CDNUMPOL AND            
                                     CDSINIES = :WS-TBL-CDSINIES                
                END-EXEC                                                        
                                                                                
           WHEN 'KREMB9T'                                                       
              EXEC SQL                                                          
                DELETE FROM KREMB9T                                             
                              WHERE  CDNUMPOL = :WS-TBL-CDNUMPOL AND            
                                     CDSINIES = :WS-TBL-CDSINIES                
                END-EXEC                                                        
                                                                                
           WHEN 'KREMD7T'                                                       
              EXEC SQL                                                          
                DELETE FROM KREMD7T                                             
                              WHERE  CDNUMPOL = :WS-TBL-CDNUMPOL AND            
                                     CDSINIES = :WS-TBL-CDSINIES                
                END-EXEC                                                        
                                                                                
           WHEN 'KREMB6T'                                                       
              EXEC SQL                                                          
                DELETE FROM KREMB6T                                             
                              WHERE  CDNUMPOL = :WS-TBL-CDNUMPOL AND            
                                     CDSINIES = :WS-TBL-CDSINIES                
                END-EXEC                                                        
                                                                                
           WHEN 'KREMB8T'                                                       
              EXEC SQL                                                          
                DELETE FROM KREMB8T                                             
                              WHERE  CDNUMPOL = :WS-TBL-CDNUMPOL AND            
                                     CDSINIES = :WS-TBL-CDSINIES                
                END-EXEC                                                        
                                                                                
           WHEN 'KREMB7T'                                                       
              EXEC SQL                                                          
                DELETE FROM KREMB7T                                             
                              WHERE  CDNUMPOL = :WS-TBL-CDNUMPOL AND            
                                     CDSINIES = :WS-TBL-CDSINIES                
                END-EXEC                                                        
                                                                                
           WHEN 'KREMC1T'                                                       
              EXEC SQL                                                          
                DELETE FROM KREMC1T                                             
                              WHERE  CDNUMPOL = :WS-TBL-CDNUMPOL AND            
                                     CDSINIES = :WS-TBL-CDSINIES                
                END-EXEC                                                        
                                                                                
           WHEN 'KREMC3T'                                                       
              EXEC SQL                                                          
                DELETE FROM KREMC3T                                             
                              WHERE  CDNUMPOL = :WS-TBL-CDNUMPOL AND            
                                     CDSINIES = :WS-TBL-CDSINIES                
                END-EXEC                                                        
                                                                                
           WHEN 'KREMC2T'                                                       
              EXEC SQL                                                          
                DELETE FROM KREMC2T                                             
                              WHERE  CDNUMPOL = :WS-TBL-CDNUMPOL AND            
                                     CDSINIES = :WS-TBL-CDSINIES                
                END-EXEC                                                        
                                                                                
           WHEN 'KREM25T'                                                       
              EXEC SQL                                                          
                DELETE FROM KREM25T                                             
                              WHERE  CDNUMPOL = :WS-TBL-CDNUMPOL AND            
                                     CDSINIES = :WS-TBL-CDSINIES                
                END-EXEC                                                        
                                                                                
           WHEN 'KREMC4T'                                                       
              EXEC SQL                                                          
                DELETE FROM KREMC4T                                             
                              WHERE  CDNUMPOL = :WS-TBL-CDNUMPOL AND            
                                     CDSINIES = :WS-TBL-CDSINIES                
                END-EXEC                                                        
                                                                                
           WHEN 'KREMC0T'                                                       
              EXEC SQL                                                          
                DELETE FROM KREMC0T                                             
                              WHERE  CDNUMPOL = :WS-TBL-CDNUMPOL AND            
                                     CDSINIES = :WS-TBL-CDSINIES                
                END-EXEC                                                        
                                                                                
           WHEN 'KREMD0T'                                                       
              EXEC SQL                                                          
                DELETE FROM KREMD0T                                             
                              WHERE  CDNUMPOL = :WS-TBL-CDNUMPOL AND            
                                     CDSINIES = :WS-TBL-CDSINIES                
                END-EXEC                                                        
                                                                                
           END-EVALUATE                                                         
                                                                                
           PERFORM 3300-CHECA-ESPD.                                             
                                                                                
                                                                                
       3300-CHECA-ESPI.                                                         
           EVALUATE SQLCODE                                                     
             WHEN  WN-SQLCODE-OK                                                
alpqui*          IF WS-WRITE                                                    
                   MOVE SQLCODE               TO WS-OUT-SQLCODE                 
                   MOVE WS-TBL-CDNUMPOL       TO WS-OUT-POLIZA                  
                   MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
                   MOVE '3350-EJEC-QUERY    ' TO WS-OUT-PARRAFO                 
                   MOVE 'INSERT CORRECTO '    TO WS-OUT-DESC                    
                   MOVE WS-TBL-CDSINIES       TO WS-OUT-DESC(18:12)             
                   PERFORM 1570-ESCRIBE-DESCARTADA                              
alpqui*          END-IF                                                         
             WHEN  WN-SQLCODE-CLAVE-DUPLICADA                                   
                   SET WS-DUPLICADOS   TO TRUE                                  
                   MOVE 'SI'                  TO WS-ROLLBACK                    
                   MOVE SQLCODE               TO WS-OUT-SQLCODE                 
                   MOVE WS-TBL-CDNUMPOL       TO WS-OUT-POLIZA                  
                   MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
                   MOVE '3350-EJEC-QUERY   FD' TO WS-OUT-PARRAFO                
                   STRING                                                       
                     'DUPLICADO:'             DELIMITED BY SIZE                 
                      WS-CAMPOPOL             DELIMITED BY ' '                  
                      '='                     DELIMITED BY SIZE                 
                      WS-TBL-CDSINIES         DELIMITED BY SIZE                 
                   INTO WS-OUT-DESC                                             
                   END-STRING                                                   
                   PERFORM 1570-ESCRIBE-DESCARTADA                              
             WHEN  WN-SQLCODE-NOT-FOUND                                         
                 IF WS-WRITE                                                    
                   ADD  WC-1                  TO WS-IERR                        
                   MOVE SQLCODE               TO WS-OUT-SQLCODE                 
                   MOVE WS-TBL-CDNUMPOL       TO WS-OUT-POLIZA                  
                   MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
                   MOVE '3350-EJEC-QUERY   FD' TO WS-OUT-PARRAFO                
                   STRING                                                       
                      'SIN '                  DELIMITED BY SIZE                 
                      WS-CAMPOPOL             DELIMITED BY ' '                  
                      '='                     DELIMITED BY SIZE                 
                      WS-TBL-CDSINIES         DELIMITED BY SIZE                 
                     INTO WS-OUT-DESC                                           
                   END-STRING                                                   
                   PERFORM 1570-ESCRIBE-DESCARTADA                              
                 END-IF                                                         
             WHEN OTHER                                                         
                   IF SQLCODE = -911                                            
                      MOVE 'S' TO SW-911                                        
                      ADD 1 TO WS-CANT-ERRORES                                  
                      SET WS-DUPLICADOS   TO TRUE                               
                      MOVE 'SI'                  TO WS-ROLLBACK                 
                      MOVE SQLCODE               TO WS-OUT-SQLCODE              
                      MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA               
                      MOVE WS-TABLA-H            TO WS-OUT-TABLA                
                      MOVE '3350-EJEX-QUERY     ' TO WS-OUT-PARRAFO             
                      STRING                                                    
                        'CONTENCIO:'             DELIMITED BY SIZE              
                         WS-CAMPOPOL             DELIMITED BY ' '               
                         '='                     DELIMITED BY SIZE              
                         WS-LEE-CDNUMPOL         DELIMITED BY SIZE              
                      INTO WS-OUT-DESC                                          
                      END-STRING                                                
                      PERFORM 1570-ESCRIBE-DESCARTADA                           
                  ELSE                                                          
                   ADD  WC-1                  TO WS-CANT-ERRORES                
                   MOVE 'SI'       TO WS-ROLLBACK                               
                   MOVE SQLCODE               TO WS-OUT-SQLCODE                 
                   MOVE WS-TBL-CDNUMPOL       TO WS-OUT-POLIZA                  
                   MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
                   MOVE '3350-EJEC-QUERY    ' TO WS-OUT-PARRAFO                 
                   STRING                                                       
                      'ERRDB2:'               DELIMITED BY SIZE                 
                      WS-CAMPOPOL             DELIMITED BY ' '                  
                      '='                     DELIMITED BY SIZE                 
                      WS-TBL-CDSINIES         DELIMITED BY SIZE                 
                     INTO WS-OUT-DESC                                           
                   END-STRING                                                   
                   PERFORM 1570-ESCRIBE-DESCARTADA                              
               MOVE WC-COD                   TO CDERR    OF KAELCWEZ            
               MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ            
               MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ            
               MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ            
               MOVE '3350-EJEC-QUERY       ' TO CDPARRAF OF KAELCWEZ            
                                                                                
               IF SQLCODE = -911                                                
                  MOVE 'S' TO SW-911                                            
                  MOVE 'S' TO SW-911-911                                        
                  ADD 1 TO WS-CANT-ERRORES                                      
               ELSE                                                             
               PERFORM 9999-GESTION-ERRORES                                     
               END-IF                                                           
           END-IF                                                               
                                                                                
           END-EVALUATE.                                                        
                                                                                
       3300-CHECA-ESPD.                                                         
           EVALUATE SQLCODE                                                     
             WHEN  WN-SQLCODE-OK                                                
                   CONTINUE                                                     
             WHEN  WN-SQLCODE-CLAVE-DUPLICADA                                   
                   SET WS-DUPLICADOS   TO TRUE                                  
                   MOVE 'SI'                  TO WS-ROLLBACK                    
                   ADD  WC-1                  TO WS-CANT-ERRORES                
                   MOVE SQLCODE               TO WS-OUT-SQLCODE                 
                   MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
                   MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
                   MOVE '3740-EJEC-QUERY   FB' TO WS-OUT-PARRAFO                
                   MOVE 'POLIZA DUPLICADA   ' TO WS-OUT-DESC                    
                   PERFORM 1570-ESCRIBE-DESCARTADA                              
             WHEN  WN-SQLCODE-NOT-FOUND                                         
                   CONTINUE                                                     
alpqui*            MOVE 'SI'                  TO WS-ROLLBACK                    
alpqui*            ADD  WC-1                  TO WS-CANT-ERRORES                
alpqui*            MOVE SQLCODE               TO WS-OUT-SQLCODE                 
alpqui*            MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
alpqui*            MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
alpqui*            MOVE '3740-EJEC-QUERY   FB' TO WS-OUT-PARRAFO                
alpqui*            MOVE 'POLIZA NO EXISTE   ' TO WS-OUT-DESC                    
alpqui*            PERFORM 1570-ESCRIBE-DESCARTADA                              
             WHEN OTHER                                                         
                   IF SQLCODE = -911                                            
                      MOVE 'S' TO SW-911                                        
                      ADD 1 TO WS-CANT-ERRORES                                  
                      SET WS-DUPLICADOS   TO TRUE                               
                      MOVE 'SI'                  TO WS-ROLLBACK                 
                      MOVE SQLCODE               TO WS-OUT-SQLCODE              
                      MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA               
                      MOVE WS-TABLA-H            TO WS-OUT-TABLA                
                      MOVE '3740-EJEC-QUERY     ' TO WS-OUT-PARRAFO             
                      STRING                                                    
                        'CONTENCIO:'             DELIMITED BY SIZE              
                         WS-CAMPOPOL             DELIMITED BY ' '               
                         '='                     DELIMITED BY SIZE              
                         WS-LEE-CDNUMPOL         DELIMITED BY SIZE              
                      INTO WS-OUT-DESC                                          
                      END-STRING                                                
                      PERFORM 1570-ESCRIBE-DESCARTADA                           
                  ELSE                                                          
                   ADD  WC-1                  TO WS-CANT-ERRORES                
                   MOVE 'SI'                  TO WS-ROLLBACK                    
                   MOVE SQLCODE               TO WS-OUT-SQLCODE                 
                   MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
                   MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
                   MOVE '3740-EJEC-QUERY     ' TO WS-OUT-PARRAFO                
                   MOVE 'ERROR TBL DB2      ' TO WS-OUT-DESC                    
                   PERFORM 1570-ESCRIBE-DESCARTADA                              
                 STRING                                                         
                 '???????????????????????????????????????????????' '\N'         
                 ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
                 '???????????????????????????????????????????????' '\N'         
                 DELIMITED BY SIZE                                              
                 INTO WS-CIFRASCONTROL                                          
                 CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
               MOVE WC-COD                   TO CDERR    OF KAELCWEZ            
               MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ            
               MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ            
               MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ            
               MOVE '3740-EJEC-QUERY       ' TO CDPARRAF OF KAELCWEZ            
                                                                                
               IF SQLCODE = -911                                                
                  MOVE 'S' TO SW-911                                            
                  MOVE 'S' TO SW-911-911                                        
                  ADD 1 TO WS-CANT-ERRORES                                      
               ELSE                                                             
               PERFORM 9999-GESTION-ERRORES                                     
               END-IF                                                           
           END-IF                                                               
           END-EVALUATE.                                                        
                                                                                
ALPOP1                                                                          
123520*****************************************************************         
123520*                                                                         
123520*****************************************************************         
123530 2000-COMMIT.                                                             
123540     MOVE "2000-COMMIT           " TO CDPARRAF OF KAELCWEZ.               
              EXEC SQL                                                          
                    COMMIT                                                      
              END-EXEC                                                          
           EVALUATE SQLCODE                                                     
               WHEN WN-SQLCODE-OK                                               
                 ADD WC-1  TO WS-CONT-COMMIT                                    
                 MOVE FUNCTION CURRENT-DATE (9:06) TO WS-HORA-SISTEMA           
                 MOVE WS-HORA    TO WS-HORAY                                    
                 MOVE WS-MINUTO  TO WS-MINUTOY                                  
                 MOVE WS-SEGUNDO TO WS-SEGUNDOY                                 
                 STRING                                                         
                 ' COMMIT POLIZA :' WS-LEE-CDNUMPOL ' HORA:' WS-HORA-SYS        
                 DELIMITED BY SIZE                                              
                 INTO WS-CIFRASCONTROL                                          
                 CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
                   MOVE SQLCODE               TO WS-OUT-SQLCODE                 
                   MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
                   MOVE 'COMMIT'              TO WS-OUT-TABLA                   
                   MOVE '2000-COMMIT        ' TO WS-OUT-PARRAFO                 
                   ADD   IMTOTREC OF KRBM10T  TO WS-TOT-PRIMAS                  
                   MOVE IMTOTREC OF KRBM10T   TO WS-TOTN-PRIMAS                 
                   MOVE WS-TOTN-PRIMAS        TO WS-TOTV-PRIMAS                 
                   STRING                                                       
                      'PRIMAS :'                                                
                      WS-TOTV-PRIMAS                                            
                      DELIMITED BY SIZE                                         
                      INTO WS-OUT-DESC                                          
                   PERFORM 1570-ESCRIBE-DESCARTADA                              
                   MOVE 0 TO IMTOTREC OF KRBM10T                                
               WHEN OTHER                                                       
                 STRING                                                         
                 '===============================================' '\N'         
                 ' ERCOMIT  POLIZA      : ' WS-LEE-CDNUMPOL       '\N'          
                 '===============================================' '\N'         
                 DELIMITED BY SIZE                                              
                 INTO WS-CIFRASCONTROL                                          
                 CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
                   MOVE SQLCODE               TO WS-OUT-SQLCODE                 
                   MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
                   MOVE 'ERCOMIT'              TO WS-OUT-TABLA                  
                   MOVE '2000-COMMIT         ' TO WS-OUT-PARRAFO                
                   PERFORM 1570-ESCRIBE-DESCARTADA                              
                    MOVE WC-ERROR-COMMIT           TO CDERR                     
                    MOVE "ERROR DB2"             TO DSARGU1 OF ENTRADA          
                    MOVE SQLCODE                 TO DSARGU2 OF ENTRADA          
                    MOVE "2000-COMMIT      "       TO CDPARRAF                  
                    PERFORM 9999-GESTION-ERRORES                                
                                                                                
           END-EVALUATE.                                                        
           EXEC SQL                                                             
               SAVEPOINT A ON ROLLBACK RETAIN CURSORS                           
           END-EXEC                                                             
           .                                                                    
123500*****************************************************************         
123510*                                                                         
123520*****************************************************************         
123530 2500-ROLLBACK.                                                           
           STRING                                                               
           ' ENTRO A 2500-ROLLB   : ' WS-LEE-CDNUMPOL       '\N'                
           DELIMITED BY SIZE                                                    
           INTO WS-CIFRASCONTROL                                                
           CALL W-KMCLMCCB USING WS-CIFRASCONTROL                               
123540     MOVE "2500-ROLLBACK         " TO CDPARRAF OF KAELCWEZ.               
           IF SW-911     = 'S'  OR                                              
              SW-911-911 = 'S'                                                  
              EXEC SQL                                                          
                  SAVEPOINT A ON ROLLBACK RETAIN CURSORS                        
              END-EXEC                                                          
           END-IF                                                               
123570     EXEC SQL                                                             
123580         ROLLBACK WORK TO SAVEPOINT A                                     
123590     END-EXEC.                                                            
123600     EVALUATE SQLCODE                                                     
123610        WHEN WN-SQLCODE-OK                                                
                 ADD WC-1  TO WS-CONT-ROLLBACK                                  
                 MOVE 0 TO IMTOTREC OF KRBM10T                                  
                 STRING                                                         
                 '===============================================' '\N'         
                 ' ROLLBACK POLIZA      : ' WS-LEE-CDNUMPOL       '\N'          
                 '===============================================' '\N'         
                 DELIMITED BY SIZE                                              
                 INTO WS-CIFRASCONTROL                                          
                 CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
                 MOVE SQLCODE               TO WS-OUT-SQLCODE                   
                 MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                    
                 MOVE 'ROLLBACK'             TO WS-OUT-TABLA                    
                 MOVE '2500-ROLLBACK     FC' TO WS-OUT-PARRAFO                  
                 PERFORM 1570-ESCRIBE-DESCARTADA                                
                 EXEC SQL                                                       
                     SAVEPOINT A ON ROLLBACK RETAIN CURSORS                     
                 END-EXEC                                                       
      *          IF WS-CANT-ERRORES > 0                                         
      *              PERFORM 2700-ACTUALIZA                                     
      *          END-IF                                                         
123710        WHEN OTHER                                                        
                 STRING                                                         
                 '===============================================' '\N'         
                 ' ER-ROLLBA POLIZA     : ' WS-LEE-CDNUMPOL       '\N'          
                 '===============================================' '\N'         
                 DELIMITED BY SIZE                                              
                 INTO WS-CIFRASCONTROL                                          
                 CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
                 MOVE SQLCODE               TO WS-OUT-SQLCODE                   
                 MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                    
                 MOVE 'E-ROLLBA'            TO WS-OUT-TABLA                     
                 MOVE '2500-ROLLBACK      ' TO WS-OUT-PARRAFO                   
                 MOVE 'ERROR ROLLBACK     ' TO WS-OUT-DESC                      
                 PERFORM 1570-ESCRIBE-DESCARTADA                                
123720             MOVE WC-ERROR-EN-SQL           TO CDERR                      
123730             MOVE "ERROR DB2"             TO DSARGU1 OF ENTRADA           
123740             MOVE SQLCODE                 TO DSARGU2 OF ENTRADA           
123750             MOVE "2500-ROLLBACK    "       TO CDPARRAF                   
123770             PERFORM 9999-GESTION-ERRORES                                 
123790     END-EVALUATE.                                                        
      ******************************************************************        
      * ACTUALIZA LA KCIM06T DESPUES DE DAR ROLLBACK POR REGISTROS     *        
      * DUPLICADOS                                                     *        
      ******************************************************************        
       2700-ACTUALIZA.                                                          
           EXEC SQL                                                             
               UPDATE KCIM06T                                                   
                  SET INBLOPOL = "I"                                            
               WHERE CDNUMPOL = :WS-LEE-CDNUMPOL                                
           END-EXEC.                                                            
              EXEC SQL                                                          
                    COMMIT                                                      
              END-EXEC                                                          
           EVALUATE SQLCODE                                                     
               WHEN WN-SQLCODE-OK                                               
                 MOVE FUNCTION CURRENT-DATE (9:06) TO WS-HORA-SISTEMA           
                 MOVE WS-HORA    TO WS-HORAY                                    
                 MOVE WS-MINUTO  TO WS-MINUTOY                                  
                 MOVE WS-SEGUNDO TO WS-SEGUNDOY                                 
                 STRING                                                         
                 ' COMMIT KCIM06T:' WS-LEE-CDNUMPOL ' HORA:' WS-HORA-SYS        
                 DELIMITED BY SIZE                                              
                 INTO WS-CIFRASCONTROL                                          
                 CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
                   MOVE SQLCODE               TO WS-OUT-SQLCODE                 
                   MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
                   MOVE 'COMMIT'              TO WS-OUT-TABLA                   
                   MOVE '2700-ACTUALIZA     ' TO WS-OUT-PARRAFO                 
                   STRING                                                       
                      'INBLOPOL = I'                                            
                      DELIMITED BY SIZE                                         
                      INTO WS-OUT-DESC                                          
                   PERFORM 1570-ESCRIBE-DESCARTADA                              
               WHEN OTHER                                                       
                 STRING                                                         
                 '===============================================' '\N'         
                 ' ERCOMIT KCIM06T POLIZA:' WS-LEE-CDNUMPOL       '\N'          
                 '===============================================' '\N'         
                 DELIMITED BY SIZE                                              
                 INTO WS-CIFRASCONTROL                                          
                 CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
                   MOVE SQLCODE               TO WS-OUT-SQLCODE                 
                   MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
                   MOVE 'ERCOMIT'              TO WS-OUT-TABLA                  
                   MOVE '2700-ACTUALIZA      ' TO WS-OUT-PARRAFO                
                   PERFORM 1570-ESCRIBE-DESCARTADA                              
                    MOVE WC-ERROR-COMMIT           TO CDERR                     
                    MOVE "ERROR DB2"             TO DSARGU1 OF ENTRADA          
                    MOVE SQLCODE                 TO DSARGU2 OF ENTRADA          
                    MOVE "2700-COMMIT      "       TO CDPARRAF                  
                    PERFORM 9999-GESTION-ERRORES                                
                                                                                
           END-EVALUATE.                                                        
           EXEC SQL                                                             
               SAVEPOINT A ON ROLLBACK RETAIN CURSORS                           
           END-EXEC.                                                            
      ******************************************************************        
      * 9000-FINAL.                                                    *        
      * -------------------------------------------------------------  *        
      * PARRAFO QUE SE EJCUTARA SOLO SI NO HAN OCURRIDO ERRORES QUE    *        
      * LO HUBIESEN FINALIZADO.                                        *        
      ******************************************************************        
       9000-FINAL.                                                              
      *SON ESCRITAS EN EL ARCHIVO ANEXO LAS LINEAS FINALES.                     
                                                                                
           CLOSE KAHSIMUL                                                       
           CLOSE ERPOLIZA                                                       
           MOVE FUNCTION CURRENT-DATE (1:08) TO WS-FECHA-SISTEMA.               
           MOVE FUNCTION CURRENT-DATE (9:06) TO WS-HORA-SISTEMA.                
           MOVE WS-HORA    TO WS-HORAY                                          
           MOVE WS-MINUTO  TO WS-MINUTOY                                        
           MOVE WS-SEGUNDO TO WS-SEGUNDOY                                       
           MOVE WS-TOT-PRIMAS TO WS-TOTN-PRIMAS                                 
           MOVE WS-TOTN-PRIMAS TO WS-TOTV-PRIMAS                                
           STRING                                                               
                 '===============================================' '\N'         
                   ' NOMBRE DEL PROGRAMA  : ' WC-PROGRAMA           '\N'        
                   '      FINALIZA A LAS  : ' WS-HORA-SYS           '\N'        
                   ' POLIZAS      LEIDAS  : ' WS-CONT-LEIDOS        '\N'        
                   ' POLIZAS      COMMIT  : ' WS-CONT-COMMIT        '\N'        
                   ' POLIZAS    ROLLBACK  : ' WS-CONT-ROLLBACK      '\N'        
                   ' MENSAJES   ESCRITOS  : ' WS-CONT-GRAB          '\N'        
                   ' TOTAL PRIMAS COPIADAS: ' WS-TOTV-PRIMAS        '\N'        
                 '===============================================' '\N'         
           DELIMITED BY SIZE                                                    
           INTO WS-CIFRASCONTROL                                                
           CALL W-KMCLMCCB USING WS-CIFRASCONTROL                               
           MOVE 0 TO WS-TOT-PRIMAS                                              
           STOP RUN                                                             
                                                                                
           .                                                                    
      ******************************************************************        
      * 9999-GESTION-ERRORES                                           *        
      * -------------------------------------------------------------  *        
      * PARRAFO UTILIZADO PARA EL MANEJO DE LOS ERRORES OCURRDIOS      *        
      * DURANTE EL PROCESAMIENTO DE LOS DATOS.                         *        
      ******************************************************************        
       9999-GESTION-ERRORES.                                                    
                 STRING                                                         
                 'A5555 VA HACER ROLLBACK                        ' '\N'         
                 ' 4TTTTCOPIA-RECIBOS    :' CDPARRAF       '\N'                 
                 'A5555??????????????????????????????????????????' '\N'         
                 DELIMITED BY SIZE                                              
                 INTO WS-CIFRASCONTROL                                          
                 CALL W-KMCLMCCB USING WS-CIFRASCONTROL.                        
                                                                                
      * EL PROGRMA QUE LLAMA A ESTE SERVICIO RECUPERA EL CODIGO DE              
      * RETORNO DE LA VARIABLE DE CDERROR EN LA ARQUITECTURA DE                 
      * VUELTA.                                                                 
                                                                                
           COPY KAELCPEZ.                                                       
           PERFORM 9000-FINAL                                                   
           .                                                                    
                                                                                
      ******************************************************************        
      * 9999-CIERRE-CURSORES. -(EN ESTE CASO NO HAY CURSOR)            *        
      * ------------------------------------------------------------   *        
      * EN ESTE CASO ESTE PARRAFO SE UTILIZA PARA CERRAR LOS ARCHIVOS  *        
      * YA QUE LA RUTINA DE GESTION DE ERRORES INVOCA AL PARRAFO       *        
      * 9999-CIERRE-CURSORES.                                          *        
      ******************************************************************        
       9999-CIERRE-CURSORES.                                                    
                                                                                
           CONTINUE.                                                            
                                                                                
       9999-CIERRE-CURSORES-EXIT.                                               
           EXIT.                                                                
      *IBM-INI                                                                  
      ******************************************************************        
      * 3100-CONSULTA-KSITRST                                          *        
      * VALIDA QUE EL SINIESTRO DE ROBO SE ENCUENTRE EN LA TABLA                
      ******************************************************************        
       3100-CONSULTA-KSITRST.                                                   
      *                                                                         
           MOVE CDSINIES OF KSIM10T   TO CDSINIES OF KSITRST                    
      *                                                                         
           EXEC SQL                                                             
              SELECT NUMAVPRE                                                   
                    ,FECANCEL                                                   
                    ,FERECDOC                                                   
                INTO :KSITRST.NUMAVPRE                                          
                    ,:KSITRST.FECANCEL                                          
                    ,:KSITRST.FERECDOC                                          
                FROM KSITRST                                                    
               WHERE  CDSINIES = :KSITRST.CDSINIES                              
               WITH UR                                                          
           END-EXEC                                                             
      *                                                                         
           EVALUATE SQLCODE                                                     
             WHEN WN-SQLCODE-OK                                                 
             WHEN WN-SQLCODE-MAS-DE-UNA-FILA                                    
                SET WS-EXISTE-KSITRST         TO TRUE                           
             WHEN  WN-SQLCODE-NOT-FOUND                                         
                SET WS-NO-EXISTE-KSITRST      TO TRUE                           
             WHEN OTHER                                                         
                MOVE WC-ERROR-SELECT          TO CDERR                          
                MOVE 'SELECT'                 TO DSARGU1 OF ENTRADA             
                MOVE 'KSITRST'                TO DSARGU2 OF ENTRADA             
                MOVE 'SELECT-SINIES'          TO DSARGU3 OF ENTRADA             
                MOVE '3100-CONSULTA-KSITR'    TO CDPARRAF                       
                PERFORM 9999-GESTION-ERRORES                                    
           END-EVALUATE.                                                        
      *IBM-FIN                                                                  
      ******************************************************************        
      * 3200-CONSULTA-KSITRCT                                          *        
      * VALIDA QUE EL SINIESTRO DE ROBO SE ENCUENTRE EN LA TABLA                
      ******************************************************************        
       3200-CONSULTA-KSITRCT.                                                   
      *                                                                         
           MOVE CDSINIES OF KSIM10T   TO CDSINIES OF KSITRCT                    
      *                                                                         
           EXEC SQL                                                             
              SELECT FERECUPE                                                   
                    ,CDTIPREC                                                   
                INTO :KSITRCT.FERECUPE                                          
                    ,:KSITRCT.CDTIPREC                                          
                FROM KSITRCT                                                    
               WHERE  CDSINIES = :KSITRCT.CDSINIES                              
               WITH UR                                                          
           END-EXEC                                                             
      *                                                                         
           EVALUATE SQLCODE                                                     
             WHEN WN-SQLCODE-OK                                                 
BAHA         WHEN WN-SQLCODE-MAS-DE-UNA-FILA                                    
                SET WS-EXISTE-KSITRCT         TO TRUE                           
             WHEN  WN-SQLCODE-NOT-FOUND                                         
                SET WS-NO-EXISTE-KSITRCT      TO TRUE                           
             WHEN OTHER                                                         
                MOVE WC-ERROR-SELECT          TO CDERR                          
                MOVE 'SELECT'                 TO DSARGU1 OF ENTRADA             
                MOVE 'KSITRCT'                TO DSARGU2 OF ENTRADA             
                MOVE 'SELECT-SINIES'          TO DSARGU3 OF ENTRADA             
                MOVE '3200-CONSULTA-KSITR'    TO CDPARRAF                       
                PERFORM 9999-GESTION-ERRORES                                    
           END-EVALUATE.                                                        
      *                                                                         
      ******************************************************************        
      * 3300-VALIDA-FECHA-ROBO                                         *        
      * VALIDA SI LA FECHA DE ROBO ES MENOR O MAYOR A 6 ANIOS          *        
      ******************************************************************        
       3300-VALIDA-FECHA-ROBO.                                                  
      *                                                                         
           PERFORM 3310-OBTIENE-ANIO-HIST                                       
           MOVE FETERMIN OF KSIM10T      TO WS-FECHA-PASO-N                     
           MOVE WS-FECHA-PASO-N          TO WS-FECHA-PASO-RA                    
           MOVE WS-FECHA-PASO-RA         TO WS-FECHA-PASO                       
           MOVE WS-FECHA-PASO-AAAA       TO WS-FECHA-AUX-AAAA                   
           MOVE WS-FECHA-PASO-MM         TO WS-FECHA-AUX-MM                     
           MOVE WS-FECHA-PASO-DD         TO WS-FECHA-AUX-DD                     
      *                                                                         
           DIVIDE WC-N-12 INTO WS-NUMSESRR                                      
                     GIVING WS-NUM-ANIO                                         
                  REMAINDER WS-NUM-MESES                                        
      *                                                                         
           COMPUTE WS-FECHA-AUX-AAAA = WS-FECHA-AUX-AAAA                        
                                     + WS-NUM-ANIO                              
           IF WS-NUM-MESES > ZEROES                                             
              COMPUTE WS-FECHA-AUX-MM   = WS-FECHA-AUX-MM                       
                                        + WS-NUM-MESES                          
           END-IF                                                               
      *                                                                         
           IF WS-FECHA-AUX-MM > WC-N-12                                         
              COMPUTE WS-FECHA-AUX-AAAA = WS-FECHA-AUX-AAAA                     
                                        + WC-N-1                                
              COMPUTE WS-FECHA-AUX-MM   = WS-FECHA-AUX-MM                       
                                        - WC-N-12                               
           END-IF                                                               
      *                                                                         
           MOVE WS-FECHA-AUX-AAAA        TO WS-FECHA-PASO-AAAA                  
           MOVE WS-FECHA-AUX-MM          TO WS-FECHA-PASO-MM                    
           MOVE WS-FECHA-AUX-DD          TO WS-FECHA-PASO-DD                    
      *                                                                         
           COMPUTE WS-ANIO-DIF = WS-FECHA-PASO-AAAA                             
                               - WS-FECHA-ANY                                   
      *                                                                         
           IF WS-FECHA-MES > WS-FECHA-PASO-MM                                   
              COMPUTE WS-MES-DIF  = WS-FECHA-MES                                
                                  - WS-FECHA-PASO-MM                            
              COMPUTE WS-NUMM-DIF = (WS-ANIO-DIF * WC-N-12)                     
                                  - WS-MES-DIF                                  
           ELSE                                                                 
              COMPUTE WS-MES-DIF  = WS-FECHA-PASO-MM                            
                                  - WS-FECHA-MES                                
              COMPUTE WS-NUMM-DIF = (WS-ANIO-DIF * WC-N-12)                     
                                  + WS-MES-DIF                                  
           END-IF                                                               
           IF WS-NUMM-DIF >= WS-NUMSESRR                                        
              SET WS-SI-HISTORIFICA      TO TRUE                                
           ELSE                                                                 
              SET WS-NO-HISTORIFICA      TO TRUE                                
           END-IF                                                               
           .                                                                    
      *                                                                         
      ******************************************************************        
      * 3310-OBTIENE-ANIO-HIST                                         *        
      * OBTIENE LOS A#OS A COMPARAR PARA HISTORIFICAR                  *        
      ******************************************************************        
       3310-OBTIENE-ANIO-HIST.                                                  
      *                                                                         
           INITIALIZE KAHTPET                                                   
      *                                                                         
           MOVE WC-AU                    TO LINEGOCO OF KAHTPET                 
      *                                                                         
           EXEC SQL                                                             
                SELECT NUMSESRR                                                 
                 INTO  :KAHTPET.NUMSESRR                                        
                  FROM KAHTPET                                                  
                 WHERE LINEGOCO =:KAHTPET.LINEGOCO                              
                WITH UR                                                         
           END-EXEC.                                                            
      *                                                                         
           EVALUATE SQLCODE                                                     
              WHEN WN-SQLCODE-OK                                                
                 MOVE NUMSESRR OF KAHTPET      TO WS-NUMSESRR                   
              WHEN  WN-SQLCODE-NOT-FOUND                                        
                 CONTINUE                                                       
              WHEN OTHER                                                        
                 MOVE WC-ERROR-SELECT          TO CDERR                         
                 MOVE 'SELECT'                 TO DSARGU1 OF ENTRADA            
                 MOVE 'KAHTPET'                TO DSARGU2 OF ENTRADA            
                 MOVE 'SELECT-NUANRO'          TO DSARGU3 OF ENTRADA            
                 MOVE '3310-OBTIENE-ANIO-H'    TO CDPARRAF                      
                 PERFORM 9999-GESTION-ERRORES                                   
            END-EVALUATE                                                        
           .                                                                    
      *IBM-FIN                                                                  
                                                                                
H P H  3001-PROCESA-KACA50T.                                                    
H P H              MOVE 'KACA50T'             TO WS-TABLA-T                     
H P H              MOVE 'KACA50H'             TO WS-TABLA-H                     
H P H *                                                                         
H P H              MOVE 'KACA50T'             TO WS-TIPO-TABLA                  
H P H              MOVE 'CDSINIES'            TO WS-CAMPOPOL                    
H P H                                                                           
H P H              IF TAB-ESP-SR                                                
H P H               IF WS-SI-HISTORIFICA                                        
H P H                 PERFORM 3300-INSERTA-ESP-SIN                              
H P H               END-IF                                                      
H P H              ELSE                                                         
H P H               IF WS-SI-HISTORIFICA                                        
H P H      EXEC SQL                                                             
H P H         DECLARE CURSOR-01 CURSOR FOR                                      
H P H            SELECT CDSINIES FROM KACA50T                                   
H P H             WHERE CDSINIES = :WS-TBL-SINOREC                              
H P H             FETCH FIRST 1 ROWS ONLY                                       
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EXEC SQL                                                             
H P H          OPEN CURSOR-01                                                   
H P H      END-EXEC                                                             
H P H      PERFORM 3306-VALIDA-CODIGO                                           
H P H      EXEC SQL                                                             
H P H          FETCH CURSOR-01                                                  
H P H          INTO                                                             
H P H          :WS-SINOREC                                                      
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H             EXEC SQL                                                      
H P H                CLOSE CURSOR-01                                            
H P H             END-EXEC                                                      
H P H             SET WS-PARA-INSERT TO TRUE                                    
H P H      EXEC SQL                                                             
H P H         INSERT INTO KACA50H                                               
H P H            (SELECT * FROM KACA50T                                         
H P H             WHERE CDSINIES = :WS-TBL-SINOREC)                             
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3001-PROCESA-KACA50T' TO WS-OUT-PARRAFO                
H P H              MOVE 'INSERT CORRECTO '    TO WS-OUT-DESC                    
H P H              MOVE WS-TBL-SINOREC        TO WS-OUT-DESC(18:12)             
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-CLAVE-DUPLICADA                                   
H P H              SET WS-DUPLICADOS   TO TRUE                                  
H P H              MOVE 'SI'                  TO WS-ROLLBACK                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3001-PROCESA-KACA50T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                'DUPLICADO:'             DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H              INTO WS-OUT-DESC                                             
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H            IF WS-WRITE                                                    
H P H              ADD  WC-1                  TO WS-IERR                        
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3001-PROCESA-KACA50T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'SIN '                  DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN OTHER                                                         
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                     SET WS-DUPLICADOS   TO TRUE                           
H P H                     MOVE 'SI'                  TO WS-ROLLBACK             
H P H                     MOVE SQLCODE               TO WS-OUT-SQLCODE          
H P H                     MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA           
H P H                     MOVE WS-TABLA-H            TO WS-OUT-TABLA            
H P H                     MOVE '3001-PROCESA-KACA50T' TO WS-OUT-PARRAFO         
H P H                     STRING                                                
H P H                      'CONTENCIO:'             DELIMITED BY SIZE           
H P H                       WS-CAMPOPOL             DELIMITED BY ' '            
H P H                       '='                     DELIMITED BY SIZE           
H P H                       WS-LEE-CDNUMPOL         DELIMITED BY SIZE           
H P H                       INTO WS-OUT-DESC                                    
H P H                       END-STRING                                          
H P H                     PERFORM 1570-ESCRIBE-DESCARTADA                       
H P H              ELSE                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3001-PROCESA-KACA50T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'ERRDB2:'               DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H              MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
H P H              MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
H P H              MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
H P H              MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
H P H              MOVE '3001-PROCESA-KACA50T  ' TO CDPARRAF OF KAELCWEZ        
H P H                                                                           
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 MOVE 'S' TO SW-911-911                                    
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H              ELSE                                                         
H P H                 PERFORM 9999-GESTION-ERRORES                              
H P H              END-IF                                                       
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                                                                           
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H            SET WS-NO-PARA-INSERT      TO TRUE                             
H P H            IF WS-WRITE                                                    
H P H              ADD  WC-1                  TO WS-IERR                        
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3001-PROCESA-KACA50T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'NOHAY '                DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H            EXEC SQL                                                       
H P H                CLOSE CURSOR-01                                            
H P H            END-EXEC                                                       
H P H        WHEN OTHER                                                         
H P H              SET WS-NO-PARA-INSERT      TO TRUE                           
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3001-PROCESA-KACA50T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'ERRDB2:'               DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            STRING                                                         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            ' ERROR EN SQL :' W-QUERY-TEXT                    '\N'         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H          MOVE WC-COD                   TO CDERR    OF KAELCWEZ            
H P H          MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ            
H P H          MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ            
H P H          MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ            
H P H          MOVE '3001-PROCESA-KACA50T  ' TO CDPARRAF OF KAELCWEZ            
H P H                                                                           
H P H          IF SQLCODE = -911                                                
H P H              MOVE 'S' TO SW-911                                           
H P H              MOVE 'S' TO SW-911-911                                       
H P H              ADD 1 TO WS-CANT-ERRORES                                     
H P H          ELSE                                                             
H P H             PERFORM 9999-GESTION-ERRORES                                  
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                 IF  SQLCODE = WN-SQLCODE-OK                               
H P H                 AND WS-PARA-INSERT                                        
H P H      EXEC SQL                                                             
H P H         DELETE FROM KACA50T                                               
H P H         WHERE CDSINIES = :WS-TBL-SINOREC                                  
H P H      END-EXEC                                                             
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3001-PROCESA-KACA50T' TO WS-OUT-PARRAFO                
H P H              MOVE 'BORRAR CORRECTO    ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3001-PROCESA-KACA50T' TO WS-OUT-PARRAFO                
H P H              MOVE 'NO EXISTE BORRAR   ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H              MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
H P H              MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
H P H              MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
H P H              MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
H P H              MOVE '3001-PROCESA-KACA50T  ' TO CDPARRAF OF KAELCWEZ        
H P H                                                                           
H P H              PERFORM 9999-GESTION-ERRORES                                 
H P H                                                                           
H P H        WHEN OTHER                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3001-PROCESA-KACA50T' TO WS-OUT-PARRAFO                
H P H              MOVE 'ERR BORRAR DB2     ' TO WS-OUT-DESC                    
H P H              IF SQLCODE  = -911                                           
H P H                 MOVE '3001-PROCESA-KACA50T'  TO WS-OUT-PARRAFO            
H P H                 MOVE 'CONTENCION TABLA   '   TO WS-OUT-DESC               
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 mOVE 'S' TO SW-911                                        
H P H                 MOVE 'S' TO SW-911-911                                    
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 MOVE 'SI'                  TO WS-ROLLBACK                 
H P H                 MOVE SQLCODE               TO WS-OUT-SQLCODE              
H P H                 MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA               
H P H                 MOVE WS-TABLA-H            TO WS-OUT-TABLA                
H P H                 MOVE '3001-PROCESA-KACA50T' TO WS-OUT-PARRAFO             
H P H                    STRING                                                 
H P H                   'CONTENCIO:'             DELIMITED BY SIZE              
H P H                    WS-CAMPOPOL             DELIMITED BY ' '               
H P H                    '='                     DELIMITED BY SIZE              
H P H                    WS-LEE-CDNUMPOL         DELIMITED BY SIZE              
H P H                    INTO WS-OUT-DESC                                       
H P H                 END-STRING                                                
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H            STRING                                                         
H P H            'Z8883??????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            'Z8881??????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H              ELSE                                                         
H P H                 MOVE WC-COD              TO CDERR    OF KAELCWEZ          
H P H                 MOVE WC-DES01            TO DSARGU1  OF KAELCWEZ          
H P H                 MOVE WC-PROGRAMA         TO DSARGU2  OF KAELCWEZ          
H P H                 MOVE WS-ERPOLIZA         TO DSARGU3  OF KAELCWEZ          
H P H                 MOVE '3001-PROCESA-KACA50T'                               
H P H                                          TO CDPARRAF OF KAELCWEZ          
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H                 IF SQLCODE = -911                                         
H P H                    MOVE 'S' TO SW-911                                     
H P H                    MOVE 'S' TO SW-911-911                                 
H P H                    ADD 1 TO WS-CANT-ERRORES                               
H P H                 ELSE                                                      
H P H            STRING                                                         
H P H            'X9999??????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            'X9999??????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H                 PERFORM 9999-GESTION-ERRORES                              
H P H                 END-IF                                                    
H P H              END-IF                                                       
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                                                                           
H P H                 END-IF                                                    
H P H               END-IF                                                      
H P H              END-IF                                                       
H P H              IF WS-ROLLBACK = 'SI'                                        
H P H                 SET WS-NO-HAY-SINIESTROS TO TRUE                          
H P H                 MOVE 98 TO WS-ITBLS                                       
H P H              END-IF                                                       
H P H              ADD WC-1 TO WS-ITBLS.                                        
H P H                                                                           
H P H  4710-COPIA-RAIZ-SI.                                                      
H P H      MOVE SPACES    TO WS-CAMPOPOL                                        
H P H         EXEC SQL                                                          
H P H            INSERT INTO KSIM10H                                            
H P H               (SELECT * FROM KSIM10T                                      
H P H                WHERE CDNUMPOL = :WS-LEE-CDNUMPOL)                         
H P H         END-EXEC                                                          
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H           IF WS-TABLA-T = WC-KRBM10T                                      
H P H              PERFORM 4500-OBTEN-PRIMAS                                    
H P H           END-IF                                                          
H P H           IF WS-TABLA-T = WC-KCIM06T AND WS-WRITE                         
H P H              MOVE SQLCODE                TO WS-OUT-SQLCODE                
H P H              MOVE WS-LEE-CDNUMPOL        TO WS-OUT-POLIZA                 
H P H              MOVE WS-TABLA-H             TO WS-OUT-TABLA                  
H P H              MOVE '4710-COPIA-RAIZ-SI  ' TO WS-OUT-PARRAFO                
H P H              MOVE 'INSERT PRINCIPAL OK ' TO WS-OUT-DESC                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H           END-IF                                                          
H P H        WHEN  WN-SQLCODE-CLAVE-DUPLICADA                                   
H P H              SET WS-DUPLICADOS   TO TRUE                                  
H P H              MOVE 'SI'                  TO WS-ROLLBACK                    
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '4710-COPIA-RAIZ-SI  ' TO WS-OUT-PARRAFO                
H P H              MOVE 'POLIZA DUPLICADA   ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H              MOVE 'SI'                  TO WS-ROLLBACK                    
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '4710-COPIA-RAIZ-SI  ' TO WS-OUT-PARRAFO                
H P H              MOVE 'POLIZA NO EXISTE   ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H        WHEN OTHER                                                         
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 MOVE 'SI'                  TO WS-ROLLBACK                 
H P H                 MOVE SQLCODE               TO WS-OUT-SQLCODE              
H P H                 MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA               
H P H                 MOVE WS-TABLA-H            TO WS-OUT-TABLA                
H P H                 MOVE '4710-COPIA-RAIZ-SI  ' TO WS-OUT-PARRAFO             
H P H                 STRING                                                    
H P H                   'CONTENCIO:'             DELIMITED BY SIZE              
H P H                    WS-CAMPOPOL             DELIMITED BY ' '               
H P H                    '='                     DELIMITED BY SIZE              
H P H                    WS-LEE-CDNUMPOL         DELIMITED BY SIZE              
H P H                 INTO WS-OUT-DESC                                          
H P H                 END-STRING                                                
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H              ELSE                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'                  TO WS-ROLLBACK                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '4710-COPIA-RAIZ-SI  ' TO WS-OUT-PARRAFO                
H P H              MOVE 'ERROR TBL DB2      ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            STRING                                                         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            '???????????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H          MOVE WC-COD                   TO CDERR    OF KAELCWEZ            
H P H          MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ            
H P H          MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ            
H P H          MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ            
H P H          MOVE '4710-COPIA-RAIZ-SI    ' TO CDPARRAF OF KAELCWEZ            
H P H                                                                           
H P H          IF SQLCODE = -911                                                
H P H             MOVE 'S' TO SW-911                                            
H P H             MOVE 'S' TO SW-911-911                                        
H P H             ADD 1 TO WS-CANT-ERRORES                                      
H P H          ELSE                                                             
H P H          PERFORM 9999-GESTION-ERRORES                                     
H P H          END-IF                                                           
H P H      END-IF                                                               
H P H      END-EVALUATE                                                         
H P H                                                                           
H P H      IF SQLCODE = WN-SQLCODE-OK                                           
H P H      EXEC SQL                                                             
H P H         DELETE FROM KSIM10T                                               
H P H         WHERE CDNUMPOL = :WS-LEE-CDNUMPOL                                 
H P H      END-EXEC                                                             
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '4710-COPIA-RAIZ-SI ' TO WS-OUT-PARRAFO                 
H P H              MOVE 'BORRA PRINCIPAL OK ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H              ADD  WC-1       TO WS-IERR                                   
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '4710-COPIA-RAIZ-SI ' TO WS-OUT-PARRAFO                 
H P H              MOVE 'NO EXISTE BORRAR   ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H          MOVE WC-COD                   TO CDERR    OF KAELCWEZ            
H P H          MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ            
H P H          MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ            
H P H          MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ            
H P H          MOVE '4710-COPIA-RAIZ-SI    ' TO CDPARRAF OF KAELCWEZ            
H P H                                                                           
H P H          PERFORM 9999-GESTION-ERRORES                                     
H P H                                                                           
H P H        WHEN OTHER                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '4710-COPIA-RAIZ-SI ' TO WS-OUT-PARRAFO                 
H P H              MOVE 'ERR BORRAR DB2     ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            STRING                                                         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            ' 4710-COP ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            '???????????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H          MOVE WC-COD                   TO CDERR    OF KAELCWEZ            
H P H          MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ            
H P H          MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ            
H P H          MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ            
H P H          MOVE '4710-COPIA-RAIZ-SI    ' TO CDPARRAF OF KAELCWEZ            
H P H                                                                           
H P H          IF SQLCODE = -911                                                
H P H             MOVE 'S' TO SW-911                                            
H P H             MOVE 'S' TO SW-911-911                                        
H P H             ADD 1 TO WS-CANT-ERRORES                                      
H P H          ELSE                                                             
H P H          PERFORM 9999-GESTION-ERRORES                                     
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                                                                           
H P H      END-IF.                                                              
H P H                                                                           
H P H  3002-PROCESA-KACA52T.                                                    
H P H              MOVE 'KACA52T'             TO WS-TABLA-T                     
H P H              MOVE 'KACA52H'             TO WS-TABLA-H                     
H P H *                                                                         
H P H              MOVE 'KACA52T'             TO WS-TIPO-TABLA                  
H P H              MOVE 'CDSINIES'            TO WS-CAMPOPOL                    
H P H                                                                           
H P H              IF TAB-ESP-SR                                                
H P H               IF WS-SI-HISTORIFICA                                        
H P H                 PERFORM 3300-INSERTA-ESP-SIN                              
H P H               END-IF                                                      
H P H              ELSE                                                         
H P H               IF WS-SI-HISTORIFICA                                        
H P H      EXEC SQL                                                             
H P H         DECLARE CURSOR-02 CURSOR FOR                                      
H P H            SELECT CDSINIES FROM KACA52T                                   
H P H             WHERE CDSINIES = :WS-TBL-SINOREC                              
H P H             FETCH FIRST 1 ROWS ONLY                                       
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EXEC SQL                                                             
H P H          OPEN CURSOR-02                                                   
H P H      END-EXEC                                                             
H P H      PERFORM 3306-VALIDA-CODIGO                                           
H P H      EXEC SQL                                                             
H P H          FETCH CURSOR-02                                                  
H P H          INTO                                                             
H P H          :WS-SINOREC                                                      
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H             EXEC SQL                                                      
H P H                CLOSE CURSOR-02                                            
H P H             END-EXEC                                                      
H P H             SET WS-PARA-INSERT TO TRUE                                    
H P H      EXEC SQL                                                             
H P H         INSERT INTO KACA52H                                               
H P H            (SELECT * FROM KACA52T                                         
H P H             WHERE CDSINIES = :WS-TBL-SINOREC)                             
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3002-PROCESA-KACA52T' TO WS-OUT-PARRAFO                
H P H              MOVE 'INSERT CORRECTO '    TO WS-OUT-DESC                    
H P H              MOVE WS-TBL-SINOREC        TO WS-OUT-DESC(18:12)             
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-CLAVE-DUPLICADA                                   
H P H              SET WS-DUPLICADOS   TO TRUE                                  
H P H              MOVE 'SI'                  TO WS-ROLLBACK                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3002-PROCESA-KACA52T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                'DUPLICADO:'             DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H              INTO WS-OUT-DESC                                             
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H            IF WS-WRITE                                                    
H P H              ADD  WC-1                  TO WS-IERR                        
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3002-PROCESA-KACA52T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'SIN '                  DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN OTHER                                                         
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                     SET WS-DUPLICADOS   TO TRUE                           
H P H                     MOVE 'SI'                  TO WS-ROLLBACK             
H P H                     MOVE SQLCODE               TO WS-OUT-SQLCODE          
H P H                     MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA           
H P H                     MOVE WS-TABLA-H            TO WS-OUT-TABLA            
H P H                     MOVE '3002-PROCESA-KACA52T' TO WS-OUT-PARRAFO         
H P H                     STRING                                                
H P H                      'CONTENCIO:'             DELIMITED BY SIZE           
H P H                       WS-CAMPOPOL             DELIMITED BY ' '            
H P H                       '='                     DELIMITED BY SIZE           
H P H                       WS-LEE-CDNUMPOL         DELIMITED BY SIZE           
H P H                       INTO WS-OUT-DESC                                    
H P H                       END-STRING                                          
H P H                     PERFORM 1570-ESCRIBE-DESCARTADA                       
H P H              ELSE                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3002-PROCESA-KACA52T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'ERRDB2:'               DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H              MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
H P H              MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
H P H              MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
H P H              MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
H P H              MOVE '3002-PROCESA-KACA52T  ' TO CDPARRAF OF KAELCWEZ        
H P H                                                                           
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 MOVE 'S' TO SW-911-911                                    
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H              ELSE                                                         
H P H                 PERFORM 9999-GESTION-ERRORES                              
H P H              END-IF                                                       
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                                                                           
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H            SET WS-NO-PARA-INSERT      TO TRUE                             
H P H            IF WS-WRITE                                                    
H P H              ADD  WC-1                  TO WS-IERR                        
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3002-PROCESA-KACA52T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'NOHAY '                DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H            EXEC SQL                                                       
H P H                CLOSE CURSOR-02                                            
H P H            END-EXEC                                                       
H P H        WHEN OTHER                                                         
H P H              SET WS-NO-PARA-INSERT      TO TRUE                           
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3002-PROCESA-KACA52T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'ERRDB2:'               DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            STRING                                                         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            ' ERROR EN SQL :' W-QUERY-TEXT                    '\N'         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H          MOVE WC-COD                   TO CDERR    OF KAELCWEZ            
H P H          MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ            
H P H          MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ            
H P H          MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ            
H P H          MOVE '3002-PROCESA-KACA52T  ' TO CDPARRAF OF KAELCWEZ            
H P H                                                                           
H P H          IF SQLCODE = -911                                                
H P H              MOVE 'S' TO SW-911                                           
H P H              MOVE 'S' TO SW-911-911                                       
H P H              ADD 1 TO WS-CANT-ERRORES                                     
H P H          ELSE                                                             
H P H             PERFORM 9999-GESTION-ERRORES                                  
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                 IF  SQLCODE = WN-SQLCODE-OK                               
H P H                 AND WS-PARA-INSERT                                        
H P H      EXEC SQL                                                             
H P H         DELETE FROM KACA52T                                               
H P H         WHERE CDSINIES = :WS-TBL-SINOREC                                  
H P H      END-EXEC                                                             
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3002-PROCESA-KACA52T' TO WS-OUT-PARRAFO                
H P H              MOVE 'BORRAR CORRECTO    ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3002-PROCESA-KACA52T' TO WS-OUT-PARRAFO                
H P H              MOVE 'NO EXISTE BORRAR   ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H              MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
H P H              MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
H P H              MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
H P H              MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
H P H              MOVE '3002-PROCESA-KACA52T  ' TO CDPARRAF OF KAELCWEZ        
H P H                                                                           
H P H              PERFORM 9999-GESTION-ERRORES                                 
H P H                                                                           
H P H        WHEN OTHER                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3002-PROCESA-KACA52T' TO WS-OUT-PARRAFO                
H P H              MOVE 'ERR BORRAR DB2     ' TO WS-OUT-DESC                    
H P H              IF SQLCODE  = -911                                           
H P H                 MOVE '3002-PROCESA-KACA52T'  TO WS-OUT-PARRAFO            
H P H                 MOVE 'CONTENCION TABLA   '   TO WS-OUT-DESC               
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 mOVE 'S' TO SW-911                                        
H P H                 MOVE 'S' TO SW-911-911                                    
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 MOVE 'SI'                  TO WS-ROLLBACK                 
H P H                 MOVE SQLCODE               TO WS-OUT-SQLCODE              
H P H                 MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA               
H P H                 MOVE WS-TABLA-H            TO WS-OUT-TABLA                
H P H                 MOVE '3002-PROCESA-KACA52T' TO WS-OUT-PARRAFO             
H P H                    STRING                                                 
H P H                   'CONTENCIO:'             DELIMITED BY SIZE              
H P H                    WS-CAMPOPOL             DELIMITED BY ' '               
H P H                    '='                     DELIMITED BY SIZE              
H P H                    WS-LEE-CDNUMPOL         DELIMITED BY SIZE              
H P H                    INTO WS-OUT-DESC                                       
H P H                 END-STRING                                                
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H            STRING                                                         
H P H            'Z8883??????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            'Z8881??????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H              ELSE                                                         
H P H                 MOVE WC-COD              TO CDERR    OF KAELCWEZ          
H P H                 MOVE WC-DES01            TO DSARGU1  OF KAELCWEZ          
H P H                 MOVE WC-PROGRAMA         TO DSARGU2  OF KAELCWEZ          
H P H                 MOVE WS-ERPOLIZA         TO DSARGU3  OF KAELCWEZ          
H P H                 MOVE '3002-PROCESA-KACA52T'                               
H P H                                          TO CDPARRAF OF KAELCWEZ          
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H                 IF SQLCODE = -911                                         
H P H                    MOVE 'S' TO SW-911                                     
H P H                    MOVE 'S' TO SW-911-911                                 
H P H                    ADD 1 TO WS-CANT-ERRORES                               
H P H                 ELSE                                                      
H P H            STRING                                                         
H P H            'X9999??????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            'X9999??????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H                 PERFORM 9999-GESTION-ERRORES                              
H P H                 END-IF                                                    
H P H              END-IF                                                       
H P H      END-EVALUATE                                                         
H P H                 END-IF                                                    
H P H               END-IF                                                      
H P H              END-IF                                                       
H P H              IF WS-ROLLBACK = 'SI'                                        
H P H                 SET WS-NO-HAY-SINIESTROS TO TRUE                          
H P H                 MOVE 98 TO WS-ITBLS                                       
H P H              END-IF                                                       
H P H              ADD WC-1 TO WS-ITBLS.                                        
H P H *                                                                         
H P H  3003-PROCESA-KACA53T.                                                    
H P H              MOVE 'KACA53T'             TO WS-TABLA-T                     
H P H              MOVE 'KACA53H'             TO WS-TABLA-H                     
H P H *                                                                         
H P H              MOVE 'KACA53T'             TO WS-TIPO-TABLA                  
H P H              MOVE 'CDSINIES'            TO WS-CAMPOPOL                    
H P H                                                                           
H P H              IF TAB-ESP-SR                                                
H P H               IF WS-SI-HISTORIFICA                                        
H P H                 PERFORM 3300-INSERTA-ESP-SIN                              
H P H               END-IF                                                      
H P H              ELSE                                                         
H P H               IF WS-SI-HISTORIFICA                                        
H P H      EXEC SQL                                                             
H P H         DECLARE CURSOR-03 CURSOR FOR                                      
H P H            SELECT CDSINIES FROM KACA53T                                   
H P H             WHERE CDSINIES = :WS-TBL-SINOREC                              
H P H             FETCH FIRST 1 ROWS ONLY                                       
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EXEC SQL                                                             
H P H          OPEN CURSOR-03                                                   
H P H      END-EXEC                                                             
H P H      PERFORM 3306-VALIDA-CODIGO                                           
H P H      EXEC SQL                                                             
H P H          FETCH CURSOR-03                                                  
H P H          INTO                                                             
H P H          :WS-SINOREC                                                      
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H             EXEC SQL                                                      
H P H                CLOSE CURSOR-03                                            
H P H             END-EXEC                                                      
H P H             SET WS-PARA-INSERT TO TRUE                                    
H P H      EXEC SQL                                                             
H P H         INSERT INTO KACA53H                                               
H P H            (SELECT * FROM KACA53T                                         
H P H             WHERE CDSINIES = :WS-TBL-SINOREC)                             
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3003-PROCESA-KACA53T' TO WS-OUT-PARRAFO                
H P H              MOVE 'INSERT CORRECTO '    TO WS-OUT-DESC                    
H P H              MOVE WS-TBL-SINOREC        TO WS-OUT-DESC(18:12)             
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-CLAVE-DUPLICADA                                   
H P H              SET WS-DUPLICADOS   TO TRUE                                  
H P H              MOVE 'SI'                  TO WS-ROLLBACK                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3003-PROCESA-KACA53T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                'DUPLICADO:'             DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H              INTO WS-OUT-DESC                                             
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H            IF WS-WRITE                                                    
H P H              ADD  WC-1                  TO WS-IERR                        
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3003-PROCESA-KACA53T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'SIN '                  DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN OTHER                                                         
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                     SET WS-DUPLICADOS   TO TRUE                           
H P H                     MOVE 'SI'                  TO WS-ROLLBACK             
H P H                     MOVE SQLCODE               TO WS-OUT-SQLCODE          
H P H                     MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA           
H P H                     MOVE WS-TABLA-H            TO WS-OUT-TABLA            
H P H                     MOVE '3003-PROCESA-KACA53T' TO WS-OUT-PARRAFO         
H P H                     STRING                                                
H P H                      'CONTENCIO:'             DELIMITED BY SIZE           
H P H                       WS-CAMPOPOL             DELIMITED BY ' '            
H P H                       '='                     DELIMITED BY SIZE           
H P H                       WS-LEE-CDNUMPOL         DELIMITED BY SIZE           
H P H                       INTO WS-OUT-DESC                                    
H P H                       END-STRING                                          
H P H                     PERFORM 1570-ESCRIBE-DESCARTADA                       
H P H              ELSE                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3003-PROCESA-KACA53T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'ERRDB2:'               DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H              MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
H P H              MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
H P H              MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
H P H              MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
H P H              MOVE '3003-PROCESA-KACA53T  ' TO CDPARRAF OF KAELCWEZ        
H P H                                                                           
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 MOVE 'S' TO SW-911-911                                    
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H              ELSE                                                         
H P H                 PERFORM 9999-GESTION-ERRORES                              
H P H              END-IF                                                       
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                                                                           
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H            SET WS-NO-PARA-INSERT      TO TRUE                             
H P H            IF WS-WRITE                                                    
H P H              ADD  WC-1                  TO WS-IERR                        
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3003-PROCESA-KACA53T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'NOHAY '                DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H            EXEC SQL                                                       
H P H                CLOSE CURSOR-03                                            
H P H            END-EXEC                                                       
H P H        WHEN OTHER                                                         
H P H              SET WS-NO-PARA-INSERT      TO TRUE                           
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3003-PROCESA-KACA53T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'ERRDB2:'               DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            STRING                                                         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            ' ERROR EN SQL :' W-QUERY-TEXT                    '\N'         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H          MOVE WC-COD                   TO CDERR    OF KAELCWEZ            
H P H          MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ            
H P H          MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ            
H P H          MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ            
H P H          MOVE '3003-PROCESA-KACA53T  ' TO CDPARRAF OF KAELCWEZ            
H P H                                                                           
H P H          IF SQLCODE = -911                                                
H P H              MOVE 'S' TO SW-911                                           
H P H              MOVE 'S' TO SW-911-911                                       
H P H              ADD 1 TO WS-CANT-ERRORES                                     
H P H          ELSE                                                             
H P H             PERFORM 9999-GESTION-ERRORES                                  
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                 IF  SQLCODE = WN-SQLCODE-OK                               
H P H                 AND WS-PARA-INSERT                                        
H P H      EXEC SQL                                                             
H P H         DELETE FROM KACA53T                                               
H P H         WHERE CDSINIES = :WS-TBL-SINOREC                                  
H P H      END-EXEC                                                             
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3003-PROCESA-KACA53T' TO WS-OUT-PARRAFO                
H P H              MOVE 'BORRAR CORRECTO    ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3003-PROCESA-KACA53T' TO WS-OUT-PARRAFO                
H P H              MOVE 'NO EXISTE BORRAR   ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H              MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
H P H              MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
H P H              MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
H P H              MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
H P H              MOVE '3003-PROCESA-KACA53T  ' TO CDPARRAF OF KAELCWEZ        
H P H                                                                           
H P H              PERFORM 9999-GESTION-ERRORES                                 
H P H                                                                           
H P H        WHEN OTHER                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3003-PROCESA-KACA53T' TO WS-OUT-PARRAFO                
H P H              MOVE 'ERR BORRAR DB2     ' TO WS-OUT-DESC                    
H P H              IF SQLCODE  = -911                                           
H P H                 MOVE '3003-PROCESA-KACA53T'  TO WS-OUT-PARRAFO            
H P H                 MOVE 'CONTENCION TABLA   '   TO WS-OUT-DESC               
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 mOVE 'S' TO SW-911                                        
H P H                 MOVE 'S' TO SW-911-911                                    
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 MOVE 'SI'                  TO WS-ROLLBACK                 
H P H                 MOVE SQLCODE               TO WS-OUT-SQLCODE              
H P H                 MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA               
H P H                 MOVE WS-TABLA-H            TO WS-OUT-TABLA                
H P H                 MOVE '3003-PROCESA-KACA53T' TO WS-OUT-PARRAFO             
H P H                    STRING                                                 
H P H                   'CONTENCIO:'             DELIMITED BY SIZE              
H P H                    WS-CAMPOPOL             DELIMITED BY ' '               
H P H                    '='                     DELIMITED BY SIZE              
H P H                    WS-LEE-CDNUMPOL         DELIMITED BY SIZE              
H P H                    INTO WS-OUT-DESC                                       
H P H                 END-STRING                                                
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H            STRING                                                         
H P H            'Z8883??????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            'Z8881??????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H              ELSE                                                         
H P H                 MOVE WC-COD              TO CDERR    OF KAELCWEZ          
H P H                 MOVE WC-DES01            TO DSARGU1  OF KAELCWEZ          
H P H                 MOVE WC-PROGRAMA         TO DSARGU2  OF KAELCWEZ          
H P H                 MOVE WS-ERPOLIZA         TO DSARGU3  OF KAELCWEZ          
H P H                 MOVE '3003-PROCESA-KACA53T'                               
H P H                                          TO CDPARRAF OF KAELCWEZ          
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H                 IF SQLCODE = -911                                         
H P H                    MOVE 'S' TO SW-911                                     
H P H                    MOVE 'S' TO SW-911-911                                 
H P H                    ADD 1 TO WS-CANT-ERRORES                               
H P H                 ELSE                                                      
H P H            STRING                                                         
H P H            'X9999??????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            'X9999??????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H                 PERFORM 9999-GESTION-ERRORES                              
H P H                 END-IF                                                    
H P H              END-IF                                                       
H P H      END-EVALUATE                                                         
H P H                 END-IF                                                    
H P H               END-IF                                                      
H P H              END-IF                                                       
H P H              IF WS-ROLLBACK = 'SI'                                        
H P H                 SET WS-NO-HAY-SINIESTROS TO TRUE                          
H P H                 MOVE 98 TO WS-ITBLS                                       
H P H              END-IF                                                       
H P H              ADD WC-1 TO WS-ITBLS.                                        
H P H *                                                                         
H P H  3004-PROCESA-KACA60T.                                                    
H P H              MOVE 'KACA60T'             TO WS-TABLA-T                     
H P H              MOVE 'KACA60H'             TO WS-TABLA-H                     
H P H *                                                                         
H P H              MOVE 'KACA60T'             TO WS-TIPO-TABLA                  
H P H              MOVE 'CDSINIES'            TO WS-CAMPOPOL                    
H P H                                                                           
H P H              IF TAB-ESP-SR                                                
H P H               IF WS-SI-HISTORIFICA                                        
H P H                 PERFORM 3300-INSERTA-ESP-SIN                              
H P H               END-IF                                                      
H P H              ELSE                                                         
H P H               IF WS-SI-HISTORIFICA                                        
H P H      EXEC SQL                                                             
H P H         DECLARE CURSOR-04 CURSOR FOR                                      
H P H            SELECT CDSINIES FROM KACA60T                                   
H P H             WHERE CDSINIES = :WS-TBL-SINOREC                              
H P H             FETCH FIRST 1 ROWS ONLY                                       
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EXEC SQL                                                             
H P H          OPEN CURSOR-04                                                   
H P H      END-EXEC                                                             
H P H      PERFORM 3306-VALIDA-CODIGO                                           
H P H      EXEC SQL                                                             
H P H          FETCH CURSOR-04                                                  
H P H          INTO                                                             
H P H          :WS-SINOREC                                                      
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H             EXEC SQL                                                      
H P H                CLOSE CURSOR-04                                            
H P H             END-EXEC                                                      
H P H             SET WS-PARA-INSERT TO TRUE                                    
H P H      EXEC SQL                                                             
H P H         INSERT INTO KACA60H                                               
H P H            (SELECT * FROM KACA60T                                         
H P H             WHERE CDSINIES = :WS-TBL-SINOREC)                             
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3004-PROCESA-KACA60T' TO WS-OUT-PARRAFO                
H P H              MOVE 'INSERT CORRECTO '    TO WS-OUT-DESC                    
H P H              MOVE WS-TBL-SINOREC        TO WS-OUT-DESC(18:12)             
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-CLAVE-DUPLICADA                                   
H P H              SET WS-DUPLICADOS   TO TRUE                                  
H P H              MOVE 'SI'                  TO WS-ROLLBACK                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3004-PROCESA-KACA60T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                'DUPLICADO:'             DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H              INTO WS-OUT-DESC                                             
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H            IF WS-WRITE                                                    
H P H              ADD  WC-1                  TO WS-IERR                        
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3004-PROCESA-KACA60T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'SIN '                  DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN OTHER                                                         
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                     SET WS-DUPLICADOS   TO TRUE                           
H P H                     MOVE 'SI'                  TO WS-ROLLBACK             
H P H                     MOVE SQLCODE               TO WS-OUT-SQLCODE          
H P H                     MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA           
H P H                     MOVE WS-TABLA-H            TO WS-OUT-TABLA            
H P H                     MOVE '3004-PROCESA-KACA60T' TO WS-OUT-PARRAFO         
H P H                     STRING                                                
H P H                      'CONTENCIO:'             DELIMITED BY SIZE           
H P H                       WS-CAMPOPOL             DELIMITED BY ' '            
H P H                       '='                     DELIMITED BY SIZE           
H P H                       WS-LEE-CDNUMPOL         DELIMITED BY SIZE           
H P H                       INTO WS-OUT-DESC                                    
H P H                       END-STRING                                          
H P H                     PERFORM 1570-ESCRIBE-DESCARTADA                       
H P H              ELSE                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3004-PROCESA-KACA60T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'ERRDB2:'               DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H              MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
H P H              MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
H P H              MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
H P H              MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
H P H              MOVE '3004-PROCESA-KACA60T  ' TO CDPARRAF OF KAELCWEZ        
H P H                                                                           
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 MOVE 'S' TO SW-911-911                                    
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H              ELSE                                                         
H P H                 PERFORM 9999-GESTION-ERRORES                              
H P H              END-IF                                                       
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                                                                           
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H            SET WS-NO-PARA-INSERT      TO TRUE                             
H P H            IF WS-WRITE                                                    
H P H              ADD  WC-1                  TO WS-IERR                        
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3004-PROCESA-KACA60T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'NOHAY '                DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H            EXEC SQL                                                       
H P H                CLOSE CURSOR-04                                            
H P H            END-EXEC                                                       
H P H        WHEN OTHER                                                         
H P H              SET WS-NO-PARA-INSERT      TO TRUE                           
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3004-PROCESA-KACA60T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'ERRDB2:'               DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            STRING                                                         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            ' ERROR EN SQL :' W-QUERY-TEXT                    '\N'         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H          MOVE WC-COD                   TO CDERR    OF KAELCWEZ            
H P H          MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ            
H P H          MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ            
H P H          MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ            
H P H          MOVE '3004-PROCESA-KACA60T  ' TO CDPARRAF OF KAELCWEZ            
H P H                                                                           
H P H          IF SQLCODE = -911                                                
H P H              MOVE 'S' TO SW-911                                           
H P H              MOVE 'S' TO SW-911-911                                       
H P H              ADD 1 TO WS-CANT-ERRORES                                     
H P H          ELSE                                                             
H P H             PERFORM 9999-GESTION-ERRORES                                  
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                 IF  SQLCODE = WN-SQLCODE-OK                               
H P H                 AND WS-PARA-INSERT                                        
H P H      EXEC SQL                                                             
H P H         DELETE FROM KACA60T                                               
H P H         WHERE CDSINIES = :WS-TBL-SINOREC                                  
H P H      END-EXEC                                                             
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3004-PROCESA-KACA60T' TO WS-OUT-PARRAFO                
H P H              MOVE 'BORRAR CORRECTO    ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3004-PROCESA-KACA60T' TO WS-OUT-PARRAFO                
H P H              MOVE 'NO EXISTE BORRAR   ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H              MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
H P H              MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
H P H              MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
H P H              MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
H P H              MOVE '3004-PROCESA-KACA60T  ' TO CDPARRAF OF KAELCWEZ        
H P H                                                                           
H P H              PERFORM 9999-GESTION-ERRORES                                 
H P H                                                                           
H P H        WHEN OTHER                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3004-PROCESA-KACA60T' TO WS-OUT-PARRAFO                
H P H              MOVE 'ERR BORRAR DB2     ' TO WS-OUT-DESC                    
H P H              IF SQLCODE  = -911                                           
H P H                 MOVE '3004-PROCESA-KACA60T'  TO WS-OUT-PARRAFO            
H P H                 MOVE 'CONTENCION TABLA   '   TO WS-OUT-DESC               
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 mOVE 'S' TO SW-911                                        
H P H                 MOVE 'S' TO SW-911-911                                    
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 MOVE 'SI'                  TO WS-ROLLBACK                 
H P H                 MOVE SQLCODE               TO WS-OUT-SQLCODE              
H P H                 MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA               
H P H                 MOVE WS-TABLA-H            TO WS-OUT-TABLA                
H P H                 MOVE '3004-PROCESA-KACA60T' TO WS-OUT-PARRAFO             
H P H                    STRING                                                 
H P H                   'CONTENCIO:'             DELIMITED BY SIZE              
H P H                    WS-CAMPOPOL             DELIMITED BY ' '               
H P H                    '='                     DELIMITED BY SIZE              
H P H                    WS-LEE-CDNUMPOL         DELIMITED BY SIZE              
H P H                    INTO WS-OUT-DESC                                       
H P H                 END-STRING                                                
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H            STRING                                                         
H P H            'Z8883??????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            'Z8881??????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H              ELSE                                                         
H P H                 MOVE WC-COD              TO CDERR    OF KAELCWEZ          
H P H                 MOVE WC-DES01            TO DSARGU1  OF KAELCWEZ          
H P H                 MOVE WC-PROGRAMA         TO DSARGU2  OF KAELCWEZ          
H P H                 MOVE WS-ERPOLIZA         TO DSARGU3  OF KAELCWEZ          
H P H                 MOVE '3004-PROCESA-KACA60T'                               
H P H                                          TO CDPARRAF OF KAELCWEZ          
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H                 IF SQLCODE = -911                                         
H P H                    MOVE 'S' TO SW-911                                     
H P H                    MOVE 'S' TO SW-911-911                                 
H P H                    ADD 1 TO WS-CANT-ERRORES                               
H P H                 ELSE                                                      
H P H            STRING                                                         
H P H            'X9999??????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            'X9999??????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H                 PERFORM 9999-GESTION-ERRORES                              
H P H                 END-IF                                                    
H P H              END-IF                                                       
H P H      END-EVALUATE                                                         
H P H                 END-IF                                                    
H P H               END-IF                                                      
H P H              END-IF                                                       
H P H              IF WS-ROLLBACK = 'SI'                                        
H P H                 SET WS-NO-HAY-SINIESTROS TO TRUE                          
H P H                 MOVE 98 TO WS-ITBLS                                       
H P H              END-IF                                                       
H P H              ADD WC-1 TO WS-ITBLS.                                        
H P H *                                                                         
H P H  3005-PROCESA-KACA61T.                                                    
H P H              MOVE 'KACA61T'             TO WS-TABLA-T                     
H P H              MOVE 'KACA61H'             TO WS-TABLA-H                     
H P H *                                                                         
H P H              MOVE 'KACA61T'             TO WS-TIPO-TABLA                  
H P H              MOVE 'CDSINIES'            TO WS-CAMPOPOL                    
H P H                                                                           
H P H              IF TAB-ESP-SR                                                
H P H               IF WS-SI-HISTORIFICA                                        
H P H                 PERFORM 3300-INSERTA-ESP-SIN                              
H P H               END-IF                                                      
H P H              ELSE                                                         
H P H               IF WS-SI-HISTORIFICA                                        
H P H      EXEC SQL                                                             
H P H         DECLARE CURSOR-05 CURSOR FOR                                      
H P H            SELECT CDSINIES FROM KACA61T                                   
H P H             WHERE CDSINIES = :WS-TBL-SINOREC                              
H P H             FETCH FIRST 1 ROWS ONLY                                       
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EXEC SQL                                                             
H P H          OPEN CURSOR-05                                                   
H P H      END-EXEC                                                             
H P H      PERFORM 3306-VALIDA-CODIGO                                           
H P H      EXEC SQL                                                             
H P H          FETCH CURSOR-05                                                  
H P H          INTO                                                             
H P H          :WS-SINOREC                                                      
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H             EXEC SQL                                                      
H P H                CLOSE CURSOR-05                                            
H P H             END-EXEC                                                      
H P H             SET WS-PARA-INSERT TO TRUE                                    
H P H      EXEC SQL                                                             
H P H         INSERT INTO KACA61H                                               
H P H            (SELECT * FROM KACA61T                                         
H P H             WHERE CDSINIES = :WS-TBL-SINOREC)                             
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3005-PROCESA-KACA61T' TO WS-OUT-PARRAFO                
H P H              MOVE 'INSERT CORRECTO '    TO WS-OUT-DESC                    
H P H              MOVE WS-TBL-SINOREC        TO WS-OUT-DESC(18:12)             
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-CLAVE-DUPLICADA                                   
H P H              SET WS-DUPLICADOS   TO TRUE                                  
H P H              MOVE 'SI'                  TO WS-ROLLBACK                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3005-PROCESA-KACA61T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                'DUPLICADO:'             DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H              INTO WS-OUT-DESC                                             
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H            IF WS-WRITE                                                    
H P H              ADD  WC-1                  TO WS-IERR                        
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3005-PROCESA-KACA61T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'SIN '                  DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN OTHER                                                         
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                     SET WS-DUPLICADOS   TO TRUE                           
H P H                     MOVE 'SI'                  TO WS-ROLLBACK             
H P H                     MOVE SQLCODE               TO WS-OUT-SQLCODE          
H P H                     MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA           
H P H                     MOVE WS-TABLA-H            TO WS-OUT-TABLA            
H P H                     MOVE '3005-PROCESA-KACA61T' TO WS-OUT-PARRAFO         
H P H                     STRING                                                
H P H                      'CONTENCIO:'             DELIMITED BY SIZE           
H P H                       WS-CAMPOPOL             DELIMITED BY ' '            
H P H                       '='                     DELIMITED BY SIZE           
H P H                       WS-LEE-CDNUMPOL         DELIMITED BY SIZE           
H P H                       INTO WS-OUT-DESC                                    
H P H                       END-STRING                                          
H P H                     PERFORM 1570-ESCRIBE-DESCARTADA                       
H P H              ELSE                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3005-PROCESA-KACA61T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'ERRDB2:'               DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H              MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
H P H              MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
H P H              MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
H P H              MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
H P H              MOVE '3005-PROCESA-KACA61T  ' TO CDPARRAF OF KAELCWEZ        
H P H                                                                           
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 MOVE 'S' TO SW-911-911                                    
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H              ELSE                                                         
H P H                 PERFORM 9999-GESTION-ERRORES                              
H P H              END-IF                                                       
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                                                                           
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H            SET WS-NO-PARA-INSERT      TO TRUE                             
H P H            IF WS-WRITE                                                    
H P H              ADD  WC-1                  TO WS-IERR                        
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3005-PROCESA-KACA61T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'NOHAY '                DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H            EXEC SQL                                                       
H P H                CLOSE CURSOR-05                                            
H P H            END-EXEC                                                       
H P H        WHEN OTHER                                                         
H P H              SET WS-NO-PARA-INSERT      TO TRUE                           
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3005-PROCESA-KACA61T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'ERRDB2:'               DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            STRING                                                         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            ' ERROR EN SQL :' W-QUERY-TEXT                    '\N'         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H          MOVE WC-COD                   TO CDERR    OF KAELCWEZ            
H P H          MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ            
H P H          MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ            
H P H          MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ            
H P H          MOVE '3005-PROCESA-KACA61T  ' TO CDPARRAF OF KAELCWEZ            
H P H                                                                           
H P H          IF SQLCODE = -911                                                
H P H              MOVE 'S' TO SW-911                                           
H P H              MOVE 'S' TO SW-911-911                                       
H P H              ADD 1 TO WS-CANT-ERRORES                                     
H P H          ELSE                                                             
H P H             PERFORM 9999-GESTION-ERRORES                                  
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                 IF  SQLCODE = WN-SQLCODE-OK                               
H P H                 AND WS-PARA-INSERT                                        
H P H      EXEC SQL                                                             
H P H         DELETE FROM KACA61T                                               
H P H         WHERE CDSINIES = :WS-TBL-SINOREC                                  
H P H      END-EXEC                                                             
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3005-PROCESA-KACA61T' TO WS-OUT-PARRAFO                
H P H              MOVE 'BORRAR CORRECTO    ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3005-PROCESA-KACA61T' TO WS-OUT-PARRAFO                
H P H              MOVE 'NO EXISTE BORRAR   ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H              MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
H P H              MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
H P H              MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
H P H              MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
H P H              MOVE '3005-PROCESA-KACA61T  ' TO CDPARRAF OF KAELCWEZ        
H P H                                                                           
H P H              PERFORM 9999-GESTION-ERRORES                                 
H P H                                                                           
H P H        WHEN OTHER                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3005-PROCESA-KACA61T' TO WS-OUT-PARRAFO                
H P H              MOVE 'ERR BORRAR DB2     ' TO WS-OUT-DESC                    
H P H              IF SQLCODE  = -911                                           
H P H                 MOVE '3005-PROCESA-KACA61T'  TO WS-OUT-PARRAFO            
H P H                 MOVE 'CONTENCION TABLA   '   TO WS-OUT-DESC               
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 mOVE 'S' TO SW-911                                        
H P H                 MOVE 'S' TO SW-911-911                                    
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 MOVE 'SI'                  TO WS-ROLLBACK                 
H P H                 MOVE SQLCODE               TO WS-OUT-SQLCODE              
H P H                 MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA               
H P H                 MOVE WS-TABLA-H            TO WS-OUT-TABLA                
H P H                 MOVE '3005-PROCESA-KACA61T' TO WS-OUT-PARRAFO             
H P H                    STRING                                                 
H P H                   'CONTENCIO:'             DELIMITED BY SIZE              
H P H                    WS-CAMPOPOL             DELIMITED BY ' '               
H P H                    '='                     DELIMITED BY SIZE              
H P H                    WS-LEE-CDNUMPOL         DELIMITED BY SIZE              
H P H                    INTO WS-OUT-DESC                                       
H P H                 END-STRING                                                
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H            STRING                                                         
H P H            'Z8883??????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            'Z8881??????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H              ELSE                                                         
H P H                 MOVE WC-COD              TO CDERR    OF KAELCWEZ          
H P H                 MOVE WC-DES01            TO DSARGU1  OF KAELCWEZ          
H P H                 MOVE WC-PROGRAMA         TO DSARGU2  OF KAELCWEZ          
H P H                 MOVE WS-ERPOLIZA         TO DSARGU3  OF KAELCWEZ          
H P H                 MOVE '3005-PROCESA-KACA61T'                               
H P H                                          TO CDPARRAF OF KAELCWEZ          
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H                 IF SQLCODE = -911                                         
H P H                    MOVE 'S' TO SW-911                                     
H P H                    MOVE 'S' TO SW-911-911                                 
H P H                    ADD 1 TO WS-CANT-ERRORES                               
H P H                 ELSE                                                      
H P H            STRING                                                         
H P H            'X9999??????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            'X9999??????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H                 PERFORM 9999-GESTION-ERRORES                              
H P H                 END-IF                                                    
H P H              END-IF                                                       
H P H      END-EVALUATE                                                         
H P H                 END-IF                                                    
H P H               END-IF                                                      
H P H              END-IF                                                       
H P H              IF WS-ROLLBACK = 'SI'                                        
H P H                 SET WS-NO-HAY-SINIESTROS TO TRUE                          
H P H                 MOVE 98 TO WS-ITBLS                                       
H P H              END-IF                                                       
H P H              ADD WC-1 TO WS-ITBLS.                                        
H P H *                                                                         
H P H  3006-PROCESA-KACA63T.                                                    
H P H              MOVE 'KACA63T'             TO WS-TABLA-T                     
H P H              MOVE 'KACA63H'             TO WS-TABLA-H                     
H P H *                                                                         
H P H              MOVE 'KACA63T'             TO WS-TIPO-TABLA                  
H P H              MOVE 'CDSINIES'            TO WS-CAMPOPOL                    
H P H                                                                           
H P H              IF TAB-ESP-SR                                                
H P H               IF WS-SI-HISTORIFICA                                        
H P H                 PERFORM 3300-INSERTA-ESP-SIN                              
H P H               END-IF                                                      
H P H              ELSE                                                         
H P H               IF WS-SI-HISTORIFICA                                        
H P H      EXEC SQL                                                             
H P H         DECLARE CURSOR-06 CURSOR FOR                                      
H P H            SELECT CDSINIES FROM KACA63T                                   
H P H             WHERE CDSINIES = :WS-TBL-SINOREC                              
H P H             FETCH FIRST 1 ROWS ONLY                                       
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EXEC SQL                                                             
H P H          OPEN CURSOR-06                                                   
H P H      END-EXEC                                                             
H P H      PERFORM 3306-VALIDA-CODIGO                                           
H P H      EXEC SQL                                                             
H P H          FETCH CURSOR-06                                                  
H P H          INTO                                                             
H P H          :WS-SINOREC                                                      
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H             EXEC SQL                                                      
H P H                CLOSE CURSOR-06                                            
H P H             END-EXEC                                                      
H P H             SET WS-PARA-INSERT TO TRUE                                    
H P H      EXEC SQL                                                             
H P H         INSERT INTO KACA63H                                               
H P H            (SELECT * FROM KACA63T                                         
H P H             WHERE CDSINIES = :WS-TBL-SINOREC)                             
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3006-PROCESA-KACA63T' TO WS-OUT-PARRAFO                
H P H              MOVE 'INSERT CORRECTO '    TO WS-OUT-DESC                    
H P H              MOVE WS-TBL-SINOREC        TO WS-OUT-DESC(18:12)             
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-CLAVE-DUPLICADA                                   
H P H              SET WS-DUPLICADOS   TO TRUE                                  
H P H              MOVE 'SI'                  TO WS-ROLLBACK                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3006-PROCESA-KACA63T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                'DUPLICADO:'             DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H              INTO WS-OUT-DESC                                             
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H            IF WS-WRITE                                                    
H P H              ADD  WC-1                  TO WS-IERR                        
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3006-PROCESA-KACA63T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'SIN '                  DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN OTHER                                                         
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                     SET WS-DUPLICADOS   TO TRUE                           
H P H                     MOVE 'SI'                  TO WS-ROLLBACK             
H P H                     MOVE SQLCODE               TO WS-OUT-SQLCODE          
H P H                     MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA           
H P H                     MOVE WS-TABLA-H            TO WS-OUT-TABLA            
H P H                     MOVE '3006-PROCESA-KACA63T' TO WS-OUT-PARRAFO         
H P H                     STRING                                                
H P H                      'CONTENCIO:'             DELIMITED BY SIZE           
H P H                       WS-CAMPOPOL             DELIMITED BY ' '            
H P H                       '='                     DELIMITED BY SIZE           
H P H                       WS-LEE-CDNUMPOL         DELIMITED BY SIZE           
H P H                       INTO WS-OUT-DESC                                    
H P H                       END-STRING                                          
H P H                     PERFORM 1570-ESCRIBE-DESCARTADA                       
H P H              ELSE                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3006-PROCESA-KACA63T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'ERRDB2:'               DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H              MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
H P H              MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
H P H              MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
H P H              MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
H P H              MOVE '3006-PROCESA-KACA63T  ' TO CDPARRAF OF KAELCWEZ        
H P H                                                                           
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 MOVE 'S' TO SW-911-911                                    
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H              ELSE                                                         
H P H                 PERFORM 9999-GESTION-ERRORES                              
H P H              END-IF                                                       
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                                                                           
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H            SET WS-NO-PARA-INSERT      TO TRUE                             
H P H            IF WS-WRITE                                                    
H P H              ADD  WC-1                  TO WS-IERR                        
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3006-PROCESA-KACA63T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'NOHAY '                DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H            EXEC SQL                                                       
H P H                CLOSE CURSOR-06                                            
H P H            END-EXEC                                                       
H P H        WHEN OTHER                                                         
H P H              SET WS-NO-PARA-INSERT      TO TRUE                           
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3006-PROCESA-KACA63T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'ERRDB2:'               DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            STRING                                                         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            ' ERROR EN SQL :' W-QUERY-TEXT                    '\N'         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H          MOVE WC-COD                   TO CDERR    OF KAELCWEZ            
H P H          MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ            
H P H          MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ            
H P H          MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ            
H P H          MOVE '3006-PROCESA-KACA63T  ' TO CDPARRAF OF KAELCWEZ            
H P H                                                                           
H P H          IF SQLCODE = -911                                                
H P H              MOVE 'S' TO SW-911                                           
H P H              MOVE 'S' TO SW-911-911                                       
H P H              ADD 1 TO WS-CANT-ERRORES                                     
H P H          ELSE                                                             
H P H             PERFORM 9999-GESTION-ERRORES                                  
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                 IF  SQLCODE = WN-SQLCODE-OK                               
H P H                 AND WS-PARA-INSERT                                        
H P H      EXEC SQL                                                             
H P H         DELETE FROM KACA63T                                               
H P H         WHERE CDSINIES = :WS-TBL-SINOREC                                  
H P H      END-EXEC                                                             
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3006-PROCESA-KACA63T' TO WS-OUT-PARRAFO                
H P H              MOVE 'BORRAR CORRECTO    ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3006-PROCESA-KACA63T' TO WS-OUT-PARRAFO                
H P H              MOVE 'NO EXISTE BORRAR   ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H              MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
H P H              MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
H P H              MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
H P H              MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
H P H              MOVE '3006-PROCESA-KACA63T  ' TO CDPARRAF OF KAELCWEZ        
H P H                                                                           
H P H              PERFORM 9999-GESTION-ERRORES                                 
H P H                                                                           
H P H        WHEN OTHER                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3006-PROCESA-KACA63T' TO WS-OUT-PARRAFO                
H P H              MOVE 'ERR BORRAR DB2     ' TO WS-OUT-DESC                    
H P H              IF SQLCODE  = -911                                           
H P H                 MOVE '3006-PROCESA-KACA63T'  TO WS-OUT-PARRAFO            
H P H                 MOVE 'CONTENCION TABLA   '   TO WS-OUT-DESC               
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 mOVE 'S' TO SW-911                                        
H P H                 MOVE 'S' TO SW-911-911                                    
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 MOVE 'SI'                  TO WS-ROLLBACK                 
H P H                 MOVE SQLCODE               TO WS-OUT-SQLCODE              
H P H                 MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA               
H P H                 MOVE WS-TABLA-H            TO WS-OUT-TABLA                
H P H                 MOVE '3006-PROCESA-KACA63T' TO WS-OUT-PARRAFO             
H P H                    STRING                                                 
H P H                   'CONTENCIO:'             DELIMITED BY SIZE              
H P H                    WS-CAMPOPOL             DELIMITED BY ' '               
H P H                    '='                     DELIMITED BY SIZE              
H P H                    WS-LEE-CDNUMPOL         DELIMITED BY SIZE              
H P H                    INTO WS-OUT-DESC                                       
H P H                 END-STRING                                                
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H            STRING                                                         
H P H            'Z8883??????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            'Z8881??????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H              ELSE                                                         
H P H                 MOVE WC-COD              TO CDERR    OF KAELCWEZ          
H P H                 MOVE WC-DES01            TO DSARGU1  OF KAELCWEZ          
H P H                 MOVE WC-PROGRAMA         TO DSARGU2  OF KAELCWEZ          
H P H                 MOVE WS-ERPOLIZA         TO DSARGU3  OF KAELCWEZ          
H P H                 MOVE '3006-PROCESA-KACA63T'                               
H P H                                          TO CDPARRAF OF KAELCWEZ          
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H                 IF SQLCODE = -911                                         
H P H                    MOVE 'S' TO SW-911                                     
H P H                    MOVE 'S' TO SW-911-911                                 
H P H                    ADD 1 TO WS-CANT-ERRORES                               
H P H                 ELSE                                                      
H P H            STRING                                                         
H P H            'X9999??????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            'X9999??????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H                 PERFORM 9999-GESTION-ERRORES                              
H P H                 END-IF                                                    
H P H              END-IF                                                       
H P H      END-EVALUATE                                                         
H P H                 END-IF                                                    
H P H               END-IF                                                      
H P H              END-IF                                                       
H P H              IF WS-ROLLBACK = 'SI'                                        
H P H                 SET WS-NO-HAY-SINIESTROS TO TRUE                          
H P H                 MOVE 98 TO WS-ITBLS                                       
H P H              END-IF                                                       
H P H              ADD WC-1 TO WS-ITBLS.                                        
H P H *                                                                         
H P H  3007-PROCESA-KACA68T.                                                    
H P H              MOVE 'KACA68T'             TO WS-TABLA-T                     
H P H              MOVE 'KACA68H'             TO WS-TABLA-H                     
H P H *                                                                         
H P H              MOVE 'KACA68T'             TO WS-TIPO-TABLA                  
H P H              MOVE 'CDSINIES'            TO WS-CAMPOPOL                    
H P H                                                                           
H P H              IF TAB-ESP-SR                                                
H P H               IF WS-SI-HISTORIFICA                                        
H P H                 PERFORM 3300-INSERTA-ESP-SIN                              
H P H               END-IF                                                      
H P H              ELSE                                                         
H P H               IF WS-SI-HISTORIFICA                                        
H P H      EXEC SQL                                                             
H P H         DECLARE CURSOR-07 CURSOR FOR                                      
H P H            SELECT CDSINIES FROM KACA68T                                   
H P H             WHERE CDSINIES = :WS-TBL-SINOREC                              
H P H             FETCH FIRST 1 ROWS ONLY                                       
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EXEC SQL                                                             
H P H          OPEN CURSOR-07                                                   
H P H      END-EXEC                                                             
H P H      PERFORM 3306-VALIDA-CODIGO                                           
H P H      EXEC SQL                                                             
H P H          FETCH CURSOR-07                                                  
H P H          INTO                                                             
H P H          :WS-SINOREC                                                      
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H             EXEC SQL                                                      
H P H                CLOSE CURSOR-07                                            
H P H             END-EXEC                                                      
H P H             SET WS-PARA-INSERT TO TRUE                                    
H P H      EXEC SQL                                                             
H P H         INSERT INTO KACA68H                                               
H P H            (SELECT * FROM KACA68T                                         
H P H             WHERE CDSINIES = :WS-TBL-SINOREC)                             
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3007-PROCESA-KACA68T' TO WS-OUT-PARRAFO                
H P H              MOVE 'INSERT CORRECTO '    TO WS-OUT-DESC                    
H P H              MOVE WS-TBL-SINOREC        TO WS-OUT-DESC(18:12)             
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-CLAVE-DUPLICADA                                   
H P H              SET WS-DUPLICADOS   TO TRUE                                  
H P H              MOVE 'SI'                  TO WS-ROLLBACK                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3007-PROCESA-KACA68T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                'DUPLICADO:'             DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H              INTO WS-OUT-DESC                                             
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H            IF WS-WRITE                                                    
H P H              ADD  WC-1                  TO WS-IERR                        
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3007-PROCESA-KACA68T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'SIN '                  DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN OTHER                                                         
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                     SET WS-DUPLICADOS   TO TRUE                           
H P H                     MOVE 'SI'                  TO WS-ROLLBACK             
H P H                     MOVE SQLCODE               TO WS-OUT-SQLCODE          
H P H                     MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA           
H P H                     MOVE WS-TABLA-H            TO WS-OUT-TABLA            
H P H                     MOVE '3007-PROCESA-KACA68T' TO WS-OUT-PARRAFO         
H P H                     STRING                                                
H P H                      'CONTENCIO:'             DELIMITED BY SIZE           
H P H                       WS-CAMPOPOL             DELIMITED BY ' '            
H P H                       '='                     DELIMITED BY SIZE           
H P H                       WS-LEE-CDNUMPOL         DELIMITED BY SIZE           
H P H                       INTO WS-OUT-DESC                                    
H P H                       END-STRING                                          
H P H                     PERFORM 1570-ESCRIBE-DESCARTADA                       
H P H              ELSE                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3007-PROCESA-KACA68T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'ERRDB2:'               DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H              MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
H P H              MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
H P H              MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
H P H              MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
H P H              MOVE '3007-PROCESA-KACA68T  ' TO CDPARRAF OF KAELCWEZ        
H P H                                                                           
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 MOVE 'S' TO SW-911-911                                    
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H              ELSE                                                         
H P H                 PERFORM 9999-GESTION-ERRORES                              
H P H              END-IF                                                       
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                                                                           
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H            SET WS-NO-PARA-INSERT      TO TRUE                             
H P H            IF WS-WRITE                                                    
H P H              ADD  WC-1                  TO WS-IERR                        
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3007-PROCESA-KACA68T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'NOHAY '                DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H            EXEC SQL                                                       
H P H                CLOSE CURSOR-07                                            
H P H            END-EXEC                                                       
H P H        WHEN OTHER                                                         
H P H              SET WS-NO-PARA-INSERT      TO TRUE                           
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3007-PROCESA-KACA68T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'ERRDB2:'               DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            STRING                                                         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            ' ERROR EN SQL :' W-QUERY-TEXT                    '\N'         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H          MOVE WC-COD                   TO CDERR    OF KAELCWEZ            
H P H          MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ            
H P H          MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ            
H P H          MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ            
H P H          MOVE '3007-PROCESA-KACA68T  ' TO CDPARRAF OF KAELCWEZ            
H P H                                                                           
H P H          IF SQLCODE = -911                                                
H P H              MOVE 'S' TO SW-911                                           
H P H              MOVE 'S' TO SW-911-911                                       
H P H              ADD 1 TO WS-CANT-ERRORES                                     
H P H          ELSE                                                             
H P H             PERFORM 9999-GESTION-ERRORES                                  
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                 IF  SQLCODE = WN-SQLCODE-OK                               
H P H                 AND WS-PARA-INSERT                                        
H P H      EXEC SQL                                                             
H P H         DELETE FROM KACA68T                                               
H P H         WHERE CDSINIES = :WS-TBL-SINOREC                                  
H P H      END-EXEC                                                             
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3007-PROCESA-KACA68T' TO WS-OUT-PARRAFO                
H P H              MOVE 'BORRAR CORRECTO    ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3007-PROCESA-KACA68T' TO WS-OUT-PARRAFO                
H P H              MOVE 'NO EXISTE BORRAR   ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H              MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
H P H              MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
H P H              MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
H P H              MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
H P H              MOVE '3007-PROCESA-KACA68T  ' TO CDPARRAF OF KAELCWEZ        
H P H                                                                           
H P H              PERFORM 9999-GESTION-ERRORES                                 
H P H                                                                           
H P H        WHEN OTHER                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3007-PROCESA-KACA68T' TO WS-OUT-PARRAFO                
H P H              MOVE 'ERR BORRAR DB2     ' TO WS-OUT-DESC                    
H P H              IF SQLCODE  = -911                                           
H P H                 MOVE '3007-PROCESA-KACA68T'  TO WS-OUT-PARRAFO            
H P H                 MOVE 'CONTENCION TABLA   '   TO WS-OUT-DESC               
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 mOVE 'S' TO SW-911                                        
H P H                 MOVE 'S' TO SW-911-911                                    
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 MOVE 'SI'                  TO WS-ROLLBACK                 
H P H                 MOVE SQLCODE               TO WS-OUT-SQLCODE              
H P H                 MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA               
H P H                 MOVE WS-TABLA-H            TO WS-OUT-TABLA                
H P H                 MOVE '3007-PROCESA-KACA68T' TO WS-OUT-PARRAFO             
H P H                    STRING                                                 
H P H                   'CONTENCIO:'             DELIMITED BY SIZE              
H P H                    WS-CAMPOPOL             DELIMITED BY ' '               
H P H                    '='                     DELIMITED BY SIZE              
H P H                    WS-LEE-CDNUMPOL         DELIMITED BY SIZE              
H P H                    INTO WS-OUT-DESC                                       
H P H                 END-STRING                                                
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H            STRING                                                         
H P H            'Z8883??????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            'Z8881??????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H              ELSE                                                         
H P H                 MOVE WC-COD              TO CDERR    OF KAELCWEZ          
H P H                 MOVE WC-DES01            TO DSARGU1  OF KAELCWEZ          
H P H                 MOVE WC-PROGRAMA         TO DSARGU2  OF KAELCWEZ          
H P H                 MOVE WS-ERPOLIZA         TO DSARGU3  OF KAELCWEZ          
H P H                 MOVE '3007-PROCESA-KACA68T'                               
H P H                                          TO CDPARRAF OF KAELCWEZ          
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H                 IF SQLCODE = -911                                         
H P H                    MOVE 'S' TO SW-911                                     
H P H                    MOVE 'S' TO SW-911-911                                 
H P H                    ADD 1 TO WS-CANT-ERRORES                               
H P H                 ELSE                                                      
H P H            STRING                                                         
H P H            'X9999??????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            'X9999??????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H                 PERFORM 9999-GESTION-ERRORES                              
H P H                 END-IF                                                    
H P H              END-IF                                                       
H P H      END-EVALUATE                                                         
H P H                 END-IF                                                    
H P H               END-IF                                                      
H P H              END-IF                                                       
H P H              IF WS-ROLLBACK = 'SI'                                        
H P H                 SET WS-NO-HAY-SINIESTROS TO TRUE                          
H P H                 MOVE 98 TO WS-ITBLS                                       
H P H              END-IF                                                       
H P H              ADD WC-1 TO WS-ITBLS.                                        
H P H *                                                                         
H P H  3008-PROCESA-KACA71T.                                                    
H P H              MOVE 'KACA71T'             TO WS-TABLA-T                     
H P H              MOVE 'KACA71H'             TO WS-TABLA-H                     
H P H *                                                                         
H P H              MOVE 'KACA71T'             TO WS-TIPO-TABLA                  
H P H              MOVE 'CDSINIES'            TO WS-CAMPOPOL                    
H P H                                                                           
H P H              IF TAB-ESP-SR                                                
H P H               IF WS-SI-HISTORIFICA                                        
H P H                 PERFORM 3300-INSERTA-ESP-SIN                              
H P H               END-IF                                                      
H P H              ELSE                                                         
H P H               IF WS-SI-HISTORIFICA                                        
H P H      EXEC SQL                                                             
H P H         DECLARE CURSOR-08 CURSOR FOR                                      
H P H            SELECT CDSINIES FROM KACA71T                                   
H P H             WHERE CDSINIES = :WS-TBL-SINOREC                              
H P H             FETCH FIRST 1 ROWS ONLY                                       
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EXEC SQL                                                             
H P H          OPEN CURSOR-08                                                   
H P H      END-EXEC                                                             
H P H      PERFORM 3306-VALIDA-CODIGO                                           
H P H      EXEC SQL                                                             
H P H          FETCH CURSOR-08                                                  
H P H          INTO                                                             
H P H          :WS-SINOREC                                                      
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H             EXEC SQL                                                      
H P H                CLOSE CURSOR-08                                            
H P H             END-EXEC                                                      
H P H             SET WS-PARA-INSERT TO TRUE                                    
H P H      EXEC SQL                                                             
H P H         INSERT INTO KACA71H                                               
H P H            (SELECT * FROM KACA71T                                         
H P H             WHERE CDSINIES = :WS-TBL-SINOREC)                             
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3008-PROCESA-KACA71T' TO WS-OUT-PARRAFO                
H P H              MOVE 'INSERT CORRECTO '    TO WS-OUT-DESC                    
H P H              MOVE WS-TBL-SINOREC        TO WS-OUT-DESC(18:12)             
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-CLAVE-DUPLICADA                                   
H P H              SET WS-DUPLICADOS   TO TRUE                                  
H P H              MOVE 'SI'                  TO WS-ROLLBACK                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3008-PROCESA-KACA71T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                'DUPLICADO:'             DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H              INTO WS-OUT-DESC                                             
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H            IF WS-WRITE                                                    
H P H              ADD  WC-1                  TO WS-IERR                        
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3008-PROCESA-KACA71T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'SIN '                  DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN OTHER                                                         
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                     SET WS-DUPLICADOS   TO TRUE                           
H P H                     MOVE 'SI'                  TO WS-ROLLBACK             
H P H                     MOVE SQLCODE               TO WS-OUT-SQLCODE          
H P H                     MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA           
H P H                     MOVE WS-TABLA-H            TO WS-OUT-TABLA            
H P H                     MOVE '3008-PROCESA-KACA71T' TO WS-OUT-PARRAFO         
H P H                     STRING                                                
H P H                      'CONTENCIO:'             DELIMITED BY SIZE           
H P H                       WS-CAMPOPOL             DELIMITED BY ' '            
H P H                       '='                     DELIMITED BY SIZE           
H P H                       WS-LEE-CDNUMPOL         DELIMITED BY SIZE           
H P H                       INTO WS-OUT-DESC                                    
H P H                       END-STRING                                          
H P H                     PERFORM 1570-ESCRIBE-DESCARTADA                       
H P H              ELSE                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3008-PROCESA-KACA71T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'ERRDB2:'               DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H              MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
H P H              MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
H P H              MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
H P H              MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
H P H              MOVE '3008-PROCESA-KACA71T  ' TO CDPARRAF OF KAELCWEZ        
H P H                                                                           
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 MOVE 'S' TO SW-911-911                                    
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H              ELSE                                                         
H P H                 PERFORM 9999-GESTION-ERRORES                              
H P H              END-IF                                                       
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                                                                           
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H            SET WS-NO-PARA-INSERT      TO TRUE                             
H P H            IF WS-WRITE                                                    
H P H              ADD  WC-1                  TO WS-IERR                        
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3008-PROCESA-KACA71T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'NOHAY '                DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H            EXEC SQL                                                       
H P H                CLOSE CURSOR-08                                            
H P H            END-EXEC                                                       
H P H        WHEN OTHER                                                         
H P H              SET WS-NO-PARA-INSERT      TO TRUE                           
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3008-PROCESA-KACA71T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'ERRDB2:'               DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            STRING                                                         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            ' ERROR EN SQL :' W-QUERY-TEXT                    '\N'         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H          MOVE WC-COD                   TO CDERR    OF KAELCWEZ            
H P H          MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ            
H P H          MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ            
H P H          MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ            
H P H          MOVE '3008-PROCESA-KACA71T  ' TO CDPARRAF OF KAELCWEZ            
H P H                                                                           
H P H          IF SQLCODE = -911                                                
H P H              MOVE 'S' TO SW-911                                           
H P H              MOVE 'S' TO SW-911-911                                       
H P H              ADD 1 TO WS-CANT-ERRORES                                     
H P H          ELSE                                                             
H P H             PERFORM 9999-GESTION-ERRORES                                  
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                 IF  SQLCODE = WN-SQLCODE-OK                               
H P H                 AND WS-PARA-INSERT                                        
H P H      EXEC SQL                                                             
H P H         DELETE FROM KACA71T                                               
H P H         WHERE CDSINIES = :WS-TBL-SINOREC                                  
H P H      END-EXEC                                                             
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3008-PROCESA-KACA71T' TO WS-OUT-PARRAFO                
H P H              MOVE 'BORRAR CORRECTO    ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3008-PROCESA-KACA71T' TO WS-OUT-PARRAFO                
H P H              MOVE 'NO EXISTE BORRAR   ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H              MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
H P H              MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
H P H              MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
H P H              MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
H P H              MOVE '3008-PROCESA-KACA71T  ' TO CDPARRAF OF KAELCWEZ        
H P H                                                                           
H P H              PERFORM 9999-GESTION-ERRORES                                 
H P H                                                                           
H P H        WHEN OTHER                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3008-PROCESA-KACA71T' TO WS-OUT-PARRAFO                
H P H              MOVE 'ERR BORRAR DB2     ' TO WS-OUT-DESC                    
H P H              IF SQLCODE  = -911                                           
H P H                 MOVE '3008-PROCESA-KACA71T'  TO WS-OUT-PARRAFO            
H P H                 MOVE 'CONTENCION TABLA   '   TO WS-OUT-DESC               
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 mOVE 'S' TO SW-911                                        
H P H                 MOVE 'S' TO SW-911-911                                    
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 MOVE 'SI'                  TO WS-ROLLBACK                 
H P H                 MOVE SQLCODE               TO WS-OUT-SQLCODE              
H P H                 MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA               
H P H                 MOVE WS-TABLA-H            TO WS-OUT-TABLA                
H P H                 MOVE '3008-PROCESA-KACA71T' TO WS-OUT-PARRAFO             
H P H                    STRING                                                 
H P H                   'CONTENCIO:'             DELIMITED BY SIZE              
H P H                    WS-CAMPOPOL             DELIMITED BY ' '               
H P H                    '='                     DELIMITED BY SIZE              
H P H                    WS-LEE-CDNUMPOL         DELIMITED BY SIZE              
H P H                    INTO WS-OUT-DESC                                       
H P H                 END-STRING                                                
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H            STRING                                                         
H P H            'Z8883??????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            'Z8881??????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H              ELSE                                                         
H P H                 MOVE WC-COD              TO CDERR    OF KAELCWEZ          
H P H                 MOVE WC-DES01            TO DSARGU1  OF KAELCWEZ          
H P H                 MOVE WC-PROGRAMA         TO DSARGU2  OF KAELCWEZ          
H P H                 MOVE WS-ERPOLIZA         TO DSARGU3  OF KAELCWEZ          
H P H                 MOVE '3008-PROCESA-KACA71T'                               
H P H                                          TO CDPARRAF OF KAELCWEZ          
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H                 IF SQLCODE = -911                                         
H P H                    MOVE 'S' TO SW-911                                     
H P H                    MOVE 'S' TO SW-911-911                                 
H P H                    ADD 1 TO WS-CANT-ERRORES                               
H P H                 ELSE                                                      
H P H            STRING                                                         
H P H            'X9999??????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            'X9999??????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H                 PERFORM 9999-GESTION-ERRORES                              
H P H                 END-IF                                                    
H P H              END-IF                                                       
H P H      END-EVALUATE                                                         
H P H                 END-IF                                                    
H P H               END-IF                                                      
H P H              END-IF                                                       
H P H              IF WS-ROLLBACK = 'SI'                                        
H P H                 SET WS-NO-HAY-SINIESTROS TO TRUE                          
H P H                 MOVE 98 TO WS-ITBLS                                       
H P H              END-IF                                                       
H P H              ADD WC-1 TO WS-ITBLS.                                        
H P H *                                                                         
H P H  3009-PROCESA-KACM50T.                                                    
H P H              MOVE 'KACM50T'             TO WS-TABLA-T                     
H P H              MOVE 'KACM50H'             TO WS-TABLA-H                     
H P H *                                                                         
H P H              MOVE 'KACM50T'             TO WS-TIPO-TABLA                  
H P H              MOVE 'CDSINIES'            TO WS-CAMPOPOL                    
H P H                                                                           
H P H              IF TAB-ESP-SR                                                
H P H               IF WS-SI-HISTORIFICA                                        
H P H                 PERFORM 3300-INSERTA-ESP-SIN                              
H P H               END-IF                                                      
H P H              ELSE                                                         
H P H               IF WS-SI-HISTORIFICA                                        
H P H      EXEC SQL                                                             
H P H         DECLARE CURSOR-09 CURSOR FOR                                      
H P H            SELECT CDSINIES FROM KACM50T                                   
H P H             WHERE CDSINIES = :WS-TBL-SINOREC                              
H P H             FETCH FIRST 1 ROWS ONLY                                       
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EXEC SQL                                                             
H P H          OPEN CURSOR-09                                                   
H P H      END-EXEC                                                             
H P H      PERFORM 3306-VALIDA-CODIGO                                           
H P H      EXEC SQL                                                             
H P H          FETCH CURSOR-09                                                  
H P H          INTO                                                             
H P H          :WS-SINOREC                                                      
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H             EXEC SQL                                                      
H P H                CLOSE CURSOR-09                                            
H P H             END-EXEC                                                      
H P H             SET WS-PARA-INSERT TO TRUE                                    
H P H      EXEC SQL                                                             
H P H         INSERT INTO KACM50H                                               
H P H            (SELECT * FROM KACM50T                                         
H P H             WHERE CDSINIES = :WS-TBL-SINOREC)                             
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3009-PROCESA-KACM50T' TO WS-OUT-PARRAFO                
H P H              MOVE 'INSERT CORRECTO '    TO WS-OUT-DESC                    
H P H              MOVE WS-TBL-SINOREC        TO WS-OUT-DESC(18:12)             
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-CLAVE-DUPLICADA                                   
H P H              SET WS-DUPLICADOS   TO TRUE                                  
H P H              MOVE 'SI'                  TO WS-ROLLBACK                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3009-PROCESA-KACM50T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                'DUPLICADO:'             DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H              INTO WS-OUT-DESC                                             
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H            IF WS-WRITE                                                    
H P H              ADD  WC-1                  TO WS-IERR                        
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3009-PROCESA-KACM50T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'SIN '                  DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN OTHER                                                         
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                     SET WS-DUPLICADOS   TO TRUE                           
H P H                     MOVE 'SI'                  TO WS-ROLLBACK             
H P H                     MOVE SQLCODE               TO WS-OUT-SQLCODE          
H P H                     MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA           
H P H                     MOVE WS-TABLA-H            TO WS-OUT-TABLA            
H P H                     MOVE '3009-PROCESA-KACM50T' TO WS-OUT-PARRAFO         
H P H                     STRING                                                
H P H                      'CONTENCIO:'             DELIMITED BY SIZE           
H P H                       WS-CAMPOPOL             DELIMITED BY ' '            
H P H                       '='                     DELIMITED BY SIZE           
H P H                       WS-LEE-CDNUMPOL         DELIMITED BY SIZE           
H P H                       INTO WS-OUT-DESC                                    
H P H                       END-STRING                                          
H P H                     PERFORM 1570-ESCRIBE-DESCARTADA                       
H P H              ELSE                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3009-PROCESA-KACM50T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'ERRDB2:'               DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H              MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
H P H              MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
H P H              MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
H P H              MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
H P H              MOVE '3009-PROCESA-KACM50T  ' TO CDPARRAF OF KAELCWEZ        
H P H                                                                           
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 MOVE 'S' TO SW-911-911                                    
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H              ELSE                                                         
H P H                 PERFORM 9999-GESTION-ERRORES                              
H P H              END-IF                                                       
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                                                                           
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H            SET WS-NO-PARA-INSERT      TO TRUE                             
H P H            IF WS-WRITE                                                    
H P H              ADD  WC-1                  TO WS-IERR                        
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3009-PROCESA-KACM50T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'NOHAY '                DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H            EXEC SQL                                                       
H P H                CLOSE CURSOR-09                                            
H P H            END-EXEC                                                       
H P H        WHEN OTHER                                                         
H P H              SET WS-NO-PARA-INSERT      TO TRUE                           
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3009-PROCESA-KACM50T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'ERRDB2:'               DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            STRING                                                         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            ' ERROR EN SQL :' W-QUERY-TEXT                    '\N'         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H          MOVE WC-COD                   TO CDERR    OF KAELCWEZ            
H P H          MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ            
H P H          MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ            
H P H          MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ            
H P H          MOVE '3009-PROCESA-KACM50T  ' TO CDPARRAF OF KAELCWEZ            
H P H                                                                           
H P H          IF SQLCODE = -911                                                
H P H              MOVE 'S' TO SW-911                                           
H P H              MOVE 'S' TO SW-911-911                                       
H P H              ADD 1 TO WS-CANT-ERRORES                                     
H P H          ELSE                                                             
H P H             PERFORM 9999-GESTION-ERRORES                                  
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                 IF  SQLCODE = WN-SQLCODE-OK                               
H P H                 AND WS-PARA-INSERT                                        
H P H      EXEC SQL                                                             
H P H         DELETE FROM KACM50T                                               
H P H         WHERE CDSINIES = :WS-TBL-SINOREC                                  
H P H      END-EXEC                                                             
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3009-PROCESA-KACM50T' TO WS-OUT-PARRAFO                
H P H              MOVE 'BORRAR CORRECTO    ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3009-PROCESA-KACM50T' TO WS-OUT-PARRAFO                
H P H              MOVE 'NO EXISTE BORRAR   ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H              MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
H P H              MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
H P H              MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
H P H              MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
H P H              MOVE '3009-PROCESA-KACM50T  ' TO CDPARRAF OF KAELCWEZ        
H P H                                                                           
H P H              PERFORM 9999-GESTION-ERRORES                                 
H P H                                                                           
H P H        WHEN OTHER                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3009-PROCESA-KACM50T' TO WS-OUT-PARRAFO                
H P H              MOVE 'ERR BORRAR DB2     ' TO WS-OUT-DESC                    
H P H              IF SQLCODE  = -911                                           
H P H                 MOVE '3009-PROCESA-KACM50T'  TO WS-OUT-PARRAFO            
H P H                 MOVE 'CONTENCION TABLA   '   TO WS-OUT-DESC               
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 mOVE 'S' TO SW-911                                        
H P H                 MOVE 'S' TO SW-911-911                                    
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 MOVE 'SI'                  TO WS-ROLLBACK                 
H P H                 MOVE SQLCODE               TO WS-OUT-SQLCODE              
H P H                 MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA               
H P H                 MOVE WS-TABLA-H            TO WS-OUT-TABLA                
H P H                 MOVE '3009-PROCESA-KACM50T' TO WS-OUT-PARRAFO             
H P H                    STRING                                                 
H P H                   'CONTENCIO:'             DELIMITED BY SIZE              
H P H                    WS-CAMPOPOL             DELIMITED BY ' '               
H P H                    '='                     DELIMITED BY SIZE              
H P H                    WS-LEE-CDNUMPOL         DELIMITED BY SIZE              
H P H                    INTO WS-OUT-DESC                                       
H P H                 END-STRING                                                
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H            STRING                                                         
H P H            'Z8883??????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            'Z8881??????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H              ELSE                                                         
H P H                 MOVE WC-COD              TO CDERR    OF KAELCWEZ          
H P H                 MOVE WC-DES01            TO DSARGU1  OF KAELCWEZ          
H P H                 MOVE WC-PROGRAMA         TO DSARGU2  OF KAELCWEZ          
H P H                 MOVE WS-ERPOLIZA         TO DSARGU3  OF KAELCWEZ          
H P H                 MOVE '3009-PROCESA-KACM50T'                               
H P H                                          TO CDPARRAF OF KAELCWEZ          
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H                 IF SQLCODE = -911                                         
H P H                    MOVE 'S' TO SW-911                                     
H P H                    MOVE 'S' TO SW-911-911                                 
H P H                    ADD 1 TO WS-CANT-ERRORES                               
H P H                 ELSE                                                      
H P H            STRING                                                         
H P H            'X9999??????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            'X9999??????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H                 PERFORM 9999-GESTION-ERRORES                              
H P H                 END-IF                                                    
H P H              END-IF                                                       
H P H      END-EVALUATE                                                         
H P H                 END-IF                                                    
H P H               END-IF                                                      
H P H              END-IF                                                       
H P H              IF WS-ROLLBACK = 'SI'                                        
H P H                 SET WS-NO-HAY-SINIESTROS TO TRUE                          
H P H                 MOVE 98 TO WS-ITBLS                                       
H P H              END-IF                                                       
H P H              ADD WC-1 TO WS-ITBLS.                                        
H P H *                                                                         
H P H  3010-PROCESA-KACM51T.                                                    
H P H              MOVE 'KACM51T'             TO WS-TABLA-T                     
H P H              MOVE 'KACM51H'             TO WS-TABLA-H                     
H P H *                                                                         
H P H              MOVE 'KACM51T'             TO WS-TIPO-TABLA                  
H P H              MOVE 'CDSINIES'            TO WS-CAMPOPOL                    
H P H                                                                           
H P H              IF TAB-ESP-SR                                                
H P H               IF WS-SI-HISTORIFICA                                        
H P H                 PERFORM 3300-INSERTA-ESP-SIN                              
H P H               END-IF                                                      
H P H              ELSE                                                         
H P H               IF WS-SI-HISTORIFICA                                        
H P H      EXEC SQL                                                             
H P H         DECLARE CURSOR-10 CURSOR FOR                                      
H P H            SELECT CDSINIES FROM KACM51T                                   
H P H             WHERE CDSINIES = :WS-TBL-SINOREC                              
H P H             FETCH FIRST 1 ROWS ONLY                                       
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EXEC SQL                                                             
H P H          OPEN CURSOR-10                                                   
H P H      END-EXEC                                                             
H P H      PERFORM 3306-VALIDA-CODIGO                                           
H P H      EXEC SQL                                                             
H P H          FETCH CURSOR-10                                                  
H P H          INTO                                                             
H P H          :WS-SINOREC                                                      
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H             EXEC SQL                                                      
H P H                CLOSE CURSOR-10                                            
H P H             END-EXEC                                                      
H P H             SET WS-PARA-INSERT TO TRUE                                    
H P H      EXEC SQL                                                             
H P H         INSERT INTO KACM51H                                               
H P H            (SELECT * FROM KACM51T                                         
H P H             WHERE CDSINIES = :WS-TBL-SINOREC)                             
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3010-PROCESA-KACM51T' TO WS-OUT-PARRAFO                
H P H              MOVE 'INSERT CORRECTO '    TO WS-OUT-DESC                    
H P H              MOVE WS-TBL-SINOREC        TO WS-OUT-DESC(18:12)             
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-CLAVE-DUPLICADA                                   
H P H              SET WS-DUPLICADOS   TO TRUE                                  
H P H              MOVE 'SI'                  TO WS-ROLLBACK                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3010-PROCESA-KACM51T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                'DUPLICADO:'             DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H              INTO WS-OUT-DESC                                             
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H            IF WS-WRITE                                                    
H P H              ADD  WC-1                  TO WS-IERR                        
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3010-PROCESA-KACM51T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'SIN '                  DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN OTHER                                                         
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                     SET WS-DUPLICADOS   TO TRUE                           
H P H                     MOVE 'SI'                  TO WS-ROLLBACK             
H P H                     MOVE SQLCODE               TO WS-OUT-SQLCODE          
H P H                     MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA           
H P H                     MOVE WS-TABLA-H            TO WS-OUT-TABLA            
H P H                     MOVE '3010-PROCESA-KACM51T' TO WS-OUT-PARRAFO         
H P H                     STRING                                                
H P H                      'CONTENCIO:'             DELIMITED BY SIZE           
H P H                       WS-CAMPOPOL             DELIMITED BY ' '            
H P H                       '='                     DELIMITED BY SIZE           
H P H                       WS-LEE-CDNUMPOL         DELIMITED BY SIZE           
H P H                       INTO WS-OUT-DESC                                    
H P H                       END-STRING                                          
H P H                     PERFORM 1570-ESCRIBE-DESCARTADA                       
H P H              ELSE                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3010-PROCESA-KACM51T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'ERRDB2:'               DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H              MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
H P H              MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
H P H              MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
H P H              MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
H P H              MOVE '3010-PROCESA-KACM51T  ' TO CDPARRAF OF KAELCWEZ        
H P H                                                                           
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 MOVE 'S' TO SW-911-911                                    
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H              ELSE                                                         
H P H                 PERFORM 9999-GESTION-ERRORES                              
H P H              END-IF                                                       
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                                                                           
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H            SET WS-NO-PARA-INSERT      TO TRUE                             
H P H            IF WS-WRITE                                                    
H P H              ADD  WC-1                  TO WS-IERR                        
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3010-PROCESA-KACM51T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'NOHAY '                DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H            EXEC SQL                                                       
H P H                CLOSE CURSOR-10                                            
H P H            END-EXEC                                                       
H P H        WHEN OTHER                                                         
H P H              SET WS-NO-PARA-INSERT      TO TRUE                           
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3010-PROCESA-KACM51T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'ERRDB2:'               DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            STRING                                                         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            ' ERROR EN SQL :' W-QUERY-TEXT                    '\N'         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H          MOVE WC-COD                   TO CDERR    OF KAELCWEZ            
H P H          MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ            
H P H          MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ            
H P H          MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ            
H P H          MOVE '3010-PROCESA-KACM51T  ' TO CDPARRAF OF KAELCWEZ            
H P H                                                                           
H P H          IF SQLCODE = -911                                                
H P H              MOVE 'S' TO SW-911                                           
H P H              MOVE 'S' TO SW-911-911                                       
H P H              ADD 1 TO WS-CANT-ERRORES                                     
H P H          ELSE                                                             
H P H             PERFORM 9999-GESTION-ERRORES                                  
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                 IF  SQLCODE = WN-SQLCODE-OK                               
H P H                 AND WS-PARA-INSERT                                        
H P H      EXEC SQL                                                             
H P H         DELETE FROM KACM51T                                               
H P H         WHERE CDSINIES = :WS-TBL-SINOREC                                  
H P H      END-EXEC                                                             
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3010-PROCESA-KACM51T' TO WS-OUT-PARRAFO                
H P H              MOVE 'BORRAR CORRECTO    ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3010-PROCESA-KACM51T' TO WS-OUT-PARRAFO                
H P H              MOVE 'NO EXISTE BORRAR   ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H              MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
H P H              MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
H P H              MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
H P H              MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
H P H              MOVE '3010-PROCESA-KACM51T  ' TO CDPARRAF OF KAELCWEZ        
H P H                                                                           
H P H              PERFORM 9999-GESTION-ERRORES                                 
H P H                                                                           
H P H        WHEN OTHER                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3010-PROCESA-KACM51T' TO WS-OUT-PARRAFO                
H P H              MOVE 'ERR BORRAR DB2     ' TO WS-OUT-DESC                    
H P H              IF SQLCODE  = -911                                           
H P H                 MOVE '3010-PROCESA-KACM51T'  TO WS-OUT-PARRAFO            
H P H                 MOVE 'CONTENCION TABLA   '   TO WS-OUT-DESC               
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 mOVE 'S' TO SW-911                                        
H P H                 MOVE 'S' TO SW-911-911                                    
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 MOVE 'SI'                  TO WS-ROLLBACK                 
H P H                 MOVE SQLCODE               TO WS-OUT-SQLCODE              
H P H                 MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA               
H P H                 MOVE WS-TABLA-H            TO WS-OUT-TABLA                
H P H                 MOVE '3010-PROCESA-KACM51T' TO WS-OUT-PARRAFO             
H P H                    STRING                                                 
H P H                   'CONTENCIO:'             DELIMITED BY SIZE              
H P H                    WS-CAMPOPOL             DELIMITED BY ' '               
H P H                    '='                     DELIMITED BY SIZE              
H P H                    WS-LEE-CDNUMPOL         DELIMITED BY SIZE              
H P H                    INTO WS-OUT-DESC                                       
H P H                 END-STRING                                                
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H            STRING                                                         
H P H            'Z8883??????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            'Z8881??????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H              ELSE                                                         
H P H                 MOVE WC-COD              TO CDERR    OF KAELCWEZ          
H P H                 MOVE WC-DES01            TO DSARGU1  OF KAELCWEZ          
H P H                 MOVE WC-PROGRAMA         TO DSARGU2  OF KAELCWEZ          
H P H                 MOVE WS-ERPOLIZA         TO DSARGU3  OF KAELCWEZ          
H P H                 MOVE '3010-PROCESA-KACM51T'                               
H P H                                          TO CDPARRAF OF KAELCWEZ          
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H                 IF SQLCODE = -911                                         
H P H                    MOVE 'S' TO SW-911                                     
H P H                    MOVE 'S' TO SW-911-911                                 
H P H                    ADD 1 TO WS-CANT-ERRORES                               
H P H                 ELSE                                                      
H P H            STRING                                                         
H P H            'X9999??????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            'X9999??????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H                 PERFORM 9999-GESTION-ERRORES                              
H P H                 END-IF                                                    
H P H              END-IF                                                       
H P H      END-EVALUATE                                                         
H P H                 END-IF                                                    
H P H               END-IF                                                      
H P H              END-IF                                                       
H P H              IF WS-ROLLBACK = 'SI'                                        
H P H                 SET WS-NO-HAY-SINIESTROS TO TRUE                          
H P H                 MOVE 98 TO WS-ITBLS                                       
H P H              END-IF                                                       
H P H              ADD WC-1 TO WS-ITBLS.                                        
H P H *                                                                         
H P H  3011-PROCESA-KACM52T.                                                    
H P H              MOVE 'KACM52T'             TO WS-TABLA-T                     
H P H              MOVE 'KACM52H'             TO WS-TABLA-H                     
H P H *                                                                         
H P H              MOVE 'KACM52T'             TO WS-TIPO-TABLA                  
H P H              MOVE 'CDSINIES'            TO WS-CAMPOPOL                    
H P H                                                                           
H P H              IF TAB-ESP-SR                                                
H P H               IF WS-SI-HISTORIFICA                                        
H P H                 PERFORM 3300-INSERTA-ESP-SIN                              
H P H               END-IF                                                      
H P H              ELSE                                                         
H P H               IF WS-SI-HISTORIFICA                                        
H P H      EXEC SQL                                                             
H P H         DECLARE CURSOR-11 CURSOR FOR                                      
H P H            SELECT CDSINIES FROM KACM52T                                   
H P H             WHERE CDSINIES = :WS-TBL-SINOREC                              
H P H             FETCH FIRST 1 ROWS ONLY                                       
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EXEC SQL                                                             
H P H          OPEN CURSOR-11                                                   
H P H      END-EXEC                                                             
H P H      PERFORM 3306-VALIDA-CODIGO                                           
H P H      EXEC SQL                                                             
H P H          FETCH CURSOR-11                                                  
H P H          INTO                                                             
H P H          :WS-SINOREC                                                      
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H             EXEC SQL                                                      
H P H                CLOSE CURSOR-11                                            
H P H             END-EXEC                                                      
H P H             SET WS-PARA-INSERT TO TRUE                                    
H P H      EXEC SQL                                                             
H P H         INSERT INTO KACM52H                                               
H P H            (SELECT * FROM KACM52T                                         
H P H             WHERE CDSINIES = :WS-TBL-SINOREC)                             
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3011-PROCESA-KACM52T' TO WS-OUT-PARRAFO                
H P H              MOVE 'INSERT CORRECTO '    TO WS-OUT-DESC                    
H P H              MOVE WS-TBL-SINOREC        TO WS-OUT-DESC(18:12)             
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-CLAVE-DUPLICADA                                   
H P H              SET WS-DUPLICADOS   TO TRUE                                  
H P H              MOVE 'SI'                  TO WS-ROLLBACK                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3011-PROCESA-KACM52T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                'DUPLICADO:'             DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H              INTO WS-OUT-DESC                                             
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H            IF WS-WRITE                                                    
H P H              ADD  WC-1                  TO WS-IERR                        
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3011-PROCESA-KACM52T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'SIN '                  DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN OTHER                                                         
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                     SET WS-DUPLICADOS   TO TRUE                           
H P H                     MOVE 'SI'                  TO WS-ROLLBACK             
H P H                     MOVE SQLCODE               TO WS-OUT-SQLCODE          
H P H                     MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA           
H P H                     MOVE WS-TABLA-H            TO WS-OUT-TABLA            
H P H                     MOVE '3011-PROCESA-KACM52T' TO WS-OUT-PARRAFO         
H P H                     STRING                                                
H P H                      'CONTENCIO:'             DELIMITED BY SIZE           
H P H                       WS-CAMPOPOL             DELIMITED BY ' '            
H P H                       '='                     DELIMITED BY SIZE           
H P H                       WS-LEE-CDNUMPOL         DELIMITED BY SIZE           
H P H                       INTO WS-OUT-DESC                                    
H P H                       END-STRING                                          
H P H                     PERFORM 1570-ESCRIBE-DESCARTADA                       
H P H              ELSE                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3011-PROCESA-KACM52T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'ERRDB2:'               DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H              MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
H P H              MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
H P H              MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
H P H              MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
H P H              MOVE '3011-PROCESA-KACM52T  ' TO CDPARRAF OF KAELCWEZ        
H P H                                                                           
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 MOVE 'S' TO SW-911-911                                    
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H              ELSE                                                         
H P H                 PERFORM 9999-GESTION-ERRORES                              
H P H              END-IF                                                       
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                                                                           
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H            SET WS-NO-PARA-INSERT      TO TRUE                             
H P H            IF WS-WRITE                                                    
H P H              ADD  WC-1                  TO WS-IERR                        
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3011-PROCESA-KACM52T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'NOHAY '                DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H            EXEC SQL                                                       
H P H                CLOSE CURSOR-11                                            
H P H            END-EXEC                                                       
H P H        WHEN OTHER                                                         
H P H              SET WS-NO-PARA-INSERT      TO TRUE                           
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3011-PROCESA-KACM52T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'ERRDB2:'               DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            STRING                                                         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            ' ERROR EN SQL :' W-QUERY-TEXT                    '\N'         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H          MOVE WC-COD                   TO CDERR    OF KAELCWEZ            
H P H          MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ            
H P H          MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ            
H P H          MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ            
H P H          MOVE '3011-PROCESA-KACM52T  ' TO CDPARRAF OF KAELCWEZ            
H P H                                                                           
H P H          IF SQLCODE = -911                                                
H P H              MOVE 'S' TO SW-911                                           
H P H              MOVE 'S' TO SW-911-911                                       
H P H              ADD 1 TO WS-CANT-ERRORES                                     
H P H          ELSE                                                             
H P H             PERFORM 9999-GESTION-ERRORES                                  
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                 IF  SQLCODE = WN-SQLCODE-OK                               
H P H                 AND WS-PARA-INSERT                                        
H P H      EXEC SQL                                                             
H P H         DELETE FROM KACM52T                                               
H P H         WHERE CDSINIES = :WS-TBL-SINOREC                                  
H P H      END-EXEC                                                             
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3011-PROCESA-KACM52T' TO WS-OUT-PARRAFO                
H P H              MOVE 'BORRAR CORRECTO    ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3011-PROCESA-KACM52T' TO WS-OUT-PARRAFO                
H P H              MOVE 'NO EXISTE BORRAR   ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H              MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
H P H              MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
H P H              MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
H P H              MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
H P H              MOVE '3011-PROCESA-KACM52T  ' TO CDPARRAF OF KAELCWEZ        
H P H                                                                           
H P H              PERFORM 9999-GESTION-ERRORES                                 
H P H                                                                           
H P H        WHEN OTHER                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3011-PROCESA-KACM52T' TO WS-OUT-PARRAFO                
H P H              MOVE 'ERR BORRAR DB2     ' TO WS-OUT-DESC                    
H P H              IF SQLCODE  = -911                                           
H P H                 MOVE '3011-PROCESA-KACM52T'  TO WS-OUT-PARRAFO            
H P H                 MOVE 'CONTENCION TABLA   '   TO WS-OUT-DESC               
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 mOVE 'S' TO SW-911                                        
H P H                 MOVE 'S' TO SW-911-911                                    
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 MOVE 'SI'                  TO WS-ROLLBACK                 
H P H                 MOVE SQLCODE               TO WS-OUT-SQLCODE              
H P H                 MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA               
H P H                 MOVE WS-TABLA-H            TO WS-OUT-TABLA                
H P H                 MOVE '3011-PROCESA-KACM52T' TO WS-OUT-PARRAFO             
H P H                    STRING                                                 
H P H                   'CONTENCIO:'             DELIMITED BY SIZE              
H P H                    WS-CAMPOPOL             DELIMITED BY ' '               
H P H                    '='                     DELIMITED BY SIZE              
H P H                    WS-LEE-CDNUMPOL         DELIMITED BY SIZE              
H P H                    INTO WS-OUT-DESC                                       
H P H                 END-STRING                                                
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H            STRING                                                         
H P H            'Z8883??????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            'Z8881??????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H              ELSE                                                         
H P H                 MOVE WC-COD              TO CDERR    OF KAELCWEZ          
H P H                 MOVE WC-DES01            TO DSARGU1  OF KAELCWEZ          
H P H                 MOVE WC-PROGRAMA         TO DSARGU2  OF KAELCWEZ          
H P H                 MOVE WS-ERPOLIZA         TO DSARGU3  OF KAELCWEZ          
H P H                 MOVE '3011-PROCESA-KACM52T'                               
H P H                                          TO CDPARRAF OF KAELCWEZ          
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H                 IF SQLCODE = -911                                         
H P H                    MOVE 'S' TO SW-911                                     
H P H                    MOVE 'S' TO SW-911-911                                 
H P H                    ADD 1 TO WS-CANT-ERRORES                               
H P H                 ELSE                                                      
H P H            STRING                                                         
H P H            'X9999??????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            'X9999??????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H                 PERFORM 9999-GESTION-ERRORES                              
H P H                 END-IF                                                    
H P H              END-IF                                                       
H P H      END-EVALUATE                                                         
H P H                 END-IF                                                    
H P H               END-IF                                                      
H P H              END-IF                                                       
H P H              IF WS-ROLLBACK = 'SI'                                        
H P H                 SET WS-NO-HAY-SINIESTROS TO TRUE                          
H P H                 MOVE 98 TO WS-ITBLS                                       
H P H              END-IF                                                       
H P H              ADD WC-1 TO WS-ITBLS.                                        
H P H *                                                                         
H P H  3012-PROCESA-KACM53T.                                                    
H P H              MOVE 'KACM53T'             TO WS-TABLA-T                     
H P H              MOVE 'KACM53H'             TO WS-TABLA-H                     
H P H *                                                                         
H P H              MOVE 'KACM53T'             TO WS-TIPO-TABLA                  
H P H              MOVE 'CDSINIES'            TO WS-CAMPOPOL                    
H P H                                                                           
H P H              IF TAB-ESP-SR                                                
H P H               IF WS-SI-HISTORIFICA                                        
H P H                 PERFORM 3300-INSERTA-ESP-SIN                              
H P H               END-IF                                                      
H P H              ELSE                                                         
H P H               IF WS-SI-HISTORIFICA                                        
H P H      EXEC SQL                                                             
H P H         DECLARE CURSOR-12 CURSOR FOR                                      
H P H            SELECT CDSINIES FROM KACM53T                                   
H P H             WHERE CDSINIES = :WS-TBL-SINOREC                              
H P H             FETCH FIRST 1 ROWS ONLY                                       
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EXEC SQL                                                             
H P H          OPEN CURSOR-12                                                   
H P H      END-EXEC                                                             
H P H      PERFORM 3306-VALIDA-CODIGO                                           
H P H      EXEC SQL                                                             
H P H          FETCH CURSOR-12                                                  
H P H          INTO                                                             
H P H          :WS-SINOREC                                                      
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H             EXEC SQL                                                      
H P H                CLOSE CURSOR-12                                            
H P H             END-EXEC                                                      
H P H             SET WS-PARA-INSERT TO TRUE                                    
H P H      EXEC SQL                                                             
H P H         INSERT INTO KACM53H                                               
H P H            (SELECT * FROM KACM53T                                         
H P H             WHERE CDSINIES = :WS-TBL-SINOREC)                             
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3012-PROCESA-KACM53T' TO WS-OUT-PARRAFO                
H P H              MOVE 'INSERT CORRECTO '    TO WS-OUT-DESC                    
H P H              MOVE WS-TBL-SINOREC        TO WS-OUT-DESC(18:12)             
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-CLAVE-DUPLICADA                                   
H P H              SET WS-DUPLICADOS   TO TRUE                                  
H P H              MOVE 'SI'                  TO WS-ROLLBACK                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3012-PROCESA-KACM53T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                'DUPLICADO:'             DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H              INTO WS-OUT-DESC                                             
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H            IF WS-WRITE                                                    
H P H              ADD  WC-1                  TO WS-IERR                        
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3012-PROCESA-KACM53T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'SIN '                  DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN OTHER                                                         
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                     SET WS-DUPLICADOS   TO TRUE                           
H P H                     MOVE 'SI'                  TO WS-ROLLBACK             
H P H                     MOVE SQLCODE               TO WS-OUT-SQLCODE          
H P H                     MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA           
H P H                     MOVE WS-TABLA-H            TO WS-OUT-TABLA            
H P H                     MOVE '3012-PROCESA-KACM53T' TO WS-OUT-PARRAFO         
H P H                     STRING                                                
H P H                      'CONTENCIO:'             DELIMITED BY SIZE           
H P H                       WS-CAMPOPOL             DELIMITED BY ' '            
H P H                       '='                     DELIMITED BY SIZE           
H P H                       WS-LEE-CDNUMPOL         DELIMITED BY SIZE           
H P H                       INTO WS-OUT-DESC                                    
H P H                       END-STRING                                          
H P H                     PERFORM 1570-ESCRIBE-DESCARTADA                       
H P H              ELSE                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3012-PROCESA-KACM53T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'ERRDB2:'               DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H              MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
H P H              MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
H P H              MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
H P H              MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
H P H              MOVE '3012-PROCESA-KACM53T  ' TO CDPARRAF OF KAELCWEZ        
H P H                                                                           
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 MOVE 'S' TO SW-911-911                                    
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H              ELSE                                                         
H P H                 PERFORM 9999-GESTION-ERRORES                              
H P H              END-IF                                                       
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                                                                           
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H            SET WS-NO-PARA-INSERT      TO TRUE                             
H P H            IF WS-WRITE                                                    
H P H              ADD  WC-1                  TO WS-IERR                        
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3012-PROCESA-KACM53T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'NOHAY '                DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H            EXEC SQL                                                       
H P H                CLOSE CURSOR-12                                            
H P H            END-EXEC                                                       
H P H        WHEN OTHER                                                         
H P H              SET WS-NO-PARA-INSERT      TO TRUE                           
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3012-PROCESA-KACM53T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'ERRDB2:'               DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            STRING                                                         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            ' ERROR EN SQL :' W-QUERY-TEXT                    '\N'         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H          MOVE WC-COD                   TO CDERR    OF KAELCWEZ            
H P H          MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ            
H P H          MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ            
H P H          MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ            
H P H          MOVE '3012-PROCESA-KACM53T  ' TO CDPARRAF OF KAELCWEZ            
H P H                                                                           
H P H          IF SQLCODE = -911                                                
H P H              MOVE 'S' TO SW-911                                           
H P H              MOVE 'S' TO SW-911-911                                       
H P H              ADD 1 TO WS-CANT-ERRORES                                     
H P H          ELSE                                                             
H P H             PERFORM 9999-GESTION-ERRORES                                  
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                 IF  SQLCODE = WN-SQLCODE-OK                               
H P H                 AND WS-PARA-INSERT                                        
H P H      EXEC SQL                                                             
H P H         DELETE FROM KACM53T                                               
H P H         WHERE CDSINIES = :WS-TBL-SINOREC                                  
H P H      END-EXEC                                                             
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3012-PROCESA-KACM53T' TO WS-OUT-PARRAFO                
H P H              MOVE 'BORRAR CORRECTO    ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3012-PROCESA-KACM53T' TO WS-OUT-PARRAFO                
H P H              MOVE 'NO EXISTE BORRAR   ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H              MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
H P H              MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
H P H              MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
H P H              MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
H P H              MOVE '3012-PROCESA-KACM53T  ' TO CDPARRAF OF KAELCWEZ        
H P H                                                                           
H P H              PERFORM 9999-GESTION-ERRORES                                 
H P H                                                                           
H P H        WHEN OTHER                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3012-PROCESA-KACM53T' TO WS-OUT-PARRAFO                
H P H              MOVE 'ERR BORRAR DB2     ' TO WS-OUT-DESC                    
H P H              IF SQLCODE  = -911                                           
H P H                 MOVE '3012-PROCESA-KACM53T'  TO WS-OUT-PARRAFO            
H P H                 MOVE 'CONTENCION TABLA   '   TO WS-OUT-DESC               
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 mOVE 'S' TO SW-911                                        
H P H                 MOVE 'S' TO SW-911-911                                    
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 MOVE 'SI'                  TO WS-ROLLBACK                 
H P H                 MOVE SQLCODE               TO WS-OUT-SQLCODE              
H P H                 MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA               
H P H                 MOVE WS-TABLA-H            TO WS-OUT-TABLA                
H P H                 MOVE '3012-PROCESA-KACM53T' TO WS-OUT-PARRAFO             
H P H                    STRING                                                 
H P H                   'CONTENCIO:'             DELIMITED BY SIZE              
H P H                    WS-CAMPOPOL             DELIMITED BY ' '               
H P H                    '='                     DELIMITED BY SIZE              
H P H                    WS-LEE-CDNUMPOL         DELIMITED BY SIZE              
H P H                    INTO WS-OUT-DESC                                       
H P H                 END-STRING                                                
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H            STRING                                                         
H P H            'Z8883??????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            'Z8881??????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H              ELSE                                                         
H P H                 MOVE WC-COD              TO CDERR    OF KAELCWEZ          
H P H                 MOVE WC-DES01            TO DSARGU1  OF KAELCWEZ          
H P H                 MOVE WC-PROGRAMA         TO DSARGU2  OF KAELCWEZ          
H P H                 MOVE WS-ERPOLIZA         TO DSARGU3  OF KAELCWEZ          
H P H                 MOVE '3012-PROCESA-KACM53T'                               
H P H                                          TO CDPARRAF OF KAELCWEZ          
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H                 IF SQLCODE = -911                                         
H P H                    MOVE 'S' TO SW-911                                     
H P H                    MOVE 'S' TO SW-911-911                                 
H P H                    ADD 1 TO WS-CANT-ERRORES                               
H P H                 ELSE                                                      
H P H            STRING                                                         
H P H            'X9999??????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            'X9999??????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H                 PERFORM 9999-GESTION-ERRORES                              
H P H                 END-IF                                                    
H P H              END-IF                                                       
H P H      END-EVALUATE                                                         
H P H                 END-IF                                                    
H P H               END-IF                                                      
H P H              END-IF                                                       
H P H              IF WS-ROLLBACK = 'SI'                                        
H P H                 SET WS-NO-HAY-SINIESTROS TO TRUE                          
H P H                 MOVE 98 TO WS-ITBLS                                       
H P H              END-IF                                                       
H P H              ADD WC-1 TO WS-ITBLS.                                        
H P H *                                                                         
H P H  3013-PROCESA-KACM54T.                                                    
H P H              MOVE 'KACM54T'             TO WS-TABLA-T                     
H P H              MOVE 'KACM54H'             TO WS-TABLA-H                     
H P H *                                                                         
H P H              MOVE 'KACM54T'             TO WS-TIPO-TABLA                  
H P H              MOVE 'CDSINIES'            TO WS-CAMPOPOL                    
H P H                                                                           
H P H              IF TAB-ESP-SR                                                
H P H               IF WS-SI-HISTORIFICA                                        
H P H                 PERFORM 3300-INSERTA-ESP-SIN                              
H P H               END-IF                                                      
H P H              ELSE                                                         
H P H               IF WS-SI-HISTORIFICA                                        
H P H      EXEC SQL                                                             
H P H         DECLARE CURSOR-13 CURSOR FOR                                      
H P H            SELECT CDSINIES FROM KACM54T                                   
H P H             WHERE CDSINIES = :WS-TBL-SINOREC                              
H P H             FETCH FIRST 1 ROWS ONLY                                       
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EXEC SQL                                                             
H P H          OPEN CURSOR-13                                                   
H P H      END-EXEC                                                             
H P H      PERFORM 3306-VALIDA-CODIGO                                           
H P H      EXEC SQL                                                             
H P H          FETCH CURSOR-13                                                  
H P H          INTO                                                             
H P H          :WS-SINOREC                                                      
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H             EXEC SQL                                                      
H P H                CLOSE CURSOR-13                                            
H P H             END-EXEC                                                      
H P H             SET WS-PARA-INSERT TO TRUE                                    
H P H      EXEC SQL                                                             
H P H         INSERT INTO KACM54H                                               
H P H            (SELECT * FROM KACM54T                                         
H P H             WHERE CDSINIES = :WS-TBL-SINOREC)                             
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3013-PROCESA-KACM54T' TO WS-OUT-PARRAFO                
H P H              MOVE 'INSERT CORRECTO '    TO WS-OUT-DESC                    
H P H              MOVE WS-TBL-SINOREC        TO WS-OUT-DESC(18:12)             
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-CLAVE-DUPLICADA                                   
H P H              SET WS-DUPLICADOS   TO TRUE                                  
H P H              MOVE 'SI'                  TO WS-ROLLBACK                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3013-PROCESA-KACM54T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                'DUPLICADO:'             DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H              INTO WS-OUT-DESC                                             
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H            IF WS-WRITE                                                    
H P H              ADD  WC-1                  TO WS-IERR                        
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3013-PROCESA-KACM54T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'SIN '                  DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN OTHER                                                         
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                     SET WS-DUPLICADOS   TO TRUE                           
H P H                     MOVE 'SI'                  TO WS-ROLLBACK             
H P H                     MOVE SQLCODE               TO WS-OUT-SQLCODE          
H P H                     MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA           
H P H                     MOVE WS-TABLA-H            TO WS-OUT-TABLA            
H P H                     MOVE '3013-PROCESA-KACM54T' TO WS-OUT-PARRAFO         
H P H                     STRING                                                
H P H                      'CONTENCIO:'             DELIMITED BY SIZE           
H P H                       WS-CAMPOPOL             DELIMITED BY ' '            
H P H                       '='                     DELIMITED BY SIZE           
H P H                       WS-LEE-CDNUMPOL         DELIMITED BY SIZE           
H P H                       INTO WS-OUT-DESC                                    
H P H                       END-STRING                                          
H P H                     PERFORM 1570-ESCRIBE-DESCARTADA                       
H P H              ELSE                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3013-PROCESA-KACM54T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'ERRDB2:'               DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H              MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
H P H              MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
H P H              MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
H P H              MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
H P H              MOVE '3013-PROCESA-KACM54T  ' TO CDPARRAF OF KAELCWEZ        
H P H                                                                           
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 MOVE 'S' TO SW-911-911                                    
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H              ELSE                                                         
H P H                 PERFORM 9999-GESTION-ERRORES                              
H P H              END-IF                                                       
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                                                                           
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H            SET WS-NO-PARA-INSERT      TO TRUE                             
H P H            IF WS-WRITE                                                    
H P H              ADD  WC-1                  TO WS-IERR                        
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3013-PROCESA-KACM54T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'NOHAY '                DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H            EXEC SQL                                                       
H P H                CLOSE CURSOR-13                                            
H P H            END-EXEC                                                       
H P H        WHEN OTHER                                                         
H P H              SET WS-NO-PARA-INSERT      TO TRUE                           
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3013-PROCESA-KACM54T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'ERRDB2:'               DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            STRING                                                         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            ' ERROR EN SQL :' W-QUERY-TEXT                    '\N'         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H          MOVE WC-COD                   TO CDERR    OF KAELCWEZ            
H P H          MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ            
H P H          MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ            
H P H          MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ            
H P H          MOVE '3013-PROCESA-KACM54T  ' TO CDPARRAF OF KAELCWEZ            
H P H                                                                           
H P H          IF SQLCODE = -911                                                
H P H              MOVE 'S' TO SW-911                                           
H P H              MOVE 'S' TO SW-911-911                                       
H P H              ADD 1 TO WS-CANT-ERRORES                                     
H P H          ELSE                                                             
H P H             PERFORM 9999-GESTION-ERRORES                                  
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                 IF  SQLCODE = WN-SQLCODE-OK                               
H P H                 AND WS-PARA-INSERT                                        
H P H      EXEC SQL                                                             
H P H         DELETE FROM KACM54T                                               
H P H         WHERE CDSINIES = :WS-TBL-SINOREC                                  
H P H      END-EXEC                                                             
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3013-PROCESA-KACM54T' TO WS-OUT-PARRAFO                
H P H              MOVE 'BORRAR CORRECTO    ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3013-PROCESA-KACM54T' TO WS-OUT-PARRAFO                
H P H              MOVE 'NO EXISTE BORRAR   ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H              MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
H P H              MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
H P H              MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
H P H              MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
H P H              MOVE '3013-PROCESA-KACM54T  ' TO CDPARRAF OF KAELCWEZ        
H P H                                                                           
H P H              PERFORM 9999-GESTION-ERRORES                                 
H P H                                                                           
H P H        WHEN OTHER                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3013-PROCESA-KACM54T' TO WS-OUT-PARRAFO                
H P H              MOVE 'ERR BORRAR DB2     ' TO WS-OUT-DESC                    
H P H              IF SQLCODE  = -911                                           
H P H                 MOVE '3013-PROCESA-KACM54T'  TO WS-OUT-PARRAFO            
H P H                 MOVE 'CONTENCION TABLA   '   TO WS-OUT-DESC               
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 mOVE 'S' TO SW-911                                        
H P H                 MOVE 'S' TO SW-911-911                                    
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 MOVE 'SI'                  TO WS-ROLLBACK                 
H P H                 MOVE SQLCODE               TO WS-OUT-SQLCODE              
H P H                 MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA               
H P H                 MOVE WS-TABLA-H            TO WS-OUT-TABLA                
H P H                 MOVE '3013-PROCESA-KACM54T' TO WS-OUT-PARRAFO             
H P H                    STRING                                                 
H P H                   'CONTENCIO:'             DELIMITED BY SIZE              
H P H                    WS-CAMPOPOL             DELIMITED BY ' '               
H P H                    '='                     DELIMITED BY SIZE              
H P H                    WS-LEE-CDNUMPOL         DELIMITED BY SIZE              
H P H                    INTO WS-OUT-DESC                                       
H P H                 END-STRING                                                
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H            STRING                                                         
H P H            'Z8883??????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            'Z8881??????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H              ELSE                                                         
H P H                 MOVE WC-COD              TO CDERR    OF KAELCWEZ          
H P H                 MOVE WC-DES01            TO DSARGU1  OF KAELCWEZ          
H P H                 MOVE WC-PROGRAMA         TO DSARGU2  OF KAELCWEZ          
H P H                 MOVE WS-ERPOLIZA         TO DSARGU3  OF KAELCWEZ          
H P H                 MOVE '3013-PROCESA-KACM54T'                               
H P H                                          TO CDPARRAF OF KAELCWEZ          
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H                 IF SQLCODE = -911                                         
H P H                    MOVE 'S' TO SW-911                                     
H P H                    MOVE 'S' TO SW-911-911                                 
H P H                    ADD 1 TO WS-CANT-ERRORES                               
H P H                 ELSE                                                      
H P H            STRING                                                         
H P H            'X9999??????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            'X9999??????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H                 PERFORM 9999-GESTION-ERRORES                              
H P H                 END-IF                                                    
H P H              END-IF                                                       
H P H      END-EVALUATE                                                         
H P H                 END-IF                                                    
H P H               END-IF                                                      
H P H              END-IF                                                       
H P H              IF WS-ROLLBACK = 'SI'                                        
H P H                 SET WS-NO-HAY-SINIESTROS TO TRUE                          
H P H                 MOVE 98 TO WS-ITBLS                                       
H P H              END-IF                                                       
H P H              ADD WC-1 TO WS-ITBLS.                                        
H P H *                                                                         
H P H  3014-PROCESA-KACM55T.                                                    
H P H              MOVE 'KACM55T'             TO WS-TABLA-T                     
H P H              MOVE 'KACM55H'             TO WS-TABLA-H                     
H P H *                                                                         
H P H              MOVE 'KACM55T'             TO WS-TIPO-TABLA                  
H P H              MOVE 'CDSINIES'            TO WS-CAMPOPOL                    
H P H                                                                           
H P H              IF TAB-ESP-SR                                                
H P H               IF WS-SI-HISTORIFICA                                        
H P H                 PERFORM 3300-INSERTA-ESP-SIN                              
H P H               END-IF                                                      
H P H              ELSE                                                         
H P H               IF WS-SI-HISTORIFICA                                        
H P H      EXEC SQL                                                             
H P H         DECLARE CURSOR-14 CURSOR FOR                                      
H P H            SELECT CDSINIES FROM KACM55T                                   
H P H             WHERE CDSINIES = :WS-TBL-SINOREC                              
H P H             FETCH FIRST 1 ROWS ONLY                                       
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EXEC SQL                                                             
H P H          OPEN CURSOR-14                                                   
H P H      END-EXEC                                                             
H P H      PERFORM 3306-VALIDA-CODIGO                                           
H P H      EXEC SQL                                                             
H P H          FETCH CURSOR-14                                                  
H P H          INTO                                                             
H P H          :WS-SINOREC                                                      
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H             EXEC SQL                                                      
H P H                CLOSE CURSOR-14                                            
H P H             END-EXEC                                                      
H P H             SET WS-PARA-INSERT TO TRUE                                    
H P H      EXEC SQL                                                             
H P H         INSERT INTO KACM55H                                               
H P H            (SELECT * FROM KACM55T                                         
H P H             WHERE CDSINIES = :WS-TBL-SINOREC)                             
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3014-PROCESA-KACM55T' TO WS-OUT-PARRAFO                
H P H              MOVE 'INSERT CORRECTO '    TO WS-OUT-DESC                    
H P H              MOVE WS-TBL-SINOREC        TO WS-OUT-DESC(18:12)             
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-CLAVE-DUPLICADA                                   
H P H              SET WS-DUPLICADOS   TO TRUE                                  
H P H              MOVE 'SI'                  TO WS-ROLLBACK                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3014-PROCESA-KACM55T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                'DUPLICADO:'             DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H              INTO WS-OUT-DESC                                             
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H            IF WS-WRITE                                                    
H P H              ADD  WC-1                  TO WS-IERR                        
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3014-PROCESA-KACM55T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'SIN '                  DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN OTHER                                                         
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                     SET WS-DUPLICADOS   TO TRUE                           
H P H                     MOVE 'SI'                  TO WS-ROLLBACK             
H P H                     MOVE SQLCODE               TO WS-OUT-SQLCODE          
H P H                     MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA           
H P H                     MOVE WS-TABLA-H            TO WS-OUT-TABLA            
H P H                     MOVE '3014-PROCESA-KACM55T' TO WS-OUT-PARRAFO         
H P H                     STRING                                                
H P H                      'CONTENCIO:'             DELIMITED BY SIZE           
H P H                       WS-CAMPOPOL             DELIMITED BY ' '            
H P H                       '='                     DELIMITED BY SIZE           
H P H                       WS-LEE-CDNUMPOL         DELIMITED BY SIZE           
H P H                       INTO WS-OUT-DESC                                    
H P H                       END-STRING                                          
H P H                     PERFORM 1570-ESCRIBE-DESCARTADA                       
H P H              ELSE                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3014-PROCESA-KACM55T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'ERRDB2:'               DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H              MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
H P H              MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
H P H              MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
H P H              MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
H P H              MOVE '3014-PROCESA-KACM55T  ' TO CDPARRAF OF KAELCWEZ        
H P H                                                                           
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 MOVE 'S' TO SW-911-911                                    
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H              ELSE                                                         
H P H                 PERFORM 9999-GESTION-ERRORES                              
H P H              END-IF                                                       
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                                                                           
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H            SET WS-NO-PARA-INSERT      TO TRUE                             
H P H            IF WS-WRITE                                                    
H P H              ADD  WC-1                  TO WS-IERR                        
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3014-PROCESA-KACM55T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'NOHAY '                DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H            EXEC SQL                                                       
H P H                CLOSE CURSOR-14                                            
H P H            END-EXEC                                                       
H P H        WHEN OTHER                                                         
H P H              SET WS-NO-PARA-INSERT      TO TRUE                           
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3014-PROCESA-KACM55T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'ERRDB2:'               DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            STRING                                                         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            ' ERROR EN SQL :' W-QUERY-TEXT                    '\N'         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H          MOVE WC-COD                   TO CDERR    OF KAELCWEZ            
H P H          MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ            
H P H          MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ            
H P H          MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ            
H P H          MOVE '3014-PROCESA-KACM55T  ' TO CDPARRAF OF KAELCWEZ            
H P H                                                                           
H P H          IF SQLCODE = -911                                                
H P H              MOVE 'S' TO SW-911                                           
H P H              MOVE 'S' TO SW-911-911                                       
H P H              ADD 1 TO WS-CANT-ERRORES                                     
H P H          ELSE                                                             
H P H             PERFORM 9999-GESTION-ERRORES                                  
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                 IF  SQLCODE = WN-SQLCODE-OK                               
H P H                 AND WS-PARA-INSERT                                        
H P H      EXEC SQL                                                             
H P H         DELETE FROM KACM55T                                               
H P H         WHERE CDSINIES = :WS-TBL-SINOREC                                  
H P H      END-EXEC                                                             
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3014-PROCESA-KACM55T' TO WS-OUT-PARRAFO                
H P H              MOVE 'BORRAR CORRECTO    ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3014-PROCESA-KACM55T' TO WS-OUT-PARRAFO                
H P H              MOVE 'NO EXISTE BORRAR   ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H              MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
H P H              MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
H P H              MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
H P H              MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
H P H              MOVE '3014-PROCESA-KACM55T  ' TO CDPARRAF OF KAELCWEZ        
H P H                                                                           
H P H              PERFORM 9999-GESTION-ERRORES                                 
H P H                                                                           
H P H        WHEN OTHER                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3014-PROCESA-KACM55T' TO WS-OUT-PARRAFO                
H P H              MOVE 'ERR BORRAR DB2     ' TO WS-OUT-DESC                    
H P H              IF SQLCODE  = -911                                           
H P H                 MOVE '3014-PROCESA-KACM55T'  TO WS-OUT-PARRAFO            
H P H                 MOVE 'CONTENCION TABLA   '   TO WS-OUT-DESC               
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 mOVE 'S' TO SW-911                                        
H P H                 MOVE 'S' TO SW-911-911                                    
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 MOVE 'SI'                  TO WS-ROLLBACK                 
H P H                 MOVE SQLCODE               TO WS-OUT-SQLCODE              
H P H                 MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA               
H P H                 MOVE WS-TABLA-H            TO WS-OUT-TABLA                
H P H                 MOVE '3014-PROCESA-KACM55T' TO WS-OUT-PARRAFO             
H P H                    STRING                                                 
H P H                   'CONTENCIO:'             DELIMITED BY SIZE              
H P H                    WS-CAMPOPOL             DELIMITED BY ' '               
H P H                    '='                     DELIMITED BY SIZE              
H P H                    WS-LEE-CDNUMPOL         DELIMITED BY SIZE              
H P H                    INTO WS-OUT-DESC                                       
H P H                 END-STRING                                                
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H            STRING                                                         
H P H            'Z8883??????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            'Z8881??????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H              ELSE                                                         
H P H                 MOVE WC-COD              TO CDERR    OF KAELCWEZ          
H P H                 MOVE WC-DES01            TO DSARGU1  OF KAELCWEZ          
H P H                 MOVE WC-PROGRAMA         TO DSARGU2  OF KAELCWEZ          
H P H                 MOVE WS-ERPOLIZA         TO DSARGU3  OF KAELCWEZ          
H P H                 MOVE '3014-PROCESA-KACM55T'                               
H P H                                          TO CDPARRAF OF KAELCWEZ          
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H                 IF SQLCODE = -911                                         
H P H                    MOVE 'S' TO SW-911                                     
H P H                    MOVE 'S' TO SW-911-911                                 
H P H                    ADD 1 TO WS-CANT-ERRORES                               
H P H                 ELSE                                                      
H P H            STRING                                                         
H P H            'X9999??????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            'X9999??????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H                 PERFORM 9999-GESTION-ERRORES                              
H P H                 END-IF                                                    
H P H              END-IF                                                       
H P H      END-EVALUATE                                                         
H P H                 END-IF                                                    
H P H               END-IF                                                      
H P H              END-IF                                                       
H P H              IF WS-ROLLBACK = 'SI'                                        
H P H                 SET WS-NO-HAY-SINIESTROS TO TRUE                          
H P H                 MOVE 98 TO WS-ITBLS                                       
H P H              END-IF                                                       
H P H              ADD WC-1 TO WS-ITBLS.                                        
H P H *                                                                         
H P H  3015-PROCESA-KACM56T.                                                    
H P H              MOVE 'KACM56T'             TO WS-TABLA-T                     
H P H              MOVE 'KACM56H'             TO WS-TABLA-H                     
H P H *                                                                         
H P H              MOVE 'KACM56T'             TO WS-TIPO-TABLA                  
H P H              MOVE 'CDSINIES'            TO WS-CAMPOPOL                    
H P H                                                                           
H P H              IF TAB-ESP-SR                                                
H P H               IF WS-SI-HISTORIFICA                                        
H P H                 PERFORM 3300-INSERTA-ESP-SIN                              
H P H               END-IF                                                      
H P H              ELSE                                                         
H P H               IF WS-SI-HISTORIFICA                                        
H P H      EXEC SQL                                                             
H P H         DECLARE CURSOR-15 CURSOR FOR                                      
H P H            SELECT CDSINIES FROM KACM56T                                   
H P H             WHERE CDSINIES = :WS-TBL-SINOREC                              
H P H             FETCH FIRST 1 ROWS ONLY                                       
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EXEC SQL                                                             
H P H          OPEN CURSOR-15                                                   
H P H      END-EXEC                                                             
H P H      PERFORM 3306-VALIDA-CODIGO                                           
H P H      EXEC SQL                                                             
H P H          FETCH CURSOR-15                                                  
H P H          INTO                                                             
H P H          :WS-SINOREC                                                      
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H             EXEC SQL                                                      
H P H                CLOSE CURSOR-15                                            
H P H             END-EXEC                                                      
H P H             SET WS-PARA-INSERT TO TRUE                                    
H P H      EXEC SQL                                                             
H P H         INSERT INTO KACM56H                                               
H P H            (SELECT * FROM KACM56T                                         
H P H             WHERE CDSINIES = :WS-TBL-SINOREC)                             
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3015-PROCESA-KACM56T' TO WS-OUT-PARRAFO                
H P H              MOVE 'INSERT CORRECTO '    TO WS-OUT-DESC                    
H P H              MOVE WS-TBL-SINOREC        TO WS-OUT-DESC(18:12)             
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-CLAVE-DUPLICADA                                   
H P H              SET WS-DUPLICADOS   TO TRUE                                  
H P H              MOVE 'SI'                  TO WS-ROLLBACK                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3015-PROCESA-KACM56T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                'DUPLICADO:'             DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H              INTO WS-OUT-DESC                                             
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H            IF WS-WRITE                                                    
H P H              ADD  WC-1                  TO WS-IERR                        
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3015-PROCESA-KACM56T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'SIN '                  DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN OTHER                                                         
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                     SET WS-DUPLICADOS   TO TRUE                           
H P H                     MOVE 'SI'                  TO WS-ROLLBACK             
H P H                     MOVE SQLCODE               TO WS-OUT-SQLCODE          
H P H                     MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA           
H P H                     MOVE WS-TABLA-H            TO WS-OUT-TABLA            
H P H                     MOVE '3015-PROCESA-KACM56T' TO WS-OUT-PARRAFO         
H P H                     STRING                                                
H P H                      'CONTENCIO:'             DELIMITED BY SIZE           
H P H                       WS-CAMPOPOL             DELIMITED BY ' '            
H P H                       '='                     DELIMITED BY SIZE           
H P H                       WS-LEE-CDNUMPOL         DELIMITED BY SIZE           
H P H                       INTO WS-OUT-DESC                                    
H P H                       END-STRING                                          
H P H                     PERFORM 1570-ESCRIBE-DESCARTADA                       
H P H              ELSE                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3015-PROCESA-KACM56T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'ERRDB2:'               DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H              MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
H P H              MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
H P H              MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
H P H              MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
H P H              MOVE '3015-PROCESA-KACM56T  ' TO CDPARRAF OF KAELCWEZ        
H P H                                                                           
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 MOVE 'S' TO SW-911-911                                    
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H              ELSE                                                         
H P H                 PERFORM 9999-GESTION-ERRORES                              
H P H              END-IF                                                       
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                                                                           
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H            SET WS-NO-PARA-INSERT      TO TRUE                             
H P H            IF WS-WRITE                                                    
H P H              ADD  WC-1                  TO WS-IERR                        
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3015-PROCESA-KACM56T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'NOHAY '                DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H            EXEC SQL                                                       
H P H                CLOSE CURSOR-15                                            
H P H            END-EXEC                                                       
H P H        WHEN OTHER                                                         
H P H              SET WS-NO-PARA-INSERT      TO TRUE                           
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3015-PROCESA-KACM56T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'ERRDB2:'               DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            STRING                                                         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            ' ERROR EN SQL :' W-QUERY-TEXT                    '\N'         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H          MOVE WC-COD                   TO CDERR    OF KAELCWEZ            
H P H          MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ            
H P H          MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ            
H P H          MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ            
H P H          MOVE '3015-PROCESA-KACM56T  ' TO CDPARRAF OF KAELCWEZ            
H P H                                                                           
H P H          IF SQLCODE = -911                                                
H P H              MOVE 'S' TO SW-911                                           
H P H              MOVE 'S' TO SW-911-911                                       
H P H              ADD 1 TO WS-CANT-ERRORES                                     
H P H          ELSE                                                             
H P H             PERFORM 9999-GESTION-ERRORES                                  
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                 IF  SQLCODE = WN-SQLCODE-OK                               
H P H                 AND WS-PARA-INSERT                                        
H P H      EXEC SQL                                                             
H P H         DELETE FROM KACM56T                                               
H P H         WHERE CDSINIES = :WS-TBL-SINOREC                                  
H P H      END-EXEC                                                             
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3015-PROCESA-KACM56T' TO WS-OUT-PARRAFO                
H P H              MOVE 'BORRAR CORRECTO    ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3015-PROCESA-KACM56T' TO WS-OUT-PARRAFO                
H P H              MOVE 'NO EXISTE BORRAR   ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H              MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
H P H              MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
H P H              MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
H P H              MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
H P H              MOVE '3015-PROCESA-KACM56T  ' TO CDPARRAF OF KAELCWEZ        
H P H                                                                           
H P H              PERFORM 9999-GESTION-ERRORES                                 
H P H                                                                           
H P H        WHEN OTHER                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3015-PROCESA-KACM56T' TO WS-OUT-PARRAFO                
H P H              MOVE 'ERR BORRAR DB2     ' TO WS-OUT-DESC                    
H P H              IF SQLCODE  = -911                                           
H P H                 MOVE '3015-PROCESA-KACM56T'  TO WS-OUT-PARRAFO            
H P H                 MOVE 'CONTENCION TABLA   '   TO WS-OUT-DESC               
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 mOVE 'S' TO SW-911                                        
H P H                 MOVE 'S' TO SW-911-911                                    
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 MOVE 'SI'                  TO WS-ROLLBACK                 
H P H                 MOVE SQLCODE               TO WS-OUT-SQLCODE              
H P H                 MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA               
H P H                 MOVE WS-TABLA-H            TO WS-OUT-TABLA                
H P H                 MOVE '3015-PROCESA-KACM56T' TO WS-OUT-PARRAFO             
H P H                    STRING                                                 
H P H                   'CONTENCIO:'             DELIMITED BY SIZE              
H P H                    WS-CAMPOPOL             DELIMITED BY ' '               
H P H                    '='                     DELIMITED BY SIZE              
H P H                    WS-LEE-CDNUMPOL         DELIMITED BY SIZE              
H P H                    INTO WS-OUT-DESC                                       
H P H                 END-STRING                                                
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H            STRING                                                         
H P H            'Z8883??????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            'Z8881??????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H              ELSE                                                         
H P H                 MOVE WC-COD              TO CDERR    OF KAELCWEZ          
H P H                 MOVE WC-DES01            TO DSARGU1  OF KAELCWEZ          
H P H                 MOVE WC-PROGRAMA         TO DSARGU2  OF KAELCWEZ          
H P H                 MOVE WS-ERPOLIZA         TO DSARGU3  OF KAELCWEZ          
H P H                 MOVE '3015-PROCESA-KACM56T'                               
H P H                                          TO CDPARRAF OF KAELCWEZ          
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H                 IF SQLCODE = -911                                         
H P H                    MOVE 'S' TO SW-911                                     
H P H                    MOVE 'S' TO SW-911-911                                 
H P H                    ADD 1 TO WS-CANT-ERRORES                               
H P H                 ELSE                                                      
H P H            STRING                                                         
H P H            'X9999??????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            'X9999??????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H                 PERFORM 9999-GESTION-ERRORES                              
H P H                 END-IF                                                    
H P H              END-IF                                                       
H P H      END-EVALUATE                                                         
H P H                 END-IF                                                    
H P H               END-IF                                                      
H P H              END-IF                                                       
H P H              IF WS-ROLLBACK = 'SI'                                        
H P H                 SET WS-NO-HAY-SINIESTROS TO TRUE                          
H P H                 MOVE 98 TO WS-ITBLS                                       
H P H              END-IF                                                       
H P H              ADD WC-1 TO WS-ITBLS.                                        
H P H *                                                                         
H P H  3016-PROCESA-KACM57T.                                                    
H P H              MOVE 'KACM57T'             TO WS-TABLA-T                     
H P H              MOVE 'KACM57H'             TO WS-TABLA-H                     
H P H *                                                                         
H P H              MOVE 'KACM57T'             TO WS-TIPO-TABLA                  
H P H              MOVE 'CDSINIES'            TO WS-CAMPOPOL                    
H P H                                                                           
H P H              IF TAB-ESP-SR                                                
H P H               IF WS-SI-HISTORIFICA                                        
H P H                 PERFORM 3300-INSERTA-ESP-SIN                              
H P H               END-IF                                                      
H P H              ELSE                                                         
H P H               IF WS-SI-HISTORIFICA                                        
H P H      EXEC SQL                                                             
H P H         DECLARE CURSOR-16 CURSOR FOR                                      
H P H            SELECT CDSINIES FROM KACM57T                                   
H P H             WHERE CDSINIES = :WS-TBL-SINOREC                              
H P H             FETCH FIRST 1 ROWS ONLY                                       
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EXEC SQL                                                             
H P H          OPEN CURSOR-16                                                   
H P H      END-EXEC                                                             
H P H      PERFORM 3306-VALIDA-CODIGO                                           
H P H      EXEC SQL                                                             
H P H          FETCH CURSOR-16                                                  
H P H          INTO                                                             
H P H          :WS-SINOREC                                                      
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H             EXEC SQL                                                      
H P H                CLOSE CURSOR-16                                            
H P H             END-EXEC                                                      
H P H             SET WS-PARA-INSERT TO TRUE                                    
H P H      EXEC SQL                                                             
H P H         INSERT INTO KACM57H                                               
H P H            (SELECT * FROM KACM57T                                         
H P H             WHERE CDSINIES = :WS-TBL-SINOREC)                             
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3016-PROCESA-KACM57T' TO WS-OUT-PARRAFO                
H P H              MOVE 'INSERT CORRECTO '    TO WS-OUT-DESC                    
H P H              MOVE WS-TBL-SINOREC        TO WS-OUT-DESC(18:12)             
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-CLAVE-DUPLICADA                                   
H P H              SET WS-DUPLICADOS   TO TRUE                                  
H P H              MOVE 'SI'                  TO WS-ROLLBACK                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3016-PROCESA-KACM57T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                'DUPLICADO:'             DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H              INTO WS-OUT-DESC                                             
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H            IF WS-WRITE                                                    
H P H              ADD  WC-1                  TO WS-IERR                        
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3016-PROCESA-KACM57T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'SIN '                  DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN OTHER                                                         
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                     SET WS-DUPLICADOS   TO TRUE                           
H P H                     MOVE 'SI'                  TO WS-ROLLBACK             
H P H                     MOVE SQLCODE               TO WS-OUT-SQLCODE          
H P H                     MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA           
H P H                     MOVE WS-TABLA-H            TO WS-OUT-TABLA            
H P H                     MOVE '3016-PROCESA-KACM57T' TO WS-OUT-PARRAFO         
H P H                     STRING                                                
H P H                      'CONTENCIO:'             DELIMITED BY SIZE           
H P H                       WS-CAMPOPOL             DELIMITED BY ' '            
H P H                       '='                     DELIMITED BY SIZE           
H P H                       WS-LEE-CDNUMPOL         DELIMITED BY SIZE           
H P H                       INTO WS-OUT-DESC                                    
H P H                       END-STRING                                          
H P H                     PERFORM 1570-ESCRIBE-DESCARTADA                       
H P H              ELSE                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3016-PROCESA-KACM57T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'ERRDB2:'               DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H              MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
H P H              MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
H P H              MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
H P H              MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
H P H              MOVE '3016-PROCESA-KACM57T  ' TO CDPARRAF OF KAELCWEZ        
H P H                                                                           
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 MOVE 'S' TO SW-911-911                                    
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H              ELSE                                                         
H P H                 PERFORM 9999-GESTION-ERRORES                              
H P H              END-IF                                                       
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                                                                           
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H            SET WS-NO-PARA-INSERT      TO TRUE                             
H P H            IF WS-WRITE                                                    
H P H              ADD  WC-1                  TO WS-IERR                        
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3016-PROCESA-KACM57T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'NOHAY '                DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H            EXEC SQL                                                       
H P H                CLOSE CURSOR-16                                            
H P H            END-EXEC                                                       
H P H        WHEN OTHER                                                         
H P H              SET WS-NO-PARA-INSERT      TO TRUE                           
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3016-PROCESA-KACM57T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'ERRDB2:'               DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            STRING                                                         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            ' ERROR EN SQL :' W-QUERY-TEXT                    '\N'         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H          MOVE WC-COD                   TO CDERR    OF KAELCWEZ            
H P H          MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ            
H P H          MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ            
H P H          MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ            
H P H          MOVE '3016-PROCESA-KACM57T  ' TO CDPARRAF OF KAELCWEZ            
H P H                                                                           
H P H          IF SQLCODE = -911                                                
H P H              MOVE 'S' TO SW-911                                           
H P H              MOVE 'S' TO SW-911-911                                       
H P H              ADD 1 TO WS-CANT-ERRORES                                     
H P H          ELSE                                                             
H P H             PERFORM 9999-GESTION-ERRORES                                  
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                 IF  SQLCODE = WN-SQLCODE-OK                               
H P H                 AND WS-PARA-INSERT                                        
H P H      EXEC SQL                                                             
H P H         DELETE FROM KACM57T                                               
H P H         WHERE CDSINIES = :WS-TBL-SINOREC                                  
H P H      END-EXEC                                                             
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3016-PROCESA-KACM57T' TO WS-OUT-PARRAFO                
H P H              MOVE 'BORRAR CORRECTO    ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3016-PROCESA-KACM57T' TO WS-OUT-PARRAFO                
H P H              MOVE 'NO EXISTE BORRAR   ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H              MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
H P H              MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
H P H              MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
H P H              MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
H P H              MOVE '3016-PROCESA-KACM57T  ' TO CDPARRAF OF KAELCWEZ        
H P H                                                                           
H P H              PERFORM 9999-GESTION-ERRORES                                 
H P H                                                                           
H P H        WHEN OTHER                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3016-PROCESA-KACM57T' TO WS-OUT-PARRAFO                
H P H              MOVE 'ERR BORRAR DB2     ' TO WS-OUT-DESC                    
H P H              IF SQLCODE  = -911                                           
H P H                 MOVE '3016-PROCESA-KACM57T'  TO WS-OUT-PARRAFO            
H P H                 MOVE 'CONTENCION TABLA   '   TO WS-OUT-DESC               
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 mOVE 'S' TO SW-911                                        
H P H                 MOVE 'S' TO SW-911-911                                    
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 MOVE 'SI'                  TO WS-ROLLBACK                 
H P H                 MOVE SQLCODE               TO WS-OUT-SQLCODE              
H P H                 MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA               
H P H                 MOVE WS-TABLA-H            TO WS-OUT-TABLA                
H P H                 MOVE '3016-PROCESA-KACM57T' TO WS-OUT-PARRAFO             
H P H                    STRING                                                 
H P H                   'CONTENCIO:'             DELIMITED BY SIZE              
H P H                    WS-CAMPOPOL             DELIMITED BY ' '               
H P H                    '='                     DELIMITED BY SIZE              
H P H                    WS-LEE-CDNUMPOL         DELIMITED BY SIZE              
H P H                    INTO WS-OUT-DESC                                       
H P H                 END-STRING                                                
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H            STRING                                                         
H P H            'Z8883??????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            'Z8881??????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H              ELSE                                                         
H P H                 MOVE WC-COD              TO CDERR    OF KAELCWEZ          
H P H                 MOVE WC-DES01            TO DSARGU1  OF KAELCWEZ          
H P H                 MOVE WC-PROGRAMA         TO DSARGU2  OF KAELCWEZ          
H P H                 MOVE WS-ERPOLIZA         TO DSARGU3  OF KAELCWEZ          
H P H                 MOVE '3016-PROCESA-KACM57T'                               
H P H                                          TO CDPARRAF OF KAELCWEZ          
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H                 IF SQLCODE = -911                                         
H P H                    MOVE 'S' TO SW-911                                     
H P H                    MOVE 'S' TO SW-911-911                                 
H P H                    ADD 1 TO WS-CANT-ERRORES                               
H P H                 ELSE                                                      
H P H            STRING                                                         
H P H            'X9999??????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            'X9999??????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H                 PERFORM 9999-GESTION-ERRORES                              
H P H                 END-IF                                                    
H P H              END-IF                                                       
H P H      END-EVALUATE                                                         
H P H                 END-IF                                                    
H P H               END-IF                                                      
H P H              END-IF                                                       
H P H              IF WS-ROLLBACK = 'SI'                                        
H P H                 SET WS-NO-HAY-SINIESTROS TO TRUE                          
H P H                 MOVE 98 TO WS-ITBLS                                       
H P H              END-IF                                                       
H P H              ADD WC-1 TO WS-ITBLS.                                        
H P H *                                                                         
H P H  3017-PROCESA-KACM71T.                                                    
H P H              MOVE 'KACM71T'             TO WS-TABLA-T                     
H P H              MOVE 'KACM71H'             TO WS-TABLA-H                     
H P H *                                                                         
H P H              MOVE 'KACM71T'             TO WS-TIPO-TABLA                  
H P H              MOVE 'CDSINIES'            TO WS-CAMPOPOL                    
H P H                                                                           
H P H              IF TAB-ESP-SR                                                
H P H               IF WS-SI-HISTORIFICA                                        
H P H                 PERFORM 3300-INSERTA-ESP-SIN                              
H P H               END-IF                                                      
H P H              ELSE                                                         
H P H               IF WS-SI-HISTORIFICA                                        
H P H      EXEC SQL                                                             
H P H         DECLARE CURSOR-17 CURSOR FOR                                      
H P H            SELECT CDSINIES FROM KACM71T                                   
H P H             WHERE CDSINIES = :WS-TBL-SINOREC                              
H P H             FETCH FIRST 1 ROWS ONLY                                       
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EXEC SQL                                                             
H P H          OPEN CURSOR-17                                                   
H P H      END-EXEC                                                             
H P H      PERFORM 3306-VALIDA-CODIGO                                           
H P H      EXEC SQL                                                             
H P H          FETCH CURSOR-17                                                  
H P H          INTO                                                             
H P H          :WS-SINOREC                                                      
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H             EXEC SQL                                                      
H P H                CLOSE CURSOR-17                                            
H P H             END-EXEC                                                      
H P H             SET WS-PARA-INSERT TO TRUE                                    
H P H      EXEC SQL                                                             
H P H         INSERT INTO KACM71H                                               
H P H            (SELECT * FROM KACM71T                                         
H P H             WHERE CDSINIES = :WS-TBL-SINOREC)                             
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3017-PROCESA-KACM71T' TO WS-OUT-PARRAFO                
H P H              MOVE 'INSERT CORRECTO '    TO WS-OUT-DESC                    
H P H              MOVE WS-TBL-SINOREC        TO WS-OUT-DESC(18:12)             
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-CLAVE-DUPLICADA                                   
H P H              SET WS-DUPLICADOS   TO TRUE                                  
H P H              MOVE 'SI'                  TO WS-ROLLBACK                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3017-PROCESA-KACM71T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                'DUPLICADO:'             DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H              INTO WS-OUT-DESC                                             
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H            IF WS-WRITE                                                    
H P H              ADD  WC-1                  TO WS-IERR                        
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3017-PROCESA-KACM71T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'SIN '                  DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN OTHER                                                         
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                     SET WS-DUPLICADOS   TO TRUE                           
H P H                     MOVE 'SI'                  TO WS-ROLLBACK             
H P H                     MOVE SQLCODE               TO WS-OUT-SQLCODE          
H P H                     MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA           
H P H                     MOVE WS-TABLA-H            TO WS-OUT-TABLA            
H P H                     MOVE '3017-PROCESA-KACM71T' TO WS-OUT-PARRAFO         
H P H                     STRING                                                
H P H                      'CONTENCIO:'             DELIMITED BY SIZE           
H P H                       WS-CAMPOPOL             DELIMITED BY ' '            
H P H                       '='                     DELIMITED BY SIZE           
H P H                       WS-LEE-CDNUMPOL         DELIMITED BY SIZE           
H P H                       INTO WS-OUT-DESC                                    
H P H                       END-STRING                                          
H P H                     PERFORM 1570-ESCRIBE-DESCARTADA                       
H P H              ELSE                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3017-PROCESA-KACM71T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'ERRDB2:'               DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H              MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
H P H              MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
H P H              MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
H P H              MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
H P H              MOVE '3017-PROCESA-KACM71T  ' TO CDPARRAF OF KAELCWEZ        
H P H                                                                           
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 MOVE 'S' TO SW-911-911                                    
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H              ELSE                                                         
H P H                 PERFORM 9999-GESTION-ERRORES                              
H P H              END-IF                                                       
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                                                                           
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H            SET WS-NO-PARA-INSERT      TO TRUE                             
H P H            IF WS-WRITE                                                    
H P H              ADD  WC-1                  TO WS-IERR                        
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3017-PROCESA-KACM71T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'NOHAY '                DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H            EXEC SQL                                                       
H P H                CLOSE CURSOR-17                                            
H P H            END-EXEC                                                       
H P H        WHEN OTHER                                                         
H P H              SET WS-NO-PARA-INSERT      TO TRUE                           
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3017-PROCESA-KACM71T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'ERRDB2:'               DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            STRING                                                         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            ' ERROR EN SQL :' W-QUERY-TEXT                    '\N'         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H          MOVE WC-COD                   TO CDERR    OF KAELCWEZ            
H P H          MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ            
H P H          MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ            
H P H          MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ            
H P H          MOVE '3017-PROCESA-KACM71T  ' TO CDPARRAF OF KAELCWEZ            
H P H                                                                           
H P H          IF SQLCODE = -911                                                
H P H              MOVE 'S' TO SW-911                                           
H P H              MOVE 'S' TO SW-911-911                                       
H P H              ADD 1 TO WS-CANT-ERRORES                                     
H P H          ELSE                                                             
H P H             PERFORM 9999-GESTION-ERRORES                                  
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                 IF  SQLCODE = WN-SQLCODE-OK                               
H P H                 AND WS-PARA-INSERT                                        
H P H      EXEC SQL                                                             
H P H         DELETE FROM KACM71T                                               
H P H         WHERE CDSINIES = :WS-TBL-SINOREC                                  
H P H      END-EXEC                                                             
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3017-PROCESA-KACM71T' TO WS-OUT-PARRAFO                
H P H              MOVE 'BORRAR CORRECTO    ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3017-PROCESA-KACM71T' TO WS-OUT-PARRAFO                
H P H              MOVE 'NO EXISTE BORRAR   ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H              MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
H P H              MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
H P H              MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
H P H              MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
H P H              MOVE '3017-PROCESA-KACM71T  ' TO CDPARRAF OF KAELCWEZ        
H P H                                                                           
H P H              PERFORM 9999-GESTION-ERRORES                                 
H P H                                                                           
H P H        WHEN OTHER                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3017-PROCESA-KACM71T' TO WS-OUT-PARRAFO                
H P H              MOVE 'ERR BORRAR DB2     ' TO WS-OUT-DESC                    
H P H              IF SQLCODE  = -911                                           
H P H                 MOVE '3017-PROCESA-KACM71T'  TO WS-OUT-PARRAFO            
H P H                 MOVE 'CONTENCION TABLA   '   TO WS-OUT-DESC               
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 mOVE 'S' TO SW-911                                        
H P H                 MOVE 'S' TO SW-911-911                                    
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 MOVE 'SI'                  TO WS-ROLLBACK                 
H P H                 MOVE SQLCODE               TO WS-OUT-SQLCODE              
H P H                 MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA               
H P H                 MOVE WS-TABLA-H            TO WS-OUT-TABLA                
H P H                 MOVE '3017-PROCESA-KACM71T' TO WS-OUT-PARRAFO             
H P H                    STRING                                                 
H P H                   'CONTENCIO:'             DELIMITED BY SIZE              
H P H                    WS-CAMPOPOL             DELIMITED BY ' '               
H P H                    '='                     DELIMITED BY SIZE              
H P H                    WS-LEE-CDNUMPOL         DELIMITED BY SIZE              
H P H                    INTO WS-OUT-DESC                                       
H P H                 END-STRING                                                
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H            STRING                                                         
H P H            'Z8883??????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            'Z8881??????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H              ELSE                                                         
H P H                 MOVE WC-COD              TO CDERR    OF KAELCWEZ          
H P H                 MOVE WC-DES01            TO DSARGU1  OF KAELCWEZ          
H P H                 MOVE WC-PROGRAMA         TO DSARGU2  OF KAELCWEZ          
H P H                 MOVE WS-ERPOLIZA         TO DSARGU3  OF KAELCWEZ          
H P H                 MOVE '3017-PROCESA-KACM71T'                               
H P H                                          TO CDPARRAF OF KAELCWEZ          
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H                 IF SQLCODE = -911                                         
H P H                    MOVE 'S' TO SW-911                                     
H P H                    MOVE 'S' TO SW-911-911                                 
H P H                    ADD 1 TO WS-CANT-ERRORES                               
H P H                 ELSE                                                      
H P H            STRING                                                         
H P H            'X9999??????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            'X9999??????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H                 PERFORM 9999-GESTION-ERRORES                              
H P H                 END-IF                                                    
H P H              END-IF                                                       
H P H      END-EVALUATE                                                         
H P H                 END-IF                                                    
H P H               END-IF                                                      
H P H              END-IF                                                       
H P H              IF WS-ROLLBACK = 'SI'                                        
H P H                 SET WS-NO-HAY-SINIESTROS TO TRUE                          
H P H                 MOVE 98 TO WS-ITBLS                                       
H P H              END-IF                                                       
H P H              ADD WC-1 TO WS-ITBLS.                                        
H P H *                                                                         
H P H  3018-PROCESA-KACM72T.                                                    
H P H              MOVE 'KACM72T'             TO WS-TABLA-T                     
H P H              MOVE 'KACM72H'             TO WS-TABLA-H                     
H P H *                                                                         
H P H              MOVE 'KACM72T'             TO WS-TIPO-TABLA                  
H P H              MOVE 'CDSINIES'            TO WS-CAMPOPOL                    
H P H                                                                           
H P H              IF TAB-ESP-SR                                                
H P H               IF WS-SI-HISTORIFICA                                        
H P H                 PERFORM 3300-INSERTA-ESP-SIN                              
H P H               END-IF                                                      
H P H              ELSE                                                         
H P H               IF WS-SI-HISTORIFICA                                        
H P H      EXEC SQL                                                             
H P H         DECLARE CURSOR-18 CURSOR FOR                                      
H P H            SELECT CDSINIES FROM KACM72T                                   
H P H             WHERE CDSINIES = :WS-TBL-SINOREC                              
H P H             FETCH FIRST 1 ROWS ONLY                                       
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EXEC SQL                                                             
H P H          OPEN CURSOR-18                                                   
H P H      END-EXEC                                                             
H P H      PERFORM 3306-VALIDA-CODIGO                                           
H P H      EXEC SQL                                                             
H P H          FETCH CURSOR-18                                                  
H P H          INTO                                                             
H P H          :WS-SINOREC                                                      
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H             EXEC SQL                                                      
H P H                CLOSE CURSOR-18                                            
H P H             END-EXEC                                                      
H P H             SET WS-PARA-INSERT TO TRUE                                    
H P H      EXEC SQL                                                             
H P H         INSERT INTO KACM72H                                               
H P H            (SELECT * FROM KACM72T                                         
H P H             WHERE CDSINIES = :WS-TBL-SINOREC)                             
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3018-PROCESA-KACM72T' TO WS-OUT-PARRAFO                
H P H              MOVE 'INSERT CORRECTO '    TO WS-OUT-DESC                    
H P H              MOVE WS-TBL-SINOREC        TO WS-OUT-DESC(18:12)             
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-CLAVE-DUPLICADA                                   
H P H              SET WS-DUPLICADOS   TO TRUE                                  
H P H              MOVE 'SI'                  TO WS-ROLLBACK                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3018-PROCESA-KACM72T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                'DUPLICADO:'             DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H              INTO WS-OUT-DESC                                             
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H            IF WS-WRITE                                                    
H P H              ADD  WC-1                  TO WS-IERR                        
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3018-PROCESA-KACM72T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'SIN '                  DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN OTHER                                                         
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                     SET WS-DUPLICADOS   TO TRUE                           
H P H                     MOVE 'SI'                  TO WS-ROLLBACK             
H P H                     MOVE SQLCODE               TO WS-OUT-SQLCODE          
H P H                     MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA           
H P H                     MOVE WS-TABLA-H            TO WS-OUT-TABLA            
H P H                     MOVE '3018-PROCESA-KACM72T' TO WS-OUT-PARRAFO         
H P H                     STRING                                                
H P H                      'CONTENCIO:'             DELIMITED BY SIZE           
H P H                       WS-CAMPOPOL             DELIMITED BY ' '            
H P H                       '='                     DELIMITED BY SIZE           
H P H                       WS-LEE-CDNUMPOL         DELIMITED BY SIZE           
H P H                       INTO WS-OUT-DESC                                    
H P H                       END-STRING                                          
H P H                     PERFORM 1570-ESCRIBE-DESCARTADA                       
H P H              ELSE                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3018-PROCESA-KACM72T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'ERRDB2:'               DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H              MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
H P H              MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
H P H              MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
H P H              MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
H P H              MOVE '3018-PROCESA-KACM72T  ' TO CDPARRAF OF KAELCWEZ        
H P H                                                                           
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 MOVE 'S' TO SW-911-911                                    
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H              ELSE                                                         
H P H                 PERFORM 9999-GESTION-ERRORES                              
H P H              END-IF                                                       
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                                                                           
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H            SET WS-NO-PARA-INSERT      TO TRUE                             
H P H            IF WS-WRITE                                                    
H P H              ADD  WC-1                  TO WS-IERR                        
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3018-PROCESA-KACM72T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'NOHAY '                DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H            EXEC SQL                                                       
H P H                CLOSE CURSOR-18                                            
H P H            END-EXEC                                                       
H P H        WHEN OTHER                                                         
H P H              SET WS-NO-PARA-INSERT      TO TRUE                           
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3018-PROCESA-KACM72T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'ERRDB2:'               DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            STRING                                                         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            ' ERROR EN SQL :' W-QUERY-TEXT                    '\N'         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H          MOVE WC-COD                   TO CDERR    OF KAELCWEZ            
H P H          MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ            
H P H          MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ            
H P H          MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ            
H P H          MOVE '3018-PROCESA-KACM72T  ' TO CDPARRAF OF KAELCWEZ            
H P H                                                                           
H P H          IF SQLCODE = -911                                                
H P H              MOVE 'S' TO SW-911                                           
H P H              MOVE 'S' TO SW-911-911                                       
H P H              ADD 1 TO WS-CANT-ERRORES                                     
H P H          ELSE                                                             
H P H             PERFORM 9999-GESTION-ERRORES                                  
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                 IF  SQLCODE = WN-SQLCODE-OK                               
H P H                 AND WS-PARA-INSERT                                        
H P H      EXEC SQL                                                             
H P H         DELETE FROM KACM72T                                               
H P H         WHERE CDSINIES = :WS-TBL-SINOREC                                  
H P H      END-EXEC                                                             
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3018-PROCESA-KACM72T' TO WS-OUT-PARRAFO                
H P H              MOVE 'BORRAR CORRECTO    ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3018-PROCESA-KACM72T' TO WS-OUT-PARRAFO                
H P H              MOVE 'NO EXISTE BORRAR   ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H              MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
H P H              MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
H P H              MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
H P H              MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
H P H              MOVE '3018-PROCESA-KACM72T  ' TO CDPARRAF OF KAELCWEZ        
H P H                                                                           
H P H              PERFORM 9999-GESTION-ERRORES                                 
H P H                                                                           
H P H        WHEN OTHER                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3018-PROCESA-KACM72T' TO WS-OUT-PARRAFO                
H P H              MOVE 'ERR BORRAR DB2     ' TO WS-OUT-DESC                    
H P H              IF SQLCODE  = -911                                           
H P H                 MOVE '3018-PROCESA-KACM72T'  TO WS-OUT-PARRAFO            
H P H                 MOVE 'CONTENCION TABLA   '   TO WS-OUT-DESC               
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 mOVE 'S' TO SW-911                                        
H P H                 MOVE 'S' TO SW-911-911                                    
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 MOVE 'SI'                  TO WS-ROLLBACK                 
H P H                 MOVE SQLCODE               TO WS-OUT-SQLCODE              
H P H                 MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA               
H P H                 MOVE WS-TABLA-H            TO WS-OUT-TABLA                
H P H                 MOVE '3018-PROCESA-KACM72T' TO WS-OUT-PARRAFO             
H P H                    STRING                                                 
H P H                   'CONTENCIO:'             DELIMITED BY SIZE              
H P H                    WS-CAMPOPOL             DELIMITED BY ' '               
H P H                    '='                     DELIMITED BY SIZE              
H P H                    WS-LEE-CDNUMPOL         DELIMITED BY SIZE              
H P H                    INTO WS-OUT-DESC                                       
H P H                 END-STRING                                                
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H            STRING                                                         
H P H            'Z8883??????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            'Z8881??????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H              ELSE                                                         
H P H                 MOVE WC-COD              TO CDERR    OF KAELCWEZ          
H P H                 MOVE WC-DES01            TO DSARGU1  OF KAELCWEZ          
H P H                 MOVE WC-PROGRAMA         TO DSARGU2  OF KAELCWEZ          
H P H                 MOVE WS-ERPOLIZA         TO DSARGU3  OF KAELCWEZ          
H P H                 MOVE '3018-PROCESA-KACM72T'                               
H P H                                          TO CDPARRAF OF KAELCWEZ          
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H                 IF SQLCODE = -911                                         
H P H                    MOVE 'S' TO SW-911                                     
H P H                    MOVE 'S' TO SW-911-911                                 
H P H                    ADD 1 TO WS-CANT-ERRORES                               
H P H                 ELSE                                                      
H P H            STRING                                                         
H P H            'X9999??????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            'X9999??????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H                 PERFORM 9999-GESTION-ERRORES                              
H P H                 END-IF                                                    
H P H              END-IF                                                       
H P H      END-EVALUATE                                                         
H P H                 END-IF                                                    
H P H               END-IF                                                      
H P H              END-IF                                                       
H P H              IF WS-ROLLBACK = 'SI'                                        
H P H                 SET WS-NO-HAY-SINIESTROS TO TRUE                          
H P H                 MOVE 98 TO WS-ITBLS                                       
H P H              END-IF                                                       
H P H              ADD WC-1 TO WS-ITBLS.                                        
H P H *                                                                         
H P H  3019-PROCESA-KACM73T.                                                    
H P H              MOVE 'KACM73T'             TO WS-TABLA-T                     
H P H              MOVE 'KACM73H'             TO WS-TABLA-H                     
H P H *                                                                         
H P H              MOVE 'KACM73T'             TO WS-TIPO-TABLA                  
H P H              MOVE 'CDSINIES'            TO WS-CAMPOPOL                    
H P H                                                                           
H P H              IF TAB-ESP-SR                                                
H P H               IF WS-SI-HISTORIFICA                                        
H P H                 PERFORM 3300-INSERTA-ESP-SIN                              
H P H               END-IF                                                      
H P H              ELSE                                                         
H P H               IF WS-SI-HISTORIFICA                                        
H P H      EXEC SQL                                                             
H P H         DECLARE CURSOR-19 CURSOR FOR                                      
H P H            SELECT CDSINIES FROM KACM73T                                   
H P H             WHERE CDSINIES = :WS-TBL-SINOREC                              
H P H             FETCH FIRST 1 ROWS ONLY                                       
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EXEC SQL                                                             
H P H          OPEN CURSOR-19                                                   
H P H      END-EXEC                                                             
H P H      PERFORM 3306-VALIDA-CODIGO                                           
H P H      EXEC SQL                                                             
H P H          FETCH CURSOR-19                                                  
H P H          INTO                                                             
H P H          :WS-SINOREC                                                      
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H             EXEC SQL                                                      
H P H                CLOSE CURSOR-19                                            
H P H             END-EXEC                                                      
H P H             SET WS-PARA-INSERT TO TRUE                                    
H P H      EXEC SQL                                                             
H P H         INSERT INTO KACM73H                                               
H P H            (SELECT * FROM KACM73T                                         
H P H             WHERE CDSINIES = :WS-TBL-SINOREC)                             
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3019-PROCESA-KACM73T' TO WS-OUT-PARRAFO                
H P H              MOVE 'INSERT CORRECTO '    TO WS-OUT-DESC                    
H P H              MOVE WS-TBL-SINOREC        TO WS-OUT-DESC(18:12)             
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-CLAVE-DUPLICADA                                   
H P H              SET WS-DUPLICADOS   TO TRUE                                  
H P H              MOVE 'SI'                  TO WS-ROLLBACK                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3019-PROCESA-KACM73T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                'DUPLICADO:'             DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H              INTO WS-OUT-DESC                                             
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H            IF WS-WRITE                                                    
H P H              ADD  WC-1                  TO WS-IERR                        
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3019-PROCESA-KACM73T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'SIN '                  DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN OTHER                                                         
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                     SET WS-DUPLICADOS   TO TRUE                           
H P H                     MOVE 'SI'                  TO WS-ROLLBACK             
H P H                     MOVE SQLCODE               TO WS-OUT-SQLCODE          
H P H                     MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA           
H P H                     MOVE WS-TABLA-H            TO WS-OUT-TABLA            
H P H                     MOVE '3019-PROCESA-KACM73T' TO WS-OUT-PARRAFO         
H P H                     STRING                                                
H P H                      'CONTENCIO:'             DELIMITED BY SIZE           
H P H                       WS-CAMPOPOL             DELIMITED BY ' '            
H P H                       '='                     DELIMITED BY SIZE           
H P H                       WS-LEE-CDNUMPOL         DELIMITED BY SIZE           
H P H                       INTO WS-OUT-DESC                                    
H P H                       END-STRING                                          
H P H                     PERFORM 1570-ESCRIBE-DESCARTADA                       
H P H              ELSE                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3019-PROCESA-KACM73T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'ERRDB2:'               DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H              MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
H P H              MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
H P H              MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
H P H              MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
H P H              MOVE '3019-PROCESA-KACM73T  ' TO CDPARRAF OF KAELCWEZ        
H P H                                                                           
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 MOVE 'S' TO SW-911-911                                    
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H              ELSE                                                         
H P H                 PERFORM 9999-GESTION-ERRORES                              
H P H              END-IF                                                       
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                                                                           
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H            SET WS-NO-PARA-INSERT      TO TRUE                             
H P H            IF WS-WRITE                                                    
H P H              ADD  WC-1                  TO WS-IERR                        
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3019-PROCESA-KACM73T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'NOHAY '                DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H            EXEC SQL                                                       
H P H                CLOSE CURSOR-19                                            
H P H            END-EXEC                                                       
H P H        WHEN OTHER                                                         
H P H              SET WS-NO-PARA-INSERT      TO TRUE                           
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3019-PROCESA-KACM73T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'ERRDB2:'               DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            STRING                                                         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            ' ERROR EN SQL :' W-QUERY-TEXT                    '\N'         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H          MOVE WC-COD                   TO CDERR    OF KAELCWEZ            
H P H          MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ            
H P H          MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ            
H P H          MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ            
H P H          MOVE '3019-PROCESA-KACM73T  ' TO CDPARRAF OF KAELCWEZ            
H P H                                                                           
H P H          IF SQLCODE = -911                                                
H P H              MOVE 'S' TO SW-911                                           
H P H              MOVE 'S' TO SW-911-911                                       
H P H              ADD 1 TO WS-CANT-ERRORES                                     
H P H          ELSE                                                             
H P H             PERFORM 9999-GESTION-ERRORES                                  
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                 IF  SQLCODE = WN-SQLCODE-OK                               
H P H                 AND WS-PARA-INSERT                                        
H P H      EXEC SQL                                                             
H P H         DELETE FROM KACM73T                                               
H P H         WHERE CDSINIES = :WS-TBL-SINOREC                                  
H P H      END-EXEC                                                             
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3019-PROCESA-KACM73T' TO WS-OUT-PARRAFO                
H P H              MOVE 'BORRAR CORRECTO    ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3019-PROCESA-KACM73T' TO WS-OUT-PARRAFO                
H P H              MOVE 'NO EXISTE BORRAR   ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H              MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
H P H              MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
H P H              MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
H P H              MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
H P H              MOVE '3019-PROCESA-KACM73T  ' TO CDPARRAF OF KAELCWEZ        
H P H                                                                           
H P H              PERFORM 9999-GESTION-ERRORES                                 
H P H                                                                           
H P H        WHEN OTHER                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3019-PROCESA-KACM73T' TO WS-OUT-PARRAFO                
H P H              MOVE 'ERR BORRAR DB2     ' TO WS-OUT-DESC                    
H P H              IF SQLCODE  = -911                                           
H P H                 MOVE '3019-PROCESA-KACM73T'  TO WS-OUT-PARRAFO            
H P H                 MOVE 'CONTENCION TABLA   '   TO WS-OUT-DESC               
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 mOVE 'S' TO SW-911                                        
H P H                 MOVE 'S' TO SW-911-911                                    
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 MOVE 'SI'                  TO WS-ROLLBACK                 
H P H                 MOVE SQLCODE               TO WS-OUT-SQLCODE              
H P H                 MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA               
H P H                 MOVE WS-TABLA-H            TO WS-OUT-TABLA                
H P H                 MOVE '3019-PROCESA-KACM73T' TO WS-OUT-PARRAFO             
H P H                    STRING                                                 
H P H                   'CONTENCIO:'             DELIMITED BY SIZE              
H P H                    WS-CAMPOPOL             DELIMITED BY ' '               
H P H                    '='                     DELIMITED BY SIZE              
H P H                    WS-LEE-CDNUMPOL         DELIMITED BY SIZE              
H P H                    INTO WS-OUT-DESC                                       
H P H                 END-STRING                                                
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H            STRING                                                         
H P H            'Z8883??????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            'Z8881??????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H              ELSE                                                         
H P H                 MOVE WC-COD              TO CDERR    OF KAELCWEZ          
H P H                 MOVE WC-DES01            TO DSARGU1  OF KAELCWEZ          
H P H                 MOVE WC-PROGRAMA         TO DSARGU2  OF KAELCWEZ          
H P H                 MOVE WS-ERPOLIZA         TO DSARGU3  OF KAELCWEZ          
H P H                 MOVE '3019-PROCESA-KACM73T'                               
H P H                                          TO CDPARRAF OF KAELCWEZ          
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H                 IF SQLCODE = -911                                         
H P H                    MOVE 'S' TO SW-911                                     
H P H                    MOVE 'S' TO SW-911-911                                 
H P H                    ADD 1 TO WS-CANT-ERRORES                               
H P H                 ELSE                                                      
H P H            STRING                                                         
H P H            'X9999??????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            'X9999??????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H                 PERFORM 9999-GESTION-ERRORES                              
H P H                 END-IF                                                    
H P H              END-IF                                                       
H P H      END-EVALUATE                                                         
H P H                 END-IF                                                    
H P H               END-IF                                                      
H P H              END-IF                                                       
H P H              IF WS-ROLLBACK = 'SI'                                        
H P H                 SET WS-NO-HAY-SINIESTROS TO TRUE                          
H P H                 MOVE 98 TO WS-ITBLS                                       
H P H              END-IF                                                       
H P H              ADD WC-1 TO WS-ITBLS.                                        
H P H *                                                                         
H P H  3020-PROCESA-KACN58T.                                                    
H P H              MOVE 'KACN58T'             TO WS-TABLA-T                     
H P H              MOVE 'KACN58H'             TO WS-TABLA-H                     
H P H *                                                                         
H P H              MOVE 'KACN58T'             TO WS-TIPO-TABLA                  
H P H              MOVE 'CDSINIES'            TO WS-CAMPOPOL                    
H P H                                                                           
H P H              IF TAB-ESP-SR                                                
H P H               IF WS-SI-HISTORIFICA                                        
H P H                 PERFORM 3300-INSERTA-ESP-SIN                              
H P H               END-IF                                                      
H P H              ELSE                                                         
H P H               IF WS-SI-HISTORIFICA                                        
H P H      EXEC SQL                                                             
H P H         DECLARE CURSOR-20 CURSOR FOR                                      
H P H            SELECT CDSINIES FROM KACN58T                                   
H P H             WHERE CDSINIES = :WS-TBL-SINOREC                              
H P H             FETCH FIRST 1 ROWS ONLY                                       
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EXEC SQL                                                             
H P H          OPEN CURSOR-20                                                   
H P H      END-EXEC                                                             
H P H      PERFORM 3306-VALIDA-CODIGO                                           
H P H      EXEC SQL                                                             
H P H          FETCH CURSOR-20                                                  
H P H          INTO                                                             
H P H          :WS-SINOREC                                                      
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H             EXEC SQL                                                      
H P H                CLOSE CURSOR-20                                            
H P H             END-EXEC                                                      
H P H             SET WS-PARA-INSERT TO TRUE                                    
H P H      EXEC SQL                                                             
H P H         INSERT INTO KACN58H                                               
H P H            (SELECT * FROM KACN58T                                         
H P H             WHERE CDSINIES = :WS-TBL-SINOREC)                             
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3020-PROCESA-KACN58T' TO WS-OUT-PARRAFO                
H P H              MOVE 'INSERT CORRECTO '    TO WS-OUT-DESC                    
H P H              MOVE WS-TBL-SINOREC        TO WS-OUT-DESC(18:12)             
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-CLAVE-DUPLICADA                                   
H P H              SET WS-DUPLICADOS   TO TRUE                                  
H P H              MOVE 'SI'                  TO WS-ROLLBACK                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3020-PROCESA-KACN58T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                'DUPLICADO:'             DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H              INTO WS-OUT-DESC                                             
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H            IF WS-WRITE                                                    
H P H              ADD  WC-1                  TO WS-IERR                        
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3020-PROCESA-KACN58T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'SIN '                  DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN OTHER                                                         
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                     SET WS-DUPLICADOS   TO TRUE                           
H P H                     MOVE 'SI'                  TO WS-ROLLBACK             
H P H                     MOVE SQLCODE               TO WS-OUT-SQLCODE          
H P H                     MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA           
H P H                     MOVE WS-TABLA-H            TO WS-OUT-TABLA            
H P H                     MOVE '3020-PROCESA-KACN58T' TO WS-OUT-PARRAFO         
H P H                     STRING                                                
H P H                      'CONTENCIO:'             DELIMITED BY SIZE           
H P H                       WS-CAMPOPOL             DELIMITED BY ' '            
H P H                       '='                     DELIMITED BY SIZE           
H P H                       WS-LEE-CDNUMPOL         DELIMITED BY SIZE           
H P H                       INTO WS-OUT-DESC                                    
H P H                       END-STRING                                          
H P H                     PERFORM 1570-ESCRIBE-DESCARTADA                       
H P H              ELSE                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3020-PROCESA-KACN58T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'ERRDB2:'               DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H              MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
H P H              MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
H P H              MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
H P H              MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
H P H              MOVE '3020-PROCESA-KACN58T  ' TO CDPARRAF OF KAELCWEZ        
H P H                                                                           
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 MOVE 'S' TO SW-911-911                                    
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H              ELSE                                                         
H P H                 PERFORM 9999-GESTION-ERRORES                              
H P H              END-IF                                                       
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                                                                           
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H            SET WS-NO-PARA-INSERT      TO TRUE                             
H P H            IF WS-WRITE                                                    
H P H              ADD  WC-1                  TO WS-IERR                        
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3020-PROCESA-KACN58T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'NOHAY '                DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H            EXEC SQL                                                       
H P H                CLOSE CURSOR-20                                            
H P H            END-EXEC                                                       
H P H        WHEN OTHER                                                         
H P H              SET WS-NO-PARA-INSERT      TO TRUE                           
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3020-PROCESA-KACN58T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'ERRDB2:'               DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            STRING                                                         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            ' ERROR EN SQL :' W-QUERY-TEXT                    '\N'         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H          MOVE WC-COD                   TO CDERR    OF KAELCWEZ            
H P H          MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ            
H P H          MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ            
H P H          MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ            
H P H          MOVE '3020-PROCESA-KACN58T  ' TO CDPARRAF OF KAELCWEZ            
H P H                                                                           
H P H          IF SQLCODE = -911                                                
H P H              MOVE 'S' TO SW-911                                           
H P H              MOVE 'S' TO SW-911-911                                       
H P H              ADD 1 TO WS-CANT-ERRORES                                     
H P H          ELSE                                                             
H P H             PERFORM 9999-GESTION-ERRORES                                  
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                 IF  SQLCODE = WN-SQLCODE-OK                               
H P H                 AND WS-PARA-INSERT                                        
H P H      EXEC SQL                                                             
H P H         DELETE FROM KACN58T                                               
H P H         WHERE CDSINIES = :WS-TBL-SINOREC                                  
H P H      END-EXEC                                                             
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3020-PROCESA-KACN58T' TO WS-OUT-PARRAFO                
H P H              MOVE 'BORRAR CORRECTO    ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3020-PROCESA-KACN58T' TO WS-OUT-PARRAFO                
H P H              MOVE 'NO EXISTE BORRAR   ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H              MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
H P H              MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
H P H              MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
H P H              MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
H P H              MOVE '3020-PROCESA-KACN58T  ' TO CDPARRAF OF KAELCWEZ        
H P H                                                                           
H P H              PERFORM 9999-GESTION-ERRORES                                 
H P H                                                                           
H P H        WHEN OTHER                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3020-PROCESA-KACN58T' TO WS-OUT-PARRAFO                
H P H              MOVE 'ERR BORRAR DB2     ' TO WS-OUT-DESC                    
H P H              IF SQLCODE  = -911                                           
H P H                 MOVE '3020-PROCESA-KACN58T'  TO WS-OUT-PARRAFO            
H P H                 MOVE 'CONTENCION TABLA   '   TO WS-OUT-DESC               
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 mOVE 'S' TO SW-911                                        
H P H                 MOVE 'S' TO SW-911-911                                    
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 MOVE 'SI'                  TO WS-ROLLBACK                 
H P H                 MOVE SQLCODE               TO WS-OUT-SQLCODE              
H P H                 MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA               
H P H                 MOVE WS-TABLA-H            TO WS-OUT-TABLA                
H P H                 MOVE '3020-PROCESA-KACN58T' TO WS-OUT-PARRAFO             
H P H                    STRING                                                 
H P H                   'CONTENCIO:'             DELIMITED BY SIZE              
H P H                    WS-CAMPOPOL             DELIMITED BY ' '               
H P H                    '='                     DELIMITED BY SIZE              
H P H                    WS-LEE-CDNUMPOL         DELIMITED BY SIZE              
H P H                    INTO WS-OUT-DESC                                       
H P H                 END-STRING                                                
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H            STRING                                                         
H P H            'Z8883??????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            'Z8881??????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H              ELSE                                                         
H P H                 MOVE WC-COD              TO CDERR    OF KAELCWEZ          
H P H                 MOVE WC-DES01            TO DSARGU1  OF KAELCWEZ          
H P H                 MOVE WC-PROGRAMA         TO DSARGU2  OF KAELCWEZ          
H P H                 MOVE WS-ERPOLIZA         TO DSARGU3  OF KAELCWEZ          
H P H                 MOVE '3020-PROCESA-KACN58T'                               
H P H                                          TO CDPARRAF OF KAELCWEZ          
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H                 IF SQLCODE = -911                                         
H P H                    MOVE 'S' TO SW-911                                     
H P H                    MOVE 'S' TO SW-911-911                                 
H P H                    ADD 1 TO WS-CANT-ERRORES                               
H P H                 ELSE                                                      
H P H            STRING                                                         
H P H            'X9999??????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            'X9999??????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H                 PERFORM 9999-GESTION-ERRORES                              
H P H                 END-IF                                                    
H P H              END-IF                                                       
H P H      END-EVALUATE                                                         
H P H                 END-IF                                                    
H P H               END-IF                                                      
H P H              END-IF                                                       
H P H              IF WS-ROLLBACK = 'SI'                                        
H P H                 SET WS-NO-HAY-SINIESTROS TO TRUE                          
H P H                 MOVE 98 TO WS-ITBLS                                       
H P H              END-IF                                                       
H P H              ADD WC-1 TO WS-ITBLS.                                        
H P H *                                                                         
H P H  3021-PROCESA-KACTEIT.                                                    
H P H              MOVE 'KACTEIT'             TO WS-TABLA-T                     
H P H              MOVE 'KACTEIH'             TO WS-TABLA-H                     
H P H *                                                                         
H P H              MOVE 'KACTEIT'             TO WS-TIPO-TABLA                  
H P H              MOVE 'CDSINIES'            TO WS-CAMPOPOL                    
H P H                                                                           
H P H              IF TAB-ESP-SR                                                
H P H               IF WS-SI-HISTORIFICA                                        
H P H                 PERFORM 3300-INSERTA-ESP-SIN                              
H P H               END-IF                                                      
H P H              ELSE                                                         
H P H               IF WS-SI-HISTORIFICA                                        
H P H      EXEC SQL                                                             
H P H         DECLARE CURSOR-21 CURSOR FOR                                      
H P H            SELECT CDSINIES FROM KACTEIT                                   
H P H             WHERE CDSINIES = :WS-TBL-SINOREC                              
H P H             FETCH FIRST 1 ROWS ONLY                                       
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EXEC SQL                                                             
H P H          OPEN CURSOR-21                                                   
H P H      END-EXEC                                                             
H P H      PERFORM 3306-VALIDA-CODIGO                                           
H P H      EXEC SQL                                                             
H P H          FETCH CURSOR-21                                                  
H P H          INTO                                                             
H P H          :WS-SINOREC                                                      
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H             EXEC SQL                                                      
H P H                CLOSE CURSOR-21                                            
H P H             END-EXEC                                                      
H P H             SET WS-PARA-INSERT TO TRUE                                    
H P H      EXEC SQL                                                             
H P H         INSERT INTO KACTEIH                                               
H P H            (SELECT * FROM KACTEIT                                         
H P H             WHERE CDSINIES = :WS-TBL-SINOREC)                             
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3021-PROCESA-KACTEIT' TO WS-OUT-PARRAFO                
H P H              MOVE 'INSERT CORRECTO '    TO WS-OUT-DESC                    
H P H              MOVE WS-TBL-SINOREC        TO WS-OUT-DESC(18:12)             
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-CLAVE-DUPLICADA                                   
H P H              SET WS-DUPLICADOS   TO TRUE                                  
H P H              MOVE 'SI'                  TO WS-ROLLBACK                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3021-PROCESA-KACTEIT' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                'DUPLICADO:'             DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H              INTO WS-OUT-DESC                                             
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H            IF WS-WRITE                                                    
H P H              ADD  WC-1                  TO WS-IERR                        
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3021-PROCESA-KACTEIT' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'SIN '                  DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN OTHER                                                         
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                     SET WS-DUPLICADOS   TO TRUE                           
H P H                     MOVE 'SI'                  TO WS-ROLLBACK             
H P H                     MOVE SQLCODE               TO WS-OUT-SQLCODE          
H P H                     MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA           
H P H                     MOVE WS-TABLA-H            TO WS-OUT-TABLA            
H P H                     MOVE '3021-PROCESA-KACTEIT' TO WS-OUT-PARRAFO         
H P H                     STRING                                                
H P H                      'CONTENCIO:'             DELIMITED BY SIZE           
H P H                       WS-CAMPOPOL             DELIMITED BY ' '            
H P H                       '='                     DELIMITED BY SIZE           
H P H                       WS-LEE-CDNUMPOL         DELIMITED BY SIZE           
H P H                       INTO WS-OUT-DESC                                    
H P H                       END-STRING                                          
H P H                     PERFORM 1570-ESCRIBE-DESCARTADA                       
H P H              ELSE                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3021-PROCESA-KACTEIT' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'ERRDB2:'               DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H              MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
H P H              MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
H P H              MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
H P H              MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
H P H              MOVE '3021-PROCESA-KACTEIT  ' TO CDPARRAF OF KAELCWEZ        
H P H                                                                           
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 MOVE 'S' TO SW-911-911                                    
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H              ELSE                                                         
H P H                 PERFORM 9999-GESTION-ERRORES                              
H P H              END-IF                                                       
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                                                                           
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H            SET WS-NO-PARA-INSERT      TO TRUE                             
H P H            IF WS-WRITE                                                    
H P H              ADD  WC-1                  TO WS-IERR                        
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3021-PROCESA-KACTEIT' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'NOHAY '                DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H            EXEC SQL                                                       
H P H                CLOSE CURSOR-21                                            
H P H            END-EXEC                                                       
H P H        WHEN OTHER                                                         
H P H              SET WS-NO-PARA-INSERT      TO TRUE                           
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3021-PROCESA-KACTEIT' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'ERRDB2:'               DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            STRING                                                         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            ' ERROR EN SQL :' W-QUERY-TEXT                    '\N'         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H          MOVE WC-COD                   TO CDERR    OF KAELCWEZ            
H P H          MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ            
H P H          MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ            
H P H          MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ            
H P H          MOVE '3021-PROCESA-KACTEIT  ' TO CDPARRAF OF KAELCWEZ            
H P H                                                                           
H P H          IF SQLCODE = -911                                                
H P H              MOVE 'S' TO SW-911                                           
H P H              MOVE 'S' TO SW-911-911                                       
H P H              ADD 1 TO WS-CANT-ERRORES                                     
H P H          ELSE                                                             
H P H             PERFORM 9999-GESTION-ERRORES                                  
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                 IF  SQLCODE = WN-SQLCODE-OK                               
H P H                 AND WS-PARA-INSERT                                        
H P H      EXEC SQL                                                             
H P H         DELETE FROM KACTEIT                                               
H P H         WHERE CDSINIES = :WS-TBL-SINOREC                                  
H P H      END-EXEC                                                             
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3021-PROCESA-KACTEIT' TO WS-OUT-PARRAFO                
H P H              MOVE 'BORRAR CORRECTO    ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3021-PROCESA-KACTEIT' TO WS-OUT-PARRAFO                
H P H              MOVE 'NO EXISTE BORRAR   ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H              MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
H P H              MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
H P H              MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
H P H              MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
H P H              MOVE '3021-PROCESA-KACTEIT  ' TO CDPARRAF OF KAELCWEZ        
H P H                                                                           
H P H              PERFORM 9999-GESTION-ERRORES                                 
H P H                                                                           
H P H        WHEN OTHER                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3021-PROCESA-KACTEIT' TO WS-OUT-PARRAFO                
H P H              MOVE 'ERR BORRAR DB2     ' TO WS-OUT-DESC                    
H P H              IF SQLCODE  = -911                                           
H P H                 MOVE '3021-PROCESA-KACTEIT'  TO WS-OUT-PARRAFO            
H P H                 MOVE 'CONTENCION TABLA   '   TO WS-OUT-DESC               
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 mOVE 'S' TO SW-911                                        
H P H                 MOVE 'S' TO SW-911-911                                    
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 MOVE 'SI'                  TO WS-ROLLBACK                 
H P H                 MOVE SQLCODE               TO WS-OUT-SQLCODE              
H P H                 MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA               
H P H                 MOVE WS-TABLA-H            TO WS-OUT-TABLA                
H P H                 MOVE '3021-PROCESA-KACTEIT' TO WS-OUT-PARRAFO             
H P H                    STRING                                                 
H P H                   'CONTENCIO:'             DELIMITED BY SIZE              
H P H                    WS-CAMPOPOL             DELIMITED BY ' '               
H P H                    '='                     DELIMITED BY SIZE              
H P H                    WS-LEE-CDNUMPOL         DELIMITED BY SIZE              
H P H                    INTO WS-OUT-DESC                                       
H P H                 END-STRING                                                
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H            STRING                                                         
H P H            'Z8883??????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            'Z8881??????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H              ELSE                                                         
H P H                 MOVE WC-COD              TO CDERR    OF KAELCWEZ          
H P H                 MOVE WC-DES01            TO DSARGU1  OF KAELCWEZ          
H P H                 MOVE WC-PROGRAMA         TO DSARGU2  OF KAELCWEZ          
H P H                 MOVE WS-ERPOLIZA         TO DSARGU3  OF KAELCWEZ          
H P H                 MOVE '3021-PROCESA-KACTEIT'                               
H P H                                          TO CDPARRAF OF KAELCWEZ          
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H                 IF SQLCODE = -911                                         
H P H                    MOVE 'S' TO SW-911                                     
H P H                    MOVE 'S' TO SW-911-911                                 
H P H                    ADD 1 TO WS-CANT-ERRORES                               
H P H                 ELSE                                                      
H P H            STRING                                                         
H P H            'X9999??????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            'X9999??????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H                 PERFORM 9999-GESTION-ERRORES                              
H P H                 END-IF                                                    
H P H              END-IF                                                       
H P H      END-EVALUATE                                                         
H P H                 END-IF                                                    
H P H               END-IF                                                      
H P H              END-IF                                                       
H P H              IF WS-ROLLBACK = 'SI'                                        
H P H                 SET WS-NO-HAY-SINIESTROS TO TRUE                          
H P H                 MOVE 98 TO WS-ITBLS                                       
H P H              END-IF                                                       
H P H              ADD WC-1 TO WS-ITBLS.                                        
H P H *                                                                         
H P H  3022-PROCESA-KACTEPT.                                                    
H P H              MOVE 'KACTEPT'             TO WS-TABLA-T                     
H P H              MOVE 'KACTEPH'             TO WS-TABLA-H                     
H P H *                                                                         
H P H              MOVE 'KACTEPT'             TO WS-TIPO-TABLA                  
H P H              MOVE 'CDSINIES'            TO WS-CAMPOPOL                    
H P H                                                                           
H P H              IF TAB-ESP-SR                                                
H P H               IF WS-SI-HISTORIFICA                                        
H P H                 PERFORM 3300-INSERTA-ESP-SIN                              
H P H               END-IF                                                      
H P H              ELSE                                                         
H P H               IF WS-SI-HISTORIFICA                                        
H P H      EXEC SQL                                                             
H P H         DECLARE CURSOR-22 CURSOR FOR                                      
H P H            SELECT CDSINIES FROM KACTEPT                                   
H P H             WHERE CDSINIES = :WS-TBL-SINOREC                              
H P H             FETCH FIRST 1 ROWS ONLY                                       
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EXEC SQL                                                             
H P H          OPEN CURSOR-22                                                   
H P H      END-EXEC                                                             
H P H      PERFORM 3306-VALIDA-CODIGO                                           
H P H      EXEC SQL                                                             
H P H          FETCH CURSOR-22                                                  
H P H          INTO                                                             
H P H          :WS-SINOREC                                                      
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H             EXEC SQL                                                      
H P H                CLOSE CURSOR-22                                            
H P H             END-EXEC                                                      
H P H             SET WS-PARA-INSERT TO TRUE                                    
H P H      EXEC SQL                                                             
H P H         INSERT INTO KACTEPH                                               
H P H            (SELECT * FROM KACTEPT                                         
H P H             WHERE CDSINIES = :WS-TBL-SINOREC)                             
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3022-PROCESA-KACTEPT' TO WS-OUT-PARRAFO                
H P H              MOVE 'INSERT CORRECTO '    TO WS-OUT-DESC                    
H P H              MOVE WS-TBL-SINOREC        TO WS-OUT-DESC(18:12)             
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-CLAVE-DUPLICADA                                   
H P H              SET WS-DUPLICADOS   TO TRUE                                  
H P H              MOVE 'SI'                  TO WS-ROLLBACK                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3022-PROCESA-KACTEPT' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                'DUPLICADO:'             DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H              INTO WS-OUT-DESC                                             
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H            IF WS-WRITE                                                    
H P H              ADD  WC-1                  TO WS-IERR                        
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3022-PROCESA-KACTEPT' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'SIN '                  DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN OTHER                                                         
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                     SET WS-DUPLICADOS   TO TRUE                           
H P H                     MOVE 'SI'                  TO WS-ROLLBACK             
H P H                     MOVE SQLCODE               TO WS-OUT-SQLCODE          
H P H                     MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA           
H P H                     MOVE WS-TABLA-H            TO WS-OUT-TABLA            
H P H                     MOVE '3022-PROCESA-KACTEPT' TO WS-OUT-PARRAFO         
H P H                     STRING                                                
H P H                      'CONTENCIO:'             DELIMITED BY SIZE           
H P H                       WS-CAMPOPOL             DELIMITED BY ' '            
H P H                       '='                     DELIMITED BY SIZE           
H P H                       WS-LEE-CDNUMPOL         DELIMITED BY SIZE           
H P H                       INTO WS-OUT-DESC                                    
H P H                       END-STRING                                          
H P H                     PERFORM 1570-ESCRIBE-DESCARTADA                       
H P H              ELSE                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3022-PROCESA-KACTEPT' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'ERRDB2:'               DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H              MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
H P H              MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
H P H              MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
H P H              MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
H P H              MOVE '3022-PROCESA-KACTEPT  ' TO CDPARRAF OF KAELCWEZ        
H P H                                                                           
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 MOVE 'S' TO SW-911-911                                    
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H              ELSE                                                         
H P H                 PERFORM 9999-GESTION-ERRORES                              
H P H              END-IF                                                       
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                                                                           
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H            SET WS-NO-PARA-INSERT      TO TRUE                             
H P H            IF WS-WRITE                                                    
H P H              ADD  WC-1                  TO WS-IERR                        
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3022-PROCESA-KACTEPT' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'NOHAY '                DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H            EXEC SQL                                                       
H P H                CLOSE CURSOR-22                                            
H P H            END-EXEC                                                       
H P H        WHEN OTHER                                                         
H P H              SET WS-NO-PARA-INSERT      TO TRUE                           
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3022-PROCESA-KACTEPT' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'ERRDB2:'               DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            STRING                                                         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            ' ERROR EN SQL :' W-QUERY-TEXT                    '\N'         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H          MOVE WC-COD                   TO CDERR    OF KAELCWEZ            
H P H          MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ            
H P H          MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ            
H P H          MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ            
H P H          MOVE '3022-PROCESA-KACTEPT  ' TO CDPARRAF OF KAELCWEZ            
H P H                                                                           
H P H          IF SQLCODE = -911                                                
H P H              MOVE 'S' TO SW-911                                           
H P H              MOVE 'S' TO SW-911-911                                       
H P H              ADD 1 TO WS-CANT-ERRORES                                     
H P H          ELSE                                                             
H P H             PERFORM 9999-GESTION-ERRORES                                  
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                 IF  SQLCODE = WN-SQLCODE-OK                               
H P H                 AND WS-PARA-INSERT                                        
H P H      EXEC SQL                                                             
H P H         DELETE FROM KACTEPT                                               
H P H         WHERE CDSINIES = :WS-TBL-SINOREC                                  
H P H      END-EXEC                                                             
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3022-PROCESA-KACTEPT' TO WS-OUT-PARRAFO                
H P H              MOVE 'BORRAR CORRECTO    ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3022-PROCESA-KACTEPT' TO WS-OUT-PARRAFO                
H P H              MOVE 'NO EXISTE BORRAR   ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H              MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
H P H              MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
H P H              MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
H P H              MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
H P H              MOVE '3022-PROCESA-KACTEPT  ' TO CDPARRAF OF KAELCWEZ        
H P H                                                                           
H P H              PERFORM 9999-GESTION-ERRORES                                 
H P H                                                                           
H P H        WHEN OTHER                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3022-PROCESA-KACTEPT' TO WS-OUT-PARRAFO                
H P H              MOVE 'ERR BORRAR DB2     ' TO WS-OUT-DESC                    
H P H              IF SQLCODE  = -911                                           
H P H                 MOVE '3022-PROCESA-KACTEPT'  TO WS-OUT-PARRAFO            
H P H                 MOVE 'CONTENCION TABLA   '   TO WS-OUT-DESC               
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 mOVE 'S' TO SW-911                                        
H P H                 MOVE 'S' TO SW-911-911                                    
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 MOVE 'SI'                  TO WS-ROLLBACK                 
H P H                 MOVE SQLCODE               TO WS-OUT-SQLCODE              
H P H                 MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA               
H P H                 MOVE WS-TABLA-H            TO WS-OUT-TABLA                
H P H                 MOVE '3022-PROCESA-KACTEPT' TO WS-OUT-PARRAFO             
H P H                    STRING                                                 
H P H                   'CONTENCIO:'             DELIMITED BY SIZE              
H P H                    WS-CAMPOPOL             DELIMITED BY ' '               
H P H                    '='                     DELIMITED BY SIZE              
H P H                    WS-LEE-CDNUMPOL         DELIMITED BY SIZE              
H P H                    INTO WS-OUT-DESC                                       
H P H                 END-STRING                                                
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H            STRING                                                         
H P H            'Z8883??????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            'Z8881??????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H              ELSE                                                         
H P H                 MOVE WC-COD              TO CDERR    OF KAELCWEZ          
H P H                 MOVE WC-DES01            TO DSARGU1  OF KAELCWEZ          
H P H                 MOVE WC-PROGRAMA         TO DSARGU2  OF KAELCWEZ          
H P H                 MOVE WS-ERPOLIZA         TO DSARGU3  OF KAELCWEZ          
H P H                 MOVE '3022-PROCESA-KACTEPT'                               
H P H                                          TO CDPARRAF OF KAELCWEZ          
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H                 IF SQLCODE = -911                                         
H P H                    MOVE 'S' TO SW-911                                     
H P H                    MOVE 'S' TO SW-911-911                                 
H P H                    ADD 1 TO WS-CANT-ERRORES                               
H P H                 ELSE                                                      
H P H            STRING                                                         
H P H            'X9999??????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            'X9999??????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H                 PERFORM 9999-GESTION-ERRORES                              
H P H                 END-IF                                                    
H P H              END-IF                                                       
H P H      END-EVALUATE                                                         
H P H                 END-IF                                                    
H P H               END-IF                                                      
H P H              END-IF                                                       
H P H              IF WS-ROLLBACK = 'SI'                                        
H P H                 SET WS-NO-HAY-SINIESTROS TO TRUE                          
H P H                 MOVE 98 TO WS-ITBLS                                       
H P H              END-IF                                                       
H P H              ADD WC-1 TO WS-ITBLS.                                        
H P H *                                                                         
H P H  3023-PROCESA-KACTSAT.                                                    
H P H              MOVE 'KACTSAT'             TO WS-TABLA-T                     
H P H              MOVE 'KACTSAH'             TO WS-TABLA-H                     
H P H *                                                                         
H P H              MOVE 'KACTSAT'             TO WS-TIPO-TABLA                  
H P H              MOVE 'CDSINIES'            TO WS-CAMPOPOL                    
H P H                                                                           
H P H              IF TAB-ESP-SR                                                
H P H               IF WS-SI-HISTORIFICA                                        
H P H                 PERFORM 3300-INSERTA-ESP-SIN                              
H P H               END-IF                                                      
H P H              ELSE                                                         
H P H               IF WS-SI-HISTORIFICA                                        
H P H      EXEC SQL                                                             
H P H         DECLARE CURSOR-23 CURSOR FOR                                      
H P H            SELECT CDSINIES FROM KACTSAT                                   
H P H             WHERE CDSINIES = :WS-TBL-SINOREC                              
H P H             FETCH FIRST 1 ROWS ONLY                                       
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EXEC SQL                                                             
H P H          OPEN CURSOR-23                                                   
H P H      END-EXEC                                                             
H P H      PERFORM 3306-VALIDA-CODIGO                                           
H P H      EXEC SQL                                                             
H P H          FETCH CURSOR-23                                                  
H P H          INTO                                                             
H P H          :WS-SINOREC                                                      
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H             EXEC SQL                                                      
H P H                CLOSE CURSOR-23                                            
H P H             END-EXEC                                                      
H P H             SET WS-PARA-INSERT TO TRUE                                    
H P H      EXEC SQL                                                             
H P H         INSERT INTO KACTSAH                                               
H P H            (SELECT * FROM KACTSAT                                         
H P H             WHERE CDSINIES = :WS-TBL-SINOREC)                             
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3023-PROCESA-KACTSAT' TO WS-OUT-PARRAFO                
H P H              MOVE 'INSERT CORRECTO '    TO WS-OUT-DESC                    
H P H              MOVE WS-TBL-SINOREC        TO WS-OUT-DESC(18:12)             
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-CLAVE-DUPLICADA                                   
H P H              SET WS-DUPLICADOS   TO TRUE                                  
H P H              MOVE 'SI'                  TO WS-ROLLBACK                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3023-PROCESA-KACTSAT' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                'DUPLICADO:'             DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H              INTO WS-OUT-DESC                                             
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H            IF WS-WRITE                                                    
H P H              ADD  WC-1                  TO WS-IERR                        
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3023-PROCESA-KACTSAT' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'SIN '                  DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN OTHER                                                         
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                     SET WS-DUPLICADOS   TO TRUE                           
H P H                     MOVE 'SI'                  TO WS-ROLLBACK             
H P H                     MOVE SQLCODE               TO WS-OUT-SQLCODE          
H P H                     MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA           
H P H                     MOVE WS-TABLA-H            TO WS-OUT-TABLA            
H P H                     MOVE '3023-PROCESA-KACTSAT' TO WS-OUT-PARRAFO         
H P H                     STRING                                                
H P H                      'CONTENCIO:'             DELIMITED BY SIZE           
H P H                       WS-CAMPOPOL             DELIMITED BY ' '            
H P H                       '='                     DELIMITED BY SIZE           
H P H                       WS-LEE-CDNUMPOL         DELIMITED BY SIZE           
H P H                       INTO WS-OUT-DESC                                    
H P H                       END-STRING                                          
H P H                     PERFORM 1570-ESCRIBE-DESCARTADA                       
H P H              ELSE                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3023-PROCESA-KACTSAT' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'ERRDB2:'               DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H              MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
H P H              MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
H P H              MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
H P H              MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
H P H              MOVE '3023-PROCESA-KACTSAT  ' TO CDPARRAF OF KAELCWEZ        
H P H                                                                           
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 MOVE 'S' TO SW-911-911                                    
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H              ELSE                                                         
H P H                 PERFORM 9999-GESTION-ERRORES                              
H P H              END-IF                                                       
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                                                                           
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H            SET WS-NO-PARA-INSERT      TO TRUE                             
H P H            IF WS-WRITE                                                    
H P H              ADD  WC-1                  TO WS-IERR                        
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3023-PROCESA-KACTSAT' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'NOHAY '                DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H            EXEC SQL                                                       
H P H                CLOSE CURSOR-23                                            
H P H            END-EXEC                                                       
H P H        WHEN OTHER                                                         
H P H              SET WS-NO-PARA-INSERT      TO TRUE                           
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3023-PROCESA-KACTSAT' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'ERRDB2:'               DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            STRING                                                         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            ' ERROR EN SQL :' W-QUERY-TEXT                    '\N'         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H          MOVE WC-COD                   TO CDERR    OF KAELCWEZ            
H P H          MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ            
H P H          MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ            
H P H          MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ            
H P H          MOVE '3023-PROCESA-KACTSAT  ' TO CDPARRAF OF KAELCWEZ            
H P H                                                                           
H P H          IF SQLCODE = -911                                                
H P H              MOVE 'S' TO SW-911                                           
H P H              MOVE 'S' TO SW-911-911                                       
H P H              ADD 1 TO WS-CANT-ERRORES                                     
H P H          ELSE                                                             
H P H             PERFORM 9999-GESTION-ERRORES                                  
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                 IF  SQLCODE = WN-SQLCODE-OK                               
H P H                 AND WS-PARA-INSERT                                        
H P H      EXEC SQL                                                             
H P H         DELETE FROM KACTSAT                                               
H P H         WHERE CDSINIES = :WS-TBL-SINOREC                                  
H P H      END-EXEC                                                             
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3023-PROCESA-KACTSAT' TO WS-OUT-PARRAFO                
H P H              MOVE 'BORRAR CORRECTO    ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3023-PROCESA-KACTSAT' TO WS-OUT-PARRAFO                
H P H              MOVE 'NO EXISTE BORRAR   ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H              MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
H P H              MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
H P H              MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
H P H              MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
H P H              MOVE '3023-PROCESA-KACTSAT  ' TO CDPARRAF OF KAELCWEZ        
H P H                                                                           
H P H              PERFORM 9999-GESTION-ERRORES                                 
H P H                                                                           
H P H        WHEN OTHER                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3023-PROCESA-KACTSAT' TO WS-OUT-PARRAFO                
H P H              MOVE 'ERR BORRAR DB2     ' TO WS-OUT-DESC                    
H P H              IF SQLCODE  = -911                                           
H P H                 MOVE '3023-PROCESA-KACTSAT'  TO WS-OUT-PARRAFO            
H P H                 MOVE 'CONTENCION TABLA   '   TO WS-OUT-DESC               
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 mOVE 'S' TO SW-911                                        
H P H                 MOVE 'S' TO SW-911-911                                    
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 MOVE 'SI'                  TO WS-ROLLBACK                 
H P H                 MOVE SQLCODE               TO WS-OUT-SQLCODE              
H P H                 MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA               
H P H                 MOVE WS-TABLA-H            TO WS-OUT-TABLA                
H P H                 MOVE '3023-PROCESA-KACTSAT' TO WS-OUT-PARRAFO             
H P H                    STRING                                                 
H P H                   'CONTENCIO:'             DELIMITED BY SIZE              
H P H                    WS-CAMPOPOL             DELIMITED BY ' '               
H P H                    '='                     DELIMITED BY SIZE              
H P H                    WS-LEE-CDNUMPOL         DELIMITED BY SIZE              
H P H                    INTO WS-OUT-DESC                                       
H P H                 END-STRING                                                
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H            STRING                                                         
H P H            'Z8883??????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            'Z8881??????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H              ELSE                                                         
H P H                 MOVE WC-COD              TO CDERR    OF KAELCWEZ          
H P H                 MOVE WC-DES01            TO DSARGU1  OF KAELCWEZ          
H P H                 MOVE WC-PROGRAMA         TO DSARGU2  OF KAELCWEZ          
H P H                 MOVE WS-ERPOLIZA         TO DSARGU3  OF KAELCWEZ          
H P H                 MOVE '3023-PROCESA-KACTSAT'                               
H P H                                          TO CDPARRAF OF KAELCWEZ          
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H                 IF SQLCODE = -911                                         
H P H                    MOVE 'S' TO SW-911                                     
H P H                    MOVE 'S' TO SW-911-911                                 
H P H                    ADD 1 TO WS-CANT-ERRORES                               
H P H                 ELSE                                                      
H P H            STRING                                                         
H P H            'X9999??????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            'X9999??????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H                 PERFORM 9999-GESTION-ERRORES                              
H P H                 END-IF                                                    
H P H              END-IF                                                       
H P H      END-EVALUATE                                                         
H P H                 END-IF                                                    
H P H               END-IF                                                      
H P H              END-IF                                                       
H P H              IF WS-ROLLBACK = 'SI'                                        
H P H                 SET WS-NO-HAY-SINIESTROS TO TRUE                          
H P H                 MOVE 98 TO WS-ITBLS                                       
H P H              END-IF                                                       
H P H              ADD WC-1 TO WS-ITBLS.                                        
H P H *                                                                         
H P H  3024-PROCESA-KREM48T.                                                    
H P H              MOVE 'KREM48T'             TO WS-TABLA-T                     
H P H              MOVE 'KREM48H'             TO WS-TABLA-H                     
H P H *                                                                         
H P H              MOVE 'KREM48T'             TO WS-TIPO-TABLA                  
H P H              MOVE 'CDSINIES'            TO WS-CAMPOPOL                    
H P H                                                                           
H P H              IF TAB-ESP-SR                                                
H P H               IF WS-SI-HISTORIFICA                                        
H P H                 PERFORM 3300-INSERTA-ESP-SIN                              
H P H               END-IF                                                      
H P H              ELSE                                                         
H P H               IF WS-SI-HISTORIFICA                                        
H P H      EXEC SQL                                                             
H P H         DECLARE CURSOR-24 CURSOR FOR                                      
H P H            SELECT CDSINIES FROM KREM48T                                   
H P H             WHERE CDSINIES = :WS-TBL-SINOREC                              
H P H             FETCH FIRST 1 ROWS ONLY                                       
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EXEC SQL                                                             
H P H          OPEN CURSOR-24                                                   
H P H      END-EXEC                                                             
H P H      PERFORM 3306-VALIDA-CODIGO                                           
H P H      EXEC SQL                                                             
H P H          FETCH CURSOR-24                                                  
H P H          INTO                                                             
H P H          :WS-SINOREC                                                      
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H             EXEC SQL                                                      
H P H                CLOSE CURSOR-24                                            
H P H             END-EXEC                                                      
H P H             SET WS-PARA-INSERT TO TRUE                                    
H P H      EXEC SQL                                                             
H P H         INSERT INTO KREM48H                                               
H P H            (SELECT * FROM KREM48T                                         
H P H             WHERE CDSINIES = :WS-TBL-SINOREC)                             
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3024-PROCESA-KREM48T' TO WS-OUT-PARRAFO                
H P H              MOVE 'INSERT CORRECTO '    TO WS-OUT-DESC                    
H P H              MOVE WS-TBL-SINOREC        TO WS-OUT-DESC(18:12)             
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-CLAVE-DUPLICADA                                   
H P H              SET WS-DUPLICADOS   TO TRUE                                  
H P H              MOVE 'SI'                  TO WS-ROLLBACK                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3024-PROCESA-KREM48T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                'DUPLICADO:'             DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H              INTO WS-OUT-DESC                                             
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H            IF WS-WRITE                                                    
H P H              ADD  WC-1                  TO WS-IERR                        
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3024-PROCESA-KREM48T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'SIN '                  DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN OTHER                                                         
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                     SET WS-DUPLICADOS   TO TRUE                           
H P H                     MOVE 'SI'                  TO WS-ROLLBACK             
H P H                     MOVE SQLCODE               TO WS-OUT-SQLCODE          
H P H                     MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA           
H P H                     MOVE WS-TABLA-H            TO WS-OUT-TABLA            
H P H                     MOVE '3024-PROCESA-KREM48T' TO WS-OUT-PARRAFO         
H P H                     STRING                                                
H P H                      'CONTENCIO:'             DELIMITED BY SIZE           
H P H                       WS-CAMPOPOL             DELIMITED BY ' '            
H P H                       '='                     DELIMITED BY SIZE           
H P H                       WS-LEE-CDNUMPOL         DELIMITED BY SIZE           
H P H                       INTO WS-OUT-DESC                                    
H P H                       END-STRING                                          
H P H                     PERFORM 1570-ESCRIBE-DESCARTADA                       
H P H              ELSE                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3024-PROCESA-KREM48T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'ERRDB2:'               DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H              MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
H P H              MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
H P H              MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
H P H              MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
H P H              MOVE '3024-PROCESA-KREM48T  ' TO CDPARRAF OF KAELCWEZ        
H P H                                                                           
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 MOVE 'S' TO SW-911-911                                    
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H              ELSE                                                         
H P H                 PERFORM 9999-GESTION-ERRORES                              
H P H              END-IF                                                       
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                                                                           
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H            SET WS-NO-PARA-INSERT      TO TRUE                             
H P H            IF WS-WRITE                                                    
H P H              ADD  WC-1                  TO WS-IERR                        
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3024-PROCESA-KREM48T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'NOHAY '                DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H            EXEC SQL                                                       
H P H                CLOSE CURSOR-24                                            
H P H            END-EXEC                                                       
H P H        WHEN OTHER                                                         
H P H              SET WS-NO-PARA-INSERT      TO TRUE                           
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3024-PROCESA-KREM48T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'ERRDB2:'               DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            STRING                                                         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            ' ERROR EN SQL :' W-QUERY-TEXT                    '\N'         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H          MOVE WC-COD                   TO CDERR    OF KAELCWEZ            
H P H          MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ            
H P H          MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ            
H P H          MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ            
H P H          MOVE '3024-PROCESA-KREM48T  ' TO CDPARRAF OF KAELCWEZ            
H P H                                                                           
H P H          IF SQLCODE = -911                                                
H P H              MOVE 'S' TO SW-911                                           
H P H              MOVE 'S' TO SW-911-911                                       
H P H              ADD 1 TO WS-CANT-ERRORES                                     
H P H          ELSE                                                             
H P H             PERFORM 9999-GESTION-ERRORES                                  
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                 IF  SQLCODE = WN-SQLCODE-OK                               
H P H                 AND WS-PARA-INSERT                                        
H P H      EXEC SQL                                                             
H P H         DELETE FROM KREM48T                                               
H P H         WHERE CDSINIES = :WS-TBL-SINOREC                                  
H P H      END-EXEC                                                             
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3024-PROCESA-KREM48T' TO WS-OUT-PARRAFO                
H P H              MOVE 'BORRAR CORRECTO    ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3024-PROCESA-KREM48T' TO WS-OUT-PARRAFO                
H P H              MOVE 'NO EXISTE BORRAR   ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H              MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
H P H              MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
H P H              MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
H P H              MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
H P H              MOVE '3024-PROCESA-KREM48T  ' TO CDPARRAF OF KAELCWEZ        
H P H                                                                           
H P H              PERFORM 9999-GESTION-ERRORES                                 
H P H                                                                           
H P H        WHEN OTHER                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3024-PROCESA-KREM48T' TO WS-OUT-PARRAFO                
H P H              MOVE 'ERR BORRAR DB2     ' TO WS-OUT-DESC                    
H P H              IF SQLCODE  = -911                                           
H P H                 MOVE '3024-PROCESA-KREM48T'  TO WS-OUT-PARRAFO            
H P H                 MOVE 'CONTENCION TABLA   '   TO WS-OUT-DESC               
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 mOVE 'S' TO SW-911                                        
H P H                 MOVE 'S' TO SW-911-911                                    
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 MOVE 'SI'                  TO WS-ROLLBACK                 
H P H                 MOVE SQLCODE               TO WS-OUT-SQLCODE              
H P H                 MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA               
H P H                 MOVE WS-TABLA-H            TO WS-OUT-TABLA                
H P H                 MOVE '3024-PROCESA-KREM48T' TO WS-OUT-PARRAFO             
H P H                    STRING                                                 
H P H                   'CONTENCIO:'             DELIMITED BY SIZE              
H P H                    WS-CAMPOPOL             DELIMITED BY ' '               
H P H                    '='                     DELIMITED BY SIZE              
H P H                    WS-LEE-CDNUMPOL         DELIMITED BY SIZE              
H P H                    INTO WS-OUT-DESC                                       
H P H                 END-STRING                                                
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H            STRING                                                         
H P H            'Z8883??????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            'Z8881??????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H              ELSE                                                         
H P H                 MOVE WC-COD              TO CDERR    OF KAELCWEZ          
H P H                 MOVE WC-DES01            TO DSARGU1  OF KAELCWEZ          
H P H                 MOVE WC-PROGRAMA         TO DSARGU2  OF KAELCWEZ          
H P H                 MOVE WS-ERPOLIZA         TO DSARGU3  OF KAELCWEZ          
H P H                 MOVE '3024-PROCESA-KREM48T'                               
H P H                                          TO CDPARRAF OF KAELCWEZ          
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H                 IF SQLCODE = -911                                         
H P H                    MOVE 'S' TO SW-911                                     
H P H                    MOVE 'S' TO SW-911-911                                 
H P H                    ADD 1 TO WS-CANT-ERRORES                               
H P H                 ELSE                                                      
H P H            STRING                                                         
H P H            'X9999??????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            'X9999??????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H                 PERFORM 9999-GESTION-ERRORES                              
H P H                 END-IF                                                    
H P H              END-IF                                                       
H P H      END-EVALUATE                                                         
H P H                 END-IF                                                    
H P H               END-IF                                                      
H P H              END-IF                                                       
H P H              IF WS-ROLLBACK = 'SI'                                        
H P H                 SET WS-NO-HAY-SINIESTROS TO TRUE                          
H P H                 MOVE 98 TO WS-ITBLS                                       
H P H              END-IF                                                       
H P H              ADD WC-1 TO WS-ITBLS.                                        
H P H *                                                                         
H P H  3025-PROCESA-KREM49T.                                                    
H P H              MOVE 'KREM49T'             TO WS-TABLA-T                     
H P H              MOVE 'KREM49H'             TO WS-TABLA-H                     
H P H *                                                                         
H P H              MOVE 'KREM49T'             TO WS-TIPO-TABLA                  
H P H              MOVE 'CDSINIES'            TO WS-CAMPOPOL                    
H P H                                                                           
H P H              IF TAB-ESP-SR                                                
H P H               IF WS-SI-HISTORIFICA                                        
H P H                 PERFORM 3300-INSERTA-ESP-SIN                              
H P H               END-IF                                                      
H P H              ELSE                                                         
H P H               IF WS-SI-HISTORIFICA                                        
H P H      EXEC SQL                                                             
H P H         DECLARE CURSOR-25 CURSOR FOR                                      
H P H            SELECT CDSINIES FROM KREM49T                                   
H P H             WHERE CDSINIES = :WS-TBL-SINOREC                              
H P H             FETCH FIRST 1 ROWS ONLY                                       
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EXEC SQL                                                             
H P H          OPEN CURSOR-25                                                   
H P H      END-EXEC                                                             
H P H      PERFORM 3306-VALIDA-CODIGO                                           
H P H      EXEC SQL                                                             
H P H          FETCH CURSOR-25                                                  
H P H          INTO                                                             
H P H          :WS-SINOREC                                                      
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H             EXEC SQL                                                      
H P H                CLOSE CURSOR-25                                            
H P H             END-EXEC                                                      
H P H             SET WS-PARA-INSERT TO TRUE                                    
H P H      EXEC SQL                                                             
H P H         INSERT INTO KREM49H                                               
H P H            (SELECT * FROM KREM49T                                         
H P H             WHERE CDSINIES = :WS-TBL-SINOREC)                             
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3025-PROCESA-KREM49T' TO WS-OUT-PARRAFO                
H P H              MOVE 'INSERT CORRECTO '    TO WS-OUT-DESC                    
H P H              MOVE WS-TBL-SINOREC        TO WS-OUT-DESC(18:12)             
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-CLAVE-DUPLICADA                                   
H P H              SET WS-DUPLICADOS   TO TRUE                                  
H P H              MOVE 'SI'                  TO WS-ROLLBACK                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3025-PROCESA-KREM49T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                'DUPLICADO:'             DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H              INTO WS-OUT-DESC                                             
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H            IF WS-WRITE                                                    
H P H              ADD  WC-1                  TO WS-IERR                        
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3025-PROCESA-KREM49T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'SIN '                  DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN OTHER                                                         
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                     SET WS-DUPLICADOS   TO TRUE                           
H P H                     MOVE 'SI'                  TO WS-ROLLBACK             
H P H                     MOVE SQLCODE               TO WS-OUT-SQLCODE          
H P H                     MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA           
H P H                     MOVE WS-TABLA-H            TO WS-OUT-TABLA            
H P H                     MOVE '3025-PROCESA-KREM49T' TO WS-OUT-PARRAFO         
H P H                     STRING                                                
H P H                      'CONTENCIO:'             DELIMITED BY SIZE           
H P H                       WS-CAMPOPOL             DELIMITED BY ' '            
H P H                       '='                     DELIMITED BY SIZE           
H P H                       WS-LEE-CDNUMPOL         DELIMITED BY SIZE           
H P H                       INTO WS-OUT-DESC                                    
H P H                       END-STRING                                          
H P H                     PERFORM 1570-ESCRIBE-DESCARTADA                       
H P H              ELSE                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3025-PROCESA-KREM49T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'ERRDB2:'               DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H              MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
H P H              MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
H P H              MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
H P H              MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
H P H              MOVE '3025-PROCESA-KREM49T  ' TO CDPARRAF OF KAELCWEZ        
H P H                                                                           
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 MOVE 'S' TO SW-911-911                                    
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H              ELSE                                                         
H P H                 PERFORM 9999-GESTION-ERRORES                              
H P H              END-IF                                                       
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                                                                           
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H            SET WS-NO-PARA-INSERT      TO TRUE                             
H P H            IF WS-WRITE                                                    
H P H              ADD  WC-1                  TO WS-IERR                        
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3025-PROCESA-KREM49T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'NOHAY '                DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H            EXEC SQL                                                       
H P H                CLOSE CURSOR-25                                            
H P H            END-EXEC                                                       
H P H        WHEN OTHER                                                         
H P H              SET WS-NO-PARA-INSERT      TO TRUE                           
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3025-PROCESA-KREM49T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'ERRDB2:'               DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            STRING                                                         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            ' ERROR EN SQL :' W-QUERY-TEXT                    '\N'         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H          MOVE WC-COD                   TO CDERR    OF KAELCWEZ            
H P H          MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ            
H P H          MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ            
H P H          MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ            
H P H          MOVE '3025-PROCESA-KREM49T  ' TO CDPARRAF OF KAELCWEZ            
H P H                                                                           
H P H          IF SQLCODE = -911                                                
H P H              MOVE 'S' TO SW-911                                           
H P H              MOVE 'S' TO SW-911-911                                       
H P H              ADD 1 TO WS-CANT-ERRORES                                     
H P H          ELSE                                                             
H P H             PERFORM 9999-GESTION-ERRORES                                  
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                 IF  SQLCODE = WN-SQLCODE-OK                               
H P H                 AND WS-PARA-INSERT                                        
H P H      EXEC SQL                                                             
H P H         DELETE FROM KREM49T                                               
H P H         WHERE CDSINIES = :WS-TBL-SINOREC                                  
H P H      END-EXEC                                                             
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3025-PROCESA-KREM49T' TO WS-OUT-PARRAFO                
H P H              MOVE 'BORRAR CORRECTO    ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3025-PROCESA-KREM49T' TO WS-OUT-PARRAFO                
H P H              MOVE 'NO EXISTE BORRAR   ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H              MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
H P H              MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
H P H              MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
H P H              MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
H P H              MOVE '3025-PROCESA-KREM49T  ' TO CDPARRAF OF KAELCWEZ        
H P H                                                                           
H P H              PERFORM 9999-GESTION-ERRORES                                 
H P H                                                                           
H P H        WHEN OTHER                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3025-PROCESA-KREM49T' TO WS-OUT-PARRAFO                
H P H              MOVE 'ERR BORRAR DB2     ' TO WS-OUT-DESC                    
H P H              IF SQLCODE  = -911                                           
H P H                 MOVE '3025-PROCESA-KREM49T'  TO WS-OUT-PARRAFO            
H P H                 MOVE 'CONTENCION TABLA   '   TO WS-OUT-DESC               
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 mOVE 'S' TO SW-911                                        
H P H                 MOVE 'S' TO SW-911-911                                    
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 MOVE 'SI'                  TO WS-ROLLBACK                 
H P H                 MOVE SQLCODE               TO WS-OUT-SQLCODE              
H P H                 MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA               
H P H                 MOVE WS-TABLA-H            TO WS-OUT-TABLA                
H P H                 MOVE '3025-PROCESA-KREM49T' TO WS-OUT-PARRAFO             
H P H                    STRING                                                 
H P H                   'CONTENCIO:'             DELIMITED BY SIZE              
H P H                    WS-CAMPOPOL             DELIMITED BY ' '               
H P H                    '='                     DELIMITED BY SIZE              
H P H                    WS-LEE-CDNUMPOL         DELIMITED BY SIZE              
H P H                    INTO WS-OUT-DESC                                       
H P H                 END-STRING                                                
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H            STRING                                                         
H P H            'Z8883??????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            'Z8881??????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H              ELSE                                                         
H P H                 MOVE WC-COD              TO CDERR    OF KAELCWEZ          
H P H                 MOVE WC-DES01            TO DSARGU1  OF KAELCWEZ          
H P H                 MOVE WC-PROGRAMA         TO DSARGU2  OF KAELCWEZ          
H P H                 MOVE WS-ERPOLIZA         TO DSARGU3  OF KAELCWEZ          
H P H                 MOVE '3025-PROCESA-KREM49T'                               
H P H                                          TO CDPARRAF OF KAELCWEZ          
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H                 IF SQLCODE = -911                                         
H P H                    MOVE 'S' TO SW-911                                     
H P H                    MOVE 'S' TO SW-911-911                                 
H P H                    ADD 1 TO WS-CANT-ERRORES                               
H P H                 ELSE                                                      
H P H            STRING                                                         
H P H            'X9999??????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            'X9999??????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H                 PERFORM 9999-GESTION-ERRORES                              
H P H                 END-IF                                                    
H P H              END-IF                                                       
H P H      END-EVALUATE                                                         
H P H                 END-IF                                                    
H P H               END-IF                                                      
H P H              END-IF                                                       
H P H              IF WS-ROLLBACK = 'SI'                                        
H P H                 SET WS-NO-HAY-SINIESTROS TO TRUE                          
H P H                 MOVE 98 TO WS-ITBLS                                       
H P H              END-IF                                                       
H P H              ADD WC-1 TO WS-ITBLS.                                        
H P H *                                                                         
H P H  3026-PROCESA-KRETAST.                                                    
H P H              MOVE 'KRETAST'             TO WS-TABLA-T                     
H P H              MOVE 'KRETASH'             TO WS-TABLA-H                     
H P H *                                                                         
H P H              MOVE 'KRETAST'             TO WS-TIPO-TABLA                  
H P H              MOVE 'CDSINIES'            TO WS-CAMPOPOL                    
H P H                                                                           
H P H              IF TAB-ESP-SR                                                
H P H               IF WS-SI-HISTORIFICA                                        
H P H                 PERFORM 3300-INSERTA-ESP-SIN                              
H P H               END-IF                                                      
H P H              ELSE                                                         
H P H               IF WS-SI-HISTORIFICA                                        
H P H      EXEC SQL                                                             
H P H         DECLARE CURSOR-26 CURSOR FOR                                      
H P H            SELECT CDSINIES FROM KRETAST                                   
H P H             WHERE CDSINIES = :WS-TBL-SINOREC                              
H P H             FETCH FIRST 1 ROWS ONLY                                       
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EXEC SQL                                                             
H P H          OPEN CURSOR-26                                                   
H P H      END-EXEC                                                             
H P H      PERFORM 3306-VALIDA-CODIGO                                           
H P H      EXEC SQL                                                             
H P H          FETCH CURSOR-26                                                  
H P H          INTO                                                             
H P H          :WS-SINOREC                                                      
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H             EXEC SQL                                                      
H P H                CLOSE CURSOR-26                                            
H P H             END-EXEC                                                      
H P H             SET WS-PARA-INSERT TO TRUE                                    
H P H      EXEC SQL                                                             
H P H         INSERT INTO KRETASH                                               
H P H            (SELECT * FROM KRETAST                                         
H P H             WHERE CDSINIES = :WS-TBL-SINOREC)                             
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3026-PROCESA-KRETAST' TO WS-OUT-PARRAFO                
H P H              MOVE 'INSERT CORRECTO '    TO WS-OUT-DESC                    
H P H              MOVE WS-TBL-SINOREC        TO WS-OUT-DESC(18:12)             
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-CLAVE-DUPLICADA                                   
H P H              SET WS-DUPLICADOS   TO TRUE                                  
H P H              MOVE 'SI'                  TO WS-ROLLBACK                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3026-PROCESA-KRETAST' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                'DUPLICADO:'             DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H              INTO WS-OUT-DESC                                             
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H            IF WS-WRITE                                                    
H P H              ADD  WC-1                  TO WS-IERR                        
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3026-PROCESA-KRETAST' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'SIN '                  DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN OTHER                                                         
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                     SET WS-DUPLICADOS   TO TRUE                           
H P H                     MOVE 'SI'                  TO WS-ROLLBACK             
H P H                     MOVE SQLCODE               TO WS-OUT-SQLCODE          
H P H                     MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA           
H P H                     MOVE WS-TABLA-H            TO WS-OUT-TABLA            
H P H                     MOVE '3026-PROCESA-KRETAST' TO WS-OUT-PARRAFO         
H P H                     STRING                                                
H P H                      'CONTENCIO:'             DELIMITED BY SIZE           
H P H                       WS-CAMPOPOL             DELIMITED BY ' '            
H P H                       '='                     DELIMITED BY SIZE           
H P H                       WS-LEE-CDNUMPOL         DELIMITED BY SIZE           
H P H                       INTO WS-OUT-DESC                                    
H P H                       END-STRING                                          
H P H                     PERFORM 1570-ESCRIBE-DESCARTADA                       
H P H              ELSE                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3026-PROCESA-KRETAST' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'ERRDB2:'               DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H              MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
H P H              MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
H P H              MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
H P H              MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
H P H              MOVE '3026-PROCESA-KRETAST  ' TO CDPARRAF OF KAELCWEZ        
H P H                                                                           
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 MOVE 'S' TO SW-911-911                                    
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H              ELSE                                                         
H P H                 PERFORM 9999-GESTION-ERRORES                              
H P H              END-IF                                                       
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                                                                           
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H            SET WS-NO-PARA-INSERT      TO TRUE                             
H P H            IF WS-WRITE                                                    
H P H              ADD  WC-1                  TO WS-IERR                        
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3026-PROCESA-KRETAST' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'NOHAY '                DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H            EXEC SQL                                                       
H P H                CLOSE CURSOR-26                                            
H P H            END-EXEC                                                       
H P H        WHEN OTHER                                                         
H P H              SET WS-NO-PARA-INSERT      TO TRUE                           
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3026-PROCESA-KRETAST' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'ERRDB2:'               DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            STRING                                                         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            ' ERROR EN SQL :' W-QUERY-TEXT                    '\N'         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H          MOVE WC-COD                   TO CDERR    OF KAELCWEZ            
H P H          MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ            
H P H          MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ            
H P H          MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ            
H P H          MOVE '3026-PROCESA-KRETAST  ' TO CDPARRAF OF KAELCWEZ            
H P H                                                                           
H P H          IF SQLCODE = -911                                                
H P H              MOVE 'S' TO SW-911                                           
H P H              MOVE 'S' TO SW-911-911                                       
H P H              ADD 1 TO WS-CANT-ERRORES                                     
H P H          ELSE                                                             
H P H             PERFORM 9999-GESTION-ERRORES                                  
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                 IF  SQLCODE = WN-SQLCODE-OK                               
H P H                 AND WS-PARA-INSERT                                        
H P H      EXEC SQL                                                             
H P H         DELETE FROM KRETAST                                               
H P H         WHERE CDSINIES = :WS-TBL-SINOREC                                  
H P H      END-EXEC                                                             
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3026-PROCESA-KRETAST' TO WS-OUT-PARRAFO                
H P H              MOVE 'BORRAR CORRECTO    ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3026-PROCESA-KRETAST' TO WS-OUT-PARRAFO                
H P H              MOVE 'NO EXISTE BORRAR   ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H              MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
H P H              MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
H P H              MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
H P H              MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
H P H              MOVE '3026-PROCESA-KRETAST  ' TO CDPARRAF OF KAELCWEZ        
H P H                                                                           
H P H              PERFORM 9999-GESTION-ERRORES                                 
H P H                                                                           
H P H        WHEN OTHER                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3026-PROCESA-KRETAST' TO WS-OUT-PARRAFO                
H P H              MOVE 'ERR BORRAR DB2     ' TO WS-OUT-DESC                    
H P H              IF SQLCODE  = -911                                           
H P H                 MOVE '3026-PROCESA-KRETAST'  TO WS-OUT-PARRAFO            
H P H                 MOVE 'CONTENCION TABLA   '   TO WS-OUT-DESC               
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 mOVE 'S' TO SW-911                                        
H P H                 MOVE 'S' TO SW-911-911                                    
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 MOVE 'SI'                  TO WS-ROLLBACK                 
H P H                 MOVE SQLCODE               TO WS-OUT-SQLCODE              
H P H                 MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA               
H P H                 MOVE WS-TABLA-H            TO WS-OUT-TABLA                
H P H                 MOVE '3026-PROCESA-KRETAST' TO WS-OUT-PARRAFO             
H P H                    STRING                                                 
H P H                   'CONTENCIO:'             DELIMITED BY SIZE              
H P H                    WS-CAMPOPOL             DELIMITED BY ' '               
H P H                    '='                     DELIMITED BY SIZE              
H P H                    WS-LEE-CDNUMPOL         DELIMITED BY SIZE              
H P H                    INTO WS-OUT-DESC                                       
H P H                 END-STRING                                                
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H            STRING                                                         
H P H            'Z8883??????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            'Z8881??????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H              ELSE                                                         
H P H                 MOVE WC-COD              TO CDERR    OF KAELCWEZ          
H P H                 MOVE WC-DES01            TO DSARGU1  OF KAELCWEZ          
H P H                 MOVE WC-PROGRAMA         TO DSARGU2  OF KAELCWEZ          
H P H                 MOVE WS-ERPOLIZA         TO DSARGU3  OF KAELCWEZ          
H P H                 MOVE '3026-PROCESA-KRETAST'                               
H P H                                          TO CDPARRAF OF KAELCWEZ          
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H                 IF SQLCODE = -911                                         
H P H                    MOVE 'S' TO SW-911                                     
H P H                    MOVE 'S' TO SW-911-911                                 
H P H                    ADD 1 TO WS-CANT-ERRORES                               
H P H                 ELSE                                                      
H P H            STRING                                                         
H P H            'X9999??????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            'X9999??????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H                 PERFORM 9999-GESTION-ERRORES                              
H P H                 END-IF                                                    
H P H              END-IF                                                       
H P H      END-EVALUATE                                                         
H P H                 END-IF                                                    
H P H               END-IF                                                      
H P H              END-IF                                                       
H P H              IF WS-ROLLBACK = 'SI'                                        
H P H                 SET WS-NO-HAY-SINIESTROS TO TRUE                          
H P H                 MOVE 98 TO WS-ITBLS                                       
H P H              END-IF                                                       
H P H              ADD WC-1 TO WS-ITBLS.                                        
H P H *                                                                         
H P H  3027-PROCESA-KRETSNT.                                                    
H P H              MOVE 'KRETSNT'             TO WS-TABLA-T                     
H P H              MOVE 'KRETSNH'             TO WS-TABLA-H                     
H P H *                                                                         
H P H              MOVE 'KRETSNT'             TO WS-TIPO-TABLA                  
H P H              MOVE 'CDSINIES'            TO WS-CAMPOPOL                    
H P H                                                                           
H P H              IF TAB-ESP-SR                                                
H P H               IF WS-SI-HISTORIFICA                                        
H P H                 PERFORM 3300-INSERTA-ESP-SIN                              
H P H               END-IF                                                      
H P H              ELSE                                                         
H P H               IF WS-SI-HISTORIFICA                                        
H P H      EXEC SQL                                                             
H P H         DECLARE CURSOR-27 CURSOR FOR                                      
H P H            SELECT CDSINIES FROM KRETSNT                                   
H P H             WHERE CDSINIES = :WS-TBL-SINOREC                              
H P H             FETCH FIRST 1 ROWS ONLY                                       
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EXEC SQL                                                             
H P H          OPEN CURSOR-27                                                   
H P H      END-EXEC                                                             
H P H      PERFORM 3306-VALIDA-CODIGO                                           
H P H      EXEC SQL                                                             
H P H          FETCH CURSOR-27                                                  
H P H          INTO                                                             
H P H          :WS-SINOREC                                                      
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H             EXEC SQL                                                      
H P H                CLOSE CURSOR-27                                            
H P H             END-EXEC                                                      
H P H             SET WS-PARA-INSERT TO TRUE                                    
H P H      EXEC SQL                                                             
H P H         INSERT INTO KRETSNH                                               
H P H            (SELECT * FROM KRETSNT                                         
H P H             WHERE CDSINIES = :WS-TBL-SINOREC)                             
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3027-PROCESA-KRETSNT' TO WS-OUT-PARRAFO                
H P H              MOVE 'INSERT CORRECTO '    TO WS-OUT-DESC                    
H P H              MOVE WS-TBL-SINOREC        TO WS-OUT-DESC(18:12)             
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-CLAVE-DUPLICADA                                   
H P H              SET WS-DUPLICADOS   TO TRUE                                  
H P H              MOVE 'SI'                  TO WS-ROLLBACK                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3027-PROCESA-KRETSNT' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                'DUPLICADO:'             DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H              INTO WS-OUT-DESC                                             
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H            IF WS-WRITE                                                    
H P H              ADD  WC-1                  TO WS-IERR                        
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3027-PROCESA-KRETSNT' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'SIN '                  DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN OTHER                                                         
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                     SET WS-DUPLICADOS   TO TRUE                           
H P H                     MOVE 'SI'                  TO WS-ROLLBACK             
H P H                     MOVE SQLCODE               TO WS-OUT-SQLCODE          
H P H                     MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA           
H P H                     MOVE WS-TABLA-H            TO WS-OUT-TABLA            
H P H                     MOVE '3027-PROCESA-KRETSNT' TO WS-OUT-PARRAFO         
H P H                     STRING                                                
H P H                      'CONTENCIO:'             DELIMITED BY SIZE           
H P H                       WS-CAMPOPOL             DELIMITED BY ' '            
H P H                       '='                     DELIMITED BY SIZE           
H P H                       WS-LEE-CDNUMPOL         DELIMITED BY SIZE           
H P H                       INTO WS-OUT-DESC                                    
H P H                       END-STRING                                          
H P H                     PERFORM 1570-ESCRIBE-DESCARTADA                       
H P H              ELSE                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3027-PROCESA-KRETSNT' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'ERRDB2:'               DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H              MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
H P H              MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
H P H              MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
H P H              MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
H P H              MOVE '3027-PROCESA-KRETSNT  ' TO CDPARRAF OF KAELCWEZ        
H P H                                                                           
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 MOVE 'S' TO SW-911-911                                    
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H              ELSE                                                         
H P H                 PERFORM 9999-GESTION-ERRORES                              
H P H              END-IF                                                       
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                                                                           
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H            SET WS-NO-PARA-INSERT      TO TRUE                             
H P H            IF WS-WRITE                                                    
H P H              ADD  WC-1                  TO WS-IERR                        
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3027-PROCESA-KRETSNT' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'NOHAY '                DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H            EXEC SQL                                                       
H P H                CLOSE CURSOR-27                                            
H P H            END-EXEC                                                       
H P H        WHEN OTHER                                                         
H P H              SET WS-NO-PARA-INSERT      TO TRUE                           
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3027-PROCESA-KRETSNT' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'ERRDB2:'               DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            STRING                                                         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            ' ERROR EN SQL :' W-QUERY-TEXT                    '\N'         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H          MOVE WC-COD                   TO CDERR    OF KAELCWEZ            
H P H          MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ            
H P H          MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ            
H P H          MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ            
H P H          MOVE '3027-PROCESA-KRETSNT  ' TO CDPARRAF OF KAELCWEZ            
H P H                                                                           
H P H          IF SQLCODE = -911                                                
H P H              MOVE 'S' TO SW-911                                           
H P H              MOVE 'S' TO SW-911-911                                       
H P H              ADD 1 TO WS-CANT-ERRORES                                     
H P H          ELSE                                                             
H P H             PERFORM 9999-GESTION-ERRORES                                  
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                 IF  SQLCODE = WN-SQLCODE-OK                               
H P H                 AND WS-PARA-INSERT                                        
H P H      EXEC SQL                                                             
H P H         DELETE FROM KRETSNT                                               
H P H         WHERE CDSINIES = :WS-TBL-SINOREC                                  
H P H      END-EXEC                                                             
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3027-PROCESA-KRETSNT' TO WS-OUT-PARRAFO                
H P H              MOVE 'BORRAR CORRECTO    ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3027-PROCESA-KRETSNT' TO WS-OUT-PARRAFO                
H P H              MOVE 'NO EXISTE BORRAR   ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H              MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
H P H              MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
H P H              MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
H P H              MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
H P H              MOVE '3027-PROCESA-KRETSNT  ' TO CDPARRAF OF KAELCWEZ        
H P H                                                                           
H P H              PERFORM 9999-GESTION-ERRORES                                 
H P H                                                                           
H P H        WHEN OTHER                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3027-PROCESA-KRETSNT' TO WS-OUT-PARRAFO                
H P H              MOVE 'ERR BORRAR DB2     ' TO WS-OUT-DESC                    
H P H              IF SQLCODE  = -911                                           
H P H                 MOVE '3027-PROCESA-KRETSNT'  TO WS-OUT-PARRAFO            
H P H                 MOVE 'CONTENCION TABLA   '   TO WS-OUT-DESC               
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 mOVE 'S' TO SW-911                                        
H P H                 MOVE 'S' TO SW-911-911                                    
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 MOVE 'SI'                  TO WS-ROLLBACK                 
H P H                 MOVE SQLCODE               TO WS-OUT-SQLCODE              
H P H                 MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA               
H P H                 MOVE WS-TABLA-H            TO WS-OUT-TABLA                
H P H                 MOVE '3027-PROCESA-KRETSNT' TO WS-OUT-PARRAFO             
H P H                    STRING                                                 
H P H                   'CONTENCIO:'             DELIMITED BY SIZE              
H P H                    WS-CAMPOPOL             DELIMITED BY ' '               
H P H                    '='                     DELIMITED BY SIZE              
H P H                    WS-LEE-CDNUMPOL         DELIMITED BY SIZE              
H P H                    INTO WS-OUT-DESC                                       
H P H                 END-STRING                                                
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H            STRING                                                         
H P H            'Z8883??????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            'Z8881??????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H              ELSE                                                         
H P H                 MOVE WC-COD              TO CDERR    OF KAELCWEZ          
H P H                 MOVE WC-DES01            TO DSARGU1  OF KAELCWEZ          
H P H                 MOVE WC-PROGRAMA         TO DSARGU2  OF KAELCWEZ          
H P H                 MOVE WS-ERPOLIZA         TO DSARGU3  OF KAELCWEZ          
H P H                 MOVE '3027-PROCESA-KRETSNT'                               
H P H                                          TO CDPARRAF OF KAELCWEZ          
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H                 IF SQLCODE = -911                                         
H P H                    MOVE 'S' TO SW-911                                     
H P H                    MOVE 'S' TO SW-911-911                                 
H P H                    ADD 1 TO WS-CANT-ERRORES                               
H P H                 ELSE                                                      
H P H            STRING                                                         
H P H            'X9999??????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            'X9999??????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H                 PERFORM 9999-GESTION-ERRORES                              
H P H                 END-IF                                                    
H P H              END-IF                                                       
H P H      END-EVALUATE                                                         
H P H                 END-IF                                                    
H P H               END-IF                                                      
H P H              END-IF                                                       
H P H              IF WS-ROLLBACK = 'SI'                                        
H P H                 SET WS-NO-HAY-SINIESTROS TO TRUE                          
H P H                 MOVE 98 TO WS-ITBLS                                       
H P H              END-IF                                                       
H P H              ADD WC-1 TO WS-ITBLS.                                        
H P H *                                                                         
H P H  3028-PROCESA-KSIA04T.                                                    
H P H              MOVE 'KSIA04T'             TO WS-TABLA-T                     
H P H              MOVE 'KSIA04H'             TO WS-TABLA-H                     
H P H *                                                                         
H P H              MOVE 'KSIA04T'             TO WS-TIPO-TABLA                  
H P H              MOVE 'CDSINIES'            TO WS-CAMPOPOL                    
H P H                                                                           
H P H              IF TAB-ESP-SR                                                
H P H               IF WS-SI-HISTORIFICA                                        
H P H                 PERFORM 3300-INSERTA-ESP-SIN                              
H P H               END-IF                                                      
H P H              ELSE                                                         
H P H               IF WS-SI-HISTORIFICA                                        
H P H      EXEC SQL                                                             
H P H         DECLARE CURSOR-28 CURSOR FOR                                      
H P H            SELECT CDSINIES FROM KSIA04T                                   
H P H             WHERE CDSINIES = :WS-TBL-SINOREC                              
H P H             FETCH FIRST 1 ROWS ONLY                                       
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EXEC SQL                                                             
H P H          OPEN CURSOR-28                                                   
H P H      END-EXEC                                                             
H P H      PERFORM 3306-VALIDA-CODIGO                                           
H P H      EXEC SQL                                                             
H P H          FETCH CURSOR-28                                                  
H P H          INTO                                                             
H P H          :WS-SINOREC                                                      
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H             EXEC SQL                                                      
H P H                CLOSE CURSOR-28                                            
H P H             END-EXEC                                                      
H P H             SET WS-PARA-INSERT TO TRUE                                    
H P H      EXEC SQL                                                             
H P H         INSERT INTO KSIA04H                                               
H P H            (SELECT * FROM KSIA04T                                         
H P H             WHERE CDSINIES = :WS-TBL-SINOREC)                             
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3028-PROCESA-KSIA04T' TO WS-OUT-PARRAFO                
H P H              MOVE 'INSERT CORRECTO '    TO WS-OUT-DESC                    
H P H              MOVE WS-TBL-SINOREC        TO WS-OUT-DESC(18:12)             
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-CLAVE-DUPLICADA                                   
H P H              SET WS-DUPLICADOS   TO TRUE                                  
H P H              MOVE 'SI'                  TO WS-ROLLBACK                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3028-PROCESA-KSIA04T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                'DUPLICADO:'             DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H              INTO WS-OUT-DESC                                             
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H            IF WS-WRITE                                                    
H P H              ADD  WC-1                  TO WS-IERR                        
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3028-PROCESA-KSIA04T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'SIN '                  DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN OTHER                                                         
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                     SET WS-DUPLICADOS   TO TRUE                           
H P H                     MOVE 'SI'                  TO WS-ROLLBACK             
H P H                     MOVE SQLCODE               TO WS-OUT-SQLCODE          
H P H                     MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA           
H P H                     MOVE WS-TABLA-H            TO WS-OUT-TABLA            
H P H                     MOVE '3028-PROCESA-KSIA04T' TO WS-OUT-PARRAFO         
H P H                     STRING                                                
H P H                      'CONTENCIO:'             DELIMITED BY SIZE           
H P H                       WS-CAMPOPOL             DELIMITED BY ' '            
H P H                       '='                     DELIMITED BY SIZE           
H P H                       WS-LEE-CDNUMPOL         DELIMITED BY SIZE           
H P H                       INTO WS-OUT-DESC                                    
H P H                       END-STRING                                          
H P H                     PERFORM 1570-ESCRIBE-DESCARTADA                       
H P H              ELSE                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3028-PROCESA-KSIA04T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'ERRDB2:'               DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H              MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
H P H              MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
H P H              MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
H P H              MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
H P H              MOVE '3028-PROCESA-KSIA04T  ' TO CDPARRAF OF KAELCWEZ        
H P H                                                                           
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 MOVE 'S' TO SW-911-911                                    
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H              ELSE                                                         
H P H                 PERFORM 9999-GESTION-ERRORES                              
H P H              END-IF                                                       
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                                                                           
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H            SET WS-NO-PARA-INSERT      TO TRUE                             
H P H            IF WS-WRITE                                                    
H P H              ADD  WC-1                  TO WS-IERR                        
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3028-PROCESA-KSIA04T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'NOHAY '                DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H            EXEC SQL                                                       
H P H                CLOSE CURSOR-28                                            
H P H            END-EXEC                                                       
H P H        WHEN OTHER                                                         
H P H              SET WS-NO-PARA-INSERT      TO TRUE                           
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3028-PROCESA-KSIA04T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'ERRDB2:'               DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            STRING                                                         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            ' ERROR EN SQL :' W-QUERY-TEXT                    '\N'         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H          MOVE WC-COD                   TO CDERR    OF KAELCWEZ            
H P H          MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ            
H P H          MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ            
H P H          MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ            
H P H          MOVE '3028-PROCESA-KSIA04T  ' TO CDPARRAF OF KAELCWEZ            
H P H                                                                           
H P H          IF SQLCODE = -911                                                
H P H              MOVE 'S' TO SW-911                                           
H P H              MOVE 'S' TO SW-911-911                                       
H P H              ADD 1 TO WS-CANT-ERRORES                                     
H P H          ELSE                                                             
H P H             PERFORM 9999-GESTION-ERRORES                                  
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                 IF  SQLCODE = WN-SQLCODE-OK                               
H P H                 AND WS-PARA-INSERT                                        
H P H      EXEC SQL                                                             
H P H         DELETE FROM KSIA04T                                               
H P H         WHERE CDSINIES = :WS-TBL-SINOREC                                  
H P H      END-EXEC                                                             
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3028-PROCESA-KSIA04T' TO WS-OUT-PARRAFO                
H P H              MOVE 'BORRAR CORRECTO    ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3028-PROCESA-KSIA04T' TO WS-OUT-PARRAFO                
H P H              MOVE 'NO EXISTE BORRAR   ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H              MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
H P H              MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
H P H              MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
H P H              MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
H P H              MOVE '3028-PROCESA-KSIA04T  ' TO CDPARRAF OF KAELCWEZ        
H P H                                                                           
H P H              PERFORM 9999-GESTION-ERRORES                                 
H P H                                                                           
H P H        WHEN OTHER                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3028-PROCESA-KSIA04T' TO WS-OUT-PARRAFO                
H P H              MOVE 'ERR BORRAR DB2     ' TO WS-OUT-DESC                    
H P H              IF SQLCODE  = -911                                           
H P H                 MOVE '3028-PROCESA-KSIA04T'  TO WS-OUT-PARRAFO            
H P H                 MOVE 'CONTENCION TABLA   '   TO WS-OUT-DESC               
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 mOVE 'S' TO SW-911                                        
H P H                 MOVE 'S' TO SW-911-911                                    
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 MOVE 'SI'                  TO WS-ROLLBACK                 
H P H                 MOVE SQLCODE               TO WS-OUT-SQLCODE              
H P H                 MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA               
H P H                 MOVE WS-TABLA-H            TO WS-OUT-TABLA                
H P H                 MOVE '3028-PROCESA-KSIA04T' TO WS-OUT-PARRAFO             
H P H                    STRING                                                 
H P H                   'CONTENCIO:'             DELIMITED BY SIZE              
H P H                    WS-CAMPOPOL             DELIMITED BY ' '               
H P H                    '='                     DELIMITED BY SIZE              
H P H                    WS-LEE-CDNUMPOL         DELIMITED BY SIZE              
H P H                    INTO WS-OUT-DESC                                       
H P H                 END-STRING                                                
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H            STRING                                                         
H P H            'Z8883??????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            'Z8881??????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H              ELSE                                                         
H P H                 MOVE WC-COD              TO CDERR    OF KAELCWEZ          
H P H                 MOVE WC-DES01            TO DSARGU1  OF KAELCWEZ          
H P H                 MOVE WC-PROGRAMA         TO DSARGU2  OF KAELCWEZ          
H P H                 MOVE WS-ERPOLIZA         TO DSARGU3  OF KAELCWEZ          
H P H                 MOVE '3028-PROCESA-KSIA04T'                               
H P H                                          TO CDPARRAF OF KAELCWEZ          
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H                 IF SQLCODE = -911                                         
H P H                    MOVE 'S' TO SW-911                                     
H P H                    MOVE 'S' TO SW-911-911                                 
H P H                    ADD 1 TO WS-CANT-ERRORES                               
H P H                 ELSE                                                      
H P H            STRING                                                         
H P H            'X9999??????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            'X9999??????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H                 PERFORM 9999-GESTION-ERRORES                              
H P H                 END-IF                                                    
H P H              END-IF                                                       
H P H      END-EVALUATE                                                         
H P H                 END-IF                                                    
H P H               END-IF                                                      
H P H              END-IF                                                       
H P H              IF WS-ROLLBACK = 'SI'                                        
H P H                 SET WS-NO-HAY-SINIESTROS TO TRUE                          
H P H                 MOVE 98 TO WS-ITBLS                                       
H P H              END-IF                                                       
H P H              ADD WC-1 TO WS-ITBLS.                                        
H P H *                                                                         
H P H  3029-PROCESA-KSIA12T.                                                    
H P H              MOVE 'KSIA12T'             TO WS-TABLA-T                     
H P H              MOVE 'KSIA12H'             TO WS-TABLA-H                     
H P H *                                                                         
H P H              MOVE 'KSIA12T'             TO WS-TIPO-TABLA                  
H P H              MOVE 'CDSINIES'            TO WS-CAMPOPOL                    
H P H                                                                           
H P H              IF TAB-ESP-SR                                                
H P H               IF WS-SI-HISTORIFICA                                        
H P H                 PERFORM 3300-INSERTA-ESP-SIN                              
H P H               END-IF                                                      
H P H              ELSE                                                         
H P H               IF WS-SI-HISTORIFICA                                        
H P H      EXEC SQL                                                             
H P H         DECLARE CURSOR-29 CURSOR FOR                                      
H P H            SELECT CDSINIES FROM KSIA12T                                   
H P H             WHERE CDSINIES = :WS-TBL-SINOREC                              
H P H             FETCH FIRST 1 ROWS ONLY                                       
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EXEC SQL                                                             
H P H          OPEN CURSOR-29                                                   
H P H      END-EXEC                                                             
H P H      PERFORM 3306-VALIDA-CODIGO                                           
H P H      EXEC SQL                                                             
H P H          FETCH CURSOR-29                                                  
H P H          INTO                                                             
H P H          :WS-SINOREC                                                      
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H             EXEC SQL                                                      
H P H                CLOSE CURSOR-29                                            
H P H             END-EXEC                                                      
H P H             SET WS-PARA-INSERT TO TRUE                                    
H P H      EXEC SQL                                                             
H P H         INSERT INTO KSIA12H                                               
H P H            (SELECT * FROM KSIA12T                                         
H P H             WHERE CDSINIES = :WS-TBL-SINOREC)                             
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3029-PROCESA-KSIA12T' TO WS-OUT-PARRAFO                
H P H              MOVE 'INSERT CORRECTO '    TO WS-OUT-DESC                    
H P H              MOVE WS-TBL-SINOREC        TO WS-OUT-DESC(18:12)             
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-CLAVE-DUPLICADA                                   
H P H              SET WS-DUPLICADOS   TO TRUE                                  
H P H              MOVE 'SI'                  TO WS-ROLLBACK                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3029-PROCESA-KSIA12T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                'DUPLICADO:'             DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H              INTO WS-OUT-DESC                                             
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H            IF WS-WRITE                                                    
H P H              ADD  WC-1                  TO WS-IERR                        
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3029-PROCESA-KSIA12T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'SIN '                  DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN OTHER                                                         
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                     SET WS-DUPLICADOS   TO TRUE                           
H P H                     MOVE 'SI'                  TO WS-ROLLBACK             
H P H                     MOVE SQLCODE               TO WS-OUT-SQLCODE          
H P H                     MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA           
H P H                     MOVE WS-TABLA-H            TO WS-OUT-TABLA            
H P H                     MOVE '3029-PROCESA-KSIA12T' TO WS-OUT-PARRAFO         
H P H                     STRING                                                
H P H                      'CONTENCIO:'             DELIMITED BY SIZE           
H P H                       WS-CAMPOPOL             DELIMITED BY ' '            
H P H                       '='                     DELIMITED BY SIZE           
H P H                       WS-LEE-CDNUMPOL         DELIMITED BY SIZE           
H P H                       INTO WS-OUT-DESC                                    
H P H                       END-STRING                                          
H P H                     PERFORM 1570-ESCRIBE-DESCARTADA                       
H P H              ELSE                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3029-PROCESA-KSIA12T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'ERRDB2:'               DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H              MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
H P H              MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
H P H              MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
H P H              MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
H P H              MOVE '3029-PROCESA-KSIA12T  ' TO CDPARRAF OF KAELCWEZ        
H P H                                                                           
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 MOVE 'S' TO SW-911-911                                    
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H              ELSE                                                         
H P H                 PERFORM 9999-GESTION-ERRORES                              
H P H              END-IF                                                       
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                                                                           
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H            SET WS-NO-PARA-INSERT      TO TRUE                             
H P H            IF WS-WRITE                                                    
H P H              ADD  WC-1                  TO WS-IERR                        
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3029-PROCESA-KSIA12T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'NOHAY '                DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H            EXEC SQL                                                       
H P H                CLOSE CURSOR-29                                            
H P H            END-EXEC                                                       
H P H        WHEN OTHER                                                         
H P H              SET WS-NO-PARA-INSERT      TO TRUE                           
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3029-PROCESA-KSIA12T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'ERRDB2:'               DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            STRING                                                         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            ' ERROR EN SQL :' W-QUERY-TEXT                    '\N'         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H          MOVE WC-COD                   TO CDERR    OF KAELCWEZ            
H P H          MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ            
H P H          MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ            
H P H          MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ            
H P H          MOVE '3029-PROCESA-KSIA12T  ' TO CDPARRAF OF KAELCWEZ            
H P H                                                                           
H P H          IF SQLCODE = -911                                                
H P H              MOVE 'S' TO SW-911                                           
H P H              MOVE 'S' TO SW-911-911                                       
H P H              ADD 1 TO WS-CANT-ERRORES                                     
H P H          ELSE                                                             
H P H             PERFORM 9999-GESTION-ERRORES                                  
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                 IF  SQLCODE = WN-SQLCODE-OK                               
H P H                 AND WS-PARA-INSERT                                        
H P H      EXEC SQL                                                             
H P H         DELETE FROM KSIA12T                                               
H P H         WHERE CDSINIES = :WS-TBL-SINOREC                                  
H P H      END-EXEC                                                             
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3029-PROCESA-KSIA12T' TO WS-OUT-PARRAFO                
H P H              MOVE 'BORRAR CORRECTO    ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3029-PROCESA-KSIA12T' TO WS-OUT-PARRAFO                
H P H              MOVE 'NO EXISTE BORRAR   ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H              MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
H P H              MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
H P H              MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
H P H              MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
H P H              MOVE '3029-PROCESA-KSIA12T  ' TO CDPARRAF OF KAELCWEZ        
H P H                                                                           
H P H              PERFORM 9999-GESTION-ERRORES                                 
H P H                                                                           
H P H        WHEN OTHER                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3029-PROCESA-KSIA12T' TO WS-OUT-PARRAFO                
H P H              MOVE 'ERR BORRAR DB2     ' TO WS-OUT-DESC                    
H P H              IF SQLCODE  = -911                                           
H P H                 MOVE '3029-PROCESA-KSIA12T'  TO WS-OUT-PARRAFO            
H P H                 MOVE 'CONTENCION TABLA   '   TO WS-OUT-DESC               
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 mOVE 'S' TO SW-911                                        
H P H                 MOVE 'S' TO SW-911-911                                    
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 MOVE 'SI'                  TO WS-ROLLBACK                 
H P H                 MOVE SQLCODE               TO WS-OUT-SQLCODE              
H P H                 MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA               
H P H                 MOVE WS-TABLA-H            TO WS-OUT-TABLA                
H P H                 MOVE '3029-PROCESA-KSIA12T' TO WS-OUT-PARRAFO             
H P H                    STRING                                                 
H P H                   'CONTENCIO:'             DELIMITED BY SIZE              
H P H                    WS-CAMPOPOL             DELIMITED BY ' '               
H P H                    '='                     DELIMITED BY SIZE              
H P H                    WS-LEE-CDNUMPOL         DELIMITED BY SIZE              
H P H                    INTO WS-OUT-DESC                                       
H P H                 END-STRING                                                
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H            STRING                                                         
H P H            'Z8883??????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            'Z8881??????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H              ELSE                                                         
H P H                 MOVE WC-COD              TO CDERR    OF KAELCWEZ          
H P H                 MOVE WC-DES01            TO DSARGU1  OF KAELCWEZ          
H P H                 MOVE WC-PROGRAMA         TO DSARGU2  OF KAELCWEZ          
H P H                 MOVE WS-ERPOLIZA         TO DSARGU3  OF KAELCWEZ          
H P H                 MOVE '3029-PROCESA-KSIA12T'                               
H P H                                          TO CDPARRAF OF KAELCWEZ          
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H                 IF SQLCODE = -911                                         
H P H                    MOVE 'S' TO SW-911                                     
H P H                    MOVE 'S' TO SW-911-911                                 
H P H                    ADD 1 TO WS-CANT-ERRORES                               
H P H                 ELSE                                                      
H P H            STRING                                                         
H P H            'X9999??????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            'X9999??????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H                 PERFORM 9999-GESTION-ERRORES                              
H P H                 END-IF                                                    
H P H              END-IF                                                       
H P H      END-EVALUATE                                                         
H P H                 END-IF                                                    
H P H               END-IF                                                      
H P H              END-IF                                                       
H P H              IF WS-ROLLBACK = 'SI'                                        
H P H                 SET WS-NO-HAY-SINIESTROS TO TRUE                          
H P H                 MOVE 98 TO WS-ITBLS                                       
H P H              END-IF                                                       
H P H              ADD WC-1 TO WS-ITBLS.                                        
H P H *                                                                         
H P H  3030-PROCESA-KSIA1BT.                                                    
H P H              MOVE 'KSIA1BT'             TO WS-TABLA-T                     
H P H              MOVE 'KSIA1BH'             TO WS-TABLA-H                     
H P H *                                                                         
H P H              MOVE 'KSIA1BT'             TO WS-TIPO-TABLA                  
H P H              MOVE 'CDSINIES'            TO WS-CAMPOPOL                    
H P H                                                                           
H P H              IF TAB-ESP-SR                                                
H P H               IF WS-SI-HISTORIFICA                                        
H P H                 PERFORM 3300-INSERTA-ESP-SIN                              
H P H               END-IF                                                      
H P H              ELSE                                                         
H P H               IF WS-SI-HISTORIFICA                                        
H P H      EXEC SQL                                                             
H P H         DECLARE CURSOR-30 CURSOR FOR                                      
H P H            SELECT CDSINIES FROM KSIA1BT                                   
H P H             WHERE CDSINIES = :WS-TBL-SINOREC                              
H P H             FETCH FIRST 1 ROWS ONLY                                       
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EXEC SQL                                                             
H P H          OPEN CURSOR-30                                                   
H P H      END-EXEC                                                             
H P H      PERFORM 3306-VALIDA-CODIGO                                           
H P H      EXEC SQL                                                             
H P H          FETCH CURSOR-30                                                  
H P H          INTO                                                             
H P H          :WS-SINOREC                                                      
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H             EXEC SQL                                                      
H P H                CLOSE CURSOR-30                                            
H P H             END-EXEC                                                      
H P H             SET WS-PARA-INSERT TO TRUE                                    
H P H      EXEC SQL                                                             
H P H         INSERT INTO KSIA1BH                                               
H P H            (SELECT * FROM KSIA1BT                                         
H P H             WHERE CDSINIES = :WS-TBL-SINOREC)                             
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3030-PROCESA-KSIA1BT' TO WS-OUT-PARRAFO                
H P H              MOVE 'INSERT CORRECTO '    TO WS-OUT-DESC                    
H P H              MOVE WS-TBL-SINOREC        TO WS-OUT-DESC(18:12)             
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-CLAVE-DUPLICADA                                   
H P H              SET WS-DUPLICADOS   TO TRUE                                  
H P H              MOVE 'SI'                  TO WS-ROLLBACK                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3030-PROCESA-KSIA1BT' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                'DUPLICADO:'             DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H              INTO WS-OUT-DESC                                             
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H            IF WS-WRITE                                                    
H P H              ADD  WC-1                  TO WS-IERR                        
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3030-PROCESA-KSIA1BT' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'SIN '                  DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN OTHER                                                         
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                     SET WS-DUPLICADOS   TO TRUE                           
H P H                     MOVE 'SI'                  TO WS-ROLLBACK             
H P H                     MOVE SQLCODE               TO WS-OUT-SQLCODE          
H P H                     MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA           
H P H                     MOVE WS-TABLA-H            TO WS-OUT-TABLA            
H P H                     MOVE '3030-PROCESA-KSIA1BT' TO WS-OUT-PARRAFO         
H P H                     STRING                                                
H P H                      'CONTENCIO:'             DELIMITED BY SIZE           
H P H                       WS-CAMPOPOL             DELIMITED BY ' '            
H P H                       '='                     DELIMITED BY SIZE           
H P H                       WS-LEE-CDNUMPOL         DELIMITED BY SIZE           
H P H                       INTO WS-OUT-DESC                                    
H P H                       END-STRING                                          
H P H                     PERFORM 1570-ESCRIBE-DESCARTADA                       
H P H              ELSE                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3030-PROCESA-KSIA1BT' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'ERRDB2:'               DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H              MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
H P H              MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
H P H              MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
H P H              MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
H P H              MOVE '3030-PROCESA-KSIA1BT  ' TO CDPARRAF OF KAELCWEZ        
H P H                                                                           
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 MOVE 'S' TO SW-911-911                                    
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H              ELSE                                                         
H P H                 PERFORM 9999-GESTION-ERRORES                              
H P H              END-IF                                                       
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                                                                           
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H            SET WS-NO-PARA-INSERT      TO TRUE                             
H P H            IF WS-WRITE                                                    
H P H              ADD  WC-1                  TO WS-IERR                        
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3030-PROCESA-KSIA1BT' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'NOHAY '                DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H            EXEC SQL                                                       
H P H                CLOSE CURSOR-30                                            
H P H            END-EXEC                                                       
H P H        WHEN OTHER                                                         
H P H              SET WS-NO-PARA-INSERT      TO TRUE                           
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3030-PROCESA-KSIA1BT' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'ERRDB2:'               DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            STRING                                                         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            ' ERROR EN SQL :' W-QUERY-TEXT                    '\N'         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H          MOVE WC-COD                   TO CDERR    OF KAELCWEZ            
H P H          MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ            
H P H          MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ            
H P H          MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ            
H P H          MOVE '3030-PROCESA-KSIA1BT  ' TO CDPARRAF OF KAELCWEZ            
H P H                                                                           
H P H          IF SQLCODE = -911                                                
H P H              MOVE 'S' TO SW-911                                           
H P H              MOVE 'S' TO SW-911-911                                       
H P H              ADD 1 TO WS-CANT-ERRORES                                     
H P H          ELSE                                                             
H P H             PERFORM 9999-GESTION-ERRORES                                  
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                 IF  SQLCODE = WN-SQLCODE-OK                               
H P H                 AND WS-PARA-INSERT                                        
H P H      EXEC SQL                                                             
H P H         DELETE FROM KSIA1BT                                               
H P H         WHERE CDSINIES = :WS-TBL-SINOREC                                  
H P H      END-EXEC                                                             
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3030-PROCESA-KSIA1BT' TO WS-OUT-PARRAFO                
H P H              MOVE 'BORRAR CORRECTO    ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3030-PROCESA-KSIA1BT' TO WS-OUT-PARRAFO                
H P H              MOVE 'NO EXISTE BORRAR   ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H              MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
H P H              MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
H P H              MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
H P H              MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
H P H              MOVE '3030-PROCESA-KSIA1BT  ' TO CDPARRAF OF KAELCWEZ        
H P H                                                                           
H P H              PERFORM 9999-GESTION-ERRORES                                 
H P H                                                                           
H P H        WHEN OTHER                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3030-PROCESA-KSIA1BT' TO WS-OUT-PARRAFO                
H P H              MOVE 'ERR BORRAR DB2     ' TO WS-OUT-DESC                    
H P H              IF SQLCODE  = -911                                           
H P H                 MOVE '3030-PROCESA-KSIA1BT'  TO WS-OUT-PARRAFO            
H P H                 MOVE 'CONTENCION TABLA   '   TO WS-OUT-DESC               
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 mOVE 'S' TO SW-911                                        
H P H                 MOVE 'S' TO SW-911-911                                    
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 MOVE 'SI'                  TO WS-ROLLBACK                 
H P H                 MOVE SQLCODE               TO WS-OUT-SQLCODE              
H P H                 MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA               
H P H                 MOVE WS-TABLA-H            TO WS-OUT-TABLA                
H P H                 MOVE '3030-PROCESA-KSIA1BT' TO WS-OUT-PARRAFO             
H P H                    STRING                                                 
H P H                   'CONTENCIO:'             DELIMITED BY SIZE              
H P H                    WS-CAMPOPOL             DELIMITED BY ' '               
H P H                    '='                     DELIMITED BY SIZE              
H P H                    WS-LEE-CDNUMPOL         DELIMITED BY SIZE              
H P H                    INTO WS-OUT-DESC                                       
H P H                 END-STRING                                                
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H            STRING                                                         
H P H            'Z8883??????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            'Z8881??????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H              ELSE                                                         
H P H                 MOVE WC-COD              TO CDERR    OF KAELCWEZ          
H P H                 MOVE WC-DES01            TO DSARGU1  OF KAELCWEZ          
H P H                 MOVE WC-PROGRAMA         TO DSARGU2  OF KAELCWEZ          
H P H                 MOVE WS-ERPOLIZA         TO DSARGU3  OF KAELCWEZ          
H P H                 MOVE '3030-PROCESA-KSIA1BT'                               
H P H                                          TO CDPARRAF OF KAELCWEZ          
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H                 IF SQLCODE = -911                                         
H P H                    MOVE 'S' TO SW-911                                     
H P H                    MOVE 'S' TO SW-911-911                                 
H P H                    ADD 1 TO WS-CANT-ERRORES                               
H P H                 ELSE                                                      
H P H            STRING                                                         
H P H            'X9999??????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            'X9999??????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H                 PERFORM 9999-GESTION-ERRORES                              
H P H                 END-IF                                                    
H P H              END-IF                                                       
H P H      END-EVALUATE                                                         
H P H                 END-IF                                                    
H P H               END-IF                                                      
H P H              END-IF                                                       
H P H              IF WS-ROLLBACK = 'SI'                                        
H P H                 SET WS-NO-HAY-SINIESTROS TO TRUE                          
H P H                 MOVE 98 TO WS-ITBLS                                       
H P H              END-IF                                                       
H P H              ADD WC-1 TO WS-ITBLS.                                        
H P H *                                                                         
H P H  3031-PROCESA-KSIA22T.                                                    
H P H              MOVE 'KSIA22T'             TO WS-TABLA-T                     
H P H              MOVE 'KSIA22H'             TO WS-TABLA-H                     
H P H *                                                                         
H P H              MOVE 'KSIA22T'             TO WS-TIPO-TABLA                  
H P H              MOVE 'CDSINIES'            TO WS-CAMPOPOL                    
H P H                                                                           
H P H              IF TAB-ESP-SR                                                
H P H               IF WS-SI-HISTORIFICA                                        
H P H                 PERFORM 3300-INSERTA-ESP-SIN                              
H P H               END-IF                                                      
H P H              ELSE                                                         
H P H               IF WS-SI-HISTORIFICA                                        
H P H      EXEC SQL                                                             
H P H         DECLARE CURSOR-31 CURSOR FOR                                      
H P H            SELECT CDSINIES FROM KSIA22T                                   
H P H             WHERE CDSINIES = :WS-TBL-SINOREC                              
H P H             FETCH FIRST 1 ROWS ONLY                                       
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EXEC SQL                                                             
H P H          OPEN CURSOR-31                                                   
H P H      END-EXEC                                                             
H P H      PERFORM 3306-VALIDA-CODIGO                                           
H P H      EXEC SQL                                                             
H P H          FETCH CURSOR-31                                                  
H P H          INTO                                                             
H P H          :WS-SINOREC                                                      
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H             EXEC SQL                                                      
H P H                CLOSE CURSOR-31                                            
H P H             END-EXEC                                                      
H P H             SET WS-PARA-INSERT TO TRUE                                    
H P H      EXEC SQL                                                             
H P H         INSERT INTO KSIA22H                                               
H P H            (SELECT * FROM KSIA22T                                         
H P H             WHERE CDSINIES = :WS-TBL-SINOREC)                             
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3031-PROCESA-KSIA22T' TO WS-OUT-PARRAFO                
H P H              MOVE 'INSERT CORRECTO '    TO WS-OUT-DESC                    
H P H              MOVE WS-TBL-SINOREC        TO WS-OUT-DESC(18:12)             
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-CLAVE-DUPLICADA                                   
H P H              SET WS-DUPLICADOS   TO TRUE                                  
H P H              MOVE 'SI'                  TO WS-ROLLBACK                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3031-PROCESA-KSIA22T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                'DUPLICADO:'             DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H              INTO WS-OUT-DESC                                             
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H            IF WS-WRITE                                                    
H P H              ADD  WC-1                  TO WS-IERR                        
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3031-PROCESA-KSIA22T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'SIN '                  DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN OTHER                                                         
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                     SET WS-DUPLICADOS   TO TRUE                           
H P H                     MOVE 'SI'                  TO WS-ROLLBACK             
H P H                     MOVE SQLCODE               TO WS-OUT-SQLCODE          
H P H                     MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA           
H P H                     MOVE WS-TABLA-H            TO WS-OUT-TABLA            
H P H                     MOVE '3031-PROCESA-KSIA22T' TO WS-OUT-PARRAFO         
H P H                     STRING                                                
H P H                      'CONTENCIO:'             DELIMITED BY SIZE           
H P H                       WS-CAMPOPOL             DELIMITED BY ' '            
H P H                       '='                     DELIMITED BY SIZE           
H P H                       WS-LEE-CDNUMPOL         DELIMITED BY SIZE           
H P H                       INTO WS-OUT-DESC                                    
H P H                       END-STRING                                          
H P H                     PERFORM 1570-ESCRIBE-DESCARTADA                       
H P H              ELSE                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3031-PROCESA-KSIA22T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'ERRDB2:'               DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H              MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
H P H              MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
H P H              MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
H P H              MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
H P H              MOVE '3031-PROCESA-KSIA22T  ' TO CDPARRAF OF KAELCWEZ        
H P H                                                                           
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 MOVE 'S' TO SW-911-911                                    
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H              ELSE                                                         
H P H                 PERFORM 9999-GESTION-ERRORES                              
H P H              END-IF                                                       
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                                                                           
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H            SET WS-NO-PARA-INSERT      TO TRUE                             
H P H            IF WS-WRITE                                                    
H P H              ADD  WC-1                  TO WS-IERR                        
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3031-PROCESA-KSIA22T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'NOHAY '                DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H            EXEC SQL                                                       
H P H                CLOSE CURSOR-31                                            
H P H            END-EXEC                                                       
H P H        WHEN OTHER                                                         
H P H              SET WS-NO-PARA-INSERT      TO TRUE                           
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3031-PROCESA-KSIA22T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'ERRDB2:'               DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            STRING                                                         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            ' ERROR EN SQL :' W-QUERY-TEXT                    '\N'         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H          MOVE WC-COD                   TO CDERR    OF KAELCWEZ            
H P H          MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ            
H P H          MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ            
H P H          MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ            
H P H          MOVE '3031-PROCESA-KSIA22T  ' TO CDPARRAF OF KAELCWEZ            
H P H                                                                           
H P H          IF SQLCODE = -911                                                
H P H              MOVE 'S' TO SW-911                                           
H P H              MOVE 'S' TO SW-911-911                                       
H P H              ADD 1 TO WS-CANT-ERRORES                                     
H P H          ELSE                                                             
H P H             PERFORM 9999-GESTION-ERRORES                                  
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                 IF  SQLCODE = WN-SQLCODE-OK                               
H P H                 AND WS-PARA-INSERT                                        
H P H      EXEC SQL                                                             
H P H         DELETE FROM KSIA22T                                               
H P H         WHERE CDSINIES = :WS-TBL-SINOREC                                  
H P H      END-EXEC                                                             
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3031-PROCESA-KSIA22T' TO WS-OUT-PARRAFO                
H P H              MOVE 'BORRAR CORRECTO    ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3031-PROCESA-KSIA22T' TO WS-OUT-PARRAFO                
H P H              MOVE 'NO EXISTE BORRAR   ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H              MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
H P H              MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
H P H              MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
H P H              MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
H P H              MOVE '3031-PROCESA-KSIA22T  ' TO CDPARRAF OF KAELCWEZ        
H P H                                                                           
H P H              PERFORM 9999-GESTION-ERRORES                                 
H P H                                                                           
H P H        WHEN OTHER                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3031-PROCESA-KSIA22T' TO WS-OUT-PARRAFO                
H P H              MOVE 'ERR BORRAR DB2     ' TO WS-OUT-DESC                    
H P H              IF SQLCODE  = -911                                           
H P H                 MOVE '3031-PROCESA-KSIA22T'  TO WS-OUT-PARRAFO            
H P H                 MOVE 'CONTENCION TABLA   '   TO WS-OUT-DESC               
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 mOVE 'S' TO SW-911                                        
H P H                 MOVE 'S' TO SW-911-911                                    
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 MOVE 'SI'                  TO WS-ROLLBACK                 
H P H                 MOVE SQLCODE               TO WS-OUT-SQLCODE              
H P H                 MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA               
H P H                 MOVE WS-TABLA-H            TO WS-OUT-TABLA                
H P H                 MOVE '3031-PROCESA-KSIA22T' TO WS-OUT-PARRAFO             
H P H                    STRING                                                 
H P H                   'CONTENCIO:'             DELIMITED BY SIZE              
H P H                    WS-CAMPOPOL             DELIMITED BY ' '               
H P H                    '='                     DELIMITED BY SIZE              
H P H                    WS-LEE-CDNUMPOL         DELIMITED BY SIZE              
H P H                    INTO WS-OUT-DESC                                       
H P H                 END-STRING                                                
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H            STRING                                                         
H P H            'Z8883??????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            'Z8881??????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H              ELSE                                                         
H P H                 MOVE WC-COD              TO CDERR    OF KAELCWEZ          
H P H                 MOVE WC-DES01            TO DSARGU1  OF KAELCWEZ          
H P H                 MOVE WC-PROGRAMA         TO DSARGU2  OF KAELCWEZ          
H P H                 MOVE WS-ERPOLIZA         TO DSARGU3  OF KAELCWEZ          
H P H                 MOVE '3031-PROCESA-KSIA22T'                               
H P H                                          TO CDPARRAF OF KAELCWEZ          
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H                 IF SQLCODE = -911                                         
H P H                    MOVE 'S' TO SW-911                                     
H P H                    MOVE 'S' TO SW-911-911                                 
H P H                    ADD 1 TO WS-CANT-ERRORES                               
H P H                 ELSE                                                      
H P H            STRING                                                         
H P H            'X9999??????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            'X9999??????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H                 PERFORM 9999-GESTION-ERRORES                              
H P H                 END-IF                                                    
H P H              END-IF                                                       
H P H      END-EVALUATE                                                         
H P H                 END-IF                                                    
H P H               END-IF                                                      
H P H              END-IF                                                       
H P H              IF WS-ROLLBACK = 'SI'                                        
H P H                 SET WS-NO-HAY-SINIESTROS TO TRUE                          
H P H                 MOVE 98 TO WS-ITBLS                                       
H P H              END-IF                                                       
H P H              ADD WC-1 TO WS-ITBLS.                                        
H P H *                                                                         
H P H  3032-PROCESA-KSIA24T.                                                    
H P H              MOVE 'KSIA24T'             TO WS-TABLA-T                     
H P H              MOVE 'KSIA24H'             TO WS-TABLA-H                     
H P H *                                                                         
H P H              MOVE 'KSIA24T'             TO WS-TIPO-TABLA                  
H P H              MOVE 'CDSINIES'            TO WS-CAMPOPOL                    
H P H                                                                           
H P H              IF TAB-ESP-SR                                                
H P H               IF WS-SI-HISTORIFICA                                        
H P H                 PERFORM 3300-INSERTA-ESP-SIN                              
H P H               END-IF                                                      
H P H              ELSE                                                         
H P H               IF WS-SI-HISTORIFICA                                        
H P H      EXEC SQL                                                             
H P H         DECLARE CURSOR-32 CURSOR FOR                                      
H P H            SELECT CDSINIES FROM KSIA24T                                   
H P H             WHERE CDSINIES = :WS-TBL-SINOREC                              
H P H             FETCH FIRST 1 ROWS ONLY                                       
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EXEC SQL                                                             
H P H          OPEN CURSOR-32                                                   
H P H      END-EXEC                                                             
H P H      PERFORM 3306-VALIDA-CODIGO                                           
H P H      EXEC SQL                                                             
H P H          FETCH CURSOR-32                                                  
H P H          INTO                                                             
H P H          :WS-SINOREC                                                      
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H             EXEC SQL                                                      
H P H                CLOSE CURSOR-32                                            
H P H             END-EXEC                                                      
H P H             SET WS-PARA-INSERT TO TRUE                                    
H P H      EXEC SQL                                                             
H P H         INSERT INTO KSIA24H                                               
H P H            (SELECT * FROM KSIA24T                                         
H P H             WHERE CDSINIES = :WS-TBL-SINOREC)                             
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3032-PROCESA-KSIA24T' TO WS-OUT-PARRAFO                
H P H              MOVE 'INSERT CORRECTO '    TO WS-OUT-DESC                    
H P H              MOVE WS-TBL-SINOREC        TO WS-OUT-DESC(18:12)             
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-CLAVE-DUPLICADA                                   
H P H              SET WS-DUPLICADOS   TO TRUE                                  
H P H              MOVE 'SI'                  TO WS-ROLLBACK                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3032-PROCESA-KSIA24T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                'DUPLICADO:'             DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H              INTO WS-OUT-DESC                                             
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H            IF WS-WRITE                                                    
H P H              ADD  WC-1                  TO WS-IERR                        
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3032-PROCESA-KSIA24T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'SIN '                  DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN OTHER                                                         
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                     SET WS-DUPLICADOS   TO TRUE                           
H P H                     MOVE 'SI'                  TO WS-ROLLBACK             
H P H                     MOVE SQLCODE               TO WS-OUT-SQLCODE          
H P H                     MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA           
H P H                     MOVE WS-TABLA-H            TO WS-OUT-TABLA            
H P H                     MOVE '3032-PROCESA-KSIA24T' TO WS-OUT-PARRAFO         
H P H                     STRING                                                
H P H                      'CONTENCIO:'             DELIMITED BY SIZE           
H P H                       WS-CAMPOPOL             DELIMITED BY ' '            
H P H                       '='                     DELIMITED BY SIZE           
H P H                       WS-LEE-CDNUMPOL         DELIMITED BY SIZE           
H P H                       INTO WS-OUT-DESC                                    
H P H                       END-STRING                                          
H P H                     PERFORM 1570-ESCRIBE-DESCARTADA                       
H P H              ELSE                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3032-PROCESA-KSIA24T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'ERRDB2:'               DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H              MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
H P H              MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
H P H              MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
H P H              MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
H P H              MOVE '3032-PROCESA-KSIA24T  ' TO CDPARRAF OF KAELCWEZ        
H P H                                                                           
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 MOVE 'S' TO SW-911-911                                    
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H              ELSE                                                         
H P H                 PERFORM 9999-GESTION-ERRORES                              
H P H              END-IF                                                       
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                                                                           
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H            SET WS-NO-PARA-INSERT      TO TRUE                             
H P H            IF WS-WRITE                                                    
H P H              ADD  WC-1                  TO WS-IERR                        
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3032-PROCESA-KSIA24T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'NOHAY '                DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H            EXEC SQL                                                       
H P H                CLOSE CURSOR-32                                            
H P H            END-EXEC                                                       
H P H        WHEN OTHER                                                         
H P H              SET WS-NO-PARA-INSERT      TO TRUE                           
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3032-PROCESA-KSIA24T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'ERRDB2:'               DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            STRING                                                         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            ' ERROR EN SQL :' W-QUERY-TEXT                    '\N'         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H          MOVE WC-COD                   TO CDERR    OF KAELCWEZ            
H P H          MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ            
H P H          MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ            
H P H          MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ            
H P H          MOVE '3032-PROCESA-KSIA24T  ' TO CDPARRAF OF KAELCWEZ            
H P H                                                                           
H P H          IF SQLCODE = -911                                                
H P H              MOVE 'S' TO SW-911                                           
H P H              MOVE 'S' TO SW-911-911                                       
H P H              ADD 1 TO WS-CANT-ERRORES                                     
H P H          ELSE                                                             
H P H             PERFORM 9999-GESTION-ERRORES                                  
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                 IF  SQLCODE = WN-SQLCODE-OK                               
H P H                 AND WS-PARA-INSERT                                        
H P H      EXEC SQL                                                             
H P H         DELETE FROM KSIA24T                                               
H P H         WHERE CDSINIES = :WS-TBL-SINOREC                                  
H P H      END-EXEC                                                             
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3032-PROCESA-KSIA24T' TO WS-OUT-PARRAFO                
H P H              MOVE 'BORRAR CORRECTO    ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3032-PROCESA-KSIA24T' TO WS-OUT-PARRAFO                
H P H              MOVE 'NO EXISTE BORRAR   ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H              MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
H P H              MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
H P H              MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
H P H              MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
H P H              MOVE '3032-PROCESA-KSIA24T  ' TO CDPARRAF OF KAELCWEZ        
H P H                                                                           
H P H              PERFORM 9999-GESTION-ERRORES                                 
H P H                                                                           
H P H        WHEN OTHER                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3032-PROCESA-KSIA24T' TO WS-OUT-PARRAFO                
H P H              MOVE 'ERR BORRAR DB2     ' TO WS-OUT-DESC                    
H P H              IF SQLCODE  = -911                                           
H P H                 MOVE '3032-PROCESA-KSIA24T'  TO WS-OUT-PARRAFO            
H P H                 MOVE 'CONTENCION TABLA   '   TO WS-OUT-DESC               
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 mOVE 'S' TO SW-911                                        
H P H                 MOVE 'S' TO SW-911-911                                    
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 MOVE 'SI'                  TO WS-ROLLBACK                 
H P H                 MOVE SQLCODE               TO WS-OUT-SQLCODE              
H P H                 MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA               
H P H                 MOVE WS-TABLA-H            TO WS-OUT-TABLA                
H P H                 MOVE '3032-PROCESA-KSIA24T' TO WS-OUT-PARRAFO             
H P H                    STRING                                                 
H P H                   'CONTENCIO:'             DELIMITED BY SIZE              
H P H                    WS-CAMPOPOL             DELIMITED BY ' '               
H P H                    '='                     DELIMITED BY SIZE              
H P H                    WS-LEE-CDNUMPOL         DELIMITED BY SIZE              
H P H                    INTO WS-OUT-DESC                                       
H P H                 END-STRING                                                
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H            STRING                                                         
H P H            'Z8883??????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            'Z8881??????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H              ELSE                                                         
H P H                 MOVE WC-COD              TO CDERR    OF KAELCWEZ          
H P H                 MOVE WC-DES01            TO DSARGU1  OF KAELCWEZ          
H P H                 MOVE WC-PROGRAMA         TO DSARGU2  OF KAELCWEZ          
H P H                 MOVE WS-ERPOLIZA         TO DSARGU3  OF KAELCWEZ          
H P H                 MOVE '3032-PROCESA-KSIA24T'                               
H P H                                          TO CDPARRAF OF KAELCWEZ          
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H                 IF SQLCODE = -911                                         
H P H                    MOVE 'S' TO SW-911                                     
H P H                    MOVE 'S' TO SW-911-911                                 
H P H                    ADD 1 TO WS-CANT-ERRORES                               
H P H                 ELSE                                                      
H P H            STRING                                                         
H P H            'X9999??????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            'X9999??????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H                 PERFORM 9999-GESTION-ERRORES                              
H P H                 END-IF                                                    
H P H              END-IF                                                       
H P H      END-EVALUATE                                                         
H P H                 END-IF                                                    
H P H               END-IF                                                      
H P H              END-IF                                                       
H P H              IF WS-ROLLBACK = 'SI'                                        
H P H                 SET WS-NO-HAY-SINIESTROS TO TRUE                          
H P H                 MOVE 98 TO WS-ITBLS                                       
H P H              END-IF                                                       
H P H              ADD WC-1 TO WS-ITBLS.                                        
H P H *                                                                         
H P H  3033-PROCESA-KSIA25T.                                                    
H P H              MOVE 'KSIA25T'             TO WS-TABLA-T                     
H P H              MOVE 'KSIA25H'             TO WS-TABLA-H                     
H P H *                                                                         
H P H              MOVE 'KSIA25T'             TO WS-TIPO-TABLA                  
H P H              MOVE 'CDSINIES'            TO WS-CAMPOPOL                    
H P H                                                                           
H P H              IF TAB-ESP-SR                                                
H P H               IF WS-SI-HISTORIFICA                                        
H P H                 PERFORM 3300-INSERTA-ESP-SIN                              
H P H               END-IF                                                      
H P H              ELSE                                                         
H P H               IF WS-SI-HISTORIFICA                                        
H P H      EXEC SQL                                                             
H P H         DECLARE CURSOR-33 CURSOR FOR                                      
H P H            SELECT CDSINIES FROM KSIA25T                                   
H P H             WHERE CDSINIES = :WS-TBL-SINOREC                              
H P H             FETCH FIRST 1 ROWS ONLY                                       
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EXEC SQL                                                             
H P H          OPEN CURSOR-33                                                   
H P H      END-EXEC                                                             
H P H      PERFORM 3306-VALIDA-CODIGO                                           
H P H      EXEC SQL                                                             
H P H          FETCH CURSOR-33                                                  
H P H          INTO                                                             
H P H          :WS-SINOREC                                                      
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H             EXEC SQL                                                      
H P H                CLOSE CURSOR-33                                            
H P H             END-EXEC                                                      
H P H             SET WS-PARA-INSERT TO TRUE                                    
H P H      EXEC SQL                                                             
H P H         INSERT INTO KSIA25H                                               
H P H            (SELECT * FROM KSIA25T                                         
H P H             WHERE CDSINIES = :WS-TBL-SINOREC)                             
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3033-PROCESA-KSIA25T' TO WS-OUT-PARRAFO                
H P H              MOVE 'INSERT CORRECTO '    TO WS-OUT-DESC                    
H P H              MOVE WS-TBL-SINOREC        TO WS-OUT-DESC(18:12)             
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-CLAVE-DUPLICADA                                   
H P H              SET WS-DUPLICADOS   TO TRUE                                  
H P H              MOVE 'SI'                  TO WS-ROLLBACK                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3033-PROCESA-KSIA25T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                'DUPLICADO:'             DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H              INTO WS-OUT-DESC                                             
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H            IF WS-WRITE                                                    
H P H              ADD  WC-1                  TO WS-IERR                        
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3033-PROCESA-KSIA25T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'SIN '                  DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN OTHER                                                         
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                     SET WS-DUPLICADOS   TO TRUE                           
H P H                     MOVE 'SI'                  TO WS-ROLLBACK             
H P H                     MOVE SQLCODE               TO WS-OUT-SQLCODE          
H P H                     MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA           
H P H                     MOVE WS-TABLA-H            TO WS-OUT-TABLA            
H P H                     MOVE '3033-PROCESA-KSIA25T' TO WS-OUT-PARRAFO         
H P H                     STRING                                                
H P H                      'CONTENCIO:'             DELIMITED BY SIZE           
H P H                       WS-CAMPOPOL             DELIMITED BY ' '            
H P H                       '='                     DELIMITED BY SIZE           
H P H                       WS-LEE-CDNUMPOL         DELIMITED BY SIZE           
H P H                       INTO WS-OUT-DESC                                    
H P H                       END-STRING                                          
H P H                     PERFORM 1570-ESCRIBE-DESCARTADA                       
H P H              ELSE                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3033-PROCESA-KSIA25T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'ERRDB2:'               DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H              MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
H P H              MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
H P H              MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
H P H              MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
H P H              MOVE '3033-PROCESA-KSIA25T  ' TO CDPARRAF OF KAELCWEZ        
H P H                                                                           
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 MOVE 'S' TO SW-911-911                                    
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H              ELSE                                                         
H P H                 PERFORM 9999-GESTION-ERRORES                              
H P H              END-IF                                                       
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                                                                           
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H            SET WS-NO-PARA-INSERT      TO TRUE                             
H P H            IF WS-WRITE                                                    
H P H              ADD  WC-1                  TO WS-IERR                        
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3033-PROCESA-KSIA25T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'NOHAY '                DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H            EXEC SQL                                                       
H P H                CLOSE CURSOR-33                                            
H P H            END-EXEC                                                       
H P H        WHEN OTHER                                                         
H P H              SET WS-NO-PARA-INSERT      TO TRUE                           
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3033-PROCESA-KSIA25T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'ERRDB2:'               DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            STRING                                                         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            ' ERROR EN SQL :' W-QUERY-TEXT                    '\N'         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H          MOVE WC-COD                   TO CDERR    OF KAELCWEZ            
H P H          MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ            
H P H          MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ            
H P H          MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ            
H P H          MOVE '3033-PROCESA-KSIA25T  ' TO CDPARRAF OF KAELCWEZ            
H P H                                                                           
H P H          IF SQLCODE = -911                                                
H P H              MOVE 'S' TO SW-911                                           
H P H              MOVE 'S' TO SW-911-911                                       
H P H              ADD 1 TO WS-CANT-ERRORES                                     
H P H          ELSE                                                             
H P H             PERFORM 9999-GESTION-ERRORES                                  
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                 IF  SQLCODE = WN-SQLCODE-OK                               
H P H                 AND WS-PARA-INSERT                                        
H P H      EXEC SQL                                                             
H P H         DELETE FROM KSIA25T                                               
H P H         WHERE CDSINIES = :WS-TBL-SINOREC                                  
H P H      END-EXEC                                                             
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3033-PROCESA-KSIA25T' TO WS-OUT-PARRAFO                
H P H              MOVE 'BORRAR CORRECTO    ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3033-PROCESA-KSIA25T' TO WS-OUT-PARRAFO                
H P H              MOVE 'NO EXISTE BORRAR   ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H              MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
H P H              MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
H P H              MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
H P H              MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
H P H              MOVE '3033-PROCESA-KSIA25T  ' TO CDPARRAF OF KAELCWEZ        
H P H                                                                           
H P H              PERFORM 9999-GESTION-ERRORES                                 
H P H                                                                           
H P H        WHEN OTHER                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3033-PROCESA-KSIA25T' TO WS-OUT-PARRAFO                
H P H              MOVE 'ERR BORRAR DB2     ' TO WS-OUT-DESC                    
H P H              IF SQLCODE  = -911                                           
H P H                 MOVE '3033-PROCESA-KSIA25T'  TO WS-OUT-PARRAFO            
H P H                 MOVE 'CONTENCION TABLA   '   TO WS-OUT-DESC               
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 mOVE 'S' TO SW-911                                        
H P H                 MOVE 'S' TO SW-911-911                                    
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 MOVE 'SI'                  TO WS-ROLLBACK                 
H P H                 MOVE SQLCODE               TO WS-OUT-SQLCODE              
H P H                 MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA               
H P H                 MOVE WS-TABLA-H            TO WS-OUT-TABLA                
H P H                 MOVE '3033-PROCESA-KSIA25T' TO WS-OUT-PARRAFO             
H P H                    STRING                                                 
H P H                   'CONTENCIO:'             DELIMITED BY SIZE              
H P H                    WS-CAMPOPOL             DELIMITED BY ' '               
H P H                    '='                     DELIMITED BY SIZE              
H P H                    WS-LEE-CDNUMPOL         DELIMITED BY SIZE              
H P H                    INTO WS-OUT-DESC                                       
H P H                 END-STRING                                                
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H            STRING                                                         
H P H            'Z8883??????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            'Z8881??????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H              ELSE                                                         
H P H                 MOVE WC-COD              TO CDERR    OF KAELCWEZ          
H P H                 MOVE WC-DES01            TO DSARGU1  OF KAELCWEZ          
H P H                 MOVE WC-PROGRAMA         TO DSARGU2  OF KAELCWEZ          
H P H                 MOVE WS-ERPOLIZA         TO DSARGU3  OF KAELCWEZ          
H P H                 MOVE '3033-PROCESA-KSIA25T'                               
H P H                                          TO CDPARRAF OF KAELCWEZ          
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H                 IF SQLCODE = -911                                         
H P H                    MOVE 'S' TO SW-911                                     
H P H                    MOVE 'S' TO SW-911-911                                 
H P H                    ADD 1 TO WS-CANT-ERRORES                               
H P H                 ELSE                                                      
H P H            STRING                                                         
H P H            'X9999??????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            'X9999??????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H                 PERFORM 9999-GESTION-ERRORES                              
H P H                 END-IF                                                    
H P H              END-IF                                                       
H P H      END-EVALUATE                                                         
H P H                 END-IF                                                    
H P H               END-IF                                                      
H P H              END-IF                                                       
H P H              IF WS-ROLLBACK = 'SI'                                        
H P H                 SET WS-NO-HAY-SINIESTROS TO TRUE                          
H P H                 MOVE 98 TO WS-ITBLS                                       
H P H              END-IF                                                       
H P H              ADD WC-1 TO WS-ITBLS.                                        
H P H *                                                                         
H P H  3034-PROCESA-KSIA2BT.                                                    
H P H              MOVE 'KSIA2BT'             TO WS-TABLA-T                     
H P H              MOVE 'KSIA2BH'             TO WS-TABLA-H                     
H P H *                                                                         
H P H              MOVE 'KSIA2BT'             TO WS-TIPO-TABLA                  
H P H              MOVE 'CDSINIES'            TO WS-CAMPOPOL                    
H P H                                                                           
H P H              IF TAB-ESP-SR                                                
H P H               IF WS-SI-HISTORIFICA                                        
H P H                 PERFORM 3300-INSERTA-ESP-SIN                              
H P H               END-IF                                                      
H P H              ELSE                                                         
H P H               IF WS-SI-HISTORIFICA                                        
H P H      EXEC SQL                                                             
H P H         DECLARE CURSOR-34 CURSOR FOR                                      
H P H            SELECT CDSINIES FROM KSIA2BT                                   
H P H             WHERE CDSINIES = :WS-TBL-SINOREC                              
H P H             FETCH FIRST 1 ROWS ONLY                                       
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EXEC SQL                                                             
H P H          OPEN CURSOR-34                                                   
H P H      END-EXEC                                                             
H P H      PERFORM 3306-VALIDA-CODIGO                                           
H P H      EXEC SQL                                                             
H P H          FETCH CURSOR-34                                                  
H P H          INTO                                                             
H P H          :WS-SINOREC                                                      
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H             EXEC SQL                                                      
H P H                CLOSE CURSOR-34                                            
H P H             END-EXEC                                                      
H P H             SET WS-PARA-INSERT TO TRUE                                    
H P H      EXEC SQL                                                             
H P H         INSERT INTO KSIA2BH                                               
H P H            (SELECT * FROM KSIA2BT                                         
H P H             WHERE CDSINIES = :WS-TBL-SINOREC)                             
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3034-PROCESA-KSIA2BT' TO WS-OUT-PARRAFO                
H P H              MOVE 'INSERT CORRECTO '    TO WS-OUT-DESC                    
H P H              MOVE WS-TBL-SINOREC        TO WS-OUT-DESC(18:12)             
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-CLAVE-DUPLICADA                                   
H P H              SET WS-DUPLICADOS   TO TRUE                                  
H P H              MOVE 'SI'                  TO WS-ROLLBACK                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3034-PROCESA-KSIA2BT' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                'DUPLICADO:'             DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H              INTO WS-OUT-DESC                                             
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H            IF WS-WRITE                                                    
H P H              ADD  WC-1                  TO WS-IERR                        
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3034-PROCESA-KSIA2BT' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'SIN '                  DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN OTHER                                                         
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                     SET WS-DUPLICADOS   TO TRUE                           
H P H                     MOVE 'SI'                  TO WS-ROLLBACK             
H P H                     MOVE SQLCODE               TO WS-OUT-SQLCODE          
H P H                     MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA           
H P H                     MOVE WS-TABLA-H            TO WS-OUT-TABLA            
H P H                     MOVE '3034-PROCESA-KSIA2BT' TO WS-OUT-PARRAFO         
H P H                     STRING                                                
H P H                      'CONTENCIO:'             DELIMITED BY SIZE           
H P H                       WS-CAMPOPOL             DELIMITED BY ' '            
H P H                       '='                     DELIMITED BY SIZE           
H P H                       WS-LEE-CDNUMPOL         DELIMITED BY SIZE           
H P H                       INTO WS-OUT-DESC                                    
H P H                       END-STRING                                          
H P H                     PERFORM 1570-ESCRIBE-DESCARTADA                       
H P H              ELSE                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3034-PROCESA-KSIA2BT' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'ERRDB2:'               DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H              MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
H P H              MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
H P H              MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
H P H              MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
H P H              MOVE '3034-PROCESA-KSIA2BT  ' TO CDPARRAF OF KAELCWEZ        
H P H                                                                           
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 MOVE 'S' TO SW-911-911                                    
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H              ELSE                                                         
H P H                 PERFORM 9999-GESTION-ERRORES                              
H P H              END-IF                                                       
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                                                                           
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H            SET WS-NO-PARA-INSERT      TO TRUE                             
H P H            IF WS-WRITE                                                    
H P H              ADD  WC-1                  TO WS-IERR                        
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3034-PROCESA-KSIA2BT' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'NOHAY '                DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H            EXEC SQL                                                       
H P H                CLOSE CURSOR-34                                            
H P H            END-EXEC                                                       
H P H        WHEN OTHER                                                         
H P H              SET WS-NO-PARA-INSERT      TO TRUE                           
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3034-PROCESA-KSIA2BT' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'ERRDB2:'               DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            STRING                                                         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            ' ERROR EN SQL :' W-QUERY-TEXT                    '\N'         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H          MOVE WC-COD                   TO CDERR    OF KAELCWEZ            
H P H          MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ            
H P H          MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ            
H P H          MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ            
H P H          MOVE '3034-PROCESA-KSIA2BT  ' TO CDPARRAF OF KAELCWEZ            
H P H                                                                           
H P H          IF SQLCODE = -911                                                
H P H              MOVE 'S' TO SW-911                                           
H P H              MOVE 'S' TO SW-911-911                                       
H P H              ADD 1 TO WS-CANT-ERRORES                                     
H P H          ELSE                                                             
H P H             PERFORM 9999-GESTION-ERRORES                                  
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                 IF  SQLCODE = WN-SQLCODE-OK                               
H P H                 AND WS-PARA-INSERT                                        
H P H      EXEC SQL                                                             
H P H         DELETE FROM KSIA2BT                                               
H P H         WHERE CDSINIES = :WS-TBL-SINOREC                                  
H P H      END-EXEC                                                             
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3034-PROCESA-KSIA2BT' TO WS-OUT-PARRAFO                
H P H              MOVE 'BORRAR CORRECTO    ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3034-PROCESA-KSIA2BT' TO WS-OUT-PARRAFO                
H P H              MOVE 'NO EXISTE BORRAR   ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H              MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
H P H              MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
H P H              MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
H P H              MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
H P H              MOVE '3034-PROCESA-KSIA2BT  ' TO CDPARRAF OF KAELCWEZ        
H P H                                                                           
H P H              PERFORM 9999-GESTION-ERRORES                                 
H P H                                                                           
H P H        WHEN OTHER                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3034-PROCESA-KSIA2BT' TO WS-OUT-PARRAFO                
H P H              MOVE 'ERR BORRAR DB2     ' TO WS-OUT-DESC                    
H P H              IF SQLCODE  = -911                                           
H P H                 MOVE '3034-PROCESA-KSIA2BT'  TO WS-OUT-PARRAFO            
H P H                 MOVE 'CONTENCION TABLA   '   TO WS-OUT-DESC               
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 mOVE 'S' TO SW-911                                        
H P H                 MOVE 'S' TO SW-911-911                                    
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 MOVE 'SI'                  TO WS-ROLLBACK                 
H P H                 MOVE SQLCODE               TO WS-OUT-SQLCODE              
H P H                 MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA               
H P H                 MOVE WS-TABLA-H            TO WS-OUT-TABLA                
H P H                 MOVE '3034-PROCESA-KSIA2BT' TO WS-OUT-PARRAFO             
H P H                    STRING                                                 
H P H                   'CONTENCIO:'             DELIMITED BY SIZE              
H P H                    WS-CAMPOPOL             DELIMITED BY ' '               
H P H                    '='                     DELIMITED BY SIZE              
H P H                    WS-LEE-CDNUMPOL         DELIMITED BY SIZE              
H P H                    INTO WS-OUT-DESC                                       
H P H                 END-STRING                                                
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H            STRING                                                         
H P H            'Z8883??????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            'Z8881??????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H              ELSE                                                         
H P H                 MOVE WC-COD              TO CDERR    OF KAELCWEZ          
H P H                 MOVE WC-DES01            TO DSARGU1  OF KAELCWEZ          
H P H                 MOVE WC-PROGRAMA         TO DSARGU2  OF KAELCWEZ          
H P H                 MOVE WS-ERPOLIZA         TO DSARGU3  OF KAELCWEZ          
H P H                 MOVE '3034-PROCESA-KSIA2BT'                               
H P H                                          TO CDPARRAF OF KAELCWEZ          
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H                 IF SQLCODE = -911                                         
H P H                    MOVE 'S' TO SW-911                                     
H P H                    MOVE 'S' TO SW-911-911                                 
H P H                    ADD 1 TO WS-CANT-ERRORES                               
H P H                 ELSE                                                      
H P H            STRING                                                         
H P H            'X9999??????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            'X9999??????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H                 PERFORM 9999-GESTION-ERRORES                              
H P H                 END-IF                                                    
H P H              END-IF                                                       
H P H      END-EVALUATE                                                         
H P H                 END-IF                                                    
H P H               END-IF                                                      
H P H              END-IF                                                       
H P H              IF WS-ROLLBACK = 'SI'                                        
H P H                 SET WS-NO-HAY-SINIESTROS TO TRUE                          
H P H                 MOVE 98 TO WS-ITBLS                                       
H P H              END-IF                                                       
H P H              ADD WC-1 TO WS-ITBLS.                                        
H P H *                                                                         
H P H  3035-PROCESA-KSIA30T.                                                    
H P H              MOVE 'KSIA30T'             TO WS-TABLA-T                     
H P H              MOVE 'KSIA30H'             TO WS-TABLA-H                     
H P H *                                                                         
H P H              MOVE 'KSIA30T'             TO WS-TIPO-TABLA                  
H P H              MOVE 'CDSINIES'            TO WS-CAMPOPOL                    
H P H                                                                           
H P H              IF TAB-ESP-SR                                                
H P H               IF WS-SI-HISTORIFICA                                        
H P H                 PERFORM 3300-INSERTA-ESP-SIN                              
H P H               END-IF                                                      
H P H              ELSE                                                         
H P H               IF WS-SI-HISTORIFICA                                        
H P H      EXEC SQL                                                             
H P H         DECLARE CURSOR-35 CURSOR FOR                                      
H P H            SELECT CDSINIES FROM KSIA30T                                   
H P H             WHERE CDSINIES = :WS-TBL-SINOREC                              
H P H             FETCH FIRST 1 ROWS ONLY                                       
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EXEC SQL                                                             
H P H          OPEN CURSOR-35                                                   
H P H      END-EXEC                                                             
H P H      PERFORM 3306-VALIDA-CODIGO                                           
H P H      EXEC SQL                                                             
H P H          FETCH CURSOR-35                                                  
H P H          INTO                                                             
H P H          :WS-SINOREC                                                      
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H             EXEC SQL                                                      
H P H                CLOSE CURSOR-35                                            
H P H             END-EXEC                                                      
H P H             SET WS-PARA-INSERT TO TRUE                                    
H P H      EXEC SQL                                                             
H P H         INSERT INTO KSIA30H                                               
H P H            (SELECT * FROM KSIA30T                                         
H P H             WHERE CDSINIES = :WS-TBL-SINOREC)                             
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3035-PROCESA-KSIA30T' TO WS-OUT-PARRAFO                
H P H              MOVE 'INSERT CORRECTO '    TO WS-OUT-DESC                    
H P H              MOVE WS-TBL-SINOREC        TO WS-OUT-DESC(18:12)             
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-CLAVE-DUPLICADA                                   
H P H              SET WS-DUPLICADOS   TO TRUE                                  
H P H              MOVE 'SI'                  TO WS-ROLLBACK                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3035-PROCESA-KSIA30T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                'DUPLICADO:'             DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H              INTO WS-OUT-DESC                                             
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H            IF WS-WRITE                                                    
H P H              ADD  WC-1                  TO WS-IERR                        
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3035-PROCESA-KSIA30T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'SIN '                  DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN OTHER                                                         
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                     SET WS-DUPLICADOS   TO TRUE                           
H P H                     MOVE 'SI'                  TO WS-ROLLBACK             
H P H                     MOVE SQLCODE               TO WS-OUT-SQLCODE          
H P H                     MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA           
H P H                     MOVE WS-TABLA-H            TO WS-OUT-TABLA            
H P H                     MOVE '3035-PROCESA-KSIA30T' TO WS-OUT-PARRAFO         
H P H                     STRING                                                
H P H                      'CONTENCIO:'             DELIMITED BY SIZE           
H P H                       WS-CAMPOPOL             DELIMITED BY ' '            
H P H                       '='                     DELIMITED BY SIZE           
H P H                       WS-LEE-CDNUMPOL         DELIMITED BY SIZE           
H P H                       INTO WS-OUT-DESC                                    
H P H                       END-STRING                                          
H P H                     PERFORM 1570-ESCRIBE-DESCARTADA                       
H P H              ELSE                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3035-PROCESA-KSIA30T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'ERRDB2:'               DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H              MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
H P H              MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
H P H              MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
H P H              MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
H P H              MOVE '3035-PROCESA-KSIA30T  ' TO CDPARRAF OF KAELCWEZ        
H P H                                                                           
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 MOVE 'S' TO SW-911-911                                    
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H              ELSE                                                         
H P H                 PERFORM 9999-GESTION-ERRORES                              
H P H              END-IF                                                       
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                                                                           
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H            SET WS-NO-PARA-INSERT      TO TRUE                             
H P H            IF WS-WRITE                                                    
H P H              ADD  WC-1                  TO WS-IERR                        
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3035-PROCESA-KSIA30T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'NOHAY '                DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H            EXEC SQL                                                       
H P H                CLOSE CURSOR-35                                            
H P H            END-EXEC                                                       
H P H        WHEN OTHER                                                         
H P H              SET WS-NO-PARA-INSERT      TO TRUE                           
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3035-PROCESA-KSIA30T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'ERRDB2:'               DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            STRING                                                         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            ' ERROR EN SQL :' W-QUERY-TEXT                    '\N'         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H          MOVE WC-COD                   TO CDERR    OF KAELCWEZ            
H P H          MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ            
H P H          MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ            
H P H          MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ            
H P H          MOVE '3035-PROCESA-KSIA30T  ' TO CDPARRAF OF KAELCWEZ            
H P H                                                                           
H P H          IF SQLCODE = -911                                                
H P H              MOVE 'S' TO SW-911                                           
H P H              MOVE 'S' TO SW-911-911                                       
H P H              ADD 1 TO WS-CANT-ERRORES                                     
H P H          ELSE                                                             
H P H             PERFORM 9999-GESTION-ERRORES                                  
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                 IF  SQLCODE = WN-SQLCODE-OK                               
H P H                 AND WS-PARA-INSERT                                        
H P H      EXEC SQL                                                             
H P H         DELETE FROM KSIA30T                                               
H P H         WHERE CDSINIES = :WS-TBL-SINOREC                                  
H P H      END-EXEC                                                             
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3035-PROCESA-KSIA30T' TO WS-OUT-PARRAFO                
H P H              MOVE 'BORRAR CORRECTO    ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3035-PROCESA-KSIA30T' TO WS-OUT-PARRAFO                
H P H              MOVE 'NO EXISTE BORRAR   ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H              MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
H P H              MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
H P H              MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
H P H              MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
H P H              MOVE '3035-PROCESA-KSIA30T  ' TO CDPARRAF OF KAELCWEZ        
H P H                                                                           
H P H              PERFORM 9999-GESTION-ERRORES                                 
H P H                                                                           
H P H        WHEN OTHER                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3035-PROCESA-KSIA30T' TO WS-OUT-PARRAFO                
H P H              MOVE 'ERR BORRAR DB2     ' TO WS-OUT-DESC                    
H P H              IF SQLCODE  = -911                                           
H P H                 MOVE '3035-PROCESA-KSIA30T'  TO WS-OUT-PARRAFO            
H P H                 MOVE 'CONTENCION TABLA   '   TO WS-OUT-DESC               
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 mOVE 'S' TO SW-911                                        
H P H                 MOVE 'S' TO SW-911-911                                    
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 MOVE 'SI'                  TO WS-ROLLBACK                 
H P H                 MOVE SQLCODE               TO WS-OUT-SQLCODE              
H P H                 MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA               
H P H                 MOVE WS-TABLA-H            TO WS-OUT-TABLA                
H P H                 MOVE '3035-PROCESA-KSIA30T' TO WS-OUT-PARRAFO             
H P H                    STRING                                                 
H P H                   'CONTENCIO:'             DELIMITED BY SIZE              
H P H                    WS-CAMPOPOL             DELIMITED BY ' '               
H P H                    '='                     DELIMITED BY SIZE              
H P H                    WS-LEE-CDNUMPOL         DELIMITED BY SIZE              
H P H                    INTO WS-OUT-DESC                                       
H P H                 END-STRING                                                
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H            STRING                                                         
H P H            'Z8883??????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            'Z8881??????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H              ELSE                                                         
H P H                 MOVE WC-COD              TO CDERR    OF KAELCWEZ          
H P H                 MOVE WC-DES01            TO DSARGU1  OF KAELCWEZ          
H P H                 MOVE WC-PROGRAMA         TO DSARGU2  OF KAELCWEZ          
H P H                 MOVE WS-ERPOLIZA         TO DSARGU3  OF KAELCWEZ          
H P H                 MOVE '3035-PROCESA-KSIA30T'                               
H P H                                          TO CDPARRAF OF KAELCWEZ          
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H                 IF SQLCODE = -911                                         
H P H                    MOVE 'S' TO SW-911                                     
H P H                    MOVE 'S' TO SW-911-911                                 
H P H                    ADD 1 TO WS-CANT-ERRORES                               
H P H                 ELSE                                                      
H P H            STRING                                                         
H P H            'X9999??????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            'X9999??????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H                 PERFORM 9999-GESTION-ERRORES                              
H P H                 END-IF                                                    
H P H              END-IF                                                       
H P H      END-EVALUATE                                                         
H P H                 END-IF                                                    
H P H               END-IF                                                      
H P H              END-IF                                                       
H P H              IF WS-ROLLBACK = 'SI'                                        
H P H                 SET WS-NO-HAY-SINIESTROS TO TRUE                          
H P H                 MOVE 98 TO WS-ITBLS                                       
H P H              END-IF                                                       
H P H              ADD WC-1 TO WS-ITBLS.                                        
H P H *                                                                         
H P H  3036-PROCESA-KSIA3AT.                                                    
H P H              MOVE 'KSIA3AT'             TO WS-TABLA-T                     
H P H              MOVE 'KSIA3AH'             TO WS-TABLA-H                     
H P H *                                                                         
H P H              MOVE 'KSIA3AT'             TO WS-TIPO-TABLA                  
H P H              MOVE 'CDSINIES'            TO WS-CAMPOPOL                    
H P H                                                                           
H P H              IF TAB-ESP-SR                                                
H P H               IF WS-SI-HISTORIFICA                                        
H P H                 PERFORM 3300-INSERTA-ESP-SIN                              
H P H               END-IF                                                      
H P H              ELSE                                                         
H P H               IF WS-SI-HISTORIFICA                                        
H P H      EXEC SQL                                                             
H P H         DECLARE CURSOR-36 CURSOR FOR                                      
H P H            SELECT CDSINIES FROM KSIA3AT                                   
H P H             WHERE CDSINIES = :WS-TBL-SINOREC                              
H P H             FETCH FIRST 1 ROWS ONLY                                       
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EXEC SQL                                                             
H P H          OPEN CURSOR-36                                                   
H P H      END-EXEC                                                             
H P H      PERFORM 3306-VALIDA-CODIGO                                           
H P H      EXEC SQL                                                             
H P H          FETCH CURSOR-36                                                  
H P H          INTO                                                             
H P H          :WS-SINOREC                                                      
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H             EXEC SQL                                                      
H P H                CLOSE CURSOR-36                                            
H P H             END-EXEC                                                      
H P H             SET WS-PARA-INSERT TO TRUE                                    
H P H      EXEC SQL                                                             
H P H         INSERT INTO KSIA3AH                                               
H P H            (SELECT * FROM KSIA3AT                                         
H P H             WHERE CDSINIES = :WS-TBL-SINOREC)                             
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3036-PROCESA-KSIA3AT' TO WS-OUT-PARRAFO                
H P H              MOVE 'INSERT CORRECTO '    TO WS-OUT-DESC                    
H P H              MOVE WS-TBL-SINOREC        TO WS-OUT-DESC(18:12)             
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-CLAVE-DUPLICADA                                   
H P H              SET WS-DUPLICADOS   TO TRUE                                  
H P H              MOVE 'SI'                  TO WS-ROLLBACK                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3036-PROCESA-KSIA3AT' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                'DUPLICADO:'             DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H              INTO WS-OUT-DESC                                             
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H            IF WS-WRITE                                                    
H P H              ADD  WC-1                  TO WS-IERR                        
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3036-PROCESA-KSIA3AT' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'SIN '                  DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN OTHER                                                         
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                     SET WS-DUPLICADOS   TO TRUE                           
H P H                     MOVE 'SI'                  TO WS-ROLLBACK             
H P H                     MOVE SQLCODE               TO WS-OUT-SQLCODE          
H P H                     MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA           
H P H                     MOVE WS-TABLA-H            TO WS-OUT-TABLA            
H P H                     MOVE '3036-PROCESA-KSIA3AT' TO WS-OUT-PARRAFO         
H P H                     STRING                                                
H P H                      'CONTENCIO:'             DELIMITED BY SIZE           
H P H                       WS-CAMPOPOL             DELIMITED BY ' '            
H P H                       '='                     DELIMITED BY SIZE           
H P H                       WS-LEE-CDNUMPOL         DELIMITED BY SIZE           
H P H                       INTO WS-OUT-DESC                                    
H P H                       END-STRING                                          
H P H                     PERFORM 1570-ESCRIBE-DESCARTADA                       
H P H              ELSE                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3036-PROCESA-KSIA3AT' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'ERRDB2:'               DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H              MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
H P H              MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
H P H              MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
H P H              MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
H P H              MOVE '3036-PROCESA-KSIA3AT  ' TO CDPARRAF OF KAELCWEZ        
H P H                                                                           
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 MOVE 'S' TO SW-911-911                                    
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H              ELSE                                                         
H P H                 PERFORM 9999-GESTION-ERRORES                              
H P H              END-IF                                                       
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                                                                           
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H            SET WS-NO-PARA-INSERT      TO TRUE                             
H P H            IF WS-WRITE                                                    
H P H              ADD  WC-1                  TO WS-IERR                        
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3036-PROCESA-KSIA3AT' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'NOHAY '                DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H            EXEC SQL                                                       
H P H                CLOSE CURSOR-36                                            
H P H            END-EXEC                                                       
H P H        WHEN OTHER                                                         
H P H              SET WS-NO-PARA-INSERT      TO TRUE                           
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3036-PROCESA-KSIA3AT' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'ERRDB2:'               DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            STRING                                                         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            ' ERROR EN SQL :' W-QUERY-TEXT                    '\N'         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H          MOVE WC-COD                   TO CDERR    OF KAELCWEZ            
H P H          MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ            
H P H          MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ            
H P H          MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ            
H P H          MOVE '3036-PROCESA-KSIA3AT  ' TO CDPARRAF OF KAELCWEZ            
H P H                                                                           
H P H          IF SQLCODE = -911                                                
H P H              MOVE 'S' TO SW-911                                           
H P H              MOVE 'S' TO SW-911-911                                       
H P H              ADD 1 TO WS-CANT-ERRORES                                     
H P H          ELSE                                                             
H P H             PERFORM 9999-GESTION-ERRORES                                  
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                 IF  SQLCODE = WN-SQLCODE-OK                               
H P H                 AND WS-PARA-INSERT                                        
H P H      EXEC SQL                                                             
H P H         DELETE FROM KSIA3AT                                               
H P H         WHERE CDSINIES = :WS-TBL-SINOREC                                  
H P H      END-EXEC                                                             
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3036-PROCESA-KSIA3AT' TO WS-OUT-PARRAFO                
H P H              MOVE 'BORRAR CORRECTO    ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3036-PROCESA-KSIA3AT' TO WS-OUT-PARRAFO                
H P H              MOVE 'NO EXISTE BORRAR   ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H              MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
H P H              MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
H P H              MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
H P H              MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
H P H              MOVE '3036-PROCESA-KSIA3AT  ' TO CDPARRAF OF KAELCWEZ        
H P H                                                                           
H P H              PERFORM 9999-GESTION-ERRORES                                 
H P H                                                                           
H P H        WHEN OTHER                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3036-PROCESA-KSIA3AT' TO WS-OUT-PARRAFO                
H P H              MOVE 'ERR BORRAR DB2     ' TO WS-OUT-DESC                    
H P H              IF SQLCODE  = -911                                           
H P H                 MOVE '3036-PROCESA-KSIA3AT'  TO WS-OUT-PARRAFO            
H P H                 MOVE 'CONTENCION TABLA   '   TO WS-OUT-DESC               
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 mOVE 'S' TO SW-911                                        
H P H                 MOVE 'S' TO SW-911-911                                    
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 MOVE 'SI'                  TO WS-ROLLBACK                 
H P H                 MOVE SQLCODE               TO WS-OUT-SQLCODE              
H P H                 MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA               
H P H                 MOVE WS-TABLA-H            TO WS-OUT-TABLA                
H P H                 MOVE '3036-PROCESA-KSIA3AT' TO WS-OUT-PARRAFO             
H P H                    STRING                                                 
H P H                   'CONTENCIO:'             DELIMITED BY SIZE              
H P H                    WS-CAMPOPOL             DELIMITED BY ' '               
H P H                    '='                     DELIMITED BY SIZE              
H P H                    WS-LEE-CDNUMPOL         DELIMITED BY SIZE              
H P H                    INTO WS-OUT-DESC                                       
H P H                 END-STRING                                                
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H            STRING                                                         
H P H            'Z8883??????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            'Z8881??????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H              ELSE                                                         
H P H                 MOVE WC-COD              TO CDERR    OF KAELCWEZ          
H P H                 MOVE WC-DES01            TO DSARGU1  OF KAELCWEZ          
H P H                 MOVE WC-PROGRAMA         TO DSARGU2  OF KAELCWEZ          
H P H                 MOVE WS-ERPOLIZA         TO DSARGU3  OF KAELCWEZ          
H P H                 MOVE '3036-PROCESA-KSIA3AT'                               
H P H                                          TO CDPARRAF OF KAELCWEZ          
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H                 IF SQLCODE = -911                                         
H P H                    MOVE 'S' TO SW-911                                     
H P H                    MOVE 'S' TO SW-911-911                                 
H P H                    ADD 1 TO WS-CANT-ERRORES                               
H P H                 ELSE                                                      
H P H            STRING                                                         
H P H            'X9999??????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            'X9999??????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H                 PERFORM 9999-GESTION-ERRORES                              
H P H                 END-IF                                                    
H P H              END-IF                                                       
H P H      END-EVALUATE                                                         
H P H                 END-IF                                                    
H P H               END-IF                                                      
H P H              END-IF                                                       
H P H              IF WS-ROLLBACK = 'SI'                                        
H P H                 SET WS-NO-HAY-SINIESTROS TO TRUE                          
H P H                 MOVE 98 TO WS-ITBLS                                       
H P H              END-IF                                                       
H P H              ADD WC-1 TO WS-ITBLS.                                        
H P H *                                                                         
H P H  3037-PROCESA-KSIA3BT.                                                    
H P H              MOVE 'KSIA3BT'             TO WS-TABLA-T                     
H P H              MOVE 'KSIA3BH'             TO WS-TABLA-H                     
H P H *                                                                         
H P H              MOVE 'KSIA3BT'             TO WS-TIPO-TABLA                  
H P H              MOVE 'CDSINIES'            TO WS-CAMPOPOL                    
H P H                                                                           
H P H              IF TAB-ESP-SR                                                
H P H               IF WS-SI-HISTORIFICA                                        
H P H                 PERFORM 3300-INSERTA-ESP-SIN                              
H P H               END-IF                                                      
H P H              ELSE                                                         
H P H               IF WS-SI-HISTORIFICA                                        
H P H      EXEC SQL                                                             
H P H         DECLARE CURSOR-37 CURSOR FOR                                      
H P H            SELECT CDSINIES FROM KSIA3BT                                   
H P H             WHERE CDSINIES = :WS-TBL-SINOREC                              
H P H             FETCH FIRST 1 ROWS ONLY                                       
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EXEC SQL                                                             
H P H          OPEN CURSOR-37                                                   
H P H      END-EXEC                                                             
H P H      PERFORM 3306-VALIDA-CODIGO                                           
H P H      EXEC SQL                                                             
H P H          FETCH CURSOR-37                                                  
H P H          INTO                                                             
H P H          :WS-SINOREC                                                      
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H             EXEC SQL                                                      
H P H                CLOSE CURSOR-37                                            
H P H             END-EXEC                                                      
H P H             SET WS-PARA-INSERT TO TRUE                                    
H P H      EXEC SQL                                                             
H P H         INSERT INTO KSIA3BH                                               
H P H            (SELECT * FROM KSIA3BT                                         
H P H             WHERE CDSINIES = :WS-TBL-SINOREC)                             
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3037-PROCESA-KSIA3BT' TO WS-OUT-PARRAFO                
H P H              MOVE 'INSERT CORRECTO '    TO WS-OUT-DESC                    
H P H              MOVE WS-TBL-SINOREC        TO WS-OUT-DESC(18:12)             
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-CLAVE-DUPLICADA                                   
H P H              SET WS-DUPLICADOS   TO TRUE                                  
H P H              MOVE 'SI'                  TO WS-ROLLBACK                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3037-PROCESA-KSIA3BT' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                'DUPLICADO:'             DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H              INTO WS-OUT-DESC                                             
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H            IF WS-WRITE                                                    
H P H              ADD  WC-1                  TO WS-IERR                        
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3037-PROCESA-KSIA3BT' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'SIN '                  DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN OTHER                                                         
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                     SET WS-DUPLICADOS   TO TRUE                           
H P H                     MOVE 'SI'                  TO WS-ROLLBACK             
H P H                     MOVE SQLCODE               TO WS-OUT-SQLCODE          
H P H                     MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA           
H P H                     MOVE WS-TABLA-H            TO WS-OUT-TABLA            
H P H                     MOVE '3037-PROCESA-KSIA3BT' TO WS-OUT-PARRAFO         
H P H                     STRING                                                
H P H                      'CONTENCIO:'             DELIMITED BY SIZE           
H P H                       WS-CAMPOPOL             DELIMITED BY ' '            
H P H                       '='                     DELIMITED BY SIZE           
H P H                       WS-LEE-CDNUMPOL         DELIMITED BY SIZE           
H P H                       INTO WS-OUT-DESC                                    
H P H                       END-STRING                                          
H P H                     PERFORM 1570-ESCRIBE-DESCARTADA                       
H P H              ELSE                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3037-PROCESA-KSIA3BT' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'ERRDB2:'               DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H              MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
H P H              MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
H P H              MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
H P H              MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
H P H              MOVE '3037-PROCESA-KSIA3BT  ' TO CDPARRAF OF KAELCWEZ        
H P H                                                                           
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 MOVE 'S' TO SW-911-911                                    
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H              ELSE                                                         
H P H                 PERFORM 9999-GESTION-ERRORES                              
H P H              END-IF                                                       
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                                                                           
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H            SET WS-NO-PARA-INSERT      TO TRUE                             
H P H            IF WS-WRITE                                                    
H P H              ADD  WC-1                  TO WS-IERR                        
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3037-PROCESA-KSIA3BT' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'NOHAY '                DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H            EXEC SQL                                                       
H P H                CLOSE CURSOR-37                                            
H P H            END-EXEC                                                       
H P H        WHEN OTHER                                                         
H P H              SET WS-NO-PARA-INSERT      TO TRUE                           
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3037-PROCESA-KSIA3BT' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'ERRDB2:'               DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            STRING                                                         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            ' ERROR EN SQL :' W-QUERY-TEXT                    '\N'         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H          MOVE WC-COD                   TO CDERR    OF KAELCWEZ            
H P H          MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ            
H P H          MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ            
H P H          MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ            
H P H          MOVE '3037-PROCESA-KSIA3BT  ' TO CDPARRAF OF KAELCWEZ            
H P H                                                                           
H P H          IF SQLCODE = -911                                                
H P H              MOVE 'S' TO SW-911                                           
H P H              MOVE 'S' TO SW-911-911                                       
H P H              ADD 1 TO WS-CANT-ERRORES                                     
H P H          ELSE                                                             
H P H             PERFORM 9999-GESTION-ERRORES                                  
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                 IF  SQLCODE = WN-SQLCODE-OK                               
H P H                 AND WS-PARA-INSERT                                        
H P H      EXEC SQL                                                             
H P H         DELETE FROM KSIA3BT                                               
H P H         WHERE CDSINIES = :WS-TBL-SINOREC                                  
H P H      END-EXEC                                                             
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3037-PROCESA-KSIA3BT' TO WS-OUT-PARRAFO                
H P H              MOVE 'BORRAR CORRECTO    ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3037-PROCESA-KSIA3BT' TO WS-OUT-PARRAFO                
H P H              MOVE 'NO EXISTE BORRAR   ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H              MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
H P H              MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
H P H              MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
H P H              MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
H P H              MOVE '3037-PROCESA-KSIA3BT  ' TO CDPARRAF OF KAELCWEZ        
H P H                                                                           
H P H              PERFORM 9999-GESTION-ERRORES                                 
H P H                                                                           
H P H        WHEN OTHER                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3037-PROCESA-KSIA3BT' TO WS-OUT-PARRAFO                
H P H              MOVE 'ERR BORRAR DB2     ' TO WS-OUT-DESC                    
H P H              IF SQLCODE  = -911                                           
H P H                 MOVE '3037-PROCESA-KSIA3BT'  TO WS-OUT-PARRAFO            
H P H                 MOVE 'CONTENCION TABLA   '   TO WS-OUT-DESC               
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 mOVE 'S' TO SW-911                                        
H P H                 MOVE 'S' TO SW-911-911                                    
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 MOVE 'SI'                  TO WS-ROLLBACK                 
H P H                 MOVE SQLCODE               TO WS-OUT-SQLCODE              
H P H                 MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA               
H P H                 MOVE WS-TABLA-H            TO WS-OUT-TABLA                
H P H                 MOVE '3037-PROCESA-KSIA3BT' TO WS-OUT-PARRAFO             
H P H                    STRING                                                 
H P H                   'CONTENCIO:'             DELIMITED BY SIZE              
H P H                    WS-CAMPOPOL             DELIMITED BY ' '               
H P H                    '='                     DELIMITED BY SIZE              
H P H                    WS-LEE-CDNUMPOL         DELIMITED BY SIZE              
H P H                    INTO WS-OUT-DESC                                       
H P H                 END-STRING                                                
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H            STRING                                                         
H P H            'Z8883??????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            'Z8881??????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H              ELSE                                                         
H P H                 MOVE WC-COD              TO CDERR    OF KAELCWEZ          
H P H                 MOVE WC-DES01            TO DSARGU1  OF KAELCWEZ          
H P H                 MOVE WC-PROGRAMA         TO DSARGU2  OF KAELCWEZ          
H P H                 MOVE WS-ERPOLIZA         TO DSARGU3  OF KAELCWEZ          
H P H                 MOVE '3037-PROCESA-KSIA3BT'                               
H P H                                          TO CDPARRAF OF KAELCWEZ          
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H                 IF SQLCODE = -911                                         
H P H                    MOVE 'S' TO SW-911                                     
H P H                    MOVE 'S' TO SW-911-911                                 
H P H                    ADD 1 TO WS-CANT-ERRORES                               
H P H                 ELSE                                                      
H P H            STRING                                                         
H P H            'X9999??????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            'X9999??????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H                 PERFORM 9999-GESTION-ERRORES                              
H P H                 END-IF                                                    
H P H              END-IF                                                       
H P H      END-EVALUATE                                                         
H P H                 END-IF                                                    
H P H               END-IF                                                      
H P H              END-IF                                                       
H P H              IF WS-ROLLBACK = 'SI'                                        
H P H                 SET WS-NO-HAY-SINIESTROS TO TRUE                          
H P H                 MOVE 98 TO WS-ITBLS                                       
H P H              END-IF                                                       
H P H              ADD WC-1 TO WS-ITBLS.                                        
H P H *                                                                         
H P H  3038-PROCESA-KSIA4BT.                                                    
H P H              MOVE 'KSIA4BT'             TO WS-TABLA-T                     
H P H              MOVE 'KSIA4BH'             TO WS-TABLA-H                     
H P H *                                                                         
H P H              MOVE 'KSIA4BT'             TO WS-TIPO-TABLA                  
H P H              MOVE 'CDSINIES'            TO WS-CAMPOPOL                    
H P H                                                                           
H P H              IF TAB-ESP-SR                                                
H P H               IF WS-SI-HISTORIFICA                                        
H P H                 PERFORM 3300-INSERTA-ESP-SIN                              
H P H               END-IF                                                      
H P H              ELSE                                                         
H P H               IF WS-SI-HISTORIFICA                                        
H P H      EXEC SQL                                                             
H P H         DECLARE CURSOR-38 CURSOR FOR                                      
H P H            SELECT CDSINIES FROM KSIA4BT                                   
H P H             WHERE CDSINIES = :WS-TBL-SINOREC                              
H P H             FETCH FIRST 1 ROWS ONLY                                       
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EXEC SQL                                                             
H P H          OPEN CURSOR-38                                                   
H P H      END-EXEC                                                             
H P H      PERFORM 3306-VALIDA-CODIGO                                           
H P H      EXEC SQL                                                             
H P H          FETCH CURSOR-38                                                  
H P H          INTO                                                             
H P H          :WS-SINOREC                                                      
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H             EXEC SQL                                                      
H P H                CLOSE CURSOR-38                                            
H P H             END-EXEC                                                      
H P H             SET WS-PARA-INSERT TO TRUE                                    
H P H      EXEC SQL                                                             
H P H         INSERT INTO KSIA4BH                                               
H P H            (SELECT * FROM KSIA4BT                                         
H P H             WHERE CDSINIES = :WS-TBL-SINOREC)                             
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3038-PROCESA-KSIA4BT' TO WS-OUT-PARRAFO                
H P H              MOVE 'INSERT CORRECTO '    TO WS-OUT-DESC                    
H P H              MOVE WS-TBL-SINOREC        TO WS-OUT-DESC(18:12)             
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-CLAVE-DUPLICADA                                   
H P H              SET WS-DUPLICADOS   TO TRUE                                  
H P H              MOVE 'SI'                  TO WS-ROLLBACK                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3038-PROCESA-KSIA4BT' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                'DUPLICADO:'             DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H              INTO WS-OUT-DESC                                             
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H            IF WS-WRITE                                                    
H P H              ADD  WC-1                  TO WS-IERR                        
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3038-PROCESA-KSIA4BT' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'SIN '                  DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN OTHER                                                         
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                     SET WS-DUPLICADOS   TO TRUE                           
H P H                     MOVE 'SI'                  TO WS-ROLLBACK             
H P H                     MOVE SQLCODE               TO WS-OUT-SQLCODE          
H P H                     MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA           
H P H                     MOVE WS-TABLA-H            TO WS-OUT-TABLA            
H P H                     MOVE '3038-PROCESA-KSIA4BT' TO WS-OUT-PARRAFO         
H P H                     STRING                                                
H P H                      'CONTENCIO:'             DELIMITED BY SIZE           
H P H                       WS-CAMPOPOL             DELIMITED BY ' '            
H P H                       '='                     DELIMITED BY SIZE           
H P H                       WS-LEE-CDNUMPOL         DELIMITED BY SIZE           
H P H                       INTO WS-OUT-DESC                                    
H P H                       END-STRING                                          
H P H                     PERFORM 1570-ESCRIBE-DESCARTADA                       
H P H              ELSE                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3038-PROCESA-KSIA4BT' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'ERRDB2:'               DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H              MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
H P H              MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
H P H              MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
H P H              MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
H P H              MOVE '3038-PROCESA-KSIA4BT  ' TO CDPARRAF OF KAELCWEZ        
H P H                                                                           
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 MOVE 'S' TO SW-911-911                                    
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H              ELSE                                                         
H P H                 PERFORM 9999-GESTION-ERRORES                              
H P H              END-IF                                                       
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                                                                           
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H            SET WS-NO-PARA-INSERT      TO TRUE                             
H P H            IF WS-WRITE                                                    
H P H              ADD  WC-1                  TO WS-IERR                        
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3038-PROCESA-KSIA4BT' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'NOHAY '                DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H            EXEC SQL                                                       
H P H                CLOSE CURSOR-38                                            
H P H            END-EXEC                                                       
H P H        WHEN OTHER                                                         
H P H              SET WS-NO-PARA-INSERT      TO TRUE                           
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3038-PROCESA-KSIA4BT' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'ERRDB2:'               DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            STRING                                                         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            ' ERROR EN SQL :' W-QUERY-TEXT                    '\N'         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H          MOVE WC-COD                   TO CDERR    OF KAELCWEZ            
H P H          MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ            
H P H          MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ            
H P H          MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ            
H P H          MOVE '3038-PROCESA-KSIA4BT  ' TO CDPARRAF OF KAELCWEZ            
H P H                                                                           
H P H          IF SQLCODE = -911                                                
H P H              MOVE 'S' TO SW-911                                           
H P H              MOVE 'S' TO SW-911-911                                       
H P H              ADD 1 TO WS-CANT-ERRORES                                     
H P H          ELSE                                                             
H P H             PERFORM 9999-GESTION-ERRORES                                  
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                 IF  SQLCODE = WN-SQLCODE-OK                               
H P H                 AND WS-PARA-INSERT                                        
H P H      EXEC SQL                                                             
H P H         DELETE FROM KSIA4BT                                               
H P H         WHERE CDSINIES = :WS-TBL-SINOREC                                  
H P H      END-EXEC                                                             
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3038-PROCESA-KSIA4BT' TO WS-OUT-PARRAFO                
H P H              MOVE 'BORRAR CORRECTO    ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3038-PROCESA-KSIA4BT' TO WS-OUT-PARRAFO                
H P H              MOVE 'NO EXISTE BORRAR   ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H              MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
H P H              MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
H P H              MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
H P H              MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
H P H              MOVE '3038-PROCESA-KSIA4BT  ' TO CDPARRAF OF KAELCWEZ        
H P H                                                                           
H P H              PERFORM 9999-GESTION-ERRORES                                 
H P H                                                                           
H P H        WHEN OTHER                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3038-PROCESA-KSIA4BT' TO WS-OUT-PARRAFO                
H P H              MOVE 'ERR BORRAR DB2     ' TO WS-OUT-DESC                    
H P H              IF SQLCODE  = -911                                           
H P H                 MOVE '3038-PROCESA-KSIA4BT'  TO WS-OUT-PARRAFO            
H P H                 MOVE 'CONTENCION TABLA   '   TO WS-OUT-DESC               
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 mOVE 'S' TO SW-911                                        
H P H                 MOVE 'S' TO SW-911-911                                    
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 MOVE 'SI'                  TO WS-ROLLBACK                 
H P H                 MOVE SQLCODE               TO WS-OUT-SQLCODE              
H P H                 MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA               
H P H                 MOVE WS-TABLA-H            TO WS-OUT-TABLA                
H P H                 MOVE '3038-PROCESA-KSIA4BT' TO WS-OUT-PARRAFO             
H P H                    STRING                                                 
H P H                   'CONTENCIO:'             DELIMITED BY SIZE              
H P H                    WS-CAMPOPOL             DELIMITED BY ' '               
H P H                    '='                     DELIMITED BY SIZE              
H P H                    WS-LEE-CDNUMPOL         DELIMITED BY SIZE              
H P H                    INTO WS-OUT-DESC                                       
H P H                 END-STRING                                                
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H            STRING                                                         
H P H            'Z8883??????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            'Z8881??????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H              ELSE                                                         
H P H                 MOVE WC-COD              TO CDERR    OF KAELCWEZ          
H P H                 MOVE WC-DES01            TO DSARGU1  OF KAELCWEZ          
H P H                 MOVE WC-PROGRAMA         TO DSARGU2  OF KAELCWEZ          
H P H                 MOVE WS-ERPOLIZA         TO DSARGU3  OF KAELCWEZ          
H P H                 MOVE '3038-PROCESA-KSIA4BT'                               
H P H                                          TO CDPARRAF OF KAELCWEZ          
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H                 IF SQLCODE = -911                                         
H P H                    MOVE 'S' TO SW-911                                     
H P H                    MOVE 'S' TO SW-911-911                                 
H P H                    ADD 1 TO WS-CANT-ERRORES                               
H P H                 ELSE                                                      
H P H            STRING                                                         
H P H            'X9999??????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            'X9999??????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H                 PERFORM 9999-GESTION-ERRORES                              
H P H                 END-IF                                                    
H P H              END-IF                                                       
H P H      END-EVALUATE                                                         
H P H                 END-IF                                                    
H P H               END-IF                                                      
H P H              END-IF                                                       
H P H              IF WS-ROLLBACK = 'SI'                                        
H P H                 SET WS-NO-HAY-SINIESTROS TO TRUE                          
H P H                 MOVE 98 TO WS-ITBLS                                       
H P H              END-IF                                                       
H P H              ADD WC-1 TO WS-ITBLS.                                        
H P H *                                                                         
H P H  3039-PROCESA-KSIA5AT.                                                    
H P H              MOVE 'KSIA5AT'             TO WS-TABLA-T                     
H P H              MOVE 'KSIA5AH'             TO WS-TABLA-H                     
H P H *                                                                         
H P H              MOVE 'KSIA5AT'             TO WS-TIPO-TABLA                  
H P H              MOVE 'CDSINIES'            TO WS-CAMPOPOL                    
H P H                                                                           
H P H              IF TAB-ESP-SR                                                
H P H               IF WS-SI-HISTORIFICA                                        
H P H                 PERFORM 3300-INSERTA-ESP-SIN                              
H P H               END-IF                                                      
H P H              ELSE                                                         
H P H               IF WS-SI-HISTORIFICA                                        
H P H      EXEC SQL                                                             
H P H         DECLARE CURSOR-39 CURSOR FOR                                      
H P H            SELECT CDSINIES FROM KSIA5AT                                   
H P H             WHERE CDSINIES = :WS-TBL-SINOREC                              
H P H             FETCH FIRST 1 ROWS ONLY                                       
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EXEC SQL                                                             
H P H          OPEN CURSOR-39                                                   
H P H      END-EXEC                                                             
H P H      PERFORM 3306-VALIDA-CODIGO                                           
H P H      EXEC SQL                                                             
H P H          FETCH CURSOR-39                                                  
H P H          INTO                                                             
H P H          :WS-SINOREC                                                      
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H             EXEC SQL                                                      
H P H                CLOSE CURSOR-39                                            
H P H             END-EXEC                                                      
H P H             SET WS-PARA-INSERT TO TRUE                                    
H P H      EXEC SQL                                                             
H P H         INSERT INTO KSIA5AH                                               
H P H            (SELECT * FROM KSIA5AT                                         
H P H             WHERE CDSINIES = :WS-TBL-SINOREC)                             
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3039-PROCESA-KSIA5AT' TO WS-OUT-PARRAFO                
H P H              MOVE 'INSERT CORRECTO '    TO WS-OUT-DESC                    
H P H              MOVE WS-TBL-SINOREC        TO WS-OUT-DESC(18:12)             
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-CLAVE-DUPLICADA                                   
H P H              SET WS-DUPLICADOS   TO TRUE                                  
H P H              MOVE 'SI'                  TO WS-ROLLBACK                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3039-PROCESA-KSIA5AT' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                'DUPLICADO:'             DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H              INTO WS-OUT-DESC                                             
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H            IF WS-WRITE                                                    
H P H              ADD  WC-1                  TO WS-IERR                        
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3039-PROCESA-KSIA5AT' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'SIN '                  DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN OTHER                                                         
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                     SET WS-DUPLICADOS   TO TRUE                           
H P H                     MOVE 'SI'                  TO WS-ROLLBACK             
H P H                     MOVE SQLCODE               TO WS-OUT-SQLCODE          
H P H                     MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA           
H P H                     MOVE WS-TABLA-H            TO WS-OUT-TABLA            
H P H                     MOVE '3039-PROCESA-KSIA5AT' TO WS-OUT-PARRAFO         
H P H                     STRING                                                
H P H                      'CONTENCIO:'             DELIMITED BY SIZE           
H P H                       WS-CAMPOPOL             DELIMITED BY ' '            
H P H                       '='                     DELIMITED BY SIZE           
H P H                       WS-LEE-CDNUMPOL         DELIMITED BY SIZE           
H P H                       INTO WS-OUT-DESC                                    
H P H                       END-STRING                                          
H P H                     PERFORM 1570-ESCRIBE-DESCARTADA                       
H P H              ELSE                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3039-PROCESA-KSIA5AT' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'ERRDB2:'               DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H              MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
H P H              MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
H P H              MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
H P H              MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
H P H              MOVE '3039-PROCESA-KSIA5AT  ' TO CDPARRAF OF KAELCWEZ        
H P H                                                                           
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 MOVE 'S' TO SW-911-911                                    
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H              ELSE                                                         
H P H                 PERFORM 9999-GESTION-ERRORES                              
H P H              END-IF                                                       
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                                                                           
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H            SET WS-NO-PARA-INSERT      TO TRUE                             
H P H            IF WS-WRITE                                                    
H P H              ADD  WC-1                  TO WS-IERR                        
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3039-PROCESA-KSIA5AT' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'NOHAY '                DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H            EXEC SQL                                                       
H P H                CLOSE CURSOR-39                                            
H P H            END-EXEC                                                       
H P H        WHEN OTHER                                                         
H P H              SET WS-NO-PARA-INSERT      TO TRUE                           
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3039-PROCESA-KSIA5AT' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'ERRDB2:'               DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            STRING                                                         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            ' ERROR EN SQL :' W-QUERY-TEXT                    '\N'         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H          MOVE WC-COD                   TO CDERR    OF KAELCWEZ            
H P H          MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ            
H P H          MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ            
H P H          MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ            
H P H          MOVE '3039-PROCESA-KSIA5AT  ' TO CDPARRAF OF KAELCWEZ            
H P H                                                                           
H P H          IF SQLCODE = -911                                                
H P H              MOVE 'S' TO SW-911                                           
H P H              MOVE 'S' TO SW-911-911                                       
H P H              ADD 1 TO WS-CANT-ERRORES                                     
H P H          ELSE                                                             
H P H             PERFORM 9999-GESTION-ERRORES                                  
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                 IF  SQLCODE = WN-SQLCODE-OK                               
H P H                 AND WS-PARA-INSERT                                        
H P H      EXEC SQL                                                             
H P H         DELETE FROM KSIA5AT                                               
H P H         WHERE CDSINIES = :WS-TBL-SINOREC                                  
H P H      END-EXEC                                                             
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3039-PROCESA-KSIA5AT' TO WS-OUT-PARRAFO                
H P H              MOVE 'BORRAR CORRECTO    ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3039-PROCESA-KSIA5AT' TO WS-OUT-PARRAFO                
H P H              MOVE 'NO EXISTE BORRAR   ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H              MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
H P H              MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
H P H              MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
H P H              MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
H P H              MOVE '3039-PROCESA-KSIA5AT  ' TO CDPARRAF OF KAELCWEZ        
H P H                                                                           
H P H              PERFORM 9999-GESTION-ERRORES                                 
H P H                                                                           
H P H        WHEN OTHER                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3039-PROCESA-KSIA5AT' TO WS-OUT-PARRAFO                
H P H              MOVE 'ERR BORRAR DB2     ' TO WS-OUT-DESC                    
H P H              IF SQLCODE  = -911                                           
H P H                 MOVE '3039-PROCESA-KSIA5AT'  TO WS-OUT-PARRAFO            
H P H                 MOVE 'CONTENCION TABLA   '   TO WS-OUT-DESC               
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 mOVE 'S' TO SW-911                                        
H P H                 MOVE 'S' TO SW-911-911                                    
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 MOVE 'SI'                  TO WS-ROLLBACK                 
H P H                 MOVE SQLCODE               TO WS-OUT-SQLCODE              
H P H                 MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA               
H P H                 MOVE WS-TABLA-H            TO WS-OUT-TABLA                
H P H                 MOVE '3039-PROCESA-KSIA5AT' TO WS-OUT-PARRAFO             
H P H                    STRING                                                 
H P H                   'CONTENCIO:'             DELIMITED BY SIZE              
H P H                    WS-CAMPOPOL             DELIMITED BY ' '               
H P H                    '='                     DELIMITED BY SIZE              
H P H                    WS-LEE-CDNUMPOL         DELIMITED BY SIZE              
H P H                    INTO WS-OUT-DESC                                       
H P H                 END-STRING                                                
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H            STRING                                                         
H P H            'Z8883??????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            'Z8881??????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H              ELSE                                                         
H P H                 MOVE WC-COD              TO CDERR    OF KAELCWEZ          
H P H                 MOVE WC-DES01            TO DSARGU1  OF KAELCWEZ          
H P H                 MOVE WC-PROGRAMA         TO DSARGU2  OF KAELCWEZ          
H P H                 MOVE WS-ERPOLIZA         TO DSARGU3  OF KAELCWEZ          
H P H                 MOVE '3039-PROCESA-KSIA5AT'                               
H P H                                          TO CDPARRAF OF KAELCWEZ          
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H                 IF SQLCODE = -911                                         
H P H                    MOVE 'S' TO SW-911                                     
H P H                    MOVE 'S' TO SW-911-911                                 
H P H                    ADD 1 TO WS-CANT-ERRORES                               
H P H                 ELSE                                                      
H P H            STRING                                                         
H P H            'X9999??????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            'X9999??????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H                 PERFORM 9999-GESTION-ERRORES                              
H P H                 END-IF                                                    
H P H              END-IF                                                       
H P H      END-EVALUATE                                                         
H P H                 END-IF                                                    
H P H               END-IF                                                      
H P H              END-IF                                                       
H P H              IF WS-ROLLBACK = 'SI'                                        
H P H                 SET WS-NO-HAY-SINIESTROS TO TRUE                          
H P H                 MOVE 98 TO WS-ITBLS                                       
H P H              END-IF                                                       
H P H              ADD WC-1 TO WS-ITBLS.                                        
H P H *                                                                         
H P H  3040-PROCESA-KSIA6BT.                                                    
H P H              MOVE 'KSIA6BT'             TO WS-TABLA-T                     
H P H              MOVE 'KSIA6BH'             TO WS-TABLA-H                     
H P H *                                                                         
H P H              MOVE 'KSIA6BT'             TO WS-TIPO-TABLA                  
H P H              MOVE 'CDSINIES'            TO WS-CAMPOPOL                    
H P H                                                                           
H P H              IF TAB-ESP-SR                                                
H P H               IF WS-SI-HISTORIFICA                                        
H P H                 PERFORM 3300-INSERTA-ESP-SIN                              
H P H               END-IF                                                      
H P H              ELSE                                                         
H P H               IF WS-SI-HISTORIFICA                                        
H P H      EXEC SQL                                                             
H P H         DECLARE CURSOR-40 CURSOR FOR                                      
H P H            SELECT CDSINIES FROM KSIA6BT                                   
H P H             WHERE CDSINIES = :WS-TBL-SINOREC                              
H P H             FETCH FIRST 1 ROWS ONLY                                       
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EXEC SQL                                                             
H P H          OPEN CURSOR-40                                                   
H P H      END-EXEC                                                             
H P H      PERFORM 3306-VALIDA-CODIGO                                           
H P H      EXEC SQL                                                             
H P H          FETCH CURSOR-40                                                  
H P H          INTO                                                             
H P H          :WS-SINOREC                                                      
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H             EXEC SQL                                                      
H P H                CLOSE CURSOR-40                                            
H P H             END-EXEC                                                      
H P H             SET WS-PARA-INSERT TO TRUE                                    
H P H      EXEC SQL                                                             
H P H         INSERT INTO KSIA6BH                                               
H P H            (SELECT * FROM KSIA6BT                                         
H P H             WHERE CDSINIES = :WS-TBL-SINOREC)                             
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3040-PROCESA-KSIA6BT' TO WS-OUT-PARRAFO                
H P H              MOVE 'INSERT CORRECTO '    TO WS-OUT-DESC                    
H P H              MOVE WS-TBL-SINOREC        TO WS-OUT-DESC(18:12)             
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-CLAVE-DUPLICADA                                   
H P H              SET WS-DUPLICADOS   TO TRUE                                  
H P H              MOVE 'SI'                  TO WS-ROLLBACK                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3040-PROCESA-KSIA6BT' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                'DUPLICADO:'             DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H              INTO WS-OUT-DESC                                             
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H            IF WS-WRITE                                                    
H P H              ADD  WC-1                  TO WS-IERR                        
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3040-PROCESA-KSIA6BT' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'SIN '                  DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN OTHER                                                         
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                     SET WS-DUPLICADOS   TO TRUE                           
H P H                     MOVE 'SI'                  TO WS-ROLLBACK             
H P H                     MOVE SQLCODE               TO WS-OUT-SQLCODE          
H P H                     MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA           
H P H                     MOVE WS-TABLA-H            TO WS-OUT-TABLA            
H P H                     MOVE '3040-PROCESA-KSIA6BT' TO WS-OUT-PARRAFO         
H P H                     STRING                                                
H P H                      'CONTENCIO:'             DELIMITED BY SIZE           
H P H                       WS-CAMPOPOL             DELIMITED BY ' '            
H P H                       '='                     DELIMITED BY SIZE           
H P H                       WS-LEE-CDNUMPOL         DELIMITED BY SIZE           
H P H                       INTO WS-OUT-DESC                                    
H P H                       END-STRING                                          
H P H                     PERFORM 1570-ESCRIBE-DESCARTADA                       
H P H              ELSE                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3040-PROCESA-KSIA6BT' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'ERRDB2:'               DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H              MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
H P H              MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
H P H              MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
H P H              MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
H P H              MOVE '3040-PROCESA-KSIA6BT  ' TO CDPARRAF OF KAELCWEZ        
H P H                                                                           
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 MOVE 'S' TO SW-911-911                                    
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H              ELSE                                                         
H P H                 PERFORM 9999-GESTION-ERRORES                              
H P H              END-IF                                                       
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                                                                           
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H            SET WS-NO-PARA-INSERT      TO TRUE                             
H P H            IF WS-WRITE                                                    
H P H              ADD  WC-1                  TO WS-IERR                        
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3040-PROCESA-KSIA6BT' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'NOHAY '                DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H            EXEC SQL                                                       
H P H                CLOSE CURSOR-40                                            
H P H            END-EXEC                                                       
H P H        WHEN OTHER                                                         
H P H              SET WS-NO-PARA-INSERT      TO TRUE                           
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3040-PROCESA-KSIA6BT' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'ERRDB2:'               DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            STRING                                                         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            ' ERROR EN SQL :' W-QUERY-TEXT                    '\N'         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H          MOVE WC-COD                   TO CDERR    OF KAELCWEZ            
H P H          MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ            
H P H          MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ            
H P H          MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ            
H P H          MOVE '3040-PROCESA-KSIA6BT  ' TO CDPARRAF OF KAELCWEZ            
H P H                                                                           
H P H          IF SQLCODE = -911                                                
H P H              MOVE 'S' TO SW-911                                           
H P H              MOVE 'S' TO SW-911-911                                       
H P H              ADD 1 TO WS-CANT-ERRORES                                     
H P H          ELSE                                                             
H P H             PERFORM 9999-GESTION-ERRORES                                  
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                 IF  SQLCODE = WN-SQLCODE-OK                               
H P H                 AND WS-PARA-INSERT                                        
H P H      EXEC SQL                                                             
H P H         DELETE FROM KSIA6BT                                               
H P H         WHERE CDSINIES = :WS-TBL-SINOREC                                  
H P H      END-EXEC                                                             
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3040-PROCESA-KSIA6BT' TO WS-OUT-PARRAFO                
H P H              MOVE 'BORRAR CORRECTO    ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3040-PROCESA-KSIA6BT' TO WS-OUT-PARRAFO                
H P H              MOVE 'NO EXISTE BORRAR   ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H              MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
H P H              MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
H P H              MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
H P H              MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
H P H              MOVE '3040-PROCESA-KSIA6BT  ' TO CDPARRAF OF KAELCWEZ        
H P H                                                                           
H P H              PERFORM 9999-GESTION-ERRORES                                 
H P H                                                                           
H P H        WHEN OTHER                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3040-PROCESA-KSIA6BT' TO WS-OUT-PARRAFO                
H P H              MOVE 'ERR BORRAR DB2     ' TO WS-OUT-DESC                    
H P H              IF SQLCODE  = -911                                           
H P H                 MOVE '3040-PROCESA-KSIA6BT'  TO WS-OUT-PARRAFO            
H P H                 MOVE 'CONTENCION TABLA   '   TO WS-OUT-DESC               
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 mOVE 'S' TO SW-911                                        
H P H                 MOVE 'S' TO SW-911-911                                    
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 MOVE 'SI'                  TO WS-ROLLBACK                 
H P H                 MOVE SQLCODE               TO WS-OUT-SQLCODE              
H P H                 MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA               
H P H                 MOVE WS-TABLA-H            TO WS-OUT-TABLA                
H P H                 MOVE '3040-PROCESA-KSIA6BT' TO WS-OUT-PARRAFO             
H P H                    STRING                                                 
H P H                   'CONTENCIO:'             DELIMITED BY SIZE              
H P H                    WS-CAMPOPOL             DELIMITED BY ' '               
H P H                    '='                     DELIMITED BY SIZE              
H P H                    WS-LEE-CDNUMPOL         DELIMITED BY SIZE              
H P H                    INTO WS-OUT-DESC                                       
H P H                 END-STRING                                                
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H            STRING                                                         
H P H            'Z8883??????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            'Z8881??????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H              ELSE                                                         
H P H                 MOVE WC-COD              TO CDERR    OF KAELCWEZ          
H P H                 MOVE WC-DES01            TO DSARGU1  OF KAELCWEZ          
H P H                 MOVE WC-PROGRAMA         TO DSARGU2  OF KAELCWEZ          
H P H                 MOVE WS-ERPOLIZA         TO DSARGU3  OF KAELCWEZ          
H P H                 MOVE '3040-PROCESA-KSIA6BT'                               
H P H                                          TO CDPARRAF OF KAELCWEZ          
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H                 IF SQLCODE = -911                                         
H P H                    MOVE 'S' TO SW-911                                     
H P H                    MOVE 'S' TO SW-911-911                                 
H P H                    ADD 1 TO WS-CANT-ERRORES                               
H P H                 ELSE                                                      
H P H            STRING                                                         
H P H            'X9999??????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            'X9999??????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H                 PERFORM 9999-GESTION-ERRORES                              
H P H                 END-IF                                                    
H P H              END-IF                                                       
H P H      END-EVALUATE                                                         
H P H                 END-IF                                                    
H P H               END-IF                                                      
H P H              END-IF                                                       
H P H              IF WS-ROLLBACK = 'SI'                                        
H P H                 SET WS-NO-HAY-SINIESTROS TO TRUE                          
H P H                 MOVE 98 TO WS-ITBLS                                       
H P H              END-IF                                                       
H P H              ADD WC-1 TO WS-ITBLS.                                        
H P H *                                                                         
H P H  3041-PROCESA-KSIM12T.                                                    
H P H              MOVE 'KSIM12T'             TO WS-TABLA-T                     
H P H              MOVE 'KSIM12H'             TO WS-TABLA-H                     
H P H *                                                                         
H P H              MOVE 'KSIM12T'             TO WS-TIPO-TABLA                  
H P H              MOVE 'CDSINIES'            TO WS-CAMPOPOL                    
H P H                                                                           
H P H              IF TAB-ESP-SR                                                
H P H               IF WS-SI-HISTORIFICA                                        
H P H                 PERFORM 3300-INSERTA-ESP-SIN                              
H P H               END-IF                                                      
H P H              ELSE                                                         
H P H               IF WS-SI-HISTORIFICA                                        
H P H      EXEC SQL                                                             
H P H         DECLARE CURSOR-41 CURSOR FOR                                      
H P H            SELECT CDSINIES FROM KSIM12T                                   
H P H             WHERE CDSINIES = :WS-TBL-SINOREC                              
H P H             FETCH FIRST 1 ROWS ONLY                                       
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EXEC SQL                                                             
H P H          OPEN CURSOR-41                                                   
H P H      END-EXEC                                                             
H P H      PERFORM 3306-VALIDA-CODIGO                                           
H P H      EXEC SQL                                                             
H P H          FETCH CURSOR-41                                                  
H P H          INTO                                                             
H P H          :WS-SINOREC                                                      
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H             EXEC SQL                                                      
H P H                CLOSE CURSOR-41                                            
H P H             END-EXEC                                                      
H P H             SET WS-PARA-INSERT TO TRUE                                    
H P H      EXEC SQL                                                             
H P H         INSERT INTO KSIM12H                                               
H P H            (SELECT * FROM KSIM12T                                         
H P H             WHERE CDSINIES = :WS-TBL-SINOREC)                             
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3041-PROCESA-KSIM12T' TO WS-OUT-PARRAFO                
H P H              MOVE 'INSERT CORRECTO '    TO WS-OUT-DESC                    
H P H              MOVE WS-TBL-SINOREC        TO WS-OUT-DESC(18:12)             
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-CLAVE-DUPLICADA                                   
H P H              SET WS-DUPLICADOS   TO TRUE                                  
H P H              MOVE 'SI'                  TO WS-ROLLBACK                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3041-PROCESA-KSIM12T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                'DUPLICADO:'             DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H              INTO WS-OUT-DESC                                             
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H            IF WS-WRITE                                                    
H P H              ADD  WC-1                  TO WS-IERR                        
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3041-PROCESA-KSIM12T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'SIN '                  DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN OTHER                                                         
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                     SET WS-DUPLICADOS   TO TRUE                           
H P H                     MOVE 'SI'                  TO WS-ROLLBACK             
H P H                     MOVE SQLCODE               TO WS-OUT-SQLCODE          
H P H                     MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA           
H P H                     MOVE WS-TABLA-H            TO WS-OUT-TABLA            
H P H                     MOVE '3041-PROCESA-KSIM12T' TO WS-OUT-PARRAFO         
H P H                     STRING                                                
H P H                      'CONTENCIO:'             DELIMITED BY SIZE           
H P H                       WS-CAMPOPOL             DELIMITED BY ' '            
H P H                       '='                     DELIMITED BY SIZE           
H P H                       WS-LEE-CDNUMPOL         DELIMITED BY SIZE           
H P H                       INTO WS-OUT-DESC                                    
H P H                       END-STRING                                          
H P H                     PERFORM 1570-ESCRIBE-DESCARTADA                       
H P H              ELSE                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3041-PROCESA-KSIM12T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'ERRDB2:'               DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H              MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
H P H              MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
H P H              MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
H P H              MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
H P H              MOVE '3041-PROCESA-KSIM12T  ' TO CDPARRAF OF KAELCWEZ        
H P H                                                                           
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 MOVE 'S' TO SW-911-911                                    
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H              ELSE                                                         
H P H                 PERFORM 9999-GESTION-ERRORES                              
H P H              END-IF                                                       
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                                                                           
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H            SET WS-NO-PARA-INSERT      TO TRUE                             
H P H            IF WS-WRITE                                                    
H P H              ADD  WC-1                  TO WS-IERR                        
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3041-PROCESA-KSIM12T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'NOHAY '                DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H            EXEC SQL                                                       
H P H                CLOSE CURSOR-41                                            
H P H            END-EXEC                                                       
H P H        WHEN OTHER                                                         
H P H              SET WS-NO-PARA-INSERT      TO TRUE                           
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3041-PROCESA-KSIM12T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'ERRDB2:'               DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            STRING                                                         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            ' ERROR EN SQL :' W-QUERY-TEXT                    '\N'         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H          MOVE WC-COD                   TO CDERR    OF KAELCWEZ            
H P H          MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ            
H P H          MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ            
H P H          MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ            
H P H          MOVE '3041-PROCESA-KSIM12T  ' TO CDPARRAF OF KAELCWEZ            
H P H                                                                           
H P H          IF SQLCODE = -911                                                
H P H              MOVE 'S' TO SW-911                                           
H P H              MOVE 'S' TO SW-911-911                                       
H P H              ADD 1 TO WS-CANT-ERRORES                                     
H P H          ELSE                                                             
H P H             PERFORM 9999-GESTION-ERRORES                                  
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                 IF  SQLCODE = WN-SQLCODE-OK                               
H P H                 AND WS-PARA-INSERT                                        
H P H      EXEC SQL                                                             
H P H         DELETE FROM KSIM12T                                               
H P H         WHERE CDSINIES = :WS-TBL-SINOREC                                  
H P H      END-EXEC                                                             
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3041-PROCESA-KSIM12T' TO WS-OUT-PARRAFO                
H P H              MOVE 'BORRAR CORRECTO    ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3041-PROCESA-KSIM12T' TO WS-OUT-PARRAFO                
H P H              MOVE 'NO EXISTE BORRAR   ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H              MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
H P H              MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
H P H              MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
H P H              MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
H P H              MOVE '3041-PROCESA-KSIM12T  ' TO CDPARRAF OF KAELCWEZ        
H P H                                                                           
H P H              PERFORM 9999-GESTION-ERRORES                                 
H P H                                                                           
H P H        WHEN OTHER                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3041-PROCESA-KSIM12T' TO WS-OUT-PARRAFO                
H P H              MOVE 'ERR BORRAR DB2     ' TO WS-OUT-DESC                    
H P H              IF SQLCODE  = -911                                           
H P H                 MOVE '3041-PROCESA-KSIM12T'  TO WS-OUT-PARRAFO            
H P H                 MOVE 'CONTENCION TABLA   '   TO WS-OUT-DESC               
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 mOVE 'S' TO SW-911                                        
H P H                 MOVE 'S' TO SW-911-911                                    
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 MOVE 'SI'                  TO WS-ROLLBACK                 
H P H                 MOVE SQLCODE               TO WS-OUT-SQLCODE              
H P H                 MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA               
H P H                 MOVE WS-TABLA-H            TO WS-OUT-TABLA                
H P H                 MOVE '3041-PROCESA-KSIM12T' TO WS-OUT-PARRAFO             
H P H                    STRING                                                 
H P H                   'CONTENCIO:'             DELIMITED BY SIZE              
H P H                    WS-CAMPOPOL             DELIMITED BY ' '               
H P H                    '='                     DELIMITED BY SIZE              
H P H                    WS-LEE-CDNUMPOL         DELIMITED BY SIZE              
H P H                    INTO WS-OUT-DESC                                       
H P H                 END-STRING                                                
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H            STRING                                                         
H P H            'Z8883??????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            'Z8881??????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H              ELSE                                                         
H P H                 MOVE WC-COD              TO CDERR    OF KAELCWEZ          
H P H                 MOVE WC-DES01            TO DSARGU1  OF KAELCWEZ          
H P H                 MOVE WC-PROGRAMA         TO DSARGU2  OF KAELCWEZ          
H P H                 MOVE WS-ERPOLIZA         TO DSARGU3  OF KAELCWEZ          
H P H                 MOVE '3041-PROCESA-KSIM12T'                               
H P H                                          TO CDPARRAF OF KAELCWEZ          
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H                 IF SQLCODE = -911                                         
H P H                    MOVE 'S' TO SW-911                                     
H P H                    MOVE 'S' TO SW-911-911                                 
H P H                    ADD 1 TO WS-CANT-ERRORES                               
H P H                 ELSE                                                      
H P H            STRING                                                         
H P H            'X9999??????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            'X9999??????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H                 PERFORM 9999-GESTION-ERRORES                              
H P H                 END-IF                                                    
H P H              END-IF                                                       
H P H      END-EVALUATE                                                         
H P H                 END-IF                                                    
H P H               END-IF                                                      
H P H              END-IF                                                       
H P H              IF WS-ROLLBACK = 'SI'                                        
H P H                 SET WS-NO-HAY-SINIESTROS TO TRUE                          
H P H                 MOVE 98 TO WS-ITBLS                                       
H P H              END-IF                                                       
H P H              ADD WC-1 TO WS-ITBLS.                                        
H P H *                                                                         
H P H  3042-PROCESA-KSIM20T.                                                    
H P H              MOVE 'KSIM20T'             TO WS-TABLA-T                     
H P H              MOVE 'KSIM20H'             TO WS-TABLA-H                     
H P H *                                                                         
H P H              MOVE 'KSIM20T'             TO WS-TIPO-TABLA                  
H P H              MOVE 'CDSINIES'            TO WS-CAMPOPOL                    
H P H                                                                           
H P H              IF TAB-ESP-SR                                                
H P H               IF WS-SI-HISTORIFICA                                        
H P H                 PERFORM 3300-INSERTA-ESP-SIN                              
H P H               END-IF                                                      
H P H              ELSE                                                         
H P H               IF WS-SI-HISTORIFICA                                        
H P H      EXEC SQL                                                             
H P H         DECLARE CURSOR-42 CURSOR FOR                                      
H P H            SELECT CDSINIES FROM KSIM20T                                   
H P H             WHERE CDSINIES = :WS-TBL-SINOREC                              
H P H             FETCH FIRST 1 ROWS ONLY                                       
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EXEC SQL                                                             
H P H          OPEN CURSOR-42                                                   
H P H      END-EXEC                                                             
H P H      PERFORM 3306-VALIDA-CODIGO                                           
H P H      EXEC SQL                                                             
H P H          FETCH CURSOR-42                                                  
H P H          INTO                                                             
H P H          :WS-SINOREC                                                      
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H             EXEC SQL                                                      
H P H                CLOSE CURSOR-42                                            
H P H             END-EXEC                                                      
H P H             SET WS-PARA-INSERT TO TRUE                                    
H P H      EXEC SQL                                                             
H P H         INSERT INTO KSIM20H                                               
H P H            (SELECT * FROM KSIM20T                                         
H P H             WHERE CDSINIES = :WS-TBL-SINOREC)                             
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3042-PROCESA-KSIM20T' TO WS-OUT-PARRAFO                
H P H              MOVE 'INSERT CORRECTO '    TO WS-OUT-DESC                    
H P H              MOVE WS-TBL-SINOREC        TO WS-OUT-DESC(18:12)             
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-CLAVE-DUPLICADA                                   
H P H              SET WS-DUPLICADOS   TO TRUE                                  
H P H              MOVE 'SI'                  TO WS-ROLLBACK                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3042-PROCESA-KSIM20T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                'DUPLICADO:'             DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H              INTO WS-OUT-DESC                                             
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H            IF WS-WRITE                                                    
H P H              ADD  WC-1                  TO WS-IERR                        
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3042-PROCESA-KSIM20T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'SIN '                  DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN OTHER                                                         
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                     SET WS-DUPLICADOS   TO TRUE                           
H P H                     MOVE 'SI'                  TO WS-ROLLBACK             
H P H                     MOVE SQLCODE               TO WS-OUT-SQLCODE          
H P H                     MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA           
H P H                     MOVE WS-TABLA-H            TO WS-OUT-TABLA            
H P H                     MOVE '3042-PROCESA-KSIM20T' TO WS-OUT-PARRAFO         
H P H                     STRING                                                
H P H                      'CONTENCIO:'             DELIMITED BY SIZE           
H P H                       WS-CAMPOPOL             DELIMITED BY ' '            
H P H                       '='                     DELIMITED BY SIZE           
H P H                       WS-LEE-CDNUMPOL         DELIMITED BY SIZE           
H P H                       INTO WS-OUT-DESC                                    
H P H                       END-STRING                                          
H P H                     PERFORM 1570-ESCRIBE-DESCARTADA                       
H P H              ELSE                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3042-PROCESA-KSIM20T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'ERRDB2:'               DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H              MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
H P H              MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
H P H              MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
H P H              MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
H P H              MOVE '3042-PROCESA-KSIM20T  ' TO CDPARRAF OF KAELCWEZ        
H P H                                                                           
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 MOVE 'S' TO SW-911-911                                    
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H              ELSE                                                         
H P H                 PERFORM 9999-GESTION-ERRORES                              
H P H              END-IF                                                       
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                                                                           
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H            SET WS-NO-PARA-INSERT      TO TRUE                             
H P H            IF WS-WRITE                                                    
H P H              ADD  WC-1                  TO WS-IERR                        
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3042-PROCESA-KSIM20T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'NOHAY '                DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H            EXEC SQL                                                       
H P H                CLOSE CURSOR-42                                            
H P H            END-EXEC                                                       
H P H        WHEN OTHER                                                         
H P H              SET WS-NO-PARA-INSERT      TO TRUE                           
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3042-PROCESA-KSIM20T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'ERRDB2:'               DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            STRING                                                         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            ' ERROR EN SQL :' W-QUERY-TEXT                    '\N'         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H          MOVE WC-COD                   TO CDERR    OF KAELCWEZ            
H P H          MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ            
H P H          MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ            
H P H          MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ            
H P H          MOVE '3042-PROCESA-KSIM20T  ' TO CDPARRAF OF KAELCWEZ            
H P H                                                                           
H P H          IF SQLCODE = -911                                                
H P H              MOVE 'S' TO SW-911                                           
H P H              MOVE 'S' TO SW-911-911                                       
H P H              ADD 1 TO WS-CANT-ERRORES                                     
H P H          ELSE                                                             
H P H             PERFORM 9999-GESTION-ERRORES                                  
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                 IF  SQLCODE = WN-SQLCODE-OK                               
H P H                 AND WS-PARA-INSERT                                        
H P H      EXEC SQL                                                             
H P H         DELETE FROM KSIM20T                                               
H P H         WHERE CDSINIES = :WS-TBL-SINOREC                                  
H P H      END-EXEC                                                             
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3042-PROCESA-KSIM20T' TO WS-OUT-PARRAFO                
H P H              MOVE 'BORRAR CORRECTO    ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3042-PROCESA-KSIM20T' TO WS-OUT-PARRAFO                
H P H              MOVE 'NO EXISTE BORRAR   ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H              MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
H P H              MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
H P H              MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
H P H              MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
H P H              MOVE '3042-PROCESA-KSIM20T  ' TO CDPARRAF OF KAELCWEZ        
H P H                                                                           
H P H              PERFORM 9999-GESTION-ERRORES                                 
H P H                                                                           
H P H        WHEN OTHER                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3042-PROCESA-KSIM20T' TO WS-OUT-PARRAFO                
H P H              MOVE 'ERR BORRAR DB2     ' TO WS-OUT-DESC                    
H P H              IF SQLCODE  = -911                                           
H P H                 MOVE '3042-PROCESA-KSIM20T'  TO WS-OUT-PARRAFO            
H P H                 MOVE 'CONTENCION TABLA   '   TO WS-OUT-DESC               
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 mOVE 'S' TO SW-911                                        
H P H                 MOVE 'S' TO SW-911-911                                    
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 MOVE 'SI'                  TO WS-ROLLBACK                 
H P H                 MOVE SQLCODE               TO WS-OUT-SQLCODE              
H P H                 MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA               
H P H                 MOVE WS-TABLA-H            TO WS-OUT-TABLA                
H P H                 MOVE '3042-PROCESA-KSIM20T' TO WS-OUT-PARRAFO             
H P H                    STRING                                                 
H P H                   'CONTENCIO:'             DELIMITED BY SIZE              
H P H                    WS-CAMPOPOL             DELIMITED BY ' '               
H P H                    '='                     DELIMITED BY SIZE              
H P H                    WS-LEE-CDNUMPOL         DELIMITED BY SIZE              
H P H                    INTO WS-OUT-DESC                                       
H P H                 END-STRING                                                
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H            STRING                                                         
H P H            'Z8883??????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            'Z8881??????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H              ELSE                                                         
H P H                 MOVE WC-COD              TO CDERR    OF KAELCWEZ          
H P H                 MOVE WC-DES01            TO DSARGU1  OF KAELCWEZ          
H P H                 MOVE WC-PROGRAMA         TO DSARGU2  OF KAELCWEZ          
H P H                 MOVE WS-ERPOLIZA         TO DSARGU3  OF KAELCWEZ          
H P H                 MOVE '3042-PROCESA-KSIM20T'                               
H P H                                          TO CDPARRAF OF KAELCWEZ          
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H                 IF SQLCODE = -911                                         
H P H                    MOVE 'S' TO SW-911                                     
H P H                    MOVE 'S' TO SW-911-911                                 
H P H                    ADD 1 TO WS-CANT-ERRORES                               
H P H                 ELSE                                                      
H P H            STRING                                                         
H P H            'X9999??????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            'X9999??????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H                 PERFORM 9999-GESTION-ERRORES                              
H P H                 END-IF                                                    
H P H              END-IF                                                       
H P H      END-EVALUATE                                                         
H P H                 END-IF                                                    
H P H               END-IF                                                      
H P H              END-IF                                                       
H P H              IF WS-ROLLBACK = 'SI'                                        
H P H                 SET WS-NO-HAY-SINIESTROS TO TRUE                          
H P H                 MOVE 98 TO WS-ITBLS                                       
H P H              END-IF                                                       
H P H              ADD WC-1 TO WS-ITBLS.                                        
H P H *                                                                         
H P H  3043-PROCESA-KSIM30T.                                                    
H P H              MOVE 'KSIM30T'             TO WS-TABLA-T                     
H P H              MOVE 'KSIM30H'             TO WS-TABLA-H                     
H P H *                                                                         
H P H              MOVE 'KSIM30T'             TO WS-TIPO-TABLA                  
H P H              MOVE 'CDSINIES'            TO WS-CAMPOPOL                    
H P H                                                                           
H P H              IF TAB-ESP-SR                                                
H P H               IF WS-SI-HISTORIFICA                                        
H P H                 PERFORM 3300-INSERTA-ESP-SIN                              
H P H               END-IF                                                      
H P H              ELSE                                                         
H P H               IF WS-SI-HISTORIFICA                                        
H P H      EXEC SQL                                                             
H P H         DECLARE CURSOR-43 CURSOR FOR                                      
H P H            SELECT CDSINIES FROM KSIM30T                                   
H P H             WHERE CDSINIES = :WS-TBL-SINOREC                              
H P H             FETCH FIRST 1 ROWS ONLY                                       
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EXEC SQL                                                             
H P H          OPEN CURSOR-43                                                   
H P H      END-EXEC                                                             
H P H      PERFORM 3306-VALIDA-CODIGO                                           
H P H      EXEC SQL                                                             
H P H          FETCH CURSOR-43                                                  
H P H          INTO                                                             
H P H          :WS-SINOREC                                                      
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H             EXEC SQL                                                      
H P H                CLOSE CURSOR-43                                            
H P H             END-EXEC                                                      
H P H             SET WS-PARA-INSERT TO TRUE                                    
H P H      EXEC SQL                                                             
H P H         INSERT INTO KSIM30H                                               
H P H            (SELECT * FROM KSIM30T                                         
H P H             WHERE CDSINIES = :WS-TBL-SINOREC)                             
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3043-PROCESA-KSIM30T' TO WS-OUT-PARRAFO                
H P H              MOVE 'INSERT CORRECTO '    TO WS-OUT-DESC                    
H P H              MOVE WS-TBL-SINOREC        TO WS-OUT-DESC(18:12)             
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-CLAVE-DUPLICADA                                   
H P H              SET WS-DUPLICADOS   TO TRUE                                  
H P H              MOVE 'SI'                  TO WS-ROLLBACK                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3043-PROCESA-KSIM30T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                'DUPLICADO:'             DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H              INTO WS-OUT-DESC                                             
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H            IF WS-WRITE                                                    
H P H              ADD  WC-1                  TO WS-IERR                        
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3043-PROCESA-KSIM30T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'SIN '                  DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN OTHER                                                         
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                     SET WS-DUPLICADOS   TO TRUE                           
H P H                     MOVE 'SI'                  TO WS-ROLLBACK             
H P H                     MOVE SQLCODE               TO WS-OUT-SQLCODE          
H P H                     MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA           
H P H                     MOVE WS-TABLA-H            TO WS-OUT-TABLA            
H P H                     MOVE '3043-PROCESA-KSIM30T' TO WS-OUT-PARRAFO         
H P H                     STRING                                                
H P H                      'CONTENCIO:'             DELIMITED BY SIZE           
H P H                       WS-CAMPOPOL             DELIMITED BY ' '            
H P H                       '='                     DELIMITED BY SIZE           
H P H                       WS-LEE-CDNUMPOL         DELIMITED BY SIZE           
H P H                       INTO WS-OUT-DESC                                    
H P H                       END-STRING                                          
H P H                     PERFORM 1570-ESCRIBE-DESCARTADA                       
H P H              ELSE                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3043-PROCESA-KSIM30T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'ERRDB2:'               DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H              MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
H P H              MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
H P H              MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
H P H              MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
H P H              MOVE '3043-PROCESA-KSIM30T  ' TO CDPARRAF OF KAELCWEZ        
H P H                                                                           
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 MOVE 'S' TO SW-911-911                                    
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H              ELSE                                                         
H P H                 PERFORM 9999-GESTION-ERRORES                              
H P H              END-IF                                                       
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                                                                           
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H            SET WS-NO-PARA-INSERT      TO TRUE                             
H P H            IF WS-WRITE                                                    
H P H              ADD  WC-1                  TO WS-IERR                        
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3043-PROCESA-KSIM30T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'NOHAY '                DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H            EXEC SQL                                                       
H P H                CLOSE CURSOR-43                                            
H P H            END-EXEC                                                       
H P H        WHEN OTHER                                                         
H P H              SET WS-NO-PARA-INSERT      TO TRUE                           
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3043-PROCESA-KSIM30T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'ERRDB2:'               DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            STRING                                                         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            ' ERROR EN SQL :' W-QUERY-TEXT                    '\N'         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H          MOVE WC-COD                   TO CDERR    OF KAELCWEZ            
H P H          MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ            
H P H          MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ            
H P H          MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ            
H P H          MOVE '3043-PROCESA-KSIM30T  ' TO CDPARRAF OF KAELCWEZ            
H P H                                                                           
H P H          IF SQLCODE = -911                                                
H P H              MOVE 'S' TO SW-911                                           
H P H              MOVE 'S' TO SW-911-911                                       
H P H              ADD 1 TO WS-CANT-ERRORES                                     
H P H          ELSE                                                             
H P H             PERFORM 9999-GESTION-ERRORES                                  
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                 IF  SQLCODE = WN-SQLCODE-OK                               
H P H                 AND WS-PARA-INSERT                                        
H P H      EXEC SQL                                                             
H P H         DELETE FROM KSIM30T                                               
H P H         WHERE CDSINIES = :WS-TBL-SINOREC                                  
H P H      END-EXEC                                                             
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3043-PROCESA-KSIM30T' TO WS-OUT-PARRAFO                
H P H              MOVE 'BORRAR CORRECTO    ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3043-PROCESA-KSIM30T' TO WS-OUT-PARRAFO                
H P H              MOVE 'NO EXISTE BORRAR   ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H              MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
H P H              MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
H P H              MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
H P H              MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
H P H              MOVE '3043-PROCESA-KSIM30T  ' TO CDPARRAF OF KAELCWEZ        
H P H                                                                           
H P H              PERFORM 9999-GESTION-ERRORES                                 
H P H                                                                           
H P H        WHEN OTHER                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3043-PROCESA-KSIM30T' TO WS-OUT-PARRAFO                
H P H              MOVE 'ERR BORRAR DB2     ' TO WS-OUT-DESC                    
H P H              IF SQLCODE  = -911                                           
H P H                 MOVE '3043-PROCESA-KSIM30T'  TO WS-OUT-PARRAFO            
H P H                 MOVE 'CONTENCION TABLA   '   TO WS-OUT-DESC               
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 mOVE 'S' TO SW-911                                        
H P H                 MOVE 'S' TO SW-911-911                                    
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 MOVE 'SI'                  TO WS-ROLLBACK                 
H P H                 MOVE SQLCODE               TO WS-OUT-SQLCODE              
H P H                 MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA               
H P H                 MOVE WS-TABLA-H            TO WS-OUT-TABLA                
H P H                 MOVE '3043-PROCESA-KSIM30T' TO WS-OUT-PARRAFO             
H P H                    STRING                                                 
H P H                   'CONTENCIO:'             DELIMITED BY SIZE              
H P H                    WS-CAMPOPOL             DELIMITED BY ' '               
H P H                    '='                     DELIMITED BY SIZE              
H P H                    WS-LEE-CDNUMPOL         DELIMITED BY SIZE              
H P H                    INTO WS-OUT-DESC                                       
H P H                 END-STRING                                                
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H            STRING                                                         
H P H            'Z8883??????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            'Z8881??????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H              ELSE                                                         
H P H                 MOVE WC-COD              TO CDERR    OF KAELCWEZ          
H P H                 MOVE WC-DES01            TO DSARGU1  OF KAELCWEZ          
H P H                 MOVE WC-PROGRAMA         TO DSARGU2  OF KAELCWEZ          
H P H                 MOVE WS-ERPOLIZA         TO DSARGU3  OF KAELCWEZ          
H P H                 MOVE '3043-PROCESA-KSIM30T'                               
H P H                                          TO CDPARRAF OF KAELCWEZ          
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H                 IF SQLCODE = -911                                         
H P H                    MOVE 'S' TO SW-911                                     
H P H                    MOVE 'S' TO SW-911-911                                 
H P H                    ADD 1 TO WS-CANT-ERRORES                               
H P H                 ELSE                                                      
H P H            STRING                                                         
H P H            'X9999??????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            'X9999??????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H                 PERFORM 9999-GESTION-ERRORES                              
H P H                 END-IF                                                    
H P H              END-IF                                                       
H P H      END-EVALUATE                                                         
H P H                 END-IF                                                    
H P H               END-IF                                                      
H P H              END-IF                                                       
H P H              IF WS-ROLLBACK = 'SI'                                        
H P H                 SET WS-NO-HAY-SINIESTROS TO TRUE                          
H P H                 MOVE 98 TO WS-ITBLS                                       
H P H              END-IF                                                       
H P H              ADD WC-1 TO WS-ITBLS.                                        
H P H *                                                                         
H P H  3044-PROCESA-KSIM3AT.                                                    
H P H              MOVE 'KSIM3AT'             TO WS-TABLA-T                     
H P H              MOVE 'KSIM3AH'             TO WS-TABLA-H                     
H P H *                                                                         
H P H              MOVE 'KSIM3AT'             TO WS-TIPO-TABLA                  
H P H              MOVE 'CDSINIES'            TO WS-CAMPOPOL                    
H P H                                                                           
H P H              IF TAB-ESP-SR                                                
H P H               IF WS-SI-HISTORIFICA                                        
H P H                 PERFORM 3300-INSERTA-ESP-SIN                              
H P H               END-IF                                                      
H P H              ELSE                                                         
H P H               IF WS-SI-HISTORIFICA                                        
H P H      EXEC SQL                                                             
H P H         DECLARE CURSOR-44 CURSOR FOR                                      
H P H            SELECT CDSINIES FROM KSIM3AT                                   
H P H             WHERE CDSINIES = :WS-TBL-SINOREC                              
H P H             FETCH FIRST 1 ROWS ONLY                                       
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EXEC SQL                                                             
H P H          OPEN CURSOR-44                                                   
H P H      END-EXEC                                                             
H P H      PERFORM 3306-VALIDA-CODIGO                                           
H P H      EXEC SQL                                                             
H P H          FETCH CURSOR-44                                                  
H P H          INTO                                                             
H P H          :WS-SINOREC                                                      
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H             EXEC SQL                                                      
H P H                CLOSE CURSOR-44                                            
H P H             END-EXEC                                                      
H P H             SET WS-PARA-INSERT TO TRUE                                    
H P H      EXEC SQL                                                             
H P H         INSERT INTO KSIM3AH                                               
H P H            (SELECT * FROM KSIM3AT                                         
H P H             WHERE CDSINIES = :WS-TBL-SINOREC)                             
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3044-PROCESA-KSIM3AT' TO WS-OUT-PARRAFO                
H P H              MOVE 'INSERT CORRECTO '    TO WS-OUT-DESC                    
H P H              MOVE WS-TBL-SINOREC        TO WS-OUT-DESC(18:12)             
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-CLAVE-DUPLICADA                                   
H P H              SET WS-DUPLICADOS   TO TRUE                                  
H P H              MOVE 'SI'                  TO WS-ROLLBACK                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3044-PROCESA-KSIM3AT' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                'DUPLICADO:'             DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H              INTO WS-OUT-DESC                                             
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H            IF WS-WRITE                                                    
H P H              ADD  WC-1                  TO WS-IERR                        
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3044-PROCESA-KSIM3AT' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'SIN '                  DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN OTHER                                                         
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                     SET WS-DUPLICADOS   TO TRUE                           
H P H                     MOVE 'SI'                  TO WS-ROLLBACK             
H P H                     MOVE SQLCODE               TO WS-OUT-SQLCODE          
H P H                     MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA           
H P H                     MOVE WS-TABLA-H            TO WS-OUT-TABLA            
H P H                     MOVE '3044-PROCESA-KSIM3AT' TO WS-OUT-PARRAFO         
H P H                     STRING                                                
H P H                      'CONTENCIO:'             DELIMITED BY SIZE           
H P H                       WS-CAMPOPOL             DELIMITED BY ' '            
H P H                       '='                     DELIMITED BY SIZE           
H P H                       WS-LEE-CDNUMPOL         DELIMITED BY SIZE           
H P H                       INTO WS-OUT-DESC                                    
H P H                       END-STRING                                          
H P H                     PERFORM 1570-ESCRIBE-DESCARTADA                       
H P H              ELSE                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3044-PROCESA-KSIM3AT' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'ERRDB2:'               DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H              MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
H P H              MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
H P H              MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
H P H              MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
H P H              MOVE '3044-PROCESA-KSIM3AT  ' TO CDPARRAF OF KAELCWEZ        
H P H                                                                           
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 MOVE 'S' TO SW-911-911                                    
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H              ELSE                                                         
H P H                 PERFORM 9999-GESTION-ERRORES                              
H P H              END-IF                                                       
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                                                                           
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H            SET WS-NO-PARA-INSERT      TO TRUE                             
H P H            IF WS-WRITE                                                    
H P H              ADD  WC-1                  TO WS-IERR                        
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3044-PROCESA-KSIM3AT' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'NOHAY '                DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H            EXEC SQL                                                       
H P H                CLOSE CURSOR-44                                            
H P H            END-EXEC                                                       
H P H        WHEN OTHER                                                         
H P H              SET WS-NO-PARA-INSERT      TO TRUE                           
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3044-PROCESA-KSIM3AT' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'ERRDB2:'               DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            STRING                                                         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            ' ERROR EN SQL :' W-QUERY-TEXT                    '\N'         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H          MOVE WC-COD                   TO CDERR    OF KAELCWEZ            
H P H          MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ            
H P H          MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ            
H P H          MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ            
H P H          MOVE '3044-PROCESA-KSIM3AT  ' TO CDPARRAF OF KAELCWEZ            
H P H                                                                           
H P H          IF SQLCODE = -911                                                
H P H              MOVE 'S' TO SW-911                                           
H P H              MOVE 'S' TO SW-911-911                                       
H P H              ADD 1 TO WS-CANT-ERRORES                                     
H P H          ELSE                                                             
H P H             PERFORM 9999-GESTION-ERRORES                                  
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                 IF  SQLCODE = WN-SQLCODE-OK                               
H P H                 AND WS-PARA-INSERT                                        
H P H      EXEC SQL                                                             
H P H         DELETE FROM KSIM3AT                                               
H P H         WHERE CDSINIES = :WS-TBL-SINOREC                                  
H P H      END-EXEC                                                             
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3044-PROCESA-KSIM3AT' TO WS-OUT-PARRAFO                
H P H              MOVE 'BORRAR CORRECTO    ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3044-PROCESA-KSIM3AT' TO WS-OUT-PARRAFO                
H P H              MOVE 'NO EXISTE BORRAR   ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H              MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
H P H              MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
H P H              MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
H P H              MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
H P H              MOVE '3044-PROCESA-KSIM3AT  ' TO CDPARRAF OF KAELCWEZ        
H P H                                                                           
H P H              PERFORM 9999-GESTION-ERRORES                                 
H P H                                                                           
H P H        WHEN OTHER                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3044-PROCESA-KSIM3AT' TO WS-OUT-PARRAFO                
H P H              MOVE 'ERR BORRAR DB2     ' TO WS-OUT-DESC                    
H P H              IF SQLCODE  = -911                                           
H P H                 MOVE '3044-PROCESA-KSIM3AT'  TO WS-OUT-PARRAFO            
H P H                 MOVE 'CONTENCION TABLA   '   TO WS-OUT-DESC               
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 mOVE 'S' TO SW-911                                        
H P H                 MOVE 'S' TO SW-911-911                                    
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 MOVE 'SI'                  TO WS-ROLLBACK                 
H P H                 MOVE SQLCODE               TO WS-OUT-SQLCODE              
H P H                 MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA               
H P H                 MOVE WS-TABLA-H            TO WS-OUT-TABLA                
H P H                 MOVE '3044-PROCESA-KSIM3AT' TO WS-OUT-PARRAFO             
H P H                    STRING                                                 
H P H                   'CONTENCIO:'             DELIMITED BY SIZE              
H P H                    WS-CAMPOPOL             DELIMITED BY ' '               
H P H                    '='                     DELIMITED BY SIZE              
H P H                    WS-LEE-CDNUMPOL         DELIMITED BY SIZE              
H P H                    INTO WS-OUT-DESC                                       
H P H                 END-STRING                                                
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H            STRING                                                         
H P H            'Z8883??????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            'Z8881??????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H              ELSE                                                         
H P H                 MOVE WC-COD              TO CDERR    OF KAELCWEZ          
H P H                 MOVE WC-DES01            TO DSARGU1  OF KAELCWEZ          
H P H                 MOVE WC-PROGRAMA         TO DSARGU2  OF KAELCWEZ          
H P H                 MOVE WS-ERPOLIZA         TO DSARGU3  OF KAELCWEZ          
H P H                 MOVE '3044-PROCESA-KSIM3AT'                               
H P H                                          TO CDPARRAF OF KAELCWEZ          
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H                 IF SQLCODE = -911                                         
H P H                    MOVE 'S' TO SW-911                                     
H P H                    MOVE 'S' TO SW-911-911                                 
H P H                    ADD 1 TO WS-CANT-ERRORES                               
H P H                 ELSE                                                      
H P H            STRING                                                         
H P H            'X9999??????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            'X9999??????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H                 PERFORM 9999-GESTION-ERRORES                              
H P H                 END-IF                                                    
H P H              END-IF                                                       
H P H      END-EVALUATE                                                         
H P H                 END-IF                                                    
H P H               END-IF                                                      
H P H              END-IF                                                       
H P H              IF WS-ROLLBACK = 'SI'                                        
H P H                 SET WS-NO-HAY-SINIESTROS TO TRUE                          
H P H                 MOVE 98 TO WS-ITBLS                                       
H P H              END-IF                                                       
H P H              ADD WC-1 TO WS-ITBLS.                                        
H P H *                                                                         
H P H  3045-PROCESA-KSIM4AT.                                                    
H P H              MOVE 'KSIM4AT'             TO WS-TABLA-T                     
H P H              MOVE 'KSIM4AH'             TO WS-TABLA-H                     
H P H *                                                                         
H P H              MOVE 'KSIM4AT'             TO WS-TIPO-TABLA                  
H P H              MOVE 'CDSINIES'            TO WS-CAMPOPOL                    
H P H                                                                           
H P H              IF TAB-ESP-SR                                                
H P H               IF WS-SI-HISTORIFICA                                        
H P H                 PERFORM 3300-INSERTA-ESP-SIN                              
H P H               END-IF                                                      
H P H              ELSE                                                         
H P H               IF WS-SI-HISTORIFICA                                        
H P H      EXEC SQL                                                             
H P H         DECLARE CURSOR-45 CURSOR FOR                                      
H P H            SELECT CDSINIES FROM KSIM4AT                                   
H P H             WHERE CDSINIES = :WS-TBL-SINOREC                              
H P H             FETCH FIRST 1 ROWS ONLY                                       
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EXEC SQL                                                             
H P H          OPEN CURSOR-45                                                   
H P H      END-EXEC                                                             
H P H      PERFORM 3306-VALIDA-CODIGO                                           
H P H      EXEC SQL                                                             
H P H          FETCH CURSOR-45                                                  
H P H          INTO                                                             
H P H          :WS-SINOREC                                                      
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H             EXEC SQL                                                      
H P H                CLOSE CURSOR-45                                            
H P H             END-EXEC                                                      
H P H             SET WS-PARA-INSERT TO TRUE                                    
H P H      EXEC SQL                                                             
H P H         INSERT INTO KSIM4AH                                               
H P H            (SELECT * FROM KSIM4AT                                         
H P H             WHERE CDSINIES = :WS-TBL-SINOREC)                             
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3045-PROCESA-KSIM4AT' TO WS-OUT-PARRAFO                
H P H              MOVE 'INSERT CORRECTO '    TO WS-OUT-DESC                    
H P H              MOVE WS-TBL-SINOREC        TO WS-OUT-DESC(18:12)             
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-CLAVE-DUPLICADA                                   
H P H              SET WS-DUPLICADOS   TO TRUE                                  
H P H              MOVE 'SI'                  TO WS-ROLLBACK                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3045-PROCESA-KSIM4AT' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                'DUPLICADO:'             DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H              INTO WS-OUT-DESC                                             
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H            IF WS-WRITE                                                    
H P H              ADD  WC-1                  TO WS-IERR                        
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3045-PROCESA-KSIM4AT' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'SIN '                  DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN OTHER                                                         
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                     SET WS-DUPLICADOS   TO TRUE                           
H P H                     MOVE 'SI'                  TO WS-ROLLBACK             
H P H                     MOVE SQLCODE               TO WS-OUT-SQLCODE          
H P H                     MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA           
H P H                     MOVE WS-TABLA-H            TO WS-OUT-TABLA            
H P H                     MOVE '3045-PROCESA-KSIM4AT' TO WS-OUT-PARRAFO         
H P H                     STRING                                                
H P H                      'CONTENCIO:'             DELIMITED BY SIZE           
H P H                       WS-CAMPOPOL             DELIMITED BY ' '            
H P H                       '='                     DELIMITED BY SIZE           
H P H                       WS-LEE-CDNUMPOL         DELIMITED BY SIZE           
H P H                       INTO WS-OUT-DESC                                    
H P H                       END-STRING                                          
H P H                     PERFORM 1570-ESCRIBE-DESCARTADA                       
H P H              ELSE                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3045-PROCESA-KSIM4AT' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'ERRDB2:'               DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H              MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
H P H              MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
H P H              MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
H P H              MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
H P H              MOVE '3045-PROCESA-KSIM4AT  ' TO CDPARRAF OF KAELCWEZ        
H P H                                                                           
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 MOVE 'S' TO SW-911-911                                    
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H              ELSE                                                         
H P H                 PERFORM 9999-GESTION-ERRORES                              
H P H              END-IF                                                       
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                                                                           
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H            SET WS-NO-PARA-INSERT      TO TRUE                             
H P H            IF WS-WRITE                                                    
H P H              ADD  WC-1                  TO WS-IERR                        
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3045-PROCESA-KSIM4AT' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'NOHAY '                DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H            EXEC SQL                                                       
H P H                CLOSE CURSOR-45                                            
H P H            END-EXEC                                                       
H P H        WHEN OTHER                                                         
H P H              SET WS-NO-PARA-INSERT      TO TRUE                           
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3045-PROCESA-KSIM4AT' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'ERRDB2:'               DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            STRING                                                         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            ' ERROR EN SQL :' W-QUERY-TEXT                    '\N'         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H          MOVE WC-COD                   TO CDERR    OF KAELCWEZ            
H P H          MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ            
H P H          MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ            
H P H          MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ            
H P H          MOVE '3045-PROCESA-KSIM4AT  ' TO CDPARRAF OF KAELCWEZ            
H P H                                                                           
H P H          IF SQLCODE = -911                                                
H P H              MOVE 'S' TO SW-911                                           
H P H              MOVE 'S' TO SW-911-911                                       
H P H              ADD 1 TO WS-CANT-ERRORES                                     
H P H          ELSE                                                             
H P H             PERFORM 9999-GESTION-ERRORES                                  
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                 IF  SQLCODE = WN-SQLCODE-OK                               
H P H                 AND WS-PARA-INSERT                                        
H P H      EXEC SQL                                                             
H P H         DELETE FROM KSIM4AT                                               
H P H         WHERE CDSINIES = :WS-TBL-SINOREC                                  
H P H      END-EXEC                                                             
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3045-PROCESA-KSIM4AT' TO WS-OUT-PARRAFO                
H P H              MOVE 'BORRAR CORRECTO    ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3045-PROCESA-KSIM4AT' TO WS-OUT-PARRAFO                
H P H              MOVE 'NO EXISTE BORRAR   ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H              MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
H P H              MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
H P H              MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
H P H              MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
H P H              MOVE '3045-PROCESA-KSIM4AT  ' TO CDPARRAF OF KAELCWEZ        
H P H                                                                           
H P H              PERFORM 9999-GESTION-ERRORES                                 
H P H                                                                           
H P H        WHEN OTHER                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3045-PROCESA-KSIM4AT' TO WS-OUT-PARRAFO                
H P H              MOVE 'ERR BORRAR DB2     ' TO WS-OUT-DESC                    
H P H              IF SQLCODE  = -911                                           
H P H                 MOVE '3045-PROCESA-KSIM4AT'  TO WS-OUT-PARRAFO            
H P H                 MOVE 'CONTENCION TABLA   '   TO WS-OUT-DESC               
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 mOVE 'S' TO SW-911                                        
H P H                 MOVE 'S' TO SW-911-911                                    
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 MOVE 'SI'                  TO WS-ROLLBACK                 
H P H                 MOVE SQLCODE               TO WS-OUT-SQLCODE              
H P H                 MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA               
H P H                 MOVE WS-TABLA-H            TO WS-OUT-TABLA                
H P H                 MOVE '3045-PROCESA-KSIM4AT' TO WS-OUT-PARRAFO             
H P H                    STRING                                                 
H P H                   'CONTENCIO:'             DELIMITED BY SIZE              
H P H                    WS-CAMPOPOL             DELIMITED BY ' '               
H P H                    '='                     DELIMITED BY SIZE              
H P H                    WS-LEE-CDNUMPOL         DELIMITED BY SIZE              
H P H                    INTO WS-OUT-DESC                                       
H P H                 END-STRING                                                
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H            STRING                                                         
H P H            'Z8883??????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            'Z8881??????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H              ELSE                                                         
H P H                 MOVE WC-COD              TO CDERR    OF KAELCWEZ          
H P H                 MOVE WC-DES01            TO DSARGU1  OF KAELCWEZ          
H P H                 MOVE WC-PROGRAMA         TO DSARGU2  OF KAELCWEZ          
H P H                 MOVE WS-ERPOLIZA         TO DSARGU3  OF KAELCWEZ          
H P H                 MOVE '3045-PROCESA-KSIM4AT'                               
H P H                                          TO CDPARRAF OF KAELCWEZ          
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H                 IF SQLCODE = -911                                         
H P H                    MOVE 'S' TO SW-911                                     
H P H                    MOVE 'S' TO SW-911-911                                 
H P H                    ADD 1 TO WS-CANT-ERRORES                               
H P H                 ELSE                                                      
H P H            STRING                                                         
H P H            'X9999??????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            'X9999??????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H                 PERFORM 9999-GESTION-ERRORES                              
H P H                 END-IF                                                    
H P H              END-IF                                                       
H P H      END-EVALUATE                                                         
H P H                 END-IF                                                    
H P H               END-IF                                                      
H P H              END-IF                                                       
H P H              IF WS-ROLLBACK = 'SI'                                        
H P H                 SET WS-NO-HAY-SINIESTROS TO TRUE                          
H P H                 MOVE 98 TO WS-ITBLS                                       
H P H              END-IF                                                       
H P H              ADD WC-1 TO WS-ITBLS.                                        
H P H *                                                                         
H P H  3046-PROCESA-KSIM5AT.                                                    
H P H              MOVE 'KSIM5AT'             TO WS-TABLA-T                     
H P H              MOVE 'KSIM5AH'             TO WS-TABLA-H                     
H P H *                                                                         
H P H              MOVE 'KSIM5AT'             TO WS-TIPO-TABLA                  
H P H              MOVE 'CDSINIES'            TO WS-CAMPOPOL                    
H P H                                                                           
H P H              IF TAB-ESP-SR                                                
H P H               IF WS-SI-HISTORIFICA                                        
H P H                 PERFORM 3300-INSERTA-ESP-SIN                              
H P H               END-IF                                                      
H P H              ELSE                                                         
H P H               IF WS-SI-HISTORIFICA                                        
H P H      EXEC SQL                                                             
H P H         DECLARE CURSOR-46 CURSOR FOR                                      
H P H            SELECT CDSINIES FROM KSIM5AT                                   
H P H             WHERE CDSINIES = :WS-TBL-SINOREC                              
H P H             FETCH FIRST 1 ROWS ONLY                                       
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EXEC SQL                                                             
H P H          OPEN CURSOR-46                                                   
H P H      END-EXEC                                                             
H P H      PERFORM 3306-VALIDA-CODIGO                                           
H P H      EXEC SQL                                                             
H P H          FETCH CURSOR-46                                                  
H P H          INTO                                                             
H P H          :WS-SINOREC                                                      
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H             EXEC SQL                                                      
H P H                CLOSE CURSOR-46                                            
H P H             END-EXEC                                                      
H P H             SET WS-PARA-INSERT TO TRUE                                    
H P H      EXEC SQL                                                             
H P H         INSERT INTO KSIM5AH                                               
H P H            (SELECT * FROM KSIM5AT                                         
H P H             WHERE CDSINIES = :WS-TBL-SINOREC)                             
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3046-PROCESA-KSIM5AT' TO WS-OUT-PARRAFO                
H P H              MOVE 'INSERT CORRECTO '    TO WS-OUT-DESC                    
H P H              MOVE WS-TBL-SINOREC        TO WS-OUT-DESC(18:12)             
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-CLAVE-DUPLICADA                                   
H P H              SET WS-DUPLICADOS   TO TRUE                                  
H P H              MOVE 'SI'                  TO WS-ROLLBACK                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3046-PROCESA-KSIM5AT' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                'DUPLICADO:'             DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H              INTO WS-OUT-DESC                                             
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H            IF WS-WRITE                                                    
H P H              ADD  WC-1                  TO WS-IERR                        
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3046-PROCESA-KSIM5AT' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'SIN '                  DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN OTHER                                                         
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                     SET WS-DUPLICADOS   TO TRUE                           
H P H                     MOVE 'SI'                  TO WS-ROLLBACK             
H P H                     MOVE SQLCODE               TO WS-OUT-SQLCODE          
H P H                     MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA           
H P H                     MOVE WS-TABLA-H            TO WS-OUT-TABLA            
H P H                     MOVE '3046-PROCESA-KSIM5AT' TO WS-OUT-PARRAFO         
H P H                     STRING                                                
H P H                      'CONTENCIO:'             DELIMITED BY SIZE           
H P H                       WS-CAMPOPOL             DELIMITED BY ' '            
H P H                       '='                     DELIMITED BY SIZE           
H P H                       WS-LEE-CDNUMPOL         DELIMITED BY SIZE           
H P H                       INTO WS-OUT-DESC                                    
H P H                       END-STRING                                          
H P H                     PERFORM 1570-ESCRIBE-DESCARTADA                       
H P H              ELSE                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3046-PROCESA-KSIM5AT' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'ERRDB2:'               DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H              MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
H P H              MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
H P H              MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
H P H              MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
H P H              MOVE '3046-PROCESA-KSIM5AT  ' TO CDPARRAF OF KAELCWEZ        
H P H                                                                           
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 MOVE 'S' TO SW-911-911                                    
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H              ELSE                                                         
H P H                 PERFORM 9999-GESTION-ERRORES                              
H P H              END-IF                                                       
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                                                                           
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H            SET WS-NO-PARA-INSERT      TO TRUE                             
H P H            IF WS-WRITE                                                    
H P H              ADD  WC-1                  TO WS-IERR                        
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3046-PROCESA-KSIM5AT' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'NOHAY '                DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H            EXEC SQL                                                       
H P H                CLOSE CURSOR-46                                            
H P H            END-EXEC                                                       
H P H        WHEN OTHER                                                         
H P H              SET WS-NO-PARA-INSERT      TO TRUE                           
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3046-PROCESA-KSIM5AT' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'ERRDB2:'               DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            STRING                                                         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            ' ERROR EN SQL :' W-QUERY-TEXT                    '\N'         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H          MOVE WC-COD                   TO CDERR    OF KAELCWEZ            
H P H          MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ            
H P H          MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ            
H P H          MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ            
H P H          MOVE '3046-PROCESA-KSIM5AT  ' TO CDPARRAF OF KAELCWEZ            
H P H                                                                           
H P H          IF SQLCODE = -911                                                
H P H              MOVE 'S' TO SW-911                                           
H P H              MOVE 'S' TO SW-911-911                                       
H P H              ADD 1 TO WS-CANT-ERRORES                                     
H P H          ELSE                                                             
H P H             PERFORM 9999-GESTION-ERRORES                                  
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                 IF  SQLCODE = WN-SQLCODE-OK                               
H P H                 AND WS-PARA-INSERT                                        
H P H      EXEC SQL                                                             
H P H         DELETE FROM KSIM5AT                                               
H P H         WHERE CDSINIES = :WS-TBL-SINOREC                                  
H P H      END-EXEC                                                             
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3046-PROCESA-KSIM5AT' TO WS-OUT-PARRAFO                
H P H              MOVE 'BORRAR CORRECTO    ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3046-PROCESA-KSIM5AT' TO WS-OUT-PARRAFO                
H P H              MOVE 'NO EXISTE BORRAR   ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H              MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
H P H              MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
H P H              MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
H P H              MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
H P H              MOVE '3046-PROCESA-KSIM5AT  ' TO CDPARRAF OF KAELCWEZ        
H P H                                                                           
H P H              PERFORM 9999-GESTION-ERRORES                                 
H P H                                                                           
H P H        WHEN OTHER                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3046-PROCESA-KSIM5AT' TO WS-OUT-PARRAFO                
H P H              MOVE 'ERR BORRAR DB2     ' TO WS-OUT-DESC                    
H P H              IF SQLCODE  = -911                                           
H P H                 MOVE '3046-PROCESA-KSIM5AT'  TO WS-OUT-PARRAFO            
H P H                 MOVE 'CONTENCION TABLA   '   TO WS-OUT-DESC               
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 mOVE 'S' TO SW-911                                        
H P H                 MOVE 'S' TO SW-911-911                                    
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 MOVE 'SI'                  TO WS-ROLLBACK                 
H P H                 MOVE SQLCODE               TO WS-OUT-SQLCODE              
H P H                 MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA               
H P H                 MOVE WS-TABLA-H            TO WS-OUT-TABLA                
H P H                 MOVE '3046-PROCESA-KSIM5AT' TO WS-OUT-PARRAFO             
H P H                    STRING                                                 
H P H                   'CONTENCIO:'             DELIMITED BY SIZE              
H P H                    WS-CAMPOPOL             DELIMITED BY ' '               
H P H                    '='                     DELIMITED BY SIZE              
H P H                    WS-LEE-CDNUMPOL         DELIMITED BY SIZE              
H P H                    INTO WS-OUT-DESC                                       
H P H                 END-STRING                                                
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H            STRING                                                         
H P H            'Z8883??????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            'Z8881??????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H              ELSE                                                         
H P H                 MOVE WC-COD              TO CDERR    OF KAELCWEZ          
H P H                 MOVE WC-DES01            TO DSARGU1  OF KAELCWEZ          
H P H                 MOVE WC-PROGRAMA         TO DSARGU2  OF KAELCWEZ          
H P H                 MOVE WS-ERPOLIZA         TO DSARGU3  OF KAELCWEZ          
H P H                 MOVE '3046-PROCESA-KSIM5AT'                               
H P H                                          TO CDPARRAF OF KAELCWEZ          
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H                 IF SQLCODE = -911                                         
H P H                    MOVE 'S' TO SW-911                                     
H P H                    MOVE 'S' TO SW-911-911                                 
H P H                    ADD 1 TO WS-CANT-ERRORES                               
H P H                 ELSE                                                      
H P H            STRING                                                         
H P H            'X9999??????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            'X9999??????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H                 PERFORM 9999-GESTION-ERRORES                              
H P H                 END-IF                                                    
H P H              END-IF                                                       
H P H      END-EVALUATE                                                         
H P H                 END-IF                                                    
H P H               END-IF                                                      
H P H              END-IF                                                       
H P H              IF WS-ROLLBACK = 'SI'                                        
H P H                 SET WS-NO-HAY-SINIESTROS TO TRUE                          
H P H                 MOVE 98 TO WS-ITBLS                                       
H P H              END-IF                                                       
H P H              ADD WC-1 TO WS-ITBLS.                                        
H P H *                                                                         
H P H  3047-PROCESA-KSIM61T.                                                    
H P H              MOVE 'KSIM61T'             TO WS-TABLA-T                     
H P H              MOVE 'KSIM61H'             TO WS-TABLA-H                     
H P H *                                                                         
H P H              MOVE 'KSIM61T'             TO WS-TIPO-TABLA                  
H P H              MOVE 'CDSINIES'            TO WS-CAMPOPOL                    
H P H                                                                           
H P H              IF TAB-ESP-SR                                                
H P H               IF WS-SI-HISTORIFICA                                        
H P H                 PERFORM 3300-INSERTA-ESP-SIN                              
H P H               END-IF                                                      
H P H              ELSE                                                         
H P H               IF WS-SI-HISTORIFICA                                        
H P H      EXEC SQL                                                             
H P H         DECLARE CURSOR-47 CURSOR FOR                                      
H P H            SELECT CDSINIES FROM KSIM61T                                   
H P H             WHERE CDSINIES = :WS-TBL-SINOREC                              
H P H             FETCH FIRST 1 ROWS ONLY                                       
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EXEC SQL                                                             
H P H          OPEN CURSOR-47                                                   
H P H      END-EXEC                                                             
H P H      PERFORM 3306-VALIDA-CODIGO                                           
H P H      EXEC SQL                                                             
H P H          FETCH CURSOR-47                                                  
H P H          INTO                                                             
H P H          :WS-SINOREC                                                      
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H             EXEC SQL                                                      
H P H                CLOSE CURSOR-47                                            
H P H             END-EXEC                                                      
H P H             SET WS-PARA-INSERT TO TRUE                                    
H P H      EXEC SQL                                                             
H P H         INSERT INTO KSIM61H                                               
H P H            (SELECT * FROM KSIM61T                                         
H P H             WHERE CDSINIES = :WS-TBL-SINOREC)                             
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3047-PROCESA-KSIM61T' TO WS-OUT-PARRAFO                
H P H              MOVE 'INSERT CORRECTO '    TO WS-OUT-DESC                    
H P H              MOVE WS-TBL-SINOREC        TO WS-OUT-DESC(18:12)             
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-CLAVE-DUPLICADA                                   
H P H              SET WS-DUPLICADOS   TO TRUE                                  
H P H              MOVE 'SI'                  TO WS-ROLLBACK                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3047-PROCESA-KSIM61T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                'DUPLICADO:'             DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H              INTO WS-OUT-DESC                                             
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H            IF WS-WRITE                                                    
H P H              ADD  WC-1                  TO WS-IERR                        
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3047-PROCESA-KSIM61T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'SIN '                  DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN OTHER                                                         
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                     SET WS-DUPLICADOS   TO TRUE                           
H P H                     MOVE 'SI'                  TO WS-ROLLBACK             
H P H                     MOVE SQLCODE               TO WS-OUT-SQLCODE          
H P H                     MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA           
H P H                     MOVE WS-TABLA-H            TO WS-OUT-TABLA            
H P H                     MOVE '3047-PROCESA-KSIM61T' TO WS-OUT-PARRAFO         
H P H                     STRING                                                
H P H                      'CONTENCIO:'             DELIMITED BY SIZE           
H P H                       WS-CAMPOPOL             DELIMITED BY ' '            
H P H                       '='                     DELIMITED BY SIZE           
H P H                       WS-LEE-CDNUMPOL         DELIMITED BY SIZE           
H P H                       INTO WS-OUT-DESC                                    
H P H                       END-STRING                                          
H P H                     PERFORM 1570-ESCRIBE-DESCARTADA                       
H P H              ELSE                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3047-PROCESA-KSIM61T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'ERRDB2:'               DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H              MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
H P H              MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
H P H              MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
H P H              MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
H P H              MOVE '3047-PROCESA-KSIM61T  ' TO CDPARRAF OF KAELCWEZ        
H P H                                                                           
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 MOVE 'S' TO SW-911-911                                    
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H              ELSE                                                         
H P H                 PERFORM 9999-GESTION-ERRORES                              
H P H              END-IF                                                       
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                                                                           
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H            SET WS-NO-PARA-INSERT      TO TRUE                             
H P H            IF WS-WRITE                                                    
H P H              ADD  WC-1                  TO WS-IERR                        
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3047-PROCESA-KSIM61T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'NOHAY '                DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H            EXEC SQL                                                       
H P H                CLOSE CURSOR-47                                            
H P H            END-EXEC                                                       
H P H        WHEN OTHER                                                         
H P H              SET WS-NO-PARA-INSERT      TO TRUE                           
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3047-PROCESA-KSIM61T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'ERRDB2:'               DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            STRING                                                         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            ' ERROR EN SQL :' W-QUERY-TEXT                    '\N'         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H          MOVE WC-COD                   TO CDERR    OF KAELCWEZ            
H P H          MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ            
H P H          MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ            
H P H          MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ            
H P H          MOVE '3047-PROCESA-KSIM61T  ' TO CDPARRAF OF KAELCWEZ            
H P H                                                                           
H P H          IF SQLCODE = -911                                                
H P H              MOVE 'S' TO SW-911                                           
H P H              MOVE 'S' TO SW-911-911                                       
H P H              ADD 1 TO WS-CANT-ERRORES                                     
H P H          ELSE                                                             
H P H             PERFORM 9999-GESTION-ERRORES                                  
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                 IF  SQLCODE = WN-SQLCODE-OK                               
H P H                 AND WS-PARA-INSERT                                        
H P H      EXEC SQL                                                             
H P H         DELETE FROM KSIM61T                                               
H P H         WHERE CDSINIES = :WS-TBL-SINOREC                                  
H P H      END-EXEC                                                             
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3047-PROCESA-KSIM61T' TO WS-OUT-PARRAFO                
H P H              MOVE 'BORRAR CORRECTO    ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3047-PROCESA-KSIM61T' TO WS-OUT-PARRAFO                
H P H              MOVE 'NO EXISTE BORRAR   ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H              MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
H P H              MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
H P H              MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
H P H              MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
H P H              MOVE '3047-PROCESA-KSIM61T  ' TO CDPARRAF OF KAELCWEZ        
H P H                                                                           
H P H              PERFORM 9999-GESTION-ERRORES                                 
H P H                                                                           
H P H        WHEN OTHER                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3047-PROCESA-KSIM61T' TO WS-OUT-PARRAFO                
H P H              MOVE 'ERR BORRAR DB2     ' TO WS-OUT-DESC                    
H P H              IF SQLCODE  = -911                                           
H P H                 MOVE '3047-PROCESA-KSIM61T'  TO WS-OUT-PARRAFO            
H P H                 MOVE 'CONTENCION TABLA   '   TO WS-OUT-DESC               
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 mOVE 'S' TO SW-911                                        
H P H                 MOVE 'S' TO SW-911-911                                    
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 MOVE 'SI'                  TO WS-ROLLBACK                 
H P H                 MOVE SQLCODE               TO WS-OUT-SQLCODE              
H P H                 MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA               
H P H                 MOVE WS-TABLA-H            TO WS-OUT-TABLA                
H P H                 MOVE '3047-PROCESA-KSIM61T' TO WS-OUT-PARRAFO             
H P H                    STRING                                                 
H P H                   'CONTENCIO:'             DELIMITED BY SIZE              
H P H                    WS-CAMPOPOL             DELIMITED BY ' '               
H P H                    '='                     DELIMITED BY SIZE              
H P H                    WS-LEE-CDNUMPOL         DELIMITED BY SIZE              
H P H                    INTO WS-OUT-DESC                                       
H P H                 END-STRING                                                
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H            STRING                                                         
H P H            'Z8883??????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            'Z8881??????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H              ELSE                                                         
H P H                 MOVE WC-COD              TO CDERR    OF KAELCWEZ          
H P H                 MOVE WC-DES01            TO DSARGU1  OF KAELCWEZ          
H P H                 MOVE WC-PROGRAMA         TO DSARGU2  OF KAELCWEZ          
H P H                 MOVE WS-ERPOLIZA         TO DSARGU3  OF KAELCWEZ          
H P H                 MOVE '3047-PROCESA-KSIM61T'                               
H P H                                          TO CDPARRAF OF KAELCWEZ          
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H                 IF SQLCODE = -911                                         
H P H                    MOVE 'S' TO SW-911                                     
H P H                    MOVE 'S' TO SW-911-911                                 
H P H                    ADD 1 TO WS-CANT-ERRORES                               
H P H                 ELSE                                                      
H P H            STRING                                                         
H P H            'X9999??????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            'X9999??????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H                 PERFORM 9999-GESTION-ERRORES                              
H P H                 END-IF                                                    
H P H              END-IF                                                       
H P H      END-EVALUATE                                                         
H P H                 END-IF                                                    
H P H               END-IF                                                      
H P H              END-IF                                                       
H P H              IF WS-ROLLBACK = 'SI'                                        
H P H                 SET WS-NO-HAY-SINIESTROS TO TRUE                          
H P H                 MOVE 98 TO WS-ITBLS                                       
H P H              END-IF                                                       
H P H              ADD WC-1 TO WS-ITBLS.                                        
H P H *                                                                         
H P H  3048-PROCESA-KSIM62T.                                                    
H P H              MOVE 'KSIM62T'             TO WS-TABLA-T                     
H P H              MOVE 'KSIM62H'             TO WS-TABLA-H                     
H P H *                                                                         
H P H              MOVE 'KSIM62T'             TO WS-TIPO-TABLA                  
H P H              MOVE 'CDSINIES'            TO WS-CAMPOPOL                    
H P H                                                                           
H P H              IF TAB-ESP-SR                                                
H P H               IF WS-SI-HISTORIFICA                                        
H P H                 PERFORM 3300-INSERTA-ESP-SIN                              
H P H               END-IF                                                      
H P H              ELSE                                                         
H P H               IF WS-SI-HISTORIFICA                                        
H P H      EXEC SQL                                                             
H P H         DECLARE CURSOR-48 CURSOR FOR                                      
H P H            SELECT CDSINIES FROM KSIM62T                                   
H P H             WHERE CDSINIES = :WS-TBL-SINOREC                              
H P H             FETCH FIRST 1 ROWS ONLY                                       
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EXEC SQL                                                             
H P H          OPEN CURSOR-48                                                   
H P H      END-EXEC                                                             
H P H      PERFORM 3306-VALIDA-CODIGO                                           
H P H      EXEC SQL                                                             
H P H          FETCH CURSOR-48                                                  
H P H          INTO                                                             
H P H          :WS-SINOREC                                                      
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H             EXEC SQL                                                      
H P H                CLOSE CURSOR-48                                            
H P H             END-EXEC                                                      
H P H             SET WS-PARA-INSERT TO TRUE                                    
H P H      EXEC SQL                                                             
H P H         INSERT INTO KSIM62H                                               
H P H            (SELECT * FROM KSIM62T                                         
H P H             WHERE CDSINIES = :WS-TBL-SINOREC)                             
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3048-PROCESA-KSIM62T' TO WS-OUT-PARRAFO                
H P H              MOVE 'INSERT CORRECTO '    TO WS-OUT-DESC                    
H P H              MOVE WS-TBL-SINOREC        TO WS-OUT-DESC(18:12)             
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-CLAVE-DUPLICADA                                   
H P H              SET WS-DUPLICADOS   TO TRUE                                  
H P H              MOVE 'SI'                  TO WS-ROLLBACK                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3048-PROCESA-KSIM62T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                'DUPLICADO:'             DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H              INTO WS-OUT-DESC                                             
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H            IF WS-WRITE                                                    
H P H              ADD  WC-1                  TO WS-IERR                        
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3048-PROCESA-KSIM62T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'SIN '                  DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN OTHER                                                         
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                     SET WS-DUPLICADOS   TO TRUE                           
H P H                     MOVE 'SI'                  TO WS-ROLLBACK             
H P H                     MOVE SQLCODE               TO WS-OUT-SQLCODE          
H P H                     MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA           
H P H                     MOVE WS-TABLA-H            TO WS-OUT-TABLA            
H P H                     MOVE '3048-PROCESA-KSIM62T' TO WS-OUT-PARRAFO         
H P H                     STRING                                                
H P H                      'CONTENCIO:'             DELIMITED BY SIZE           
H P H                       WS-CAMPOPOL             DELIMITED BY ' '            
H P H                       '='                     DELIMITED BY SIZE           
H P H                       WS-LEE-CDNUMPOL         DELIMITED BY SIZE           
H P H                       INTO WS-OUT-DESC                                    
H P H                       END-STRING                                          
H P H                     PERFORM 1570-ESCRIBE-DESCARTADA                       
H P H              ELSE                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3048-PROCESA-KSIM62T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'ERRDB2:'               DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H              MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
H P H              MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
H P H              MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
H P H              MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
H P H              MOVE '3048-PROCESA-KSIM62T  ' TO CDPARRAF OF KAELCWEZ        
H P H                                                                           
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 MOVE 'S' TO SW-911-911                                    
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H              ELSE                                                         
H P H                 PERFORM 9999-GESTION-ERRORES                              
H P H              END-IF                                                       
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                                                                           
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H            SET WS-NO-PARA-INSERT      TO TRUE                             
H P H            IF WS-WRITE                                                    
H P H              ADD  WC-1                  TO WS-IERR                        
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3048-PROCESA-KSIM62T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'NOHAY '                DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H            EXEC SQL                                                       
H P H                CLOSE CURSOR-48                                            
H P H            END-EXEC                                                       
H P H        WHEN OTHER                                                         
H P H              SET WS-NO-PARA-INSERT      TO TRUE                           
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3048-PROCESA-KSIM62T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'ERRDB2:'               DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            STRING                                                         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            ' ERROR EN SQL :' W-QUERY-TEXT                    '\N'         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H          MOVE WC-COD                   TO CDERR    OF KAELCWEZ            
H P H          MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ            
H P H          MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ            
H P H          MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ            
H P H          MOVE '3048-PROCESA-KSIM62T  ' TO CDPARRAF OF KAELCWEZ            
H P H                                                                           
H P H          IF SQLCODE = -911                                                
H P H              MOVE 'S' TO SW-911                                           
H P H              MOVE 'S' TO SW-911-911                                       
H P H              ADD 1 TO WS-CANT-ERRORES                                     
H P H          ELSE                                                             
H P H             PERFORM 9999-GESTION-ERRORES                                  
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                 IF  SQLCODE = WN-SQLCODE-OK                               
H P H                 AND WS-PARA-INSERT                                        
H P H      EXEC SQL                                                             
H P H         DELETE FROM KSIM62T                                               
H P H         WHERE CDSINIES = :WS-TBL-SINOREC                                  
H P H      END-EXEC                                                             
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3048-PROCESA-KSIM62T' TO WS-OUT-PARRAFO                
H P H              MOVE 'BORRAR CORRECTO    ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3048-PROCESA-KSIM62T' TO WS-OUT-PARRAFO                
H P H              MOVE 'NO EXISTE BORRAR   ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H              MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
H P H              MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
H P H              MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
H P H              MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
H P H              MOVE '3048-PROCESA-KSIM62T  ' TO CDPARRAF OF KAELCWEZ        
H P H                                                                           
H P H              PERFORM 9999-GESTION-ERRORES                                 
H P H                                                                           
H P H        WHEN OTHER                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3048-PROCESA-KSIM62T' TO WS-OUT-PARRAFO                
H P H              MOVE 'ERR BORRAR DB2     ' TO WS-OUT-DESC                    
H P H              IF SQLCODE  = -911                                           
H P H                 MOVE '3048-PROCESA-KSIM62T'  TO WS-OUT-PARRAFO            
H P H                 MOVE 'CONTENCION TABLA   '   TO WS-OUT-DESC               
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 mOVE 'S' TO SW-911                                        
H P H                 MOVE 'S' TO SW-911-911                                    
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 MOVE 'SI'                  TO WS-ROLLBACK                 
H P H                 MOVE SQLCODE               TO WS-OUT-SQLCODE              
H P H                 MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA               
H P H                 MOVE WS-TABLA-H            TO WS-OUT-TABLA                
H P H                 MOVE '3048-PROCESA-KSIM62T' TO WS-OUT-PARRAFO             
H P H                    STRING                                                 
H P H                   'CONTENCIO:'             DELIMITED BY SIZE              
H P H                    WS-CAMPOPOL             DELIMITED BY ' '               
H P H                    '='                     DELIMITED BY SIZE              
H P H                    WS-LEE-CDNUMPOL         DELIMITED BY SIZE              
H P H                    INTO WS-OUT-DESC                                       
H P H                 END-STRING                                                
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H            STRING                                                         
H P H            'Z8883??????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            'Z8881??????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H              ELSE                                                         
H P H                 MOVE WC-COD              TO CDERR    OF KAELCWEZ          
H P H                 MOVE WC-DES01            TO DSARGU1  OF KAELCWEZ          
H P H                 MOVE WC-PROGRAMA         TO DSARGU2  OF KAELCWEZ          
H P H                 MOVE WS-ERPOLIZA         TO DSARGU3  OF KAELCWEZ          
H P H                 MOVE '3048-PROCESA-KSIM62T'                               
H P H                                          TO CDPARRAF OF KAELCWEZ          
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H                 IF SQLCODE = -911                                         
H P H                    MOVE 'S' TO SW-911                                     
H P H                    MOVE 'S' TO SW-911-911                                 
H P H                    ADD 1 TO WS-CANT-ERRORES                               
H P H                 ELSE                                                      
H P H            STRING                                                         
H P H            'X9999??????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            'X9999??????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H                 PERFORM 9999-GESTION-ERRORES                              
H P H                 END-IF                                                    
H P H              END-IF                                                       
H P H      END-EVALUATE                                                         
H P H                 END-IF                                                    
H P H               END-IF                                                      
H P H              END-IF                                                       
H P H              IF WS-ROLLBACK = 'SI'                                        
H P H                 SET WS-NO-HAY-SINIESTROS TO TRUE                          
H P H                 MOVE 98 TO WS-ITBLS                                       
H P H              END-IF                                                       
H P H              ADD WC-1 TO WS-ITBLS.                                        
H P H *                                                                         
H P H  3049-PROCESA-KSIM63T.                                                    
H P H              MOVE 'KSIM63T'             TO WS-TABLA-T                     
H P H              MOVE 'KSIM63H'             TO WS-TABLA-H                     
H P H *                                                                         
H P H              MOVE 'KSIM63T'             TO WS-TIPO-TABLA                  
H P H              MOVE 'CDSINIES'            TO WS-CAMPOPOL                    
H P H                                                                           
H P H              IF TAB-ESP-SR                                                
H P H               IF WS-SI-HISTORIFICA                                        
H P H                 PERFORM 3300-INSERTA-ESP-SIN                              
H P H               END-IF                                                      
H P H              ELSE                                                         
H P H               IF WS-SI-HISTORIFICA                                        
H P H      EXEC SQL                                                             
H P H         DECLARE CURSOR-49 CURSOR FOR                                      
H P H            SELECT CDSINIES FROM KSIM63T                                   
H P H             WHERE CDSINIES = :WS-TBL-SINOREC                              
H P H             FETCH FIRST 1 ROWS ONLY                                       
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EXEC SQL                                                             
H P H          OPEN CURSOR-49                                                   
H P H      END-EXEC                                                             
H P H      PERFORM 3306-VALIDA-CODIGO                                           
H P H      EXEC SQL                                                             
H P H          FETCH CURSOR-49                                                  
H P H          INTO                                                             
H P H          :WS-SINOREC                                                      
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H             EXEC SQL                                                      
H P H                CLOSE CURSOR-49                                            
H P H             END-EXEC                                                      
H P H             SET WS-PARA-INSERT TO TRUE                                    
H P H      EXEC SQL                                                             
H P H         INSERT INTO KSIM63H                                               
H P H            (SELECT * FROM KSIM63T                                         
H P H             WHERE CDSINIES = :WS-TBL-SINOREC)                             
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3049-PROCESA-KSIM63T' TO WS-OUT-PARRAFO                
H P H              MOVE 'INSERT CORRECTO '    TO WS-OUT-DESC                    
H P H              MOVE WS-TBL-SINOREC        TO WS-OUT-DESC(18:12)             
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-CLAVE-DUPLICADA                                   
H P H              SET WS-DUPLICADOS   TO TRUE                                  
H P H              MOVE 'SI'                  TO WS-ROLLBACK                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3049-PROCESA-KSIM63T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                'DUPLICADO:'             DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H              INTO WS-OUT-DESC                                             
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H            IF WS-WRITE                                                    
H P H              ADD  WC-1                  TO WS-IERR                        
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3049-PROCESA-KSIM63T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'SIN '                  DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN OTHER                                                         
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                     SET WS-DUPLICADOS   TO TRUE                           
H P H                     MOVE 'SI'                  TO WS-ROLLBACK             
H P H                     MOVE SQLCODE               TO WS-OUT-SQLCODE          
H P H                     MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA           
H P H                     MOVE WS-TABLA-H            TO WS-OUT-TABLA            
H P H                     MOVE '3049-PROCESA-KSIM63T' TO WS-OUT-PARRAFO         
H P H                     STRING                                                
H P H                      'CONTENCIO:'             DELIMITED BY SIZE           
H P H                       WS-CAMPOPOL             DELIMITED BY ' '            
H P H                       '='                     DELIMITED BY SIZE           
H P H                       WS-LEE-CDNUMPOL         DELIMITED BY SIZE           
H P H                       INTO WS-OUT-DESC                                    
H P H                       END-STRING                                          
H P H                     PERFORM 1570-ESCRIBE-DESCARTADA                       
H P H              ELSE                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3049-PROCESA-KSIM63T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'ERRDB2:'               DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H              MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
H P H              MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
H P H              MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
H P H              MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
H P H              MOVE '3049-PROCESA-KSIM63T  ' TO CDPARRAF OF KAELCWEZ        
H P H                                                                           
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 MOVE 'S' TO SW-911-911                                    
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H              ELSE                                                         
H P H                 PERFORM 9999-GESTION-ERRORES                              
H P H              END-IF                                                       
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                                                                           
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H            SET WS-NO-PARA-INSERT      TO TRUE                             
H P H            IF WS-WRITE                                                    
H P H              ADD  WC-1                  TO WS-IERR                        
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3049-PROCESA-KSIM63T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'NOHAY '                DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H            EXEC SQL                                                       
H P H                CLOSE CURSOR-49                                            
H P H            END-EXEC                                                       
H P H        WHEN OTHER                                                         
H P H              SET WS-NO-PARA-INSERT      TO TRUE                           
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3049-PROCESA-KSIM63T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'ERRDB2:'               DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            STRING                                                         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            ' ERROR EN SQL :' W-QUERY-TEXT                    '\N'         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H          MOVE WC-COD                   TO CDERR    OF KAELCWEZ            
H P H          MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ            
H P H          MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ            
H P H          MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ            
H P H          MOVE '3049-PROCESA-KSIM63T  ' TO CDPARRAF OF KAELCWEZ            
H P H                                                                           
H P H          IF SQLCODE = -911                                                
H P H              MOVE 'S' TO SW-911                                           
H P H              MOVE 'S' TO SW-911-911                                       
H P H              ADD 1 TO WS-CANT-ERRORES                                     
H P H          ELSE                                                             
H P H             PERFORM 9999-GESTION-ERRORES                                  
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                 IF  SQLCODE = WN-SQLCODE-OK                               
H P H                 AND WS-PARA-INSERT                                        
H P H      EXEC SQL                                                             
H P H         DELETE FROM KSIM63T                                               
H P H         WHERE CDSINIES = :WS-TBL-SINOREC                                  
H P H      END-EXEC                                                             
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3049-PROCESA-KSIM63T' TO WS-OUT-PARRAFO                
H P H              MOVE 'BORRAR CORRECTO    ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3049-PROCESA-KSIM63T' TO WS-OUT-PARRAFO                
H P H              MOVE 'NO EXISTE BORRAR   ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H              MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
H P H              MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
H P H              MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
H P H              MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
H P H              MOVE '3049-PROCESA-KSIM63T  ' TO CDPARRAF OF KAELCWEZ        
H P H                                                                           
H P H              PERFORM 9999-GESTION-ERRORES                                 
H P H                                                                           
H P H        WHEN OTHER                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3049-PROCESA-KSIM63T' TO WS-OUT-PARRAFO                
H P H              MOVE 'ERR BORRAR DB2     ' TO WS-OUT-DESC                    
H P H              IF SQLCODE  = -911                                           
H P H                 MOVE '3049-PROCESA-KSIM63T'  TO WS-OUT-PARRAFO            
H P H                 MOVE 'CONTENCION TABLA   '   TO WS-OUT-DESC               
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 mOVE 'S' TO SW-911                                        
H P H                 MOVE 'S' TO SW-911-911                                    
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 MOVE 'SI'                  TO WS-ROLLBACK                 
H P H                 MOVE SQLCODE               TO WS-OUT-SQLCODE              
H P H                 MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA               
H P H                 MOVE WS-TABLA-H            TO WS-OUT-TABLA                
H P H                 MOVE '3049-PROCESA-KSIM63T' TO WS-OUT-PARRAFO             
H P H                    STRING                                                 
H P H                   'CONTENCIO:'             DELIMITED BY SIZE              
H P H                    WS-CAMPOPOL             DELIMITED BY ' '               
H P H                    '='                     DELIMITED BY SIZE              
H P H                    WS-LEE-CDNUMPOL         DELIMITED BY SIZE              
H P H                    INTO WS-OUT-DESC                                       
H P H                 END-STRING                                                
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H            STRING                                                         
H P H            'Z8883??????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            'Z8881??????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H              ELSE                                                         
H P H                 MOVE WC-COD              TO CDERR    OF KAELCWEZ          
H P H                 MOVE WC-DES01            TO DSARGU1  OF KAELCWEZ          
H P H                 MOVE WC-PROGRAMA         TO DSARGU2  OF KAELCWEZ          
H P H                 MOVE WS-ERPOLIZA         TO DSARGU3  OF KAELCWEZ          
H P H                 MOVE '3049-PROCESA-KSIM63T'                               
H P H                                          TO CDPARRAF OF KAELCWEZ          
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H                 IF SQLCODE = -911                                         
H P H                    MOVE 'S' TO SW-911                                     
H P H                    MOVE 'S' TO SW-911-911                                 
H P H                    ADD 1 TO WS-CANT-ERRORES                               
H P H                 ELSE                                                      
H P H            STRING                                                         
H P H            'X9999??????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            'X9999??????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H                 PERFORM 9999-GESTION-ERRORES                              
H P H                 END-IF                                                    
H P H              END-IF                                                       
H P H      END-EVALUATE                                                         
H P H                 END-IF                                                    
H P H               END-IF                                                      
H P H              END-IF                                                       
H P H              IF WS-ROLLBACK = 'SI'                                        
H P H                 SET WS-NO-HAY-SINIESTROS TO TRUE                          
H P H                 MOVE 98 TO WS-ITBLS                                       
H P H              END-IF                                                       
H P H              ADD WC-1 TO WS-ITBLS.                                        
H P H *                                                                         
H P H  3050-PROCESA-KSIM64T.                                                    
H P H              MOVE 'KSIM64T'             TO WS-TABLA-T                     
H P H              MOVE 'KSIM64H'             TO WS-TABLA-H                     
H P H *                                                                         
H P H              MOVE 'KSIM64T'             TO WS-TIPO-TABLA                  
H P H              MOVE 'CDSINIES'            TO WS-CAMPOPOL                    
H P H                                                                           
H P H              IF TAB-ESP-SR                                                
H P H               IF WS-SI-HISTORIFICA                                        
H P H                 PERFORM 3300-INSERTA-ESP-SIN                              
H P H               END-IF                                                      
H P H              ELSE                                                         
H P H               IF WS-SI-HISTORIFICA                                        
H P H      EXEC SQL                                                             
H P H         DECLARE CURSOR-50 CURSOR FOR                                      
H P H            SELECT CDSINIES FROM KSIM64T                                   
H P H             WHERE CDSINIES = :WS-TBL-SINOREC                              
H P H             FETCH FIRST 1 ROWS ONLY                                       
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EXEC SQL                                                             
H P H          OPEN CURSOR-50                                                   
H P H      END-EXEC                                                             
H P H      PERFORM 3306-VALIDA-CODIGO                                           
H P H      EXEC SQL                                                             
H P H          FETCH CURSOR-50                                                  
H P H          INTO                                                             
H P H          :WS-SINOREC                                                      
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H             EXEC SQL                                                      
H P H                CLOSE CURSOR-50                                            
H P H             END-EXEC                                                      
H P H             SET WS-PARA-INSERT TO TRUE                                    
H P H      EXEC SQL                                                             
H P H         INSERT INTO KSIM64H                                               
H P H            (SELECT * FROM KSIM64T                                         
H P H             WHERE CDSINIES = :WS-TBL-SINOREC)                             
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3050-PROCESA-KSIM64T' TO WS-OUT-PARRAFO                
H P H              MOVE 'INSERT CORRECTO '    TO WS-OUT-DESC                    
H P H              MOVE WS-TBL-SINOREC        TO WS-OUT-DESC(18:12)             
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-CLAVE-DUPLICADA                                   
H P H              SET WS-DUPLICADOS   TO TRUE                                  
H P H              MOVE 'SI'                  TO WS-ROLLBACK                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3050-PROCESA-KSIM64T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                'DUPLICADO:'             DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H              INTO WS-OUT-DESC                                             
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H            IF WS-WRITE                                                    
H P H              ADD  WC-1                  TO WS-IERR                        
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3050-PROCESA-KSIM64T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'SIN '                  DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN OTHER                                                         
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                     SET WS-DUPLICADOS   TO TRUE                           
H P H                     MOVE 'SI'                  TO WS-ROLLBACK             
H P H                     MOVE SQLCODE               TO WS-OUT-SQLCODE          
H P H                     MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA           
H P H                     MOVE WS-TABLA-H            TO WS-OUT-TABLA            
H P H                     MOVE '3050-PROCESA-KSIM64T' TO WS-OUT-PARRAFO         
H P H                     STRING                                                
H P H                      'CONTENCIO:'             DELIMITED BY SIZE           
H P H                       WS-CAMPOPOL             DELIMITED BY ' '            
H P H                       '='                     DELIMITED BY SIZE           
H P H                       WS-LEE-CDNUMPOL         DELIMITED BY SIZE           
H P H                       INTO WS-OUT-DESC                                    
H P H                       END-STRING                                          
H P H                     PERFORM 1570-ESCRIBE-DESCARTADA                       
H P H              ELSE                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3050-PROCESA-KSIM64T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'ERRDB2:'               DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H              MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
H P H              MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
H P H              MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
H P H              MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
H P H              MOVE '3050-PROCESA-KSIM64T  ' TO CDPARRAF OF KAELCWEZ        
H P H                                                                           
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 MOVE 'S' TO SW-911-911                                    
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H              ELSE                                                         
H P H                 PERFORM 9999-GESTION-ERRORES                              
H P H              END-IF                                                       
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                                                                           
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H            SET WS-NO-PARA-INSERT      TO TRUE                             
H P H            IF WS-WRITE                                                    
H P H              ADD  WC-1                  TO WS-IERR                        
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3050-PROCESA-KSIM64T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'NOHAY '                DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H            EXEC SQL                                                       
H P H                CLOSE CURSOR-50                                            
H P H            END-EXEC                                                       
H P H        WHEN OTHER                                                         
H P H              SET WS-NO-PARA-INSERT      TO TRUE                           
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3050-PROCESA-KSIM64T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'ERRDB2:'               DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            STRING                                                         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            ' ERROR EN SQL :' W-QUERY-TEXT                    '\N'         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H          MOVE WC-COD                   TO CDERR    OF KAELCWEZ            
H P H          MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ            
H P H          MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ            
H P H          MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ            
H P H          MOVE '3050-PROCESA-KSIM64T  ' TO CDPARRAF OF KAELCWEZ            
H P H                                                                           
H P H          IF SQLCODE = -911                                                
H P H              MOVE 'S' TO SW-911                                           
H P H              MOVE 'S' TO SW-911-911                                       
H P H              ADD 1 TO WS-CANT-ERRORES                                     
H P H          ELSE                                                             
H P H             PERFORM 9999-GESTION-ERRORES                                  
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                 IF  SQLCODE = WN-SQLCODE-OK                               
H P H                 AND WS-PARA-INSERT                                        
H P H      EXEC SQL                                                             
H P H         DELETE FROM KSIM64T                                               
H P H         WHERE CDSINIES = :WS-TBL-SINOREC                                  
H P H      END-EXEC                                                             
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3050-PROCESA-KSIM64T' TO WS-OUT-PARRAFO                
H P H              MOVE 'BORRAR CORRECTO    ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3050-PROCESA-KSIM64T' TO WS-OUT-PARRAFO                
H P H              MOVE 'NO EXISTE BORRAR   ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H              MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
H P H              MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
H P H              MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
H P H              MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
H P H              MOVE '3050-PROCESA-KSIM64T  ' TO CDPARRAF OF KAELCWEZ        
H P H                                                                           
H P H              PERFORM 9999-GESTION-ERRORES                                 
H P H                                                                           
H P H        WHEN OTHER                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3050-PROCESA-KSIM64T' TO WS-OUT-PARRAFO                
H P H              MOVE 'ERR BORRAR DB2     ' TO WS-OUT-DESC                    
H P H              IF SQLCODE  = -911                                           
H P H                 MOVE '3050-PROCESA-KSIM64T'  TO WS-OUT-PARRAFO            
H P H                 MOVE 'CONTENCION TABLA   '   TO WS-OUT-DESC               
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 mOVE 'S' TO SW-911                                        
H P H                 MOVE 'S' TO SW-911-911                                    
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 MOVE 'SI'                  TO WS-ROLLBACK                 
H P H                 MOVE SQLCODE               TO WS-OUT-SQLCODE              
H P H                 MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA               
H P H                 MOVE WS-TABLA-H            TO WS-OUT-TABLA                
H P H                 MOVE '3050-PROCESA-KSIM64T' TO WS-OUT-PARRAFO             
H P H                    STRING                                                 
H P H                   'CONTENCIO:'             DELIMITED BY SIZE              
H P H                    WS-CAMPOPOL             DELIMITED BY ' '               
H P H                    '='                     DELIMITED BY SIZE              
H P H                    WS-LEE-CDNUMPOL         DELIMITED BY SIZE              
H P H                    INTO WS-OUT-DESC                                       
H P H                 END-STRING                                                
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H            STRING                                                         
H P H            'Z8883??????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            'Z8881??????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H              ELSE                                                         
H P H                 MOVE WC-COD              TO CDERR    OF KAELCWEZ          
H P H                 MOVE WC-DES01            TO DSARGU1  OF KAELCWEZ          
H P H                 MOVE WC-PROGRAMA         TO DSARGU2  OF KAELCWEZ          
H P H                 MOVE WS-ERPOLIZA         TO DSARGU3  OF KAELCWEZ          
H P H                 MOVE '3050-PROCESA-KSIM64T'                               
H P H                                          TO CDPARRAF OF KAELCWEZ          
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H                 IF SQLCODE = -911                                         
H P H                    MOVE 'S' TO SW-911                                     
H P H                    MOVE 'S' TO SW-911-911                                 
H P H                    ADD 1 TO WS-CANT-ERRORES                               
H P H                 ELSE                                                      
H P H            STRING                                                         
H P H            'X9999??????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            'X9999??????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H                 PERFORM 9999-GESTION-ERRORES                              
H P H                 END-IF                                                    
H P H              END-IF                                                       
H P H      END-EVALUATE                                                         
H P H                 END-IF                                                    
H P H               END-IF                                                      
H P H              END-IF                                                       
H P H              IF WS-ROLLBACK = 'SI'                                        
H P H                 SET WS-NO-HAY-SINIESTROS TO TRUE                          
H P H                 MOVE 98 TO WS-ITBLS                                       
H P H              END-IF                                                       
H P H              ADD WC-1 TO WS-ITBLS.                                        
H P H *                                                                         
H P H  3051-PROCESA-KSIM65T.                                                    
H P H              MOVE 'KSIM65T'             TO WS-TABLA-T                     
H P H              MOVE 'KSIM65H'             TO WS-TABLA-H                     
H P H *                                                                         
H P H              MOVE 'KSIM65T'             TO WS-TIPO-TABLA                  
H P H              MOVE 'CDSINIES'            TO WS-CAMPOPOL                    
H P H                                                                           
H P H              IF TAB-ESP-SR                                                
H P H               IF WS-SI-HISTORIFICA                                        
H P H                 PERFORM 3300-INSERTA-ESP-SIN                              
H P H               END-IF                                                      
H P H              ELSE                                                         
H P H               IF WS-SI-HISTORIFICA                                        
H P H      EXEC SQL                                                             
H P H         DECLARE CURSOR-51 CURSOR FOR                                      
H P H            SELECT CDSINIES FROM KSIM65T                                   
H P H             WHERE CDSINIES = :WS-TBL-SINOREC                              
H P H             FETCH FIRST 1 ROWS ONLY                                       
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EXEC SQL                                                             
H P H          OPEN CURSOR-51                                                   
H P H      END-EXEC                                                             
H P H      PERFORM 3306-VALIDA-CODIGO                                           
H P H      EXEC SQL                                                             
H P H          FETCH CURSOR-51                                                  
H P H          INTO                                                             
H P H          :WS-SINOREC                                                      
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H             EXEC SQL                                                      
H P H                CLOSE CURSOR-51                                            
H P H             END-EXEC                                                      
H P H             SET WS-PARA-INSERT TO TRUE                                    
H P H      EXEC SQL                                                             
H P H         INSERT INTO KSIM65H                                               
H P H            (SELECT * FROM KSIM65T                                         
H P H             WHERE CDSINIES = :WS-TBL-SINOREC)                             
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3051-PROCESA-KSIM65T' TO WS-OUT-PARRAFO                
H P H              MOVE 'INSERT CORRECTO '    TO WS-OUT-DESC                    
H P H              MOVE WS-TBL-SINOREC        TO WS-OUT-DESC(18:12)             
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-CLAVE-DUPLICADA                                   
H P H              SET WS-DUPLICADOS   TO TRUE                                  
H P H              MOVE 'SI'                  TO WS-ROLLBACK                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3051-PROCESA-KSIM65T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                'DUPLICADO:'             DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H              INTO WS-OUT-DESC                                             
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H            IF WS-WRITE                                                    
H P H              ADD  WC-1                  TO WS-IERR                        
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3051-PROCESA-KSIM65T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'SIN '                  DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN OTHER                                                         
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                     SET WS-DUPLICADOS   TO TRUE                           
H P H                     MOVE 'SI'                  TO WS-ROLLBACK             
H P H                     MOVE SQLCODE               TO WS-OUT-SQLCODE          
H P H                     MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA           
H P H                     MOVE WS-TABLA-H            TO WS-OUT-TABLA            
H P H                     MOVE '3051-PROCESA-KSIM65T' TO WS-OUT-PARRAFO         
H P H                     STRING                                                
H P H                      'CONTENCIO:'             DELIMITED BY SIZE           
H P H                       WS-CAMPOPOL             DELIMITED BY ' '            
H P H                       '='                     DELIMITED BY SIZE           
H P H                       WS-LEE-CDNUMPOL         DELIMITED BY SIZE           
H P H                       INTO WS-OUT-DESC                                    
H P H                       END-STRING                                          
H P H                     PERFORM 1570-ESCRIBE-DESCARTADA                       
H P H              ELSE                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3051-PROCESA-KSIM65T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'ERRDB2:'               DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H              MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
H P H              MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
H P H              MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
H P H              MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
H P H              MOVE '3051-PROCESA-KSIM65T  ' TO CDPARRAF OF KAELCWEZ        
H P H                                                                           
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 MOVE 'S' TO SW-911-911                                    
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H              ELSE                                                         
H P H                 PERFORM 9999-GESTION-ERRORES                              
H P H              END-IF                                                       
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                                                                           
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H            SET WS-NO-PARA-INSERT      TO TRUE                             
H P H            IF WS-WRITE                                                    
H P H              ADD  WC-1                  TO WS-IERR                        
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3051-PROCESA-KSIM65T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'NOHAY '                DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H            EXEC SQL                                                       
H P H                CLOSE CURSOR-51                                            
H P H            END-EXEC                                                       
H P H        WHEN OTHER                                                         
H P H              SET WS-NO-PARA-INSERT      TO TRUE                           
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3051-PROCESA-KSIM65T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'ERRDB2:'               DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            STRING                                                         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            ' ERROR EN SQL :' W-QUERY-TEXT                    '\N'         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H          MOVE WC-COD                   TO CDERR    OF KAELCWEZ            
H P H          MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ            
H P H          MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ            
H P H          MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ            
H P H          MOVE '3051-PROCESA-KSIM65T  ' TO CDPARRAF OF KAELCWEZ            
H P H                                                                           
H P H          IF SQLCODE = -911                                                
H P H              MOVE 'S' TO SW-911                                           
H P H              MOVE 'S' TO SW-911-911                                       
H P H              ADD 1 TO WS-CANT-ERRORES                                     
H P H          ELSE                                                             
H P H             PERFORM 9999-GESTION-ERRORES                                  
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                 IF  SQLCODE = WN-SQLCODE-OK                               
H P H                 AND WS-PARA-INSERT                                        
H P H      EXEC SQL                                                             
H P H         DELETE FROM KSIM65T                                               
H P H         WHERE CDSINIES = :WS-TBL-SINOREC                                  
H P H      END-EXEC                                                             
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3051-PROCESA-KSIM65T' TO WS-OUT-PARRAFO                
H P H              MOVE 'BORRAR CORRECTO    ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3051-PROCESA-KSIM65T' TO WS-OUT-PARRAFO                
H P H              MOVE 'NO EXISTE BORRAR   ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H              MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
H P H              MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
H P H              MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
H P H              MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
H P H              MOVE '3051-PROCESA-KSIM65T  ' TO CDPARRAF OF KAELCWEZ        
H P H                                                                           
H P H              PERFORM 9999-GESTION-ERRORES                                 
H P H                                                                           
H P H        WHEN OTHER                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3051-PROCESA-KSIM65T' TO WS-OUT-PARRAFO                
H P H              MOVE 'ERR BORRAR DB2     ' TO WS-OUT-DESC                    
H P H              IF SQLCODE  = -911                                           
H P H                 MOVE '3051-PROCESA-KSIM65T'  TO WS-OUT-PARRAFO            
H P H                 MOVE 'CONTENCION TABLA   '   TO WS-OUT-DESC               
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 mOVE 'S' TO SW-911                                        
H P H                 MOVE 'S' TO SW-911-911                                    
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 MOVE 'SI'                  TO WS-ROLLBACK                 
H P H                 MOVE SQLCODE               TO WS-OUT-SQLCODE              
H P H                 MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA               
H P H                 MOVE WS-TABLA-H            TO WS-OUT-TABLA                
H P H                 MOVE '3051-PROCESA-KSIM65T' TO WS-OUT-PARRAFO             
H P H                    STRING                                                 
H P H                   'CONTENCIO:'             DELIMITED BY SIZE              
H P H                    WS-CAMPOPOL             DELIMITED BY ' '               
H P H                    '='                     DELIMITED BY SIZE              
H P H                    WS-LEE-CDNUMPOL         DELIMITED BY SIZE              
H P H                    INTO WS-OUT-DESC                                       
H P H                 END-STRING                                                
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H            STRING                                                         
H P H            'Z8883??????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            'Z8881??????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H              ELSE                                                         
H P H                 MOVE WC-COD              TO CDERR    OF KAELCWEZ          
H P H                 MOVE WC-DES01            TO DSARGU1  OF KAELCWEZ          
H P H                 MOVE WC-PROGRAMA         TO DSARGU2  OF KAELCWEZ          
H P H                 MOVE WS-ERPOLIZA         TO DSARGU3  OF KAELCWEZ          
H P H                 MOVE '3051-PROCESA-KSIM65T'                               
H P H                                          TO CDPARRAF OF KAELCWEZ          
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H                 IF SQLCODE = -911                                         
H P H                    MOVE 'S' TO SW-911                                     
H P H                    MOVE 'S' TO SW-911-911                                 
H P H                    ADD 1 TO WS-CANT-ERRORES                               
H P H                 ELSE                                                      
H P H            STRING                                                         
H P H            'X9999??????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            'X9999??????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H                 PERFORM 9999-GESTION-ERRORES                              
H P H                 END-IF                                                    
H P H              END-IF                                                       
H P H      END-EVALUATE                                                         
H P H                 END-IF                                                    
H P H               END-IF                                                      
H P H              END-IF                                                       
H P H              IF WS-ROLLBACK = 'SI'                                        
H P H                 SET WS-NO-HAY-SINIESTROS TO TRUE                          
H P H                 MOVE 98 TO WS-ITBLS                                       
H P H              END-IF                                                       
H P H              ADD WC-1 TO WS-ITBLS.                                        
H P H *                                                                         
H P H  3052-PROCESA-KSIM66T.                                                    
H P H              MOVE 'KSIM66T'             TO WS-TABLA-T                     
H P H              MOVE 'KSIM66H'             TO WS-TABLA-H                     
H P H *                                                                         
H P H              MOVE 'KSIM66T'             TO WS-TIPO-TABLA                  
H P H              MOVE 'CDSINIES'            TO WS-CAMPOPOL                    
H P H                                                                           
H P H              IF TAB-ESP-SR                                                
H P H               IF WS-SI-HISTORIFICA                                        
H P H                 PERFORM 3300-INSERTA-ESP-SIN                              
H P H               END-IF                                                      
H P H              ELSE                                                         
H P H               IF WS-SI-HISTORIFICA                                        
H P H      EXEC SQL                                                             
H P H         DECLARE CURSOR-52 CURSOR FOR                                      
H P H            SELECT CDSINIES FROM KSIM66T                                   
H P H             WHERE CDSINIES = :WS-TBL-SINOREC                              
H P H             FETCH FIRST 1 ROWS ONLY                                       
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EXEC SQL                                                             
H P H          OPEN CURSOR-52                                                   
H P H      END-EXEC                                                             
H P H      PERFORM 3306-VALIDA-CODIGO                                           
H P H      EXEC SQL                                                             
H P H          FETCH CURSOR-52                                                  
H P H          INTO                                                             
H P H          :WS-SINOREC                                                      
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H             EXEC SQL                                                      
H P H                CLOSE CURSOR-52                                            
H P H             END-EXEC                                                      
H P H             SET WS-PARA-INSERT TO TRUE                                    
H P H      EXEC SQL                                                             
H P H         INSERT INTO KSIM66H                                               
H P H            (SELECT * FROM KSIM66T                                         
H P H             WHERE CDSINIES = :WS-TBL-SINOREC)                             
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3052-PROCESA-KSIM66T' TO WS-OUT-PARRAFO                
H P H              MOVE 'INSERT CORRECTO '    TO WS-OUT-DESC                    
H P H              MOVE WS-TBL-SINOREC        TO WS-OUT-DESC(18:12)             
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-CLAVE-DUPLICADA                                   
H P H              SET WS-DUPLICADOS   TO TRUE                                  
H P H              MOVE 'SI'                  TO WS-ROLLBACK                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3052-PROCESA-KSIM66T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                'DUPLICADO:'             DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H              INTO WS-OUT-DESC                                             
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H            IF WS-WRITE                                                    
H P H              ADD  WC-1                  TO WS-IERR                        
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3052-PROCESA-KSIM66T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'SIN '                  DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN OTHER                                                         
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                     SET WS-DUPLICADOS   TO TRUE                           
H P H                     MOVE 'SI'                  TO WS-ROLLBACK             
H P H                     MOVE SQLCODE               TO WS-OUT-SQLCODE          
H P H                     MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA           
H P H                     MOVE WS-TABLA-H            TO WS-OUT-TABLA            
H P H                     MOVE '3052-PROCESA-KSIM66T' TO WS-OUT-PARRAFO         
H P H                     STRING                                                
H P H                      'CONTENCIO:'             DELIMITED BY SIZE           
H P H                       WS-CAMPOPOL             DELIMITED BY ' '            
H P H                       '='                     DELIMITED BY SIZE           
H P H                       WS-LEE-CDNUMPOL         DELIMITED BY SIZE           
H P H                       INTO WS-OUT-DESC                                    
H P H                       END-STRING                                          
H P H                     PERFORM 1570-ESCRIBE-DESCARTADA                       
H P H              ELSE                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3052-PROCESA-KSIM66T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'ERRDB2:'               DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H              MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
H P H              MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
H P H              MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
H P H              MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
H P H              MOVE '3052-PROCESA-KSIM66T  ' TO CDPARRAF OF KAELCWEZ        
H P H                                                                           
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 MOVE 'S' TO SW-911-911                                    
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H              ELSE                                                         
H P H                 PERFORM 9999-GESTION-ERRORES                              
H P H              END-IF                                                       
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                                                                           
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H            SET WS-NO-PARA-INSERT      TO TRUE                             
H P H            IF WS-WRITE                                                    
H P H              ADD  WC-1                  TO WS-IERR                        
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3052-PROCESA-KSIM66T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'NOHAY '                DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H            EXEC SQL                                                       
H P H                CLOSE CURSOR-52                                            
H P H            END-EXEC                                                       
H P H        WHEN OTHER                                                         
H P H              SET WS-NO-PARA-INSERT      TO TRUE                           
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3052-PROCESA-KSIM66T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'ERRDB2:'               DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            STRING                                                         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            ' ERROR EN SQL :' W-QUERY-TEXT                    '\N'         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H          MOVE WC-COD                   TO CDERR    OF KAELCWEZ            
H P H          MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ            
H P H          MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ            
H P H          MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ            
H P H          MOVE '3052-PROCESA-KSIM66T  ' TO CDPARRAF OF KAELCWEZ            
H P H                                                                           
H P H          IF SQLCODE = -911                                                
H P H              MOVE 'S' TO SW-911                                           
H P H              MOVE 'S' TO SW-911-911                                       
H P H              ADD 1 TO WS-CANT-ERRORES                                     
H P H          ELSE                                                             
H P H             PERFORM 9999-GESTION-ERRORES                                  
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                 IF  SQLCODE = WN-SQLCODE-OK                               
H P H                 AND WS-PARA-INSERT                                        
H P H      EXEC SQL                                                             
H P H         DELETE FROM KSIM66T                                               
H P H         WHERE CDSINIES = :WS-TBL-SINOREC                                  
H P H      END-EXEC                                                             
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3052-PROCESA-KSIM66T' TO WS-OUT-PARRAFO                
H P H              MOVE 'BORRAR CORRECTO    ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3052-PROCESA-KSIM66T' TO WS-OUT-PARRAFO                
H P H              MOVE 'NO EXISTE BORRAR   ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H              MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
H P H              MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
H P H              MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
H P H              MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
H P H              MOVE '3052-PROCESA-KSIM66T  ' TO CDPARRAF OF KAELCWEZ        
H P H                                                                           
H P H              PERFORM 9999-GESTION-ERRORES                                 
H P H                                                                           
H P H        WHEN OTHER                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3052-PROCESA-KSIM66T' TO WS-OUT-PARRAFO                
H P H              MOVE 'ERR BORRAR DB2     ' TO WS-OUT-DESC                    
H P H              IF SQLCODE  = -911                                           
H P H                 MOVE '3052-PROCESA-KSIM66T'  TO WS-OUT-PARRAFO            
H P H                 MOVE 'CONTENCION TABLA   '   TO WS-OUT-DESC               
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 mOVE 'S' TO SW-911                                        
H P H                 MOVE 'S' TO SW-911-911                                    
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 MOVE 'SI'                  TO WS-ROLLBACK                 
H P H                 MOVE SQLCODE               TO WS-OUT-SQLCODE              
H P H                 MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA               
H P H                 MOVE WS-TABLA-H            TO WS-OUT-TABLA                
H P H                 MOVE '3052-PROCESA-KSIM66T' TO WS-OUT-PARRAFO             
H P H                    STRING                                                 
H P H                   'CONTENCIO:'             DELIMITED BY SIZE              
H P H                    WS-CAMPOPOL             DELIMITED BY ' '               
H P H                    '='                     DELIMITED BY SIZE              
H P H                    WS-LEE-CDNUMPOL         DELIMITED BY SIZE              
H P H                    INTO WS-OUT-DESC                                       
H P H                 END-STRING                                                
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H            STRING                                                         
H P H            'Z8883??????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            'Z8881??????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H              ELSE                                                         
H P H                 MOVE WC-COD              TO CDERR    OF KAELCWEZ          
H P H                 MOVE WC-DES01            TO DSARGU1  OF KAELCWEZ          
H P H                 MOVE WC-PROGRAMA         TO DSARGU2  OF KAELCWEZ          
H P H                 MOVE WS-ERPOLIZA         TO DSARGU3  OF KAELCWEZ          
H P H                 MOVE '3052-PROCESA-KSIM66T'                               
H P H                                          TO CDPARRAF OF KAELCWEZ          
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H                 IF SQLCODE = -911                                         
H P H                    MOVE 'S' TO SW-911                                     
H P H                    MOVE 'S' TO SW-911-911                                 
H P H                    ADD 1 TO WS-CANT-ERRORES                               
H P H                 ELSE                                                      
H P H            STRING                                                         
H P H            'X9999??????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            'X9999??????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H                 PERFORM 9999-GESTION-ERRORES                              
H P H                 END-IF                                                    
H P H              END-IF                                                       
H P H      END-EVALUATE                                                         
H P H                 END-IF                                                    
H P H               END-IF                                                      
H P H              END-IF                                                       
H P H              IF WS-ROLLBACK = 'SI'                                        
H P H                 SET WS-NO-HAY-SINIESTROS TO TRUE                          
H P H                 MOVE 98 TO WS-ITBLS                                       
H P H              END-IF                                                       
H P H              ADD WC-1 TO WS-ITBLS.                                        
H P H *                                                                         
H P H  3053-PROCESA-KSIM7AT.                                                    
H P H              MOVE 'KSIM7AT'             TO WS-TABLA-T                     
H P H              MOVE 'KSIM7AH'             TO WS-TABLA-H                     
H P H *                                                                         
H P H              MOVE 'KSIM7AT'             TO WS-TIPO-TABLA                  
H P H              MOVE 'CDSINIES'            TO WS-CAMPOPOL                    
H P H                                                                           
H P H              IF TAB-ESP-SR                                                
H P H               IF WS-SI-HISTORIFICA                                        
H P H                 PERFORM 3300-INSERTA-ESP-SIN                              
H P H               END-IF                                                      
H P H              ELSE                                                         
H P H               IF WS-SI-HISTORIFICA                                        
H P H      EXEC SQL                                                             
H P H         DECLARE CURSOR-53 CURSOR FOR                                      
H P H            SELECT CDSINIES FROM KSIM7AT                                   
H P H             WHERE CDSINIES = :WS-TBL-SINOREC                              
H P H             FETCH FIRST 1 ROWS ONLY                                       
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EXEC SQL                                                             
H P H          OPEN CURSOR-53                                                   
H P H      END-EXEC                                                             
H P H      PERFORM 3306-VALIDA-CODIGO                                           
H P H      EXEC SQL                                                             
H P H          FETCH CURSOR-53                                                  
H P H          INTO                                                             
H P H          :WS-SINOREC                                                      
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H             EXEC SQL                                                      
H P H                CLOSE CURSOR-53                                            
H P H             END-EXEC                                                      
H P H             SET WS-PARA-INSERT TO TRUE                                    
H P H      EXEC SQL                                                             
H P H         INSERT INTO KSIM7AH                                               
H P H            (SELECT * FROM KSIM7AT                                         
H P H             WHERE CDSINIES = :WS-TBL-SINOREC)                             
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3053-PROCESA-KSIM7AT' TO WS-OUT-PARRAFO                
H P H              MOVE 'INSERT CORRECTO '    TO WS-OUT-DESC                    
H P H              MOVE WS-TBL-SINOREC        TO WS-OUT-DESC(18:12)             
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-CLAVE-DUPLICADA                                   
H P H              SET WS-DUPLICADOS   TO TRUE                                  
H P H              MOVE 'SI'                  TO WS-ROLLBACK                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3053-PROCESA-KSIM7AT' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                'DUPLICADO:'             DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H              INTO WS-OUT-DESC                                             
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H            IF WS-WRITE                                                    
H P H              ADD  WC-1                  TO WS-IERR                        
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3053-PROCESA-KSIM7AT' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'SIN '                  DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN OTHER                                                         
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                     SET WS-DUPLICADOS   TO TRUE                           
H P H                     MOVE 'SI'                  TO WS-ROLLBACK             
H P H                     MOVE SQLCODE               TO WS-OUT-SQLCODE          
H P H                     MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA           
H P H                     MOVE WS-TABLA-H            TO WS-OUT-TABLA            
H P H                     MOVE '3053-PROCESA-KSIM7AT' TO WS-OUT-PARRAFO         
H P H                     STRING                                                
H P H                      'CONTENCIO:'             DELIMITED BY SIZE           
H P H                       WS-CAMPOPOL             DELIMITED BY ' '            
H P H                       '='                     DELIMITED BY SIZE           
H P H                       WS-LEE-CDNUMPOL         DELIMITED BY SIZE           
H P H                       INTO WS-OUT-DESC                                    
H P H                       END-STRING                                          
H P H                     PERFORM 1570-ESCRIBE-DESCARTADA                       
H P H              ELSE                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3053-PROCESA-KSIM7AT' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'ERRDB2:'               DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H              MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
H P H              MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
H P H              MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
H P H              MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
H P H              MOVE '3053-PROCESA-KSIM7AT  ' TO CDPARRAF OF KAELCWEZ        
H P H                                                                           
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 MOVE 'S' TO SW-911-911                                    
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H              ELSE                                                         
H P H                 PERFORM 9999-GESTION-ERRORES                              
H P H              END-IF                                                       
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                                                                           
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H            SET WS-NO-PARA-INSERT      TO TRUE                             
H P H            IF WS-WRITE                                                    
H P H              ADD  WC-1                  TO WS-IERR                        
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3053-PROCESA-KSIM7AT' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'NOHAY '                DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H            EXEC SQL                                                       
H P H                CLOSE CURSOR-53                                            
H P H            END-EXEC                                                       
H P H        WHEN OTHER                                                         
H P H              SET WS-NO-PARA-INSERT      TO TRUE                           
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3053-PROCESA-KSIM7AT' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'ERRDB2:'               DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            STRING                                                         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            ' ERROR EN SQL :' W-QUERY-TEXT                    '\N'         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H          MOVE WC-COD                   TO CDERR    OF KAELCWEZ            
H P H          MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ            
H P H          MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ            
H P H          MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ            
H P H          MOVE '3053-PROCESA-KSIM7AT  ' TO CDPARRAF OF KAELCWEZ            
H P H                                                                           
H P H          IF SQLCODE = -911                                                
H P H              MOVE 'S' TO SW-911                                           
H P H              MOVE 'S' TO SW-911-911                                       
H P H              ADD 1 TO WS-CANT-ERRORES                                     
H P H          ELSE                                                             
H P H             PERFORM 9999-GESTION-ERRORES                                  
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                 IF  SQLCODE = WN-SQLCODE-OK                               
H P H                 AND WS-PARA-INSERT                                        
H P H      EXEC SQL                                                             
H P H         DELETE FROM KSIM7AT                                               
H P H         WHERE CDSINIES = :WS-TBL-SINOREC                                  
H P H      END-EXEC                                                             
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3053-PROCESA-KSIM7AT' TO WS-OUT-PARRAFO                
H P H              MOVE 'BORRAR CORRECTO    ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3053-PROCESA-KSIM7AT' TO WS-OUT-PARRAFO                
H P H              MOVE 'NO EXISTE BORRAR   ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H              MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
H P H              MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
H P H              MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
H P H              MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
H P H              MOVE '3053-PROCESA-KSIM7AT  ' TO CDPARRAF OF KAELCWEZ        
H P H                                                                           
H P H              PERFORM 9999-GESTION-ERRORES                                 
H P H                                                                           
H P H        WHEN OTHER                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3053-PROCESA-KSIM7AT' TO WS-OUT-PARRAFO                
H P H              MOVE 'ERR BORRAR DB2     ' TO WS-OUT-DESC                    
H P H              IF SQLCODE  = -911                                           
H P H                 MOVE '3053-PROCESA-KSIM7AT'  TO WS-OUT-PARRAFO            
H P H                 MOVE 'CONTENCION TABLA   '   TO WS-OUT-DESC               
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 mOVE 'S' TO SW-911                                        
H P H                 MOVE 'S' TO SW-911-911                                    
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 MOVE 'SI'                  TO WS-ROLLBACK                 
H P H                 MOVE SQLCODE               TO WS-OUT-SQLCODE              
H P H                 MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA               
H P H                 MOVE WS-TABLA-H            TO WS-OUT-TABLA                
H P H                 MOVE '3053-PROCESA-KSIM7AT' TO WS-OUT-PARRAFO             
H P H                    STRING                                                 
H P H                   'CONTENCIO:'             DELIMITED BY SIZE              
H P H                    WS-CAMPOPOL             DELIMITED BY ' '               
H P H                    '='                     DELIMITED BY SIZE              
H P H                    WS-LEE-CDNUMPOL         DELIMITED BY SIZE              
H P H                    INTO WS-OUT-DESC                                       
H P H                 END-STRING                                                
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H            STRING                                                         
H P H            'Z8883??????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            'Z8881??????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H              ELSE                                                         
H P H                 MOVE WC-COD              TO CDERR    OF KAELCWEZ          
H P H                 MOVE WC-DES01            TO DSARGU1  OF KAELCWEZ          
H P H                 MOVE WC-PROGRAMA         TO DSARGU2  OF KAELCWEZ          
H P H                 MOVE WS-ERPOLIZA         TO DSARGU3  OF KAELCWEZ          
H P H                 MOVE '3053-PROCESA-KSIM7AT'                               
H P H                                          TO CDPARRAF OF KAELCWEZ          
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H                 IF SQLCODE = -911                                         
H P H                    MOVE 'S' TO SW-911                                     
H P H                    MOVE 'S' TO SW-911-911                                 
H P H                    ADD 1 TO WS-CANT-ERRORES                               
H P H                 ELSE                                                      
H P H            STRING                                                         
H P H            'X9999??????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            'X9999??????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H                 PERFORM 9999-GESTION-ERRORES                              
H P H                 END-IF                                                    
H P H              END-IF                                                       
H P H      END-EVALUATE                                                         
H P H                 END-IF                                                    
H P H               END-IF                                                      
H P H              END-IF                                                       
H P H              IF WS-ROLLBACK = 'SI'                                        
H P H                 SET WS-NO-HAY-SINIESTROS TO TRUE                          
H P H                 MOVE 98 TO WS-ITBLS                                       
H P H              END-IF                                                       
H P H              ADD WC-1 TO WS-ITBLS.                                        
H P H *                                                                         
H P H  3054-PROCESA-KSIM86T.                                                    
H P H              MOVE 'KSIM86T'             TO WS-TABLA-T                     
H P H              MOVE 'KSIM86H'             TO WS-TABLA-H                     
H P H *                                                                         
H P H              MOVE 'KSIM86T'             TO WS-TIPO-TABLA                  
H P H              MOVE 'CDSINIES'            TO WS-CAMPOPOL                    
H P H                                                                           
H P H              IF TAB-ESP-SR                                                
H P H               IF WS-SI-HISTORIFICA                                        
H P H                 PERFORM 3300-INSERTA-ESP-SIN                              
H P H               END-IF                                                      
H P H              ELSE                                                         
H P H               IF WS-SI-HISTORIFICA                                        
H P H      EXEC SQL                                                             
H P H         DECLARE CURSOR-54 CURSOR FOR                                      
H P H            SELECT CDSINIES FROM KSIM86T                                   
H P H             WHERE CDSINIES = :WS-TBL-SINOREC                              
H P H             FETCH FIRST 1 ROWS ONLY                                       
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EXEC SQL                                                             
H P H          OPEN CURSOR-54                                                   
H P H      END-EXEC                                                             
H P H      PERFORM 3306-VALIDA-CODIGO                                           
H P H      EXEC SQL                                                             
H P H          FETCH CURSOR-54                                                  
H P H          INTO                                                             
H P H          :WS-SINOREC                                                      
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H             EXEC SQL                                                      
H P H                CLOSE CURSOR-54                                            
H P H             END-EXEC                                                      
H P H             SET WS-PARA-INSERT TO TRUE                                    
H P H      EXEC SQL                                                             
H P H         INSERT INTO KSIM86H                                               
H P H            (SELECT * FROM KSIM86T                                         
H P H             WHERE CDSINIES = :WS-TBL-SINOREC)                             
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3054-PROCESA-KSIM86T' TO WS-OUT-PARRAFO                
H P H              MOVE 'INSERT CORRECTO '    TO WS-OUT-DESC                    
H P H              MOVE WS-TBL-SINOREC        TO WS-OUT-DESC(18:12)             
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-CLAVE-DUPLICADA                                   
H P H              SET WS-DUPLICADOS   TO TRUE                                  
H P H              MOVE 'SI'                  TO WS-ROLLBACK                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3054-PROCESA-KSIM86T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                'DUPLICADO:'             DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H              INTO WS-OUT-DESC                                             
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H            IF WS-WRITE                                                    
H P H              ADD  WC-1                  TO WS-IERR                        
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3054-PROCESA-KSIM86T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'SIN '                  DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN OTHER                                                         
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                     SET WS-DUPLICADOS   TO TRUE                           
H P H                     MOVE 'SI'                  TO WS-ROLLBACK             
H P H                     MOVE SQLCODE               TO WS-OUT-SQLCODE          
H P H                     MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA           
H P H                     MOVE WS-TABLA-H            TO WS-OUT-TABLA            
H P H                     MOVE '3054-PROCESA-KSIM86T' TO WS-OUT-PARRAFO         
H P H                     STRING                                                
H P H                      'CONTENCIO:'             DELIMITED BY SIZE           
H P H                       WS-CAMPOPOL             DELIMITED BY ' '            
H P H                       '='                     DELIMITED BY SIZE           
H P H                       WS-LEE-CDNUMPOL         DELIMITED BY SIZE           
H P H                       INTO WS-OUT-DESC                                    
H P H                       END-STRING                                          
H P H                     PERFORM 1570-ESCRIBE-DESCARTADA                       
H P H              ELSE                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3054-PROCESA-KSIM86T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'ERRDB2:'               DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H              MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
H P H              MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
H P H              MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
H P H              MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
H P H              MOVE '3054-PROCESA-KSIM86T  ' TO CDPARRAF OF KAELCWEZ        
H P H                                                                           
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 MOVE 'S' TO SW-911-911                                    
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H              ELSE                                                         
H P H                 PERFORM 9999-GESTION-ERRORES                              
H P H              END-IF                                                       
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                                                                           
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H            SET WS-NO-PARA-INSERT      TO TRUE                             
H P H            IF WS-WRITE                                                    
H P H              ADD  WC-1                  TO WS-IERR                        
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3054-PROCESA-KSIM86T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'NOHAY '                DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H            EXEC SQL                                                       
H P H                CLOSE CURSOR-54                                            
H P H            END-EXEC                                                       
H P H        WHEN OTHER                                                         
H P H              SET WS-NO-PARA-INSERT      TO TRUE                           
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3054-PROCESA-KSIM86T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'ERRDB2:'               DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            STRING                                                         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            ' ERROR EN SQL :' W-QUERY-TEXT                    '\N'         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H          MOVE WC-COD                   TO CDERR    OF KAELCWEZ            
H P H          MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ            
H P H          MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ            
H P H          MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ            
H P H          MOVE '3054-PROCESA-KSIM86T  ' TO CDPARRAF OF KAELCWEZ            
H P H                                                                           
H P H          IF SQLCODE = -911                                                
H P H              MOVE 'S' TO SW-911                                           
H P H              MOVE 'S' TO SW-911-911                                       
H P H              ADD 1 TO WS-CANT-ERRORES                                     
H P H          ELSE                                                             
H P H             PERFORM 9999-GESTION-ERRORES                                  
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                 IF  SQLCODE = WN-SQLCODE-OK                               
H P H                 AND WS-PARA-INSERT                                        
H P H      EXEC SQL                                                             
H P H         DELETE FROM KSIM86T                                               
H P H         WHERE CDSINIES = :WS-TBL-SINOREC                                  
H P H      END-EXEC                                                             
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3054-PROCESA-KSIM86T' TO WS-OUT-PARRAFO                
H P H              MOVE 'BORRAR CORRECTO    ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3054-PROCESA-KSIM86T' TO WS-OUT-PARRAFO                
H P H              MOVE 'NO EXISTE BORRAR   ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H              MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
H P H              MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
H P H              MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
H P H              MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
H P H              MOVE '3054-PROCESA-KSIM86T  ' TO CDPARRAF OF KAELCWEZ        
H P H                                                                           
H P H              PERFORM 9999-GESTION-ERRORES                                 
H P H                                                                           
H P H        WHEN OTHER                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3054-PROCESA-KSIM86T' TO WS-OUT-PARRAFO                
H P H              MOVE 'ERR BORRAR DB2     ' TO WS-OUT-DESC                    
H P H              IF SQLCODE  = -911                                           
H P H                 MOVE '3054-PROCESA-KSIM86T'  TO WS-OUT-PARRAFO            
H P H                 MOVE 'CONTENCION TABLA   '   TO WS-OUT-DESC               
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 mOVE 'S' TO SW-911                                        
H P H                 MOVE 'S' TO SW-911-911                                    
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 MOVE 'SI'                  TO WS-ROLLBACK                 
H P H                 MOVE SQLCODE               TO WS-OUT-SQLCODE              
H P H                 MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA               
H P H                 MOVE WS-TABLA-H            TO WS-OUT-TABLA                
H P H                 MOVE '3054-PROCESA-KSIM86T' TO WS-OUT-PARRAFO             
H P H                    STRING                                                 
H P H                   'CONTENCIO:'             DELIMITED BY SIZE              
H P H                    WS-CAMPOPOL             DELIMITED BY ' '               
H P H                    '='                     DELIMITED BY SIZE              
H P H                    WS-LEE-CDNUMPOL         DELIMITED BY SIZE              
H P H                    INTO WS-OUT-DESC                                       
H P H                 END-STRING                                                
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H            STRING                                                         
H P H            'Z8883??????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            'Z8881??????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H              ELSE                                                         
H P H                 MOVE WC-COD              TO CDERR    OF KAELCWEZ          
H P H                 MOVE WC-DES01            TO DSARGU1  OF KAELCWEZ          
H P H                 MOVE WC-PROGRAMA         TO DSARGU2  OF KAELCWEZ          
H P H                 MOVE WS-ERPOLIZA         TO DSARGU3  OF KAELCWEZ          
H P H                 MOVE '3054-PROCESA-KSIM86T'                               
H P H                                          TO CDPARRAF OF KAELCWEZ          
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H                 IF SQLCODE = -911                                         
H P H                    MOVE 'S' TO SW-911                                     
H P H                    MOVE 'S' TO SW-911-911                                 
H P H                    ADD 1 TO WS-CANT-ERRORES                               
H P H                 ELSE                                                      
H P H            STRING                                                         
H P H            'X9999??????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            'X9999??????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H                 PERFORM 9999-GESTION-ERRORES                              
H P H                 END-IF                                                    
H P H              END-IF                                                       
H P H      END-EVALUATE                                                         
H P H                 END-IF                                                    
H P H               END-IF                                                      
H P H              END-IF                                                       
H P H              IF WS-ROLLBACK = 'SI'                                        
H P H                 SET WS-NO-HAY-SINIESTROS TO TRUE                          
H P H                 MOVE 98 TO WS-ITBLS                                       
H P H              END-IF                                                       
H P H              ADD WC-1 TO WS-ITBLS.                                        
H P H *                                                                         
H P H  3055-PROCESA-KSIM87T.                                                    
H P H              MOVE 'KSIM87T'             TO WS-TABLA-T                     
H P H              MOVE 'KSIM87H'             TO WS-TABLA-H                     
H P H *                                                                         
H P H              MOVE 'KSIM87T'             TO WS-TIPO-TABLA                  
H P H              MOVE 'CDSINIES'            TO WS-CAMPOPOL                    
H P H                                                                           
H P H              IF TAB-ESP-SR                                                
H P H               IF WS-SI-HISTORIFICA                                        
H P H                 PERFORM 3300-INSERTA-ESP-SIN                              
H P H               END-IF                                                      
H P H              ELSE                                                         
H P H               IF WS-SI-HISTORIFICA                                        
H P H      EXEC SQL                                                             
H P H         DECLARE CURSOR-55 CURSOR FOR                                      
H P H            SELECT CDSINIES FROM KSIM87T                                   
H P H             WHERE CDSINIES = :WS-TBL-SINOREC                              
H P H             FETCH FIRST 1 ROWS ONLY                                       
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EXEC SQL                                                             
H P H          OPEN CURSOR-55                                                   
H P H      END-EXEC                                                             
H P H      PERFORM 3306-VALIDA-CODIGO                                           
H P H      EXEC SQL                                                             
H P H          FETCH CURSOR-55                                                  
H P H          INTO                                                             
H P H          :WS-SINOREC                                                      
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H             EXEC SQL                                                      
H P H                CLOSE CURSOR-55                                            
H P H             END-EXEC                                                      
H P H             SET WS-PARA-INSERT TO TRUE                                    
H P H      EXEC SQL                                                             
H P H         INSERT INTO KSIM87H                                               
H P H            (SELECT * FROM KSIM87T                                         
H P H             WHERE CDSINIES = :WS-TBL-SINOREC)                             
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3055-PROCESA-KSIM87T' TO WS-OUT-PARRAFO                
H P H              MOVE 'INSERT CORRECTO '    TO WS-OUT-DESC                    
H P H              MOVE WS-TBL-SINOREC        TO WS-OUT-DESC(18:12)             
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-CLAVE-DUPLICADA                                   
H P H              SET WS-DUPLICADOS   TO TRUE                                  
H P H              MOVE 'SI'                  TO WS-ROLLBACK                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3055-PROCESA-KSIM87T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                'DUPLICADO:'             DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H              INTO WS-OUT-DESC                                             
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H            IF WS-WRITE                                                    
H P H              ADD  WC-1                  TO WS-IERR                        
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3055-PROCESA-KSIM87T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'SIN '                  DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN OTHER                                                         
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                     SET WS-DUPLICADOS   TO TRUE                           
H P H                     MOVE 'SI'                  TO WS-ROLLBACK             
H P H                     MOVE SQLCODE               TO WS-OUT-SQLCODE          
H P H                     MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA           
H P H                     MOVE WS-TABLA-H            TO WS-OUT-TABLA            
H P H                     MOVE '3055-PROCESA-KSIM87T' TO WS-OUT-PARRAFO         
H P H                     STRING                                                
H P H                      'CONTENCIO:'             DELIMITED BY SIZE           
H P H                       WS-CAMPOPOL             DELIMITED BY ' '            
H P H                       '='                     DELIMITED BY SIZE           
H P H                       WS-LEE-CDNUMPOL         DELIMITED BY SIZE           
H P H                       INTO WS-OUT-DESC                                    
H P H                       END-STRING                                          
H P H                     PERFORM 1570-ESCRIBE-DESCARTADA                       
H P H              ELSE                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3055-PROCESA-KSIM87T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'ERRDB2:'               DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H              MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
H P H              MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
H P H              MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
H P H              MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
H P H              MOVE '3055-PROCESA-KSIM87T  ' TO CDPARRAF OF KAELCWEZ        
H P H                                                                           
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 MOVE 'S' TO SW-911-911                                    
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H              ELSE                                                         
H P H                 PERFORM 9999-GESTION-ERRORES                              
H P H              END-IF                                                       
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                                                                           
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H            SET WS-NO-PARA-INSERT      TO TRUE                             
H P H            IF WS-WRITE                                                    
H P H              ADD  WC-1                  TO WS-IERR                        
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3055-PROCESA-KSIM87T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'NOHAY '                DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H            EXEC SQL                                                       
H P H                CLOSE CURSOR-55                                            
H P H            END-EXEC                                                       
H P H        WHEN OTHER                                                         
H P H              SET WS-NO-PARA-INSERT      TO TRUE                           
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3055-PROCESA-KSIM87T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'ERRDB2:'               DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            STRING                                                         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            ' ERROR EN SQL :' W-QUERY-TEXT                    '\N'         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H          MOVE WC-COD                   TO CDERR    OF KAELCWEZ            
H P H          MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ            
H P H          MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ            
H P H          MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ            
H P H          MOVE '3055-PROCESA-KSIM87T  ' TO CDPARRAF OF KAELCWEZ            
H P H                                                                           
H P H          IF SQLCODE = -911                                                
H P H              MOVE 'S' TO SW-911                                           
H P H              MOVE 'S' TO SW-911-911                                       
H P H              ADD 1 TO WS-CANT-ERRORES                                     
H P H          ELSE                                                             
H P H             PERFORM 9999-GESTION-ERRORES                                  
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                 IF  SQLCODE = WN-SQLCODE-OK                               
H P H                 AND WS-PARA-INSERT                                        
H P H      EXEC SQL                                                             
H P H         DELETE FROM KSIM87T                                               
H P H         WHERE CDSINIES = :WS-TBL-SINOREC                                  
H P H      END-EXEC                                                             
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3055-PROCESA-KSIM87T' TO WS-OUT-PARRAFO                
H P H              MOVE 'BORRAR CORRECTO    ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3055-PROCESA-KSIM87T' TO WS-OUT-PARRAFO                
H P H              MOVE 'NO EXISTE BORRAR   ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H              MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
H P H              MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
H P H              MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
H P H              MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
H P H              MOVE '3055-PROCESA-KSIM87T  ' TO CDPARRAF OF KAELCWEZ        
H P H                                                                           
H P H              PERFORM 9999-GESTION-ERRORES                                 
H P H                                                                           
H P H        WHEN OTHER                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3055-PROCESA-KSIM87T' TO WS-OUT-PARRAFO                
H P H              MOVE 'ERR BORRAR DB2     ' TO WS-OUT-DESC                    
H P H              IF SQLCODE  = -911                                           
H P H                 MOVE '3055-PROCESA-KSIM87T'  TO WS-OUT-PARRAFO            
H P H                 MOVE 'CONTENCION TABLA   '   TO WS-OUT-DESC               
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 mOVE 'S' TO SW-911                                        
H P H                 MOVE 'S' TO SW-911-911                                    
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 MOVE 'SI'                  TO WS-ROLLBACK                 
H P H                 MOVE SQLCODE               TO WS-OUT-SQLCODE              
H P H                 MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA               
H P H                 MOVE WS-TABLA-H            TO WS-OUT-TABLA                
H P H                 MOVE '3055-PROCESA-KSIM87T' TO WS-OUT-PARRAFO             
H P H                    STRING                                                 
H P H                   'CONTENCIO:'             DELIMITED BY SIZE              
H P H                    WS-CAMPOPOL             DELIMITED BY ' '               
H P H                    '='                     DELIMITED BY SIZE              
H P H                    WS-LEE-CDNUMPOL         DELIMITED BY SIZE              
H P H                    INTO WS-OUT-DESC                                       
H P H                 END-STRING                                                
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H            STRING                                                         
H P H            'Z8883??????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            'Z8881??????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H              ELSE                                                         
H P H                 MOVE WC-COD              TO CDERR    OF KAELCWEZ          
H P H                 MOVE WC-DES01            TO DSARGU1  OF KAELCWEZ          
H P H                 MOVE WC-PROGRAMA         TO DSARGU2  OF KAELCWEZ          
H P H                 MOVE WS-ERPOLIZA         TO DSARGU3  OF KAELCWEZ          
H P H                 MOVE '3055-PROCESA-KSIM87T'                               
H P H                                          TO CDPARRAF OF KAELCWEZ          
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H                 IF SQLCODE = -911                                         
H P H                    MOVE 'S' TO SW-911                                     
H P H                    MOVE 'S' TO SW-911-911                                 
H P H                    ADD 1 TO WS-CANT-ERRORES                               
H P H                 ELSE                                                      
H P H            STRING                                                         
H P H            'X9999??????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            'X9999??????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H                 PERFORM 9999-GESTION-ERRORES                              
H P H                 END-IF                                                    
H P H              END-IF                                                       
H P H      END-EVALUATE                                                         
H P H                 END-IF                                                    
H P H               END-IF                                                      
H P H              END-IF                                                       
H P H              IF WS-ROLLBACK = 'SI'                                        
H P H                 SET WS-NO-HAY-SINIESTROS TO TRUE                          
H P H                 MOVE 98 TO WS-ITBLS                                       
H P H              END-IF                                                       
H P H              ADD WC-1 TO WS-ITBLS.                                        
H P H *                                                                         
H P H  3056-PROCESA-KSIM88T.                                                    
H P H              MOVE 'KSIM88T'             TO WS-TABLA-T                     
H P H              MOVE 'KSIM88H'             TO WS-TABLA-H                     
H P H *                                                                         
H P H              MOVE 'KSIM88T'             TO WS-TIPO-TABLA                  
H P H              MOVE 'CDSINIES'            TO WS-CAMPOPOL                    
H P H                                                                           
H P H              IF TAB-ESP-SR                                                
H P H               IF WS-SI-HISTORIFICA                                        
H P H                 PERFORM 3300-INSERTA-ESP-SIN                              
H P H               END-IF                                                      
H P H              ELSE                                                         
H P H               IF WS-SI-HISTORIFICA                                        
H P H      EXEC SQL                                                             
H P H         DECLARE CURSOR-56 CURSOR FOR                                      
H P H            SELECT CDSINIES FROM KSIM88T                                   
H P H             WHERE CDSINIES = :WS-TBL-SINOREC                              
H P H             FETCH FIRST 1 ROWS ONLY                                       
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EXEC SQL                                                             
H P H          OPEN CURSOR-56                                                   
H P H      END-EXEC                                                             
H P H      PERFORM 3306-VALIDA-CODIGO                                           
H P H      EXEC SQL                                                             
H P H          FETCH CURSOR-56                                                  
H P H          INTO                                                             
H P H          :WS-SINOREC                                                      
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H             EXEC SQL                                                      
H P H                CLOSE CURSOR-56                                            
H P H             END-EXEC                                                      
H P H             SET WS-PARA-INSERT TO TRUE                                    
H P H      EXEC SQL                                                             
H P H         INSERT INTO KSIM88H                                               
H P H            (SELECT * FROM KSIM88T                                         
H P H             WHERE CDSINIES = :WS-TBL-SINOREC)                             
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3056-PROCESA-KSIM88T' TO WS-OUT-PARRAFO                
H P H              MOVE 'INSERT CORRECTO '    TO WS-OUT-DESC                    
H P H              MOVE WS-TBL-SINOREC        TO WS-OUT-DESC(18:12)             
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-CLAVE-DUPLICADA                                   
H P H              SET WS-DUPLICADOS   TO TRUE                                  
H P H              MOVE 'SI'                  TO WS-ROLLBACK                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3056-PROCESA-KSIM88T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                'DUPLICADO:'             DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H              INTO WS-OUT-DESC                                             
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H            IF WS-WRITE                                                    
H P H              ADD  WC-1                  TO WS-IERR                        
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3056-PROCESA-KSIM88T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'SIN '                  DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN OTHER                                                         
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                     SET WS-DUPLICADOS   TO TRUE                           
H P H                     MOVE 'SI'                  TO WS-ROLLBACK             
H P H                     MOVE SQLCODE               TO WS-OUT-SQLCODE          
H P H                     MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA           
H P H                     MOVE WS-TABLA-H            TO WS-OUT-TABLA            
H P H                     MOVE '3056-PROCESA-KSIM88T' TO WS-OUT-PARRAFO         
H P H                     STRING                                                
H P H                      'CONTENCIO:'             DELIMITED BY SIZE           
H P H                       WS-CAMPOPOL             DELIMITED BY ' '            
H P H                       '='                     DELIMITED BY SIZE           
H P H                       WS-LEE-CDNUMPOL         DELIMITED BY SIZE           
H P H                       INTO WS-OUT-DESC                                    
H P H                       END-STRING                                          
H P H                     PERFORM 1570-ESCRIBE-DESCARTADA                       
H P H              ELSE                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3056-PROCESA-KSIM88T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'ERRDB2:'               DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H              MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
H P H              MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
H P H              MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
H P H              MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
H P H              MOVE '3056-PROCESA-KSIM88T  ' TO CDPARRAF OF KAELCWEZ        
H P H                                                                           
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 MOVE 'S' TO SW-911-911                                    
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H              ELSE                                                         
H P H                 PERFORM 9999-GESTION-ERRORES                              
H P H              END-IF                                                       
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                                                                           
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H            SET WS-NO-PARA-INSERT      TO TRUE                             
H P H            IF WS-WRITE                                                    
H P H              ADD  WC-1                  TO WS-IERR                        
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3056-PROCESA-KSIM88T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'NOHAY '                DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H            EXEC SQL                                                       
H P H                CLOSE CURSOR-56                                            
H P H            END-EXEC                                                       
H P H        WHEN OTHER                                                         
H P H              SET WS-NO-PARA-INSERT      TO TRUE                           
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3056-PROCESA-KSIM88T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'ERRDB2:'               DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            STRING                                                         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            ' ERROR EN SQL :' W-QUERY-TEXT                    '\N'         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H          MOVE WC-COD                   TO CDERR    OF KAELCWEZ            
H P H          MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ            
H P H          MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ            
H P H          MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ            
H P H          MOVE '3056-PROCESA-KSIM88T  ' TO CDPARRAF OF KAELCWEZ            
H P H                                                                           
H P H          IF SQLCODE = -911                                                
H P H              MOVE 'S' TO SW-911                                           
H P H              MOVE 'S' TO SW-911-911                                       
H P H              ADD 1 TO WS-CANT-ERRORES                                     
H P H          ELSE                                                             
H P H             PERFORM 9999-GESTION-ERRORES                                  
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                 IF  SQLCODE = WN-SQLCODE-OK                               
H P H                 AND WS-PARA-INSERT                                        
H P H      EXEC SQL                                                             
H P H         DELETE FROM KSIM88T                                               
H P H         WHERE CDSINIES = :WS-TBL-SINOREC                                  
H P H      END-EXEC                                                             
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3056-PROCESA-KSIM88T' TO WS-OUT-PARRAFO                
H P H              MOVE 'BORRAR CORRECTO    ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3056-PROCESA-KSIM88T' TO WS-OUT-PARRAFO                
H P H              MOVE 'NO EXISTE BORRAR   ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H              MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
H P H              MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
H P H              MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
H P H              MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
H P H              MOVE '3056-PROCESA-KSIM88T  ' TO CDPARRAF OF KAELCWEZ        
H P H                                                                           
H P H              PERFORM 9999-GESTION-ERRORES                                 
H P H                                                                           
H P H        WHEN OTHER                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3056-PROCESA-KSIM88T' TO WS-OUT-PARRAFO                
H P H              MOVE 'ERR BORRAR DB2     ' TO WS-OUT-DESC                    
H P H              IF SQLCODE  = -911                                           
H P H                 MOVE '3056-PROCESA-KSIM88T'  TO WS-OUT-PARRAFO            
H P H                 MOVE 'CONTENCION TABLA   '   TO WS-OUT-DESC               
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 mOVE 'S' TO SW-911                                        
H P H                 MOVE 'S' TO SW-911-911                                    
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 MOVE 'SI'                  TO WS-ROLLBACK                 
H P H                 MOVE SQLCODE               TO WS-OUT-SQLCODE              
H P H                 MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA               
H P H                 MOVE WS-TABLA-H            TO WS-OUT-TABLA                
H P H                 MOVE '3056-PROCESA-KSIM88T' TO WS-OUT-PARRAFO             
H P H                    STRING                                                 
H P H                   'CONTENCIO:'             DELIMITED BY SIZE              
H P H                    WS-CAMPOPOL             DELIMITED BY ' '               
H P H                    '='                     DELIMITED BY SIZE              
H P H                    WS-LEE-CDNUMPOL         DELIMITED BY SIZE              
H P H                    INTO WS-OUT-DESC                                       
H P H                 END-STRING                                                
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H            STRING                                                         
H P H            'Z8883??????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            'Z8881??????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H              ELSE                                                         
H P H                 MOVE WC-COD              TO CDERR    OF KAELCWEZ          
H P H                 MOVE WC-DES01            TO DSARGU1  OF KAELCWEZ          
H P H                 MOVE WC-PROGRAMA         TO DSARGU2  OF KAELCWEZ          
H P H                 MOVE WS-ERPOLIZA         TO DSARGU3  OF KAELCWEZ          
H P H                 MOVE '3056-PROCESA-KSIM88T'                               
H P H                                          TO CDPARRAF OF KAELCWEZ          
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H                 IF SQLCODE = -911                                         
H P H                    MOVE 'S' TO SW-911                                     
H P H                    MOVE 'S' TO SW-911-911                                 
H P H                    ADD 1 TO WS-CANT-ERRORES                               
H P H                 ELSE                                                      
H P H            STRING                                                         
H P H            'X9999??????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            'X9999??????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H                 PERFORM 9999-GESTION-ERRORES                              
H P H                 END-IF                                                    
H P H              END-IF                                                       
H P H      END-EVALUATE                                                         
H P H                 END-IF                                                    
H P H               END-IF                                                      
H P H              END-IF                                                       
H P H              IF WS-ROLLBACK = 'SI'                                        
H P H                 SET WS-NO-HAY-SINIESTROS TO TRUE                          
H P H                 MOVE 98 TO WS-ITBLS                                       
H P H              END-IF                                                       
H P H              ADD WC-1 TO WS-ITBLS.                                        
H P H *                                                                         
H P H  3057-PROCESA-KSIM8AT.                                                    
H P H              MOVE 'KSIM8AT'             TO WS-TABLA-T                     
H P H              MOVE 'KSIM8AH'             TO WS-TABLA-H                     
H P H *                                                                         
H P H              MOVE 'KSIM8AT'             TO WS-TIPO-TABLA                  
H P H              MOVE 'CDSINIES'            TO WS-CAMPOPOL                    
H P H                                                                           
H P H              IF TAB-ESP-SR                                                
H P H               IF WS-SI-HISTORIFICA                                        
H P H                 PERFORM 3300-INSERTA-ESP-SIN                              
H P H               END-IF                                                      
H P H              ELSE                                                         
H P H               IF WS-SI-HISTORIFICA                                        
H P H      EXEC SQL                                                             
H P H         DECLARE CURSOR-57 CURSOR FOR                                      
H P H            SELECT CDSINIES FROM KSIM8AT                                   
H P H             WHERE CDSINIES = :WS-TBL-SINOREC                              
H P H             FETCH FIRST 1 ROWS ONLY                                       
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EXEC SQL                                                             
H P H          OPEN CURSOR-57                                                   
H P H      END-EXEC                                                             
H P H      PERFORM 3306-VALIDA-CODIGO                                           
H P H      EXEC SQL                                                             
H P H          FETCH CURSOR-57                                                  
H P H          INTO                                                             
H P H          :WS-SINOREC                                                      
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H             EXEC SQL                                                      
H P H                CLOSE CURSOR-57                                            
H P H             END-EXEC                                                      
H P H             SET WS-PARA-INSERT TO TRUE                                    
H P H      EXEC SQL                                                             
H P H         INSERT INTO KSIM8AH                                               
H P H            (SELECT * FROM KSIM8AT                                         
H P H             WHERE CDSINIES = :WS-TBL-SINOREC)                             
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3057-PROCESA-KSIM8AT' TO WS-OUT-PARRAFO                
H P H              MOVE 'INSERT CORRECTO '    TO WS-OUT-DESC                    
H P H              MOVE WS-TBL-SINOREC        TO WS-OUT-DESC(18:12)             
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-CLAVE-DUPLICADA                                   
H P H              SET WS-DUPLICADOS   TO TRUE                                  
H P H              MOVE 'SI'                  TO WS-ROLLBACK                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3057-PROCESA-KSIM8AT' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                'DUPLICADO:'             DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H              INTO WS-OUT-DESC                                             
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H            IF WS-WRITE                                                    
H P H              ADD  WC-1                  TO WS-IERR                        
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3057-PROCESA-KSIM8AT' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'SIN '                  DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN OTHER                                                         
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                     SET WS-DUPLICADOS   TO TRUE                           
H P H                     MOVE 'SI'                  TO WS-ROLLBACK             
H P H                     MOVE SQLCODE               TO WS-OUT-SQLCODE          
H P H                     MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA           
H P H                     MOVE WS-TABLA-H            TO WS-OUT-TABLA            
H P H                     MOVE '3057-PROCESA-KSIM8AT' TO WS-OUT-PARRAFO         
H P H                     STRING                                                
H P H                      'CONTENCIO:'             DELIMITED BY SIZE           
H P H                       WS-CAMPOPOL             DELIMITED BY ' '            
H P H                       '='                     DELIMITED BY SIZE           
H P H                       WS-LEE-CDNUMPOL         DELIMITED BY SIZE           
H P H                       INTO WS-OUT-DESC                                    
H P H                       END-STRING                                          
H P H                     PERFORM 1570-ESCRIBE-DESCARTADA                       
H P H              ELSE                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3057-PROCESA-KSIM8AT' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'ERRDB2:'               DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H              MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
H P H              MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
H P H              MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
H P H              MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
H P H              MOVE '3057-PROCESA-KSIM8AT  ' TO CDPARRAF OF KAELCWEZ        
H P H                                                                           
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 MOVE 'S' TO SW-911-911                                    
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H              ELSE                                                         
H P H                 PERFORM 9999-GESTION-ERRORES                              
H P H              END-IF                                                       
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                                                                           
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H            SET WS-NO-PARA-INSERT      TO TRUE                             
H P H            IF WS-WRITE                                                    
H P H              ADD  WC-1                  TO WS-IERR                        
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3057-PROCESA-KSIM8AT' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'NOHAY '                DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H            EXEC SQL                                                       
H P H                CLOSE CURSOR-57                                            
H P H            END-EXEC                                                       
H P H        WHEN OTHER                                                         
H P H              SET WS-NO-PARA-INSERT      TO TRUE                           
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3057-PROCESA-KSIM8AT' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'ERRDB2:'               DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            STRING                                                         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            ' ERROR EN SQL :' W-QUERY-TEXT                    '\N'         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H          MOVE WC-COD                   TO CDERR    OF KAELCWEZ            
H P H          MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ            
H P H          MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ            
H P H          MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ            
H P H          MOVE '3057-PROCESA-KSIM8AT  ' TO CDPARRAF OF KAELCWEZ            
H P H                                                                           
H P H          IF SQLCODE = -911                                                
H P H              MOVE 'S' TO SW-911                                           
H P H              MOVE 'S' TO SW-911-911                                       
H P H              ADD 1 TO WS-CANT-ERRORES                                     
H P H          ELSE                                                             
H P H             PERFORM 9999-GESTION-ERRORES                                  
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                 IF  SQLCODE = WN-SQLCODE-OK                               
H P H                 AND WS-PARA-INSERT                                        
H P H      EXEC SQL                                                             
H P H         DELETE FROM KSIM8AT                                               
H P H         WHERE CDSINIES = :WS-TBL-SINOREC                                  
H P H      END-EXEC                                                             
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3057-PROCESA-KSIM8AT' TO WS-OUT-PARRAFO                
H P H              MOVE 'BORRAR CORRECTO    ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3057-PROCESA-KSIM8AT' TO WS-OUT-PARRAFO                
H P H              MOVE 'NO EXISTE BORRAR   ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H              MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
H P H              MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
H P H              MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
H P H              MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
H P H              MOVE '3057-PROCESA-KSIM8AT  ' TO CDPARRAF OF KAELCWEZ        
H P H                                                                           
H P H              PERFORM 9999-GESTION-ERRORES                                 
H P H                                                                           
H P H        WHEN OTHER                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3057-PROCESA-KSIM8AT' TO WS-OUT-PARRAFO                
H P H              MOVE 'ERR BORRAR DB2     ' TO WS-OUT-DESC                    
H P H              IF SQLCODE  = -911                                           
H P H                 MOVE '3057-PROCESA-KSIM8AT'  TO WS-OUT-PARRAFO            
H P H                 MOVE 'CONTENCION TABLA   '   TO WS-OUT-DESC               
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 mOVE 'S' TO SW-911                                        
H P H                 MOVE 'S' TO SW-911-911                                    
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 MOVE 'SI'                  TO WS-ROLLBACK                 
H P H                 MOVE SQLCODE               TO WS-OUT-SQLCODE              
H P H                 MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA               
H P H                 MOVE WS-TABLA-H            TO WS-OUT-TABLA                
H P H                 MOVE '3057-PROCESA-KSIM8AT' TO WS-OUT-PARRAFO             
H P H                    STRING                                                 
H P H                   'CONTENCIO:'             DELIMITED BY SIZE              
H P H                    WS-CAMPOPOL             DELIMITED BY ' '               
H P H                    '='                     DELIMITED BY SIZE              
H P H                    WS-LEE-CDNUMPOL         DELIMITED BY SIZE              
H P H                    INTO WS-OUT-DESC                                       
H P H                 END-STRING                                                
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H            STRING                                                         
H P H            'Z8883??????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            'Z8881??????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H              ELSE                                                         
H P H                 MOVE WC-COD              TO CDERR    OF KAELCWEZ          
H P H                 MOVE WC-DES01            TO DSARGU1  OF KAELCWEZ          
H P H                 MOVE WC-PROGRAMA         TO DSARGU2  OF KAELCWEZ          
H P H                 MOVE WS-ERPOLIZA         TO DSARGU3  OF KAELCWEZ          
H P H                 MOVE '3057-PROCESA-KSIM8AT'                               
H P H                                          TO CDPARRAF OF KAELCWEZ          
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H                 IF SQLCODE = -911                                         
H P H                    MOVE 'S' TO SW-911                                     
H P H                    MOVE 'S' TO SW-911-911                                 
H P H                    ADD 1 TO WS-CANT-ERRORES                               
H P H                 ELSE                                                      
H P H            STRING                                                         
H P H            'X9999??????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            'X9999??????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H                 PERFORM 9999-GESTION-ERRORES                              
H P H                 END-IF                                                    
H P H              END-IF                                                       
H P H      END-EVALUATE                                                         
H P H                 END-IF                                                    
H P H               END-IF                                                      
H P H              END-IF                                                       
H P H              IF WS-ROLLBACK = 'SI'                                        
H P H                 SET WS-NO-HAY-SINIESTROS TO TRUE                          
H P H                 MOVE 98 TO WS-ITBLS                                       
H P H              END-IF                                                       
H P H              ADD WC-1 TO WS-ITBLS.                                        
H P H *                                                                         
H P H  3058-PROCESA-KSIM9AT.                                                    
H P H              MOVE 'KSIM9AT'             TO WS-TABLA-T                     
H P H              MOVE 'KSIM9AH'             TO WS-TABLA-H                     
H P H *                                                                         
H P H              MOVE 'KSIM9AT'             TO WS-TIPO-TABLA                  
H P H              MOVE 'CDSINIES'            TO WS-CAMPOPOL                    
H P H                                                                           
H P H              IF TAB-ESP-SR                                                
H P H               IF WS-SI-HISTORIFICA                                        
H P H                 PERFORM 3300-INSERTA-ESP-SIN                              
H P H               END-IF                                                      
H P H              ELSE                                                         
H P H               IF WS-SI-HISTORIFICA                                        
H P H      EXEC SQL                                                             
H P H         DECLARE CURSOR-58 CURSOR FOR                                      
H P H            SELECT CDSINIES FROM KSIM9AT                                   
H P H             WHERE CDSINIES = :WS-TBL-SINOREC                              
H P H             FETCH FIRST 1 ROWS ONLY                                       
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EXEC SQL                                                             
H P H          OPEN CURSOR-58                                                   
H P H      END-EXEC                                                             
H P H      PERFORM 3306-VALIDA-CODIGO                                           
H P H      EXEC SQL                                                             
H P H          FETCH CURSOR-58                                                  
H P H          INTO                                                             
H P H          :WS-SINOREC                                                      
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H             EXEC SQL                                                      
H P H                CLOSE CURSOR-58                                            
H P H             END-EXEC                                                      
H P H             SET WS-PARA-INSERT TO TRUE                                    
H P H      EXEC SQL                                                             
H P H         INSERT INTO KSIM9AH                                               
H P H            (SELECT * FROM KSIM9AT                                         
H P H             WHERE CDSINIES = :WS-TBL-SINOREC)                             
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3058-PROCESA-KSIM9AT' TO WS-OUT-PARRAFO                
H P H              MOVE 'INSERT CORRECTO '    TO WS-OUT-DESC                    
H P H              MOVE WS-TBL-SINOREC        TO WS-OUT-DESC(18:12)             
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-CLAVE-DUPLICADA                                   
H P H              SET WS-DUPLICADOS   TO TRUE                                  
H P H              MOVE 'SI'                  TO WS-ROLLBACK                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3058-PROCESA-KSIM9AT' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                'DUPLICADO:'             DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H              INTO WS-OUT-DESC                                             
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H            IF WS-WRITE                                                    
H P H              ADD  WC-1                  TO WS-IERR                        
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3058-PROCESA-KSIM9AT' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'SIN '                  DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN OTHER                                                         
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                     SET WS-DUPLICADOS   TO TRUE                           
H P H                     MOVE 'SI'                  TO WS-ROLLBACK             
H P H                     MOVE SQLCODE               TO WS-OUT-SQLCODE          
H P H                     MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA           
H P H                     MOVE WS-TABLA-H            TO WS-OUT-TABLA            
H P H                     MOVE '3058-PROCESA-KSIM9AT' TO WS-OUT-PARRAFO         
H P H                     STRING                                                
H P H                      'CONTENCIO:'             DELIMITED BY SIZE           
H P H                       WS-CAMPOPOL             DELIMITED BY ' '            
H P H                       '='                     DELIMITED BY SIZE           
H P H                       WS-LEE-CDNUMPOL         DELIMITED BY SIZE           
H P H                       INTO WS-OUT-DESC                                    
H P H                       END-STRING                                          
H P H                     PERFORM 1570-ESCRIBE-DESCARTADA                       
H P H              ELSE                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3058-PROCESA-KSIM9AT' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'ERRDB2:'               DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H              MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
H P H              MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
H P H              MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
H P H              MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
H P H              MOVE '3058-PROCESA-KSIM9AT  ' TO CDPARRAF OF KAELCWEZ        
H P H                                                                           
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 MOVE 'S' TO SW-911-911                                    
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H              ELSE                                                         
H P H                 PERFORM 9999-GESTION-ERRORES                              
H P H              END-IF                                                       
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                                                                           
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H            SET WS-NO-PARA-INSERT      TO TRUE                             
H P H            IF WS-WRITE                                                    
H P H              ADD  WC-1                  TO WS-IERR                        
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3058-PROCESA-KSIM9AT' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'NOHAY '                DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H            EXEC SQL                                                       
H P H                CLOSE CURSOR-58                                            
H P H            END-EXEC                                                       
H P H        WHEN OTHER                                                         
H P H              SET WS-NO-PARA-INSERT      TO TRUE                           
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3058-PROCESA-KSIM9AT' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'ERRDB2:'               DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            STRING                                                         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            ' ERROR EN SQL :' W-QUERY-TEXT                    '\N'         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H          MOVE WC-COD                   TO CDERR    OF KAELCWEZ            
H P H          MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ            
H P H          MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ            
H P H          MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ            
H P H          MOVE '3058-PROCESA-KSIM9AT  ' TO CDPARRAF OF KAELCWEZ            
H P H                                                                           
H P H          IF SQLCODE = -911                                                
H P H              MOVE 'S' TO SW-911                                           
H P H              MOVE 'S' TO SW-911-911                                       
H P H              ADD 1 TO WS-CANT-ERRORES                                     
H P H          ELSE                                                             
H P H             PERFORM 9999-GESTION-ERRORES                                  
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                 IF  SQLCODE = WN-SQLCODE-OK                               
H P H                 AND WS-PARA-INSERT                                        
H P H      EXEC SQL                                                             
H P H         DELETE FROM KSIM9AT                                               
H P H         WHERE CDSINIES = :WS-TBL-SINOREC                                  
H P H      END-EXEC                                                             
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3058-PROCESA-KSIM9AT' TO WS-OUT-PARRAFO                
H P H              MOVE 'BORRAR CORRECTO    ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3058-PROCESA-KSIM9AT' TO WS-OUT-PARRAFO                
H P H              MOVE 'NO EXISTE BORRAR   ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H              MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
H P H              MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
H P H              MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
H P H              MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
H P H              MOVE '3058-PROCESA-KSIM9AT  ' TO CDPARRAF OF KAELCWEZ        
H P H                                                                           
H P H              PERFORM 9999-GESTION-ERRORES                                 
H P H                                                                           
H P H        WHEN OTHER                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3058-PROCESA-KSIM9AT' TO WS-OUT-PARRAFO                
H P H              MOVE 'ERR BORRAR DB2     ' TO WS-OUT-DESC                    
H P H              IF SQLCODE  = -911                                           
H P H                 MOVE '3058-PROCESA-KSIM9AT'  TO WS-OUT-PARRAFO            
H P H                 MOVE 'CONTENCION TABLA   '   TO WS-OUT-DESC               
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 mOVE 'S' TO SW-911                                        
H P H                 MOVE 'S' TO SW-911-911                                    
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 MOVE 'SI'                  TO WS-ROLLBACK                 
H P H                 MOVE SQLCODE               TO WS-OUT-SQLCODE              
H P H                 MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA               
H P H                 MOVE WS-TABLA-H            TO WS-OUT-TABLA                
H P H                 MOVE '3058-PROCESA-KSIM9AT' TO WS-OUT-PARRAFO             
H P H                    STRING                                                 
H P H                   'CONTENCIO:'             DELIMITED BY SIZE              
H P H                    WS-CAMPOPOL             DELIMITED BY ' '               
H P H                    '='                     DELIMITED BY SIZE              
H P H                    WS-LEE-CDNUMPOL         DELIMITED BY SIZE              
H P H                    INTO WS-OUT-DESC                                       
H P H                 END-STRING                                                
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H            STRING                                                         
H P H            'Z8883??????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            'Z8881??????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H              ELSE                                                         
H P H                 MOVE WC-COD              TO CDERR    OF KAELCWEZ          
H P H                 MOVE WC-DES01            TO DSARGU1  OF KAELCWEZ          
H P H                 MOVE WC-PROGRAMA         TO DSARGU2  OF KAELCWEZ          
H P H                 MOVE WS-ERPOLIZA         TO DSARGU3  OF KAELCWEZ          
H P H                 MOVE '3058-PROCESA-KSIM9AT'                               
H P H                                          TO CDPARRAF OF KAELCWEZ          
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H                 IF SQLCODE = -911                                         
H P H                    MOVE 'S' TO SW-911                                     
H P H                    MOVE 'S' TO SW-911-911                                 
H P H                    ADD 1 TO WS-CANT-ERRORES                               
H P H                 ELSE                                                      
H P H            STRING                                                         
H P H            'X9999??????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            'X9999??????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H                 PERFORM 9999-GESTION-ERRORES                              
H P H                 END-IF                                                    
H P H              END-IF                                                       
H P H      END-EVALUATE                                                         
H P H                 END-IF                                                    
H P H               END-IF                                                      
H P H              END-IF                                                       
H P H              IF WS-ROLLBACK = 'SI'                                        
H P H                 SET WS-NO-HAY-SINIESTROS TO TRUE                          
H P H                 MOVE 98 TO WS-ITBLS                                       
H P H              END-IF                                                       
H P H              ADD WC-1 TO WS-ITBLS.                                        
H P H *                                                                         
H P H  3059-PROCESA-KSIMA0T.                                                    
H P H              MOVE 'KSIMA0T'             TO WS-TABLA-T                     
H P H              MOVE 'KSIMA0H'             TO WS-TABLA-H                     
H P H *                                                                         
H P H              MOVE 'KSIMA0T'             TO WS-TIPO-TABLA                  
H P H              MOVE 'CDSINIES'            TO WS-CAMPOPOL                    
H P H                                                                           
H P H              IF TAB-ESP-SR                                                
H P H               IF WS-SI-HISTORIFICA                                        
H P H                 PERFORM 3300-INSERTA-ESP-SIN                              
H P H               END-IF                                                      
H P H              ELSE                                                         
H P H               IF WS-SI-HISTORIFICA                                        
H P H      EXEC SQL                                                             
H P H         DECLARE CURSOR-59 CURSOR FOR                                      
H P H            SELECT CDSINIES FROM KSIMA0T                                   
H P H             WHERE CDSINIES = :WS-TBL-SINOREC                              
H P H             FETCH FIRST 1 ROWS ONLY                                       
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EXEC SQL                                                             
H P H          OPEN CURSOR-59                                                   
H P H      END-EXEC                                                             
H P H      PERFORM 3306-VALIDA-CODIGO                                           
H P H      EXEC SQL                                                             
H P H          FETCH CURSOR-59                                                  
H P H          INTO                                                             
H P H          :WS-SINOREC                                                      
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H             EXEC SQL                                                      
H P H                CLOSE CURSOR-59                                            
H P H             END-EXEC                                                      
H P H             SET WS-PARA-INSERT TO TRUE                                    
H P H      EXEC SQL                                                             
H P H         INSERT INTO KSIMA0H                                               
H P H            (SELECT * FROM KSIMA0T                                         
H P H             WHERE CDSINIES = :WS-TBL-SINOREC)                             
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3059-PROCESA-KSIMA0T' TO WS-OUT-PARRAFO                
H P H              MOVE 'INSERT CORRECTO '    TO WS-OUT-DESC                    
H P H              MOVE WS-TBL-SINOREC        TO WS-OUT-DESC(18:12)             
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-CLAVE-DUPLICADA                                   
H P H              SET WS-DUPLICADOS   TO TRUE                                  
H P H              MOVE 'SI'                  TO WS-ROLLBACK                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3059-PROCESA-KSIMA0T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                'DUPLICADO:'             DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H              INTO WS-OUT-DESC                                             
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H            IF WS-WRITE                                                    
H P H              ADD  WC-1                  TO WS-IERR                        
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3059-PROCESA-KSIMA0T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'SIN '                  DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN OTHER                                                         
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                     SET WS-DUPLICADOS   TO TRUE                           
H P H                     MOVE 'SI'                  TO WS-ROLLBACK             
H P H                     MOVE SQLCODE               TO WS-OUT-SQLCODE          
H P H                     MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA           
H P H                     MOVE WS-TABLA-H            TO WS-OUT-TABLA            
H P H                     MOVE '3059-PROCESA-KSIMA0T' TO WS-OUT-PARRAFO         
H P H                     STRING                                                
H P H                      'CONTENCIO:'             DELIMITED BY SIZE           
H P H                       WS-CAMPOPOL             DELIMITED BY ' '            
H P H                       '='                     DELIMITED BY SIZE           
H P H                       WS-LEE-CDNUMPOL         DELIMITED BY SIZE           
H P H                       INTO WS-OUT-DESC                                    
H P H                       END-STRING                                          
H P H                     PERFORM 1570-ESCRIBE-DESCARTADA                       
H P H              ELSE                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3059-PROCESA-KSIMA0T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'ERRDB2:'               DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H              MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
H P H              MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
H P H              MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
H P H              MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
H P H              MOVE '3059-PROCESA-KSIMA0T  ' TO CDPARRAF OF KAELCWEZ        
H P H                                                                           
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 MOVE 'S' TO SW-911-911                                    
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H              ELSE                                                         
H P H                 PERFORM 9999-GESTION-ERRORES                              
H P H              END-IF                                                       
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                                                                           
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H            SET WS-NO-PARA-INSERT      TO TRUE                             
H P H            IF WS-WRITE                                                    
H P H              ADD  WC-1                  TO WS-IERR                        
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3059-PROCESA-KSIMA0T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'NOHAY '                DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H            EXEC SQL                                                       
H P H                CLOSE CURSOR-59                                            
H P H            END-EXEC                                                       
H P H        WHEN OTHER                                                         
H P H              SET WS-NO-PARA-INSERT      TO TRUE                           
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3059-PROCESA-KSIMA0T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'ERRDB2:'               DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            STRING                                                         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            ' ERROR EN SQL :' W-QUERY-TEXT                    '\N'         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H          MOVE WC-COD                   TO CDERR    OF KAELCWEZ            
H P H          MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ            
H P H          MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ            
H P H          MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ            
H P H          MOVE '3059-PROCESA-KSIMA0T  ' TO CDPARRAF OF KAELCWEZ            
H P H                                                                           
H P H          IF SQLCODE = -911                                                
H P H              MOVE 'S' TO SW-911                                           
H P H              MOVE 'S' TO SW-911-911                                       
H P H              ADD 1 TO WS-CANT-ERRORES                                     
H P H          ELSE                                                             
H P H             PERFORM 9999-GESTION-ERRORES                                  
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                 IF  SQLCODE = WN-SQLCODE-OK                               
H P H                 AND WS-PARA-INSERT                                        
H P H      EXEC SQL                                                             
H P H         DELETE FROM KSIMA0T                                               
H P H         WHERE CDSINIES = :WS-TBL-SINOREC                                  
H P H      END-EXEC                                                             
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3059-PROCESA-KSIMA0T' TO WS-OUT-PARRAFO                
H P H              MOVE 'BORRAR CORRECTO    ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3059-PROCESA-KSIMA0T' TO WS-OUT-PARRAFO                
H P H              MOVE 'NO EXISTE BORRAR   ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H              MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
H P H              MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
H P H              MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
H P H              MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
H P H              MOVE '3059-PROCESA-KSIMA0T  ' TO CDPARRAF OF KAELCWEZ        
H P H                                                                           
H P H              PERFORM 9999-GESTION-ERRORES                                 
H P H                                                                           
H P H        WHEN OTHER                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3059-PROCESA-KSIMA0T' TO WS-OUT-PARRAFO                
H P H              MOVE 'ERR BORRAR DB2     ' TO WS-OUT-DESC                    
H P H              IF SQLCODE  = -911                                           
H P H                 MOVE '3059-PROCESA-KSIMA0T'  TO WS-OUT-PARRAFO            
H P H                 MOVE 'CONTENCION TABLA   '   TO WS-OUT-DESC               
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 mOVE 'S' TO SW-911                                        
H P H                 MOVE 'S' TO SW-911-911                                    
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 MOVE 'SI'                  TO WS-ROLLBACK                 
H P H                 MOVE SQLCODE               TO WS-OUT-SQLCODE              
H P H                 MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA               
H P H                 MOVE WS-TABLA-H            TO WS-OUT-TABLA                
H P H                 MOVE '3059-PROCESA-KSIMA0T' TO WS-OUT-PARRAFO             
H P H                    STRING                                                 
H P H                   'CONTENCIO:'             DELIMITED BY SIZE              
H P H                    WS-CAMPOPOL             DELIMITED BY ' '               
H P H                    '='                     DELIMITED BY SIZE              
H P H                    WS-LEE-CDNUMPOL         DELIMITED BY SIZE              
H P H                    INTO WS-OUT-DESC                                       
H P H                 END-STRING                                                
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H            STRING                                                         
H P H            'Z8883??????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            'Z8881??????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H              ELSE                                                         
H P H                 MOVE WC-COD              TO CDERR    OF KAELCWEZ          
H P H                 MOVE WC-DES01            TO DSARGU1  OF KAELCWEZ          
H P H                 MOVE WC-PROGRAMA         TO DSARGU2  OF KAELCWEZ          
H P H                 MOVE WS-ERPOLIZA         TO DSARGU3  OF KAELCWEZ          
H P H                 MOVE '3059-PROCESA-KSIMA0T'                               
H P H                                          TO CDPARRAF OF KAELCWEZ          
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H                 IF SQLCODE = -911                                         
H P H                    MOVE 'S' TO SW-911                                     
H P H                    MOVE 'S' TO SW-911-911                                 
H P H                    ADD 1 TO WS-CANT-ERRORES                               
H P H                 ELSE                                                      
H P H            STRING                                                         
H P H            'X9999??????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            'X9999??????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H                 PERFORM 9999-GESTION-ERRORES                              
H P H                 END-IF                                                    
H P H              END-IF                                                       
H P H      END-EVALUATE                                                         
H P H                 END-IF                                                    
H P H               END-IF                                                      
H P H              END-IF                                                       
H P H              IF WS-ROLLBACK = 'SI'                                        
H P H                 SET WS-NO-HAY-SINIESTROS TO TRUE                          
H P H                 MOVE 98 TO WS-ITBLS                                       
H P H              END-IF                                                       
H P H              ADD WC-1 TO WS-ITBLS.                                        
H P H *                                                                         
H P H  3060-PROCESA-KSIN11T.                                                    
H P H              MOVE 'KSIN11T'             TO WS-TABLA-T                     
H P H              MOVE 'KSIN11H'             TO WS-TABLA-H                     
H P H *                                                                         
H P H              MOVE 'KSIN11T'             TO WS-TIPO-TABLA                  
H P H              MOVE 'CDSINIES'            TO WS-CAMPOPOL                    
H P H                                                                           
H P H              IF TAB-ESP-SR                                                
H P H               IF WS-SI-HISTORIFICA                                        
H P H                 PERFORM 3300-INSERTA-ESP-SIN                              
H P H               END-IF                                                      
H P H              ELSE                                                         
H P H               IF WS-SI-HISTORIFICA                                        
H P H      EXEC SQL                                                             
H P H         DECLARE CURSOR-60 CURSOR FOR                                      
H P H            SELECT CDSINIES FROM KSIN11T                                   
H P H             WHERE CDSINIES = :WS-TBL-SINOREC                              
H P H             FETCH FIRST 1 ROWS ONLY                                       
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EXEC SQL                                                             
H P H          OPEN CURSOR-60                                                   
H P H      END-EXEC                                                             
H P H      PERFORM 3306-VALIDA-CODIGO                                           
H P H      EXEC SQL                                                             
H P H          FETCH CURSOR-60                                                  
H P H          INTO                                                             
H P H          :WS-SINOREC                                                      
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H             EXEC SQL                                                      
H P H                CLOSE CURSOR-60                                            
H P H             END-EXEC                                                      
H P H             SET WS-PARA-INSERT TO TRUE                                    
H P H      EXEC SQL                                                             
H P H         INSERT INTO KSIN11H                                               
H P H            (SELECT * FROM KSIN11T                                         
H P H             WHERE CDSINIES = :WS-TBL-SINOREC)                             
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3060-PROCESA-KSIN11T' TO WS-OUT-PARRAFO                
H P H              MOVE 'INSERT CORRECTO '    TO WS-OUT-DESC                    
H P H              MOVE WS-TBL-SINOREC        TO WS-OUT-DESC(18:12)             
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-CLAVE-DUPLICADA                                   
H P H              SET WS-DUPLICADOS   TO TRUE                                  
H P H              MOVE 'SI'                  TO WS-ROLLBACK                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3060-PROCESA-KSIN11T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                'DUPLICADO:'             DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H              INTO WS-OUT-DESC                                             
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H            IF WS-WRITE                                                    
H P H              ADD  WC-1                  TO WS-IERR                        
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3060-PROCESA-KSIN11T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'SIN '                  DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN OTHER                                                         
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                     SET WS-DUPLICADOS   TO TRUE                           
H P H                     MOVE 'SI'                  TO WS-ROLLBACK             
H P H                     MOVE SQLCODE               TO WS-OUT-SQLCODE          
H P H                     MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA           
H P H                     MOVE WS-TABLA-H            TO WS-OUT-TABLA            
H P H                     MOVE '3060-PROCESA-KSIN11T' TO WS-OUT-PARRAFO         
H P H                     STRING                                                
H P H                      'CONTENCIO:'             DELIMITED BY SIZE           
H P H                       WS-CAMPOPOL             DELIMITED BY ' '            
H P H                       '='                     DELIMITED BY SIZE           
H P H                       WS-LEE-CDNUMPOL         DELIMITED BY SIZE           
H P H                       INTO WS-OUT-DESC                                    
H P H                       END-STRING                                          
H P H                     PERFORM 1570-ESCRIBE-DESCARTADA                       
H P H              ELSE                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3060-PROCESA-KSIN11T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'ERRDB2:'               DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H              MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
H P H              MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
H P H              MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
H P H              MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
H P H              MOVE '3060-PROCESA-KSIN11T  ' TO CDPARRAF OF KAELCWEZ        
H P H                                                                           
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 MOVE 'S' TO SW-911-911                                    
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H              ELSE                                                         
H P H                 PERFORM 9999-GESTION-ERRORES                              
H P H              END-IF                                                       
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                                                                           
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H            SET WS-NO-PARA-INSERT      TO TRUE                             
H P H            IF WS-WRITE                                                    
H P H              ADD  WC-1                  TO WS-IERR                        
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3060-PROCESA-KSIN11T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'NOHAY '                DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H            EXEC SQL                                                       
H P H                CLOSE CURSOR-60                                            
H P H            END-EXEC                                                       
H P H        WHEN OTHER                                                         
H P H              SET WS-NO-PARA-INSERT      TO TRUE                           
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3060-PROCESA-KSIN11T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'ERRDB2:'               DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            STRING                                                         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            ' ERROR EN SQL :' W-QUERY-TEXT                    '\N'         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H          MOVE WC-COD                   TO CDERR    OF KAELCWEZ            
H P H          MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ            
H P H          MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ            
H P H          MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ            
H P H          MOVE '3060-PROCESA-KSIN11T  ' TO CDPARRAF OF KAELCWEZ            
H P H                                                                           
H P H          IF SQLCODE = -911                                                
H P H              MOVE 'S' TO SW-911                                           
H P H              MOVE 'S' TO SW-911-911                                       
H P H              ADD 1 TO WS-CANT-ERRORES                                     
H P H          ELSE                                                             
H P H             PERFORM 9999-GESTION-ERRORES                                  
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                 IF  SQLCODE = WN-SQLCODE-OK                               
H P H                 AND WS-PARA-INSERT                                        
H P H      EXEC SQL                                                             
H P H         DELETE FROM KSIN11T                                               
H P H         WHERE CDSINIES = :WS-TBL-SINOREC                                  
H P H      END-EXEC                                                             
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3060-PROCESA-KSIN11T' TO WS-OUT-PARRAFO                
H P H              MOVE 'BORRAR CORRECTO    ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3060-PROCESA-KSIN11T' TO WS-OUT-PARRAFO                
H P H              MOVE 'NO EXISTE BORRAR   ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H              MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
H P H              MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
H P H              MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
H P H              MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
H P H              MOVE '3060-PROCESA-KSIN11T  ' TO CDPARRAF OF KAELCWEZ        
H P H                                                                           
H P H              PERFORM 9999-GESTION-ERRORES                                 
H P H                                                                           
H P H        WHEN OTHER                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3060-PROCESA-KSIN11T' TO WS-OUT-PARRAFO                
H P H              MOVE 'ERR BORRAR DB2     ' TO WS-OUT-DESC                    
H P H              IF SQLCODE  = -911                                           
H P H                 MOVE '3060-PROCESA-KSIN11T'  TO WS-OUT-PARRAFO            
H P H                 MOVE 'CONTENCION TABLA   '   TO WS-OUT-DESC               
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 mOVE 'S' TO SW-911                                        
H P H                 MOVE 'S' TO SW-911-911                                    
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 MOVE 'SI'                  TO WS-ROLLBACK                 
H P H                 MOVE SQLCODE               TO WS-OUT-SQLCODE              
H P H                 MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA               
H P H                 MOVE WS-TABLA-H            TO WS-OUT-TABLA                
H P H                 MOVE '3060-PROCESA-KSIN11T' TO WS-OUT-PARRAFO             
H P H                    STRING                                                 
H P H                   'CONTENCIO:'             DELIMITED BY SIZE              
H P H                    WS-CAMPOPOL             DELIMITED BY ' '               
H P H                    '='                     DELIMITED BY SIZE              
H P H                    WS-LEE-CDNUMPOL         DELIMITED BY SIZE              
H P H                    INTO WS-OUT-DESC                                       
H P H                 END-STRING                                                
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H            STRING                                                         
H P H            'Z8883??????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            'Z8881??????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H              ELSE                                                         
H P H                 MOVE WC-COD              TO CDERR    OF KAELCWEZ          
H P H                 MOVE WC-DES01            TO DSARGU1  OF KAELCWEZ          
H P H                 MOVE WC-PROGRAMA         TO DSARGU2  OF KAELCWEZ          
H P H                 MOVE WS-ERPOLIZA         TO DSARGU3  OF KAELCWEZ          
H P H                 MOVE '3060-PROCESA-KSIN11T'                               
H P H                                          TO CDPARRAF OF KAELCWEZ          
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H                 IF SQLCODE = -911                                         
H P H                    MOVE 'S' TO SW-911                                     
H P H                    MOVE 'S' TO SW-911-911                                 
H P H                    ADD 1 TO WS-CANT-ERRORES                               
H P H                 ELSE                                                      
H P H            STRING                                                         
H P H            'X9999??????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            'X9999??????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H                 PERFORM 9999-GESTION-ERRORES                              
H P H                 END-IF                                                    
H P H              END-IF                                                       
H P H      END-EVALUATE                                                         
H P H                 END-IF                                                    
H P H               END-IF                                                      
H P H              END-IF                                                       
H P H              IF WS-ROLLBACK = 'SI'                                        
H P H                 SET WS-NO-HAY-SINIESTROS TO TRUE                          
H P H                 MOVE 98 TO WS-ITBLS                                       
H P H              END-IF                                                       
H P H              ADD WC-1 TO WS-ITBLS.                                        
H P H *                                                                         
H P H  3061-PROCESA-KSIN30T.                                                    
H P H              MOVE 'KSIN30T'             TO WS-TABLA-T                     
H P H              MOVE 'KSIN30H'             TO WS-TABLA-H                     
H P H *                                                                         
H P H              MOVE 'KSIN30T'             TO WS-TIPO-TABLA                  
H P H              MOVE 'CDSINIES'            TO WS-CAMPOPOL                    
H P H                                                                           
H P H              IF TAB-ESP-SR                                                
H P H               IF WS-SI-HISTORIFICA                                        
H P H                 PERFORM 3300-INSERTA-ESP-SIN                              
H P H               END-IF                                                      
H P H              ELSE                                                         
H P H               IF WS-SI-HISTORIFICA                                        
H P H      EXEC SQL                                                             
H P H         DECLARE CURSOR-61 CURSOR FOR                                      
H P H            SELECT CDSINIES FROM KSIN30T                                   
H P H             WHERE CDSINIES = :WS-TBL-SINOREC                              
H P H             FETCH FIRST 1 ROWS ONLY                                       
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EXEC SQL                                                             
H P H          OPEN CURSOR-61                                                   
H P H      END-EXEC                                                             
H P H      PERFORM 3306-VALIDA-CODIGO                                           
H P H      EXEC SQL                                                             
H P H          FETCH CURSOR-61                                                  
H P H          INTO                                                             
H P H          :WS-SINOREC                                                      
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H             EXEC SQL                                                      
H P H                CLOSE CURSOR-61                                            
H P H             END-EXEC                                                      
H P H             SET WS-PARA-INSERT TO TRUE                                    
H P H      EXEC SQL                                                             
H P H         INSERT INTO KSIN30H                                               
H P H            (SELECT * FROM KSIN30T                                         
H P H             WHERE CDSINIES = :WS-TBL-SINOREC)                             
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3061-PROCESA-KSIN30T' TO WS-OUT-PARRAFO                
H P H              MOVE 'INSERT CORRECTO '    TO WS-OUT-DESC                    
H P H              MOVE WS-TBL-SINOREC        TO WS-OUT-DESC(18:12)             
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-CLAVE-DUPLICADA                                   
H P H              SET WS-DUPLICADOS   TO TRUE                                  
H P H              MOVE 'SI'                  TO WS-ROLLBACK                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3061-PROCESA-KSIN30T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                'DUPLICADO:'             DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H              INTO WS-OUT-DESC                                             
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H            IF WS-WRITE                                                    
H P H              ADD  WC-1                  TO WS-IERR                        
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3061-PROCESA-KSIN30T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'SIN '                  DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN OTHER                                                         
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                     SET WS-DUPLICADOS   TO TRUE                           
H P H                     MOVE 'SI'                  TO WS-ROLLBACK             
H P H                     MOVE SQLCODE               TO WS-OUT-SQLCODE          
H P H                     MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA           
H P H                     MOVE WS-TABLA-H            TO WS-OUT-TABLA            
H P H                     MOVE '3061-PROCESA-KSIN30T' TO WS-OUT-PARRAFO         
H P H                     STRING                                                
H P H                      'CONTENCIO:'             DELIMITED BY SIZE           
H P H                       WS-CAMPOPOL             DELIMITED BY ' '            
H P H                       '='                     DELIMITED BY SIZE           
H P H                       WS-LEE-CDNUMPOL         DELIMITED BY SIZE           
H P H                       INTO WS-OUT-DESC                                    
H P H                       END-STRING                                          
H P H                     PERFORM 1570-ESCRIBE-DESCARTADA                       
H P H              ELSE                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3061-PROCESA-KSIN30T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'ERRDB2:'               DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H              MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
H P H              MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
H P H              MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
H P H              MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
H P H              MOVE '3061-PROCESA-KSIN30T  ' TO CDPARRAF OF KAELCWEZ        
H P H                                                                           
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 MOVE 'S' TO SW-911-911                                    
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H              ELSE                                                         
H P H                 PERFORM 9999-GESTION-ERRORES                              
H P H              END-IF                                                       
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                                                                           
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H            SET WS-NO-PARA-INSERT      TO TRUE                             
H P H            IF WS-WRITE                                                    
H P H              ADD  WC-1                  TO WS-IERR                        
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3061-PROCESA-KSIN30T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'NOHAY '                DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H            EXEC SQL                                                       
H P H                CLOSE CURSOR-61                                            
H P H            END-EXEC                                                       
H P H        WHEN OTHER                                                         
H P H              SET WS-NO-PARA-INSERT      TO TRUE                           
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3061-PROCESA-KSIN30T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'ERRDB2:'               DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            STRING                                                         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            ' ERROR EN SQL :' W-QUERY-TEXT                    '\N'         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H          MOVE WC-COD                   TO CDERR    OF KAELCWEZ            
H P H          MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ            
H P H          MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ            
H P H          MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ            
H P H          MOVE '3061-PROCESA-KSIN30T  ' TO CDPARRAF OF KAELCWEZ            
H P H                                                                           
H P H          IF SQLCODE = -911                                                
H P H              MOVE 'S' TO SW-911                                           
H P H              MOVE 'S' TO SW-911-911                                       
H P H              ADD 1 TO WS-CANT-ERRORES                                     
H P H          ELSE                                                             
H P H             PERFORM 9999-GESTION-ERRORES                                  
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                 IF  SQLCODE = WN-SQLCODE-OK                               
H P H                 AND WS-PARA-INSERT                                        
H P H      EXEC SQL                                                             
H P H         DELETE FROM KSIN30T                                               
H P H         WHERE CDSINIES = :WS-TBL-SINOREC                                  
H P H      END-EXEC                                                             
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3061-PROCESA-KSIN30T' TO WS-OUT-PARRAFO                
H P H              MOVE 'BORRAR CORRECTO    ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3061-PROCESA-KSIN30T' TO WS-OUT-PARRAFO                
H P H              MOVE 'NO EXISTE BORRAR   ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H              MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
H P H              MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
H P H              MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
H P H              MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
H P H              MOVE '3061-PROCESA-KSIN30T  ' TO CDPARRAF OF KAELCWEZ        
H P H                                                                           
H P H              PERFORM 9999-GESTION-ERRORES                                 
H P H                                                                           
H P H        WHEN OTHER                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3061-PROCESA-KSIN30T' TO WS-OUT-PARRAFO                
H P H              MOVE 'ERR BORRAR DB2     ' TO WS-OUT-DESC                    
H P H              IF SQLCODE  = -911                                           
H P H                 MOVE '3061-PROCESA-KSIN30T'  TO WS-OUT-PARRAFO            
H P H                 MOVE 'CONTENCION TABLA   '   TO WS-OUT-DESC               
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 mOVE 'S' TO SW-911                                        
H P H                 MOVE 'S' TO SW-911-911                                    
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 MOVE 'SI'                  TO WS-ROLLBACK                 
H P H                 MOVE SQLCODE               TO WS-OUT-SQLCODE              
H P H                 MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA               
H P H                 MOVE WS-TABLA-H            TO WS-OUT-TABLA                
H P H                 MOVE '3061-PROCESA-KSIN30T' TO WS-OUT-PARRAFO             
H P H                    STRING                                                 
H P H                   'CONTENCIO:'             DELIMITED BY SIZE              
H P H                    WS-CAMPOPOL             DELIMITED BY ' '               
H P H                    '='                     DELIMITED BY SIZE              
H P H                    WS-LEE-CDNUMPOL         DELIMITED BY SIZE              
H P H                    INTO WS-OUT-DESC                                       
H P H                 END-STRING                                                
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H            STRING                                                         
H P H            'Z8883??????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            'Z8881??????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H              ELSE                                                         
H P H                 MOVE WC-COD              TO CDERR    OF KAELCWEZ          
H P H                 MOVE WC-DES01            TO DSARGU1  OF KAELCWEZ          
H P H                 MOVE WC-PROGRAMA         TO DSARGU2  OF KAELCWEZ          
H P H                 MOVE WS-ERPOLIZA         TO DSARGU3  OF KAELCWEZ          
H P H                 MOVE '3061-PROCESA-KSIN30T'                               
H P H                                          TO CDPARRAF OF KAELCWEZ          
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H                 IF SQLCODE = -911                                         
H P H                    MOVE 'S' TO SW-911                                     
H P H                    MOVE 'S' TO SW-911-911                                 
H P H                    ADD 1 TO WS-CANT-ERRORES                               
H P H                 ELSE                                                      
H P H            STRING                                                         
H P H            'X9999??????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            'X9999??????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H                 PERFORM 9999-GESTION-ERRORES                              
H P H                 END-IF                                                    
H P H              END-IF                                                       
H P H      END-EVALUATE                                                         
H P H                 END-IF                                                    
H P H               END-IF                                                      
H P H              END-IF                                                       
H P H              IF WS-ROLLBACK = 'SI'                                        
H P H                 SET WS-NO-HAY-SINIESTROS TO TRUE                          
H P H                 MOVE 98 TO WS-ITBLS                                       
H P H              END-IF                                                       
H P H              ADD WC-1 TO WS-ITBLS.                                        
H P H *                                                                         
H P H  3062-PROCESA-KSIN31T.                                                    
H P H              MOVE 'KSIN31T'             TO WS-TABLA-T                     
H P H              MOVE 'KSIN31H'             TO WS-TABLA-H                     
H P H *                                                                         
H P H              MOVE 'KSIN31T'             TO WS-TIPO-TABLA                  
H P H              MOVE 'CDSINIES'            TO WS-CAMPOPOL                    
H P H                                                                           
H P H              IF TAB-ESP-SR                                                
H P H               IF WS-SI-HISTORIFICA                                        
H P H                 PERFORM 3300-INSERTA-ESP-SIN                              
H P H               END-IF                                                      
H P H              ELSE                                                         
H P H               IF WS-SI-HISTORIFICA                                        
H P H      EXEC SQL                                                             
H P H         DECLARE CURSOR-62 CURSOR FOR                                      
H P H            SELECT CDSINIES FROM KSIN31T                                   
H P H             WHERE CDSINIES = :WS-TBL-SINOREC                              
H P H             FETCH FIRST 1 ROWS ONLY                                       
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EXEC SQL                                                             
H P H          OPEN CURSOR-62                                                   
H P H      END-EXEC                                                             
H P H      PERFORM 3306-VALIDA-CODIGO                                           
H P H      EXEC SQL                                                             
H P H          FETCH CURSOR-62                                                  
H P H          INTO                                                             
H P H          :WS-SINOREC                                                      
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H             EXEC SQL                                                      
H P H                CLOSE CURSOR-62                                            
H P H             END-EXEC                                                      
H P H             SET WS-PARA-INSERT TO TRUE                                    
H P H      EXEC SQL                                                             
H P H         INSERT INTO KSIN31H                                               
H P H            (SELECT * FROM KSIN31T                                         
H P H             WHERE CDSINIES = :WS-TBL-SINOREC)                             
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3062-PROCESA-KSIN31T' TO WS-OUT-PARRAFO                
H P H              MOVE 'INSERT CORRECTO '    TO WS-OUT-DESC                    
H P H              MOVE WS-TBL-SINOREC        TO WS-OUT-DESC(18:12)             
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-CLAVE-DUPLICADA                                   
H P H              SET WS-DUPLICADOS   TO TRUE                                  
H P H              MOVE 'SI'                  TO WS-ROLLBACK                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3062-PROCESA-KSIN31T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                'DUPLICADO:'             DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H              INTO WS-OUT-DESC                                             
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H            IF WS-WRITE                                                    
H P H              ADD  WC-1                  TO WS-IERR                        
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3062-PROCESA-KSIN31T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'SIN '                  DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN OTHER                                                         
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                     SET WS-DUPLICADOS   TO TRUE                           
H P H                     MOVE 'SI'                  TO WS-ROLLBACK             
H P H                     MOVE SQLCODE               TO WS-OUT-SQLCODE          
H P H                     MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA           
H P H                     MOVE WS-TABLA-H            TO WS-OUT-TABLA            
H P H                     MOVE '3062-PROCESA-KSIN31T' TO WS-OUT-PARRAFO         
H P H                     STRING                                                
H P H                      'CONTENCIO:'             DELIMITED BY SIZE           
H P H                       WS-CAMPOPOL             DELIMITED BY ' '            
H P H                       '='                     DELIMITED BY SIZE           
H P H                       WS-LEE-CDNUMPOL         DELIMITED BY SIZE           
H P H                       INTO WS-OUT-DESC                                    
H P H                       END-STRING                                          
H P H                     PERFORM 1570-ESCRIBE-DESCARTADA                       
H P H              ELSE                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3062-PROCESA-KSIN31T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'ERRDB2:'               DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H              MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
H P H              MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
H P H              MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
H P H              MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
H P H              MOVE '3062-PROCESA-KSIN31T  ' TO CDPARRAF OF KAELCWEZ        
H P H                                                                           
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 MOVE 'S' TO SW-911-911                                    
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H              ELSE                                                         
H P H                 PERFORM 9999-GESTION-ERRORES                              
H P H              END-IF                                                       
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                                                                           
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H            SET WS-NO-PARA-INSERT      TO TRUE                             
H P H            IF WS-WRITE                                                    
H P H              ADD  WC-1                  TO WS-IERR                        
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3062-PROCESA-KSIN31T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'NOHAY '                DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H            EXEC SQL                                                       
H P H                CLOSE CURSOR-62                                            
H P H            END-EXEC                                                       
H P H        WHEN OTHER                                                         
H P H              SET WS-NO-PARA-INSERT      TO TRUE                           
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3062-PROCESA-KSIN31T' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'ERRDB2:'               DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            STRING                                                         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            ' ERROR EN SQL :' W-QUERY-TEXT                    '\N'         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H          MOVE WC-COD                   TO CDERR    OF KAELCWEZ            
H P H          MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ            
H P H          MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ            
H P H          MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ            
H P H          MOVE '3062-PROCESA-KSIN31T  ' TO CDPARRAF OF KAELCWEZ            
H P H                                                                           
H P H          IF SQLCODE = -911                                                
H P H              MOVE 'S' TO SW-911                                           
H P H              MOVE 'S' TO SW-911-911                                       
H P H              ADD 1 TO WS-CANT-ERRORES                                     
H P H          ELSE                                                             
H P H             PERFORM 9999-GESTION-ERRORES                                  
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                 IF  SQLCODE = WN-SQLCODE-OK                               
H P H                 AND WS-PARA-INSERT                                        
H P H      EXEC SQL                                                             
H P H         DELETE FROM KSIN31T                                               
H P H         WHERE CDSINIES = :WS-TBL-SINOREC                                  
H P H      END-EXEC                                                             
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3062-PROCESA-KSIN31T' TO WS-OUT-PARRAFO                
H P H              MOVE 'BORRAR CORRECTO    ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3062-PROCESA-KSIN31T' TO WS-OUT-PARRAFO                
H P H              MOVE 'NO EXISTE BORRAR   ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H              MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
H P H              MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
H P H              MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
H P H              MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
H P H              MOVE '3062-PROCESA-KSIN31T  ' TO CDPARRAF OF KAELCWEZ        
H P H                                                                           
H P H              PERFORM 9999-GESTION-ERRORES                                 
H P H                                                                           
H P H        WHEN OTHER                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3062-PROCESA-KSIN31T' TO WS-OUT-PARRAFO                
H P H              MOVE 'ERR BORRAR DB2     ' TO WS-OUT-DESC                    
H P H              IF SQLCODE  = -911                                           
H P H                 MOVE '3062-PROCESA-KSIN31T'  TO WS-OUT-PARRAFO            
H P H                 MOVE 'CONTENCION TABLA   '   TO WS-OUT-DESC               
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 mOVE 'S' TO SW-911                                        
H P H                 MOVE 'S' TO SW-911-911                                    
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 MOVE 'SI'                  TO WS-ROLLBACK                 
H P H                 MOVE SQLCODE               TO WS-OUT-SQLCODE              
H P H                 MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA               
H P H                 MOVE WS-TABLA-H            TO WS-OUT-TABLA                
H P H                 MOVE '3062-PROCESA-KSIN31T' TO WS-OUT-PARRAFO             
H P H                    STRING                                                 
H P H                   'CONTENCIO:'             DELIMITED BY SIZE              
H P H                    WS-CAMPOPOL             DELIMITED BY ' '               
H P H                    '='                     DELIMITED BY SIZE              
H P H                    WS-LEE-CDNUMPOL         DELIMITED BY SIZE              
H P H                    INTO WS-OUT-DESC                                       
H P H                 END-STRING                                                
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H            STRING                                                         
H P H            'Z8883??????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            'Z8881??????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H              ELSE                                                         
H P H                 MOVE WC-COD              TO CDERR    OF KAELCWEZ          
H P H                 MOVE WC-DES01            TO DSARGU1  OF KAELCWEZ          
H P H                 MOVE WC-PROGRAMA         TO DSARGU2  OF KAELCWEZ          
H P H                 MOVE WS-ERPOLIZA         TO DSARGU3  OF KAELCWEZ          
H P H                 MOVE '3062-PROCESA-KSIN31T'                               
H P H                                          TO CDPARRAF OF KAELCWEZ          
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H                 IF SQLCODE = -911                                         
H P H                    MOVE 'S' TO SW-911                                     
H P H                    MOVE 'S' TO SW-911-911                                 
H P H                    ADD 1 TO WS-CANT-ERRORES                               
H P H                 ELSE                                                      
H P H            STRING                                                         
H P H            'X9999??????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            'X9999??????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H                 PERFORM 9999-GESTION-ERRORES                              
H P H                 END-IF                                                    
H P H              END-IF                                                       
H P H      END-EVALUATE                                                         
H P H                 END-IF                                                    
H P H               END-IF                                                      
H P H              END-IF                                                       
H P H              IF WS-ROLLBACK = 'SI'                                        
H P H                 SET WS-NO-HAY-SINIESTROS TO TRUE                          
H P H                 MOVE 98 TO WS-ITBLS                                       
H P H              END-IF                                                       
H P H              ADD WC-1 TO WS-ITBLS.                                        
H P H *                                                                         
H P H  3063-PROCESA-KSITART.                                                    
H P H              MOVE 'KSITART'             TO WS-TABLA-T                     
H P H              MOVE 'KSITARH'             TO WS-TABLA-H                     
H P H *                                                                         
H P H              MOVE 'KSITART'             TO WS-TIPO-TABLA                  
H P H              MOVE 'CDSINIES'            TO WS-CAMPOPOL                    
H P H                                                                           
H P H              IF TAB-ESP-SR                                                
H P H               IF WS-SI-HISTORIFICA                                        
H P H                 PERFORM 3300-INSERTA-ESP-SIN                              
H P H               END-IF                                                      
H P H              ELSE                                                         
H P H               IF WS-SI-HISTORIFICA                                        
H P H      EXEC SQL                                                             
H P H         DECLARE CURSOR-63 CURSOR FOR                                      
H P H            SELECT CDSINIES FROM KSITART                                   
H P H             WHERE CDSINIES = :WS-TBL-SINOREC                              
H P H             FETCH FIRST 1 ROWS ONLY                                       
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EXEC SQL                                                             
H P H          OPEN CURSOR-63                                                   
H P H      END-EXEC                                                             
H P H      PERFORM 3306-VALIDA-CODIGO                                           
H P H      EXEC SQL                                                             
H P H          FETCH CURSOR-63                                                  
H P H          INTO                                                             
H P H          :WS-SINOREC                                                      
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H             EXEC SQL                                                      
H P H                CLOSE CURSOR-63                                            
H P H             END-EXEC                                                      
H P H             SET WS-PARA-INSERT TO TRUE                                    
H P H      EXEC SQL                                                             
H P H         INSERT INTO KSITARH                                               
H P H            (SELECT * FROM KSITART                                         
H P H             WHERE CDSINIES = :WS-TBL-SINOREC)                             
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3063-PROCESA-KSITART' TO WS-OUT-PARRAFO                
H P H              MOVE 'INSERT CORRECTO '    TO WS-OUT-DESC                    
H P H              MOVE WS-TBL-SINOREC        TO WS-OUT-DESC(18:12)             
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-CLAVE-DUPLICADA                                   
H P H              SET WS-DUPLICADOS   TO TRUE                                  
H P H              MOVE 'SI'                  TO WS-ROLLBACK                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3063-PROCESA-KSITART' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                'DUPLICADO:'             DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H              INTO WS-OUT-DESC                                             
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H            IF WS-WRITE                                                    
H P H              ADD  WC-1                  TO WS-IERR                        
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3063-PROCESA-KSITART' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'SIN '                  DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN OTHER                                                         
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                     SET WS-DUPLICADOS   TO TRUE                           
H P H                     MOVE 'SI'                  TO WS-ROLLBACK             
H P H                     MOVE SQLCODE               TO WS-OUT-SQLCODE          
H P H                     MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA           
H P H                     MOVE WS-TABLA-H            TO WS-OUT-TABLA            
H P H                     MOVE '3063-PROCESA-KSITART' TO WS-OUT-PARRAFO         
H P H                     STRING                                                
H P H                      'CONTENCIO:'             DELIMITED BY SIZE           
H P H                       WS-CAMPOPOL             DELIMITED BY ' '            
H P H                       '='                     DELIMITED BY SIZE           
H P H                       WS-LEE-CDNUMPOL         DELIMITED BY SIZE           
H P H                       INTO WS-OUT-DESC                                    
H P H                       END-STRING                                          
H P H                     PERFORM 1570-ESCRIBE-DESCARTADA                       
H P H              ELSE                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3063-PROCESA-KSITART' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'ERRDB2:'               DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H              MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
H P H              MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
H P H              MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
H P H              MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
H P H              MOVE '3063-PROCESA-KSITART  ' TO CDPARRAF OF KAELCWEZ        
H P H                                                                           
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 MOVE 'S' TO SW-911-911                                    
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H              ELSE                                                         
H P H                 PERFORM 9999-GESTION-ERRORES                              
H P H              END-IF                                                       
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                                                                           
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H            SET WS-NO-PARA-INSERT      TO TRUE                             
H P H            IF WS-WRITE                                                    
H P H              ADD  WC-1                  TO WS-IERR                        
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3063-PROCESA-KSITART' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'NOHAY '                DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H            EXEC SQL                                                       
H P H                CLOSE CURSOR-63                                            
H P H            END-EXEC                                                       
H P H        WHEN OTHER                                                         
H P H              SET WS-NO-PARA-INSERT      TO TRUE                           
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3063-PROCESA-KSITART' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'ERRDB2:'               DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            STRING                                                         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            ' ERROR EN SQL :' W-QUERY-TEXT                    '\N'         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H          MOVE WC-COD                   TO CDERR    OF KAELCWEZ            
H P H          MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ            
H P H          MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ            
H P H          MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ            
H P H          MOVE '3063-PROCESA-KSITART  ' TO CDPARRAF OF KAELCWEZ            
H P H                                                                           
H P H          IF SQLCODE = -911                                                
H P H              MOVE 'S' TO SW-911                                           
H P H              MOVE 'S' TO SW-911-911                                       
H P H              ADD 1 TO WS-CANT-ERRORES                                     
H P H          ELSE                                                             
H P H             PERFORM 9999-GESTION-ERRORES                                  
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                 IF  SQLCODE = WN-SQLCODE-OK                               
H P H                 AND WS-PARA-INSERT                                        
H P H      EXEC SQL                                                             
H P H         DELETE FROM KSITART                                               
H P H         WHERE CDSINIES = :WS-TBL-SINOREC                                  
H P H      END-EXEC                                                             
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3063-PROCESA-KSITART' TO WS-OUT-PARRAFO                
H P H              MOVE 'BORRAR CORRECTO    ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3063-PROCESA-KSITART' TO WS-OUT-PARRAFO                
H P H              MOVE 'NO EXISTE BORRAR   ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H              MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
H P H              MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
H P H              MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
H P H              MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
H P H              MOVE '3063-PROCESA-KSITART  ' TO CDPARRAF OF KAELCWEZ        
H P H                                                                           
H P H              PERFORM 9999-GESTION-ERRORES                                 
H P H                                                                           
H P H        WHEN OTHER                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3063-PROCESA-KSITART' TO WS-OUT-PARRAFO                
H P H              MOVE 'ERR BORRAR DB2     ' TO WS-OUT-DESC                    
H P H              IF SQLCODE  = -911                                           
H P H                 MOVE '3063-PROCESA-KSITART'  TO WS-OUT-PARRAFO            
H P H                 MOVE 'CONTENCION TABLA   '   TO WS-OUT-DESC               
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 mOVE 'S' TO SW-911                                        
H P H                 MOVE 'S' TO SW-911-911                                    
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 MOVE 'SI'                  TO WS-ROLLBACK                 
H P H                 MOVE SQLCODE               TO WS-OUT-SQLCODE              
H P H                 MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA               
H P H                 MOVE WS-TABLA-H            TO WS-OUT-TABLA                
H P H                 MOVE '3063-PROCESA-KSITART' TO WS-OUT-PARRAFO             
H P H                    STRING                                                 
H P H                   'CONTENCIO:'             DELIMITED BY SIZE              
H P H                    WS-CAMPOPOL             DELIMITED BY ' '               
H P H                    '='                     DELIMITED BY SIZE              
H P H                    WS-LEE-CDNUMPOL         DELIMITED BY SIZE              
H P H                    INTO WS-OUT-DESC                                       
H P H                 END-STRING                                                
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H            STRING                                                         
H P H            'Z8883??????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            'Z8881??????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H              ELSE                                                         
H P H                 MOVE WC-COD              TO CDERR    OF KAELCWEZ          
H P H                 MOVE WC-DES01            TO DSARGU1  OF KAELCWEZ          
H P H                 MOVE WC-PROGRAMA         TO DSARGU2  OF KAELCWEZ          
H P H                 MOVE WS-ERPOLIZA         TO DSARGU3  OF KAELCWEZ          
H P H                 MOVE '3063-PROCESA-KSITART'                               
H P H                                          TO CDPARRAF OF KAELCWEZ          
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H                 IF SQLCODE = -911                                         
H P H                    MOVE 'S' TO SW-911                                     
H P H                    MOVE 'S' TO SW-911-911                                 
H P H                    ADD 1 TO WS-CANT-ERRORES                               
H P H                 ELSE                                                      
H P H            STRING                                                         
H P H            'X9999??????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            'X9999??????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H                 PERFORM 9999-GESTION-ERRORES                              
H P H                 END-IF                                                    
H P H              END-IF                                                       
H P H      END-EVALUATE                                                         
H P H                 END-IF                                                    
H P H               END-IF                                                      
H P H              END-IF                                                       
H P H              IF WS-ROLLBACK = 'SI'                                        
H P H                 SET WS-NO-HAY-SINIESTROS TO TRUE                          
H P H                 MOVE 98 TO WS-ITBLS                                       
H P H              END-IF                                                       
H P H              ADD WC-1 TO WS-ITBLS.                                        
H P H *                                                                         
H P H  3064-PROCESA-KSITCRT.                                                    
H P H              MOVE 'KSITCRT'             TO WS-TABLA-T                     
H P H              MOVE 'KSITCRH'             TO WS-TABLA-H                     
H P H *                                                                         
H P H              MOVE 'KSITCRT'             TO WS-TIPO-TABLA                  
H P H              MOVE 'CDSINIES'            TO WS-CAMPOPOL                    
H P H                                                                           
H P H              IF TAB-ESP-SR                                                
H P H               IF WS-SI-HISTORIFICA                                        
H P H                 PERFORM 3300-INSERTA-ESP-SIN                              
H P H               END-IF                                                      
H P H              ELSE                                                         
H P H               IF WS-SI-HISTORIFICA                                        
H P H      EXEC SQL                                                             
H P H         DECLARE CURSOR-64 CURSOR FOR                                      
H P H            SELECT CDSINIES FROM KSITCRT                                   
H P H             WHERE CDSINIES = :WS-TBL-SINOREC                              
H P H             FETCH FIRST 1 ROWS ONLY                                       
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EXEC SQL                                                             
H P H          OPEN CURSOR-64                                                   
H P H      END-EXEC                                                             
H P H      PERFORM 3306-VALIDA-CODIGO                                           
H P H      EXEC SQL                                                             
H P H          FETCH CURSOR-64                                                  
H P H          INTO                                                             
H P H          :WS-SINOREC                                                      
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H             EXEC SQL                                                      
H P H                CLOSE CURSOR-64                                            
H P H             END-EXEC                                                      
H P H             SET WS-PARA-INSERT TO TRUE                                    
H P H      EXEC SQL                                                             
H P H         INSERT INTO KSITCRH                                               
H P H            (SELECT * FROM KSITCRT                                         
H P H             WHERE CDSINIES = :WS-TBL-SINOREC)                             
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3064-PROCESA-KSITCRT' TO WS-OUT-PARRAFO                
H P H              MOVE 'INSERT CORRECTO '    TO WS-OUT-DESC                    
H P H              MOVE WS-TBL-SINOREC        TO WS-OUT-DESC(18:12)             
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-CLAVE-DUPLICADA                                   
H P H              SET WS-DUPLICADOS   TO TRUE                                  
H P H              MOVE 'SI'                  TO WS-ROLLBACK                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3064-PROCESA-KSITCRT' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                'DUPLICADO:'             DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H              INTO WS-OUT-DESC                                             
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H            IF WS-WRITE                                                    
H P H              ADD  WC-1                  TO WS-IERR                        
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3064-PROCESA-KSITCRT' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'SIN '                  DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN OTHER                                                         
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                     SET WS-DUPLICADOS   TO TRUE                           
H P H                     MOVE 'SI'                  TO WS-ROLLBACK             
H P H                     MOVE SQLCODE               TO WS-OUT-SQLCODE          
H P H                     MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA           
H P H                     MOVE WS-TABLA-H            TO WS-OUT-TABLA            
H P H                     MOVE '3064-PROCESA-KSITCRT' TO WS-OUT-PARRAFO         
H P H                     STRING                                                
H P H                      'CONTENCIO:'             DELIMITED BY SIZE           
H P H                       WS-CAMPOPOL             DELIMITED BY ' '            
H P H                       '='                     DELIMITED BY SIZE           
H P H                       WS-LEE-CDNUMPOL         DELIMITED BY SIZE           
H P H                       INTO WS-OUT-DESC                                    
H P H                       END-STRING                                          
H P H                     PERFORM 1570-ESCRIBE-DESCARTADA                       
H P H              ELSE                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3064-PROCESA-KSITCRT' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'ERRDB2:'               DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H              MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
H P H              MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
H P H              MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
H P H              MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
H P H              MOVE '3064-PROCESA-KSITCRT  ' TO CDPARRAF OF KAELCWEZ        
H P H                                                                           
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 MOVE 'S' TO SW-911-911                                    
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H              ELSE                                                         
H P H                 PERFORM 9999-GESTION-ERRORES                              
H P H              END-IF                                                       
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                                                                           
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H            SET WS-NO-PARA-INSERT      TO TRUE                             
H P H            IF WS-WRITE                                                    
H P H              ADD  WC-1                  TO WS-IERR                        
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3064-PROCESA-KSITCRT' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'NOHAY '                DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H            EXEC SQL                                                       
H P H                CLOSE CURSOR-64                                            
H P H            END-EXEC                                                       
H P H        WHEN OTHER                                                         
H P H              SET WS-NO-PARA-INSERT      TO TRUE                           
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3064-PROCESA-KSITCRT' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'ERRDB2:'               DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            STRING                                                         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            ' ERROR EN SQL :' W-QUERY-TEXT                    '\N'         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H          MOVE WC-COD                   TO CDERR    OF KAELCWEZ            
H P H          MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ            
H P H          MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ            
H P H          MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ            
H P H          MOVE '3064-PROCESA-KSITCRT  ' TO CDPARRAF OF KAELCWEZ            
H P H                                                                           
H P H          IF SQLCODE = -911                                                
H P H              MOVE 'S' TO SW-911                                           
H P H              MOVE 'S' TO SW-911-911                                       
H P H              ADD 1 TO WS-CANT-ERRORES                                     
H P H          ELSE                                                             
H P H             PERFORM 9999-GESTION-ERRORES                                  
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                 IF  SQLCODE = WN-SQLCODE-OK                               
H P H                 AND WS-PARA-INSERT                                        
H P H      EXEC SQL                                                             
H P H         DELETE FROM KSITCRT                                               
H P H         WHERE CDSINIES = :WS-TBL-SINOREC                                  
H P H      END-EXEC                                                             
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3064-PROCESA-KSITCRT' TO WS-OUT-PARRAFO                
H P H              MOVE 'BORRAR CORRECTO    ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3064-PROCESA-KSITCRT' TO WS-OUT-PARRAFO                
H P H              MOVE 'NO EXISTE BORRAR   ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H              MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
H P H              MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
H P H              MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
H P H              MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
H P H              MOVE '3064-PROCESA-KSITCRT  ' TO CDPARRAF OF KAELCWEZ        
H P H                                                                           
H P H              PERFORM 9999-GESTION-ERRORES                                 
H P H                                                                           
H P H        WHEN OTHER                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3064-PROCESA-KSITCRT' TO WS-OUT-PARRAFO                
H P H              MOVE 'ERR BORRAR DB2     ' TO WS-OUT-DESC                    
H P H              IF SQLCODE  = -911                                           
H P H                 MOVE '3064-PROCESA-KSITCRT'  TO WS-OUT-PARRAFO            
H P H                 MOVE 'CONTENCION TABLA   '   TO WS-OUT-DESC               
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 mOVE 'S' TO SW-911                                        
H P H                 MOVE 'S' TO SW-911-911                                    
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 MOVE 'SI'                  TO WS-ROLLBACK                 
H P H                 MOVE SQLCODE               TO WS-OUT-SQLCODE              
H P H                 MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA               
H P H                 MOVE WS-TABLA-H            TO WS-OUT-TABLA                
H P H                 MOVE '3064-PROCESA-KSITCRT' TO WS-OUT-PARRAFO             
H P H                    STRING                                                 
H P H                   'CONTENCIO:'             DELIMITED BY SIZE              
H P H                    WS-CAMPOPOL             DELIMITED BY ' '               
H P H                    '='                     DELIMITED BY SIZE              
H P H                    WS-LEE-CDNUMPOL         DELIMITED BY SIZE              
H P H                    INTO WS-OUT-DESC                                       
H P H                 END-STRING                                                
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H            STRING                                                         
H P H            'Z8883??????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            'Z8881??????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H              ELSE                                                         
H P H                 MOVE WC-COD              TO CDERR    OF KAELCWEZ          
H P H                 MOVE WC-DES01            TO DSARGU1  OF KAELCWEZ          
H P H                 MOVE WC-PROGRAMA         TO DSARGU2  OF KAELCWEZ          
H P H                 MOVE WS-ERPOLIZA         TO DSARGU3  OF KAELCWEZ          
H P H                 MOVE '3064-PROCESA-KSITCRT'                               
H P H                                          TO CDPARRAF OF KAELCWEZ          
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H                 IF SQLCODE = -911                                         
H P H                    MOVE 'S' TO SW-911                                     
H P H                    MOVE 'S' TO SW-911-911                                 
H P H                    ADD 1 TO WS-CANT-ERRORES                               
H P H                 ELSE                                                      
H P H            STRING                                                         
H P H            'X9999??????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            'X9999??????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H                 PERFORM 9999-GESTION-ERRORES                              
H P H                 END-IF                                                    
H P H              END-IF                                                       
H P H      END-EVALUATE                                                         
H P H                 END-IF                                                    
H P H               END-IF                                                      
H P H              END-IF                                                       
H P H              IF WS-ROLLBACK = 'SI'                                        
H P H                 SET WS-NO-HAY-SINIESTROS TO TRUE                          
H P H                 MOVE 98 TO WS-ITBLS                                       
H P H              END-IF                                                       
H P H              ADD WC-1 TO WS-ITBLS.                                        
H P H *                                                                         
H P H  3065-PROCESA-KSITDPT.                                                    
H P H              MOVE 'KSITDPT'             TO WS-TABLA-T                     
H P H              MOVE 'KSITDPH'             TO WS-TABLA-H                     
H P H *                                                                         
H P H              MOVE 'KSITDPT'             TO WS-TIPO-TABLA                  
H P H              MOVE 'CDSINIES'            TO WS-CAMPOPOL                    
H P H                                                                           
H P H              IF TAB-ESP-SR                                                
H P H               IF WS-SI-HISTORIFICA                                        
H P H                 PERFORM 3300-INSERTA-ESP-SIN                              
H P H               END-IF                                                      
H P H              ELSE                                                         
H P H               IF WS-SI-HISTORIFICA                                        
H P H      EXEC SQL                                                             
H P H         DECLARE CURSOR-65 CURSOR FOR                                      
H P H            SELECT CDSINIES FROM KSITDPT                                   
H P H             WHERE CDSINIES = :WS-TBL-SINOREC                              
H P H             FETCH FIRST 1 ROWS ONLY                                       
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EXEC SQL                                                             
H P H          OPEN CURSOR-65                                                   
H P H      END-EXEC                                                             
H P H      PERFORM 3306-VALIDA-CODIGO                                           
H P H      EXEC SQL                                                             
H P H          FETCH CURSOR-65                                                  
H P H          INTO                                                             
H P H          :WS-SINOREC                                                      
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H             EXEC SQL                                                      
H P H                CLOSE CURSOR-65                                            
H P H             END-EXEC                                                      
H P H             SET WS-PARA-INSERT TO TRUE                                    
H P H      EXEC SQL                                                             
H P H         INSERT INTO KSITDPH                                               
H P H            (SELECT * FROM KSITDPT                                         
H P H             WHERE CDSINIES = :WS-TBL-SINOREC)                             
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3065-PROCESA-KSITDPT' TO WS-OUT-PARRAFO                
H P H              MOVE 'INSERT CORRECTO '    TO WS-OUT-DESC                    
H P H              MOVE WS-TBL-SINOREC        TO WS-OUT-DESC(18:12)             
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-CLAVE-DUPLICADA                                   
H P H              SET WS-DUPLICADOS   TO TRUE                                  
H P H              MOVE 'SI'                  TO WS-ROLLBACK                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3065-PROCESA-KSITDPT' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                'DUPLICADO:'             DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H              INTO WS-OUT-DESC                                             
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H            IF WS-WRITE                                                    
H P H              ADD  WC-1                  TO WS-IERR                        
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3065-PROCESA-KSITDPT' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'SIN '                  DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN OTHER                                                         
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                     SET WS-DUPLICADOS   TO TRUE                           
H P H                     MOVE 'SI'                  TO WS-ROLLBACK             
H P H                     MOVE SQLCODE               TO WS-OUT-SQLCODE          
H P H                     MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA           
H P H                     MOVE WS-TABLA-H            TO WS-OUT-TABLA            
H P H                     MOVE '3065-PROCESA-KSITDPT' TO WS-OUT-PARRAFO         
H P H                     STRING                                                
H P H                      'CONTENCIO:'             DELIMITED BY SIZE           
H P H                       WS-CAMPOPOL             DELIMITED BY ' '            
H P H                       '='                     DELIMITED BY SIZE           
H P H                       WS-LEE-CDNUMPOL         DELIMITED BY SIZE           
H P H                       INTO WS-OUT-DESC                                    
H P H                       END-STRING                                          
H P H                     PERFORM 1570-ESCRIBE-DESCARTADA                       
H P H              ELSE                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3065-PROCESA-KSITDPT' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'ERRDB2:'               DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H              MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
H P H              MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
H P H              MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
H P H              MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
H P H              MOVE '3065-PROCESA-KSITDPT  ' TO CDPARRAF OF KAELCWEZ        
H P H                                                                           
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 MOVE 'S' TO SW-911-911                                    
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H              ELSE                                                         
H P H                 PERFORM 9999-GESTION-ERRORES                              
H P H              END-IF                                                       
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                                                                           
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H            SET WS-NO-PARA-INSERT      TO TRUE                             
H P H            IF WS-WRITE                                                    
H P H              ADD  WC-1                  TO WS-IERR                        
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3065-PROCESA-KSITDPT' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'NOHAY '                DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H            EXEC SQL                                                       
H P H                CLOSE CURSOR-65                                            
H P H            END-EXEC                                                       
H P H        WHEN OTHER                                                         
H P H              SET WS-NO-PARA-INSERT      TO TRUE                           
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3065-PROCESA-KSITDPT' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'ERRDB2:'               DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            STRING                                                         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            ' ERROR EN SQL :' W-QUERY-TEXT                    '\N'         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H          MOVE WC-COD                   TO CDERR    OF KAELCWEZ            
H P H          MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ            
H P H          MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ            
H P H          MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ            
H P H          MOVE '3065-PROCESA-KSITDPT  ' TO CDPARRAF OF KAELCWEZ            
H P H                                                                           
H P H          IF SQLCODE = -911                                                
H P H              MOVE 'S' TO SW-911                                           
H P H              MOVE 'S' TO SW-911-911                                       
H P H              ADD 1 TO WS-CANT-ERRORES                                     
H P H          ELSE                                                             
H P H             PERFORM 9999-GESTION-ERRORES                                  
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                 IF  SQLCODE = WN-SQLCODE-OK                               
H P H                 AND WS-PARA-INSERT                                        
H P H      EXEC SQL                                                             
H P H         DELETE FROM KSITDPT                                               
H P H         WHERE CDSINIES = :WS-TBL-SINOREC                                  
H P H      END-EXEC                                                             
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3065-PROCESA-KSITDPT' TO WS-OUT-PARRAFO                
H P H              MOVE 'BORRAR CORRECTO    ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3065-PROCESA-KSITDPT' TO WS-OUT-PARRAFO                
H P H              MOVE 'NO EXISTE BORRAR   ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H              MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
H P H              MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
H P H              MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
H P H              MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
H P H              MOVE '3065-PROCESA-KSITDPT  ' TO CDPARRAF OF KAELCWEZ        
H P H                                                                           
H P H              PERFORM 9999-GESTION-ERRORES                                 
H P H                                                                           
H P H        WHEN OTHER                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3065-PROCESA-KSITDPT' TO WS-OUT-PARRAFO                
H P H              MOVE 'ERR BORRAR DB2     ' TO WS-OUT-DESC                    
H P H              IF SQLCODE  = -911                                           
H P H                 MOVE '3065-PROCESA-KSITDPT'  TO WS-OUT-PARRAFO            
H P H                 MOVE 'CONTENCION TABLA   '   TO WS-OUT-DESC               
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 mOVE 'S' TO SW-911                                        
H P H                 MOVE 'S' TO SW-911-911                                    
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 MOVE 'SI'                  TO WS-ROLLBACK                 
H P H                 MOVE SQLCODE               TO WS-OUT-SQLCODE              
H P H                 MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA               
H P H                 MOVE WS-TABLA-H            TO WS-OUT-TABLA                
H P H                 MOVE '3065-PROCESA-KSITDPT' TO WS-OUT-PARRAFO             
H P H                    STRING                                                 
H P H                   'CONTENCIO:'             DELIMITED BY SIZE              
H P H                    WS-CAMPOPOL             DELIMITED BY ' '               
H P H                    '='                     DELIMITED BY SIZE              
H P H                    WS-LEE-CDNUMPOL         DELIMITED BY SIZE              
H P H                    INTO WS-OUT-DESC                                       
H P H                 END-STRING                                                
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H            STRING                                                         
H P H            'Z8883??????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            'Z8881??????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H              ELSE                                                         
H P H                 MOVE WC-COD              TO CDERR    OF KAELCWEZ          
H P H                 MOVE WC-DES01            TO DSARGU1  OF KAELCWEZ          
H P H                 MOVE WC-PROGRAMA         TO DSARGU2  OF KAELCWEZ          
H P H                 MOVE WS-ERPOLIZA         TO DSARGU3  OF KAELCWEZ          
H P H                 MOVE '3065-PROCESA-KSITDPT'                               
H P H                                          TO CDPARRAF OF KAELCWEZ          
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H                 IF SQLCODE = -911                                         
H P H                    MOVE 'S' TO SW-911                                     
H P H                    MOVE 'S' TO SW-911-911                                 
H P H                    ADD 1 TO WS-CANT-ERRORES                               
H P H                 ELSE                                                      
H P H            STRING                                                         
H P H            'X9999??????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            'X9999??????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H                 PERFORM 9999-GESTION-ERRORES                              
H P H                 END-IF                                                    
H P H              END-IF                                                       
H P H      END-EVALUATE                                                         
H P H                 END-IF                                                    
H P H               END-IF                                                      
H P H              END-IF                                                       
H P H              IF WS-ROLLBACK = 'SI'                                        
H P H                 SET WS-NO-HAY-SINIESTROS TO TRUE                          
H P H                 MOVE 98 TO WS-ITBLS                                       
H P H              END-IF                                                       
H P H              ADD WC-1 TO WS-ITBLS.                                        
H P H *                                                                         
H P H  3066-PROCESA-KSITPET.                                                    
H P H              MOVE 'KSITPET'             TO WS-TABLA-T                     
H P H              MOVE 'KSITPEH'             TO WS-TABLA-H                     
H P H *                                                                         
H P H              MOVE 'KSITPET'             TO WS-TIPO-TABLA                  
H P H              MOVE 'CDSINIES'            TO WS-CAMPOPOL                    
H P H                                                                           
H P H              IF TAB-ESP-SR                                                
H P H               IF WS-SI-HISTORIFICA                                        
H P H                 PERFORM 3300-INSERTA-ESP-SIN                              
H P H               END-IF                                                      
H P H              ELSE                                                         
H P H               IF WS-SI-HISTORIFICA                                        
H P H      EXEC SQL                                                             
H P H         DECLARE CURSOR-66 CURSOR FOR                                      
H P H            SELECT CDSINIES FROM KSITPET                                   
H P H             WHERE CDSINIES = :WS-TBL-SINOREC                              
H P H             FETCH FIRST 1 ROWS ONLY                                       
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EXEC SQL                                                             
H P H          OPEN CURSOR-66                                                   
H P H      END-EXEC                                                             
H P H      PERFORM 3306-VALIDA-CODIGO                                           
H P H      EXEC SQL                                                             
H P H          FETCH CURSOR-66                                                  
H P H          INTO                                                             
H P H          :WS-SINOREC                                                      
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H             EXEC SQL                                                      
H P H                CLOSE CURSOR-66                                            
H P H             END-EXEC                                                      
H P H             SET WS-PARA-INSERT TO TRUE                                    
H P H      EXEC SQL                                                             
H P H         INSERT INTO KSITPEH                                               
H P H            (SELECT * FROM KSITPET                                         
H P H             WHERE CDSINIES = :WS-TBL-SINOREC)                             
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3066-PROCESA-KSITPET' TO WS-OUT-PARRAFO                
H P H              MOVE 'INSERT CORRECTO '    TO WS-OUT-DESC                    
H P H              MOVE WS-TBL-SINOREC        TO WS-OUT-DESC(18:12)             
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-CLAVE-DUPLICADA                                   
H P H              SET WS-DUPLICADOS   TO TRUE                                  
H P H              MOVE 'SI'                  TO WS-ROLLBACK                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3066-PROCESA-KSITPET' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                'DUPLICADO:'             DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H              INTO WS-OUT-DESC                                             
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H            IF WS-WRITE                                                    
H P H              ADD  WC-1                  TO WS-IERR                        
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3066-PROCESA-KSITPET' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'SIN '                  DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN OTHER                                                         
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                     SET WS-DUPLICADOS   TO TRUE                           
H P H                     MOVE 'SI'                  TO WS-ROLLBACK             
H P H                     MOVE SQLCODE               TO WS-OUT-SQLCODE          
H P H                     MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA           
H P H                     MOVE WS-TABLA-H            TO WS-OUT-TABLA            
H P H                     MOVE '3066-PROCESA-KSITPET' TO WS-OUT-PARRAFO         
H P H                     STRING                                                
H P H                      'CONTENCIO:'             DELIMITED BY SIZE           
H P H                       WS-CAMPOPOL             DELIMITED BY ' '            
H P H                       '='                     DELIMITED BY SIZE           
H P H                       WS-LEE-CDNUMPOL         DELIMITED BY SIZE           
H P H                       INTO WS-OUT-DESC                                    
H P H                       END-STRING                                          
H P H                     PERFORM 1570-ESCRIBE-DESCARTADA                       
H P H              ELSE                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3066-PROCESA-KSITPET' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'ERRDB2:'               DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H              MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
H P H              MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
H P H              MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
H P H              MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
H P H              MOVE '3066-PROCESA-KSITPET  ' TO CDPARRAF OF KAELCWEZ        
H P H                                                                           
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 MOVE 'S' TO SW-911-911                                    
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H              ELSE                                                         
H P H                 PERFORM 9999-GESTION-ERRORES                              
H P H              END-IF                                                       
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                                                                           
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H            SET WS-NO-PARA-INSERT      TO TRUE                             
H P H            IF WS-WRITE                                                    
H P H              ADD  WC-1                  TO WS-IERR                        
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3066-PROCESA-KSITPET' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'NOHAY '                DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H            EXEC SQL                                                       
H P H                CLOSE CURSOR-66                                            
H P H            END-EXEC                                                       
H P H        WHEN OTHER                                                         
H P H              SET WS-NO-PARA-INSERT      TO TRUE                           
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3066-PROCESA-KSITPET' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'ERRDB2:'               DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            STRING                                                         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            ' ERROR EN SQL :' W-QUERY-TEXT                    '\N'         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H          MOVE WC-COD                   TO CDERR    OF KAELCWEZ            
H P H          MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ            
H P H          MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ            
H P H          MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ            
H P H          MOVE '3066-PROCESA-KSITPET  ' TO CDPARRAF OF KAELCWEZ            
H P H                                                                           
H P H          IF SQLCODE = -911                                                
H P H              MOVE 'S' TO SW-911                                           
H P H              MOVE 'S' TO SW-911-911                                       
H P H              ADD 1 TO WS-CANT-ERRORES                                     
H P H          ELSE                                                             
H P H             PERFORM 9999-GESTION-ERRORES                                  
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                 IF  SQLCODE = WN-SQLCODE-OK                               
H P H                 AND WS-PARA-INSERT                                        
H P H      EXEC SQL                                                             
H P H         DELETE FROM KSITPET                                               
H P H         WHERE CDSINIES = :WS-TBL-SINOREC                                  
H P H      END-EXEC                                                             
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3066-PROCESA-KSITPET' TO WS-OUT-PARRAFO                
H P H              MOVE 'BORRAR CORRECTO    ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3066-PROCESA-KSITPET' TO WS-OUT-PARRAFO                
H P H              MOVE 'NO EXISTE BORRAR   ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H              MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
H P H              MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
H P H              MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
H P H              MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
H P H              MOVE '3066-PROCESA-KSITPET  ' TO CDPARRAF OF KAELCWEZ        
H P H                                                                           
H P H              PERFORM 9999-GESTION-ERRORES                                 
H P H                                                                           
H P H        WHEN OTHER                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3066-PROCESA-KSITPET' TO WS-OUT-PARRAFO                
H P H              MOVE 'ERR BORRAR DB2     ' TO WS-OUT-DESC                    
H P H              IF SQLCODE  = -911                                           
H P H                 MOVE '3066-PROCESA-KSITPET'  TO WS-OUT-PARRAFO            
H P H                 MOVE 'CONTENCION TABLA   '   TO WS-OUT-DESC               
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 mOVE 'S' TO SW-911                                        
H P H                 MOVE 'S' TO SW-911-911                                    
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 MOVE 'SI'                  TO WS-ROLLBACK                 
H P H                 MOVE SQLCODE               TO WS-OUT-SQLCODE              
H P H                 MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA               
H P H                 MOVE WS-TABLA-H            TO WS-OUT-TABLA                
H P H                 MOVE '3066-PROCESA-KSITPET' TO WS-OUT-PARRAFO             
H P H                    STRING                                                 
H P H                   'CONTENCIO:'             DELIMITED BY SIZE              
H P H                    WS-CAMPOPOL             DELIMITED BY ' '               
H P H                    '='                     DELIMITED BY SIZE              
H P H                    WS-LEE-CDNUMPOL         DELIMITED BY SIZE              
H P H                    INTO WS-OUT-DESC                                       
H P H                 END-STRING                                                
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H            STRING                                                         
H P H            'Z8883??????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            'Z8881??????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H              ELSE                                                         
H P H                 MOVE WC-COD              TO CDERR    OF KAELCWEZ          
H P H                 MOVE WC-DES01            TO DSARGU1  OF KAELCWEZ          
H P H                 MOVE WC-PROGRAMA         TO DSARGU2  OF KAELCWEZ          
H P H                 MOVE WS-ERPOLIZA         TO DSARGU3  OF KAELCWEZ          
H P H                 MOVE '3066-PROCESA-KSITPET'                               
H P H                                          TO CDPARRAF OF KAELCWEZ          
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H                 IF SQLCODE = -911                                         
H P H                    MOVE 'S' TO SW-911                                     
H P H                    MOVE 'S' TO SW-911-911                                 
H P H                    ADD 1 TO WS-CANT-ERRORES                               
H P H                 ELSE                                                      
H P H            STRING                                                         
H P H            'X9999??????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            'X9999??????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H                 PERFORM 9999-GESTION-ERRORES                              
H P H                 END-IF                                                    
H P H              END-IF                                                       
H P H      END-EVALUATE                                                         
H P H                 END-IF                                                    
H P H               END-IF                                                      
H P H              END-IF                                                       
H P H              IF WS-ROLLBACK = 'SI'                                        
H P H                 SET WS-NO-HAY-SINIESTROS TO TRUE                          
H P H                 MOVE 98 TO WS-ITBLS                                       
H P H              END-IF                                                       
H P H              ADD WC-1 TO WS-ITBLS.                                        
H P H *                                                                         
H P H  3067-PROCESA-KSITRET.                                                    
H P H              MOVE 'KSITRET'             TO WS-TABLA-T                     
H P H              MOVE 'KSITREH'             TO WS-TABLA-H                     
H P H *                                                                         
H P H              MOVE 'KSITRET'             TO WS-TIPO-TABLA                  
H P H              MOVE 'CDSINIES'            TO WS-CAMPOPOL                    
H P H                                                                           
H P H              IF TAB-ESP-SR                                                
H P H               IF WS-SI-HISTORIFICA                                        
H P H                 PERFORM 3300-INSERTA-ESP-SIN                              
H P H               END-IF                                                      
H P H              ELSE                                                         
H P H               IF WS-SI-HISTORIFICA                                        
H P H      EXEC SQL                                                             
H P H         DECLARE CURSOR-67 CURSOR FOR                                      
H P H            SELECT CDSINIES FROM KSITRET                                   
H P H             WHERE CDSINIES = :WS-TBL-SINOREC                              
H P H             FETCH FIRST 1 ROWS ONLY                                       
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EXEC SQL                                                             
H P H          OPEN CURSOR-67                                                   
H P H      END-EXEC                                                             
H P H      PERFORM 3306-VALIDA-CODIGO                                           
H P H      EXEC SQL                                                             
H P H          FETCH CURSOR-67                                                  
H P H          INTO                                                             
H P H          :WS-SINOREC                                                      
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H             EXEC SQL                                                      
H P H                CLOSE CURSOR-67                                            
H P H             END-EXEC                                                      
H P H             SET WS-PARA-INSERT TO TRUE                                    
H P H      EXEC SQL                                                             
H P H         INSERT INTO KSITREH                                               
H P H            (SELECT * FROM KSITRET                                         
H P H             WHERE CDSINIES = :WS-TBL-SINOREC)                             
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3067-PROCESA-KSITRET' TO WS-OUT-PARRAFO                
H P H              MOVE 'INSERT CORRECTO '    TO WS-OUT-DESC                    
H P H              MOVE WS-TBL-SINOREC        TO WS-OUT-DESC(18:12)             
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-CLAVE-DUPLICADA                                   
H P H              SET WS-DUPLICADOS   TO TRUE                                  
H P H              MOVE 'SI'                  TO WS-ROLLBACK                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3067-PROCESA-KSITRET' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                'DUPLICADO:'             DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H              INTO WS-OUT-DESC                                             
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H            IF WS-WRITE                                                    
H P H              ADD  WC-1                  TO WS-IERR                        
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3067-PROCESA-KSITRET' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'SIN '                  DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN OTHER                                                         
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                     SET WS-DUPLICADOS   TO TRUE                           
H P H                     MOVE 'SI'                  TO WS-ROLLBACK             
H P H                     MOVE SQLCODE               TO WS-OUT-SQLCODE          
H P H                     MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA           
H P H                     MOVE WS-TABLA-H            TO WS-OUT-TABLA            
H P H                     MOVE '3067-PROCESA-KSITRET' TO WS-OUT-PARRAFO         
H P H                     STRING                                                
H P H                      'CONTENCIO:'             DELIMITED BY SIZE           
H P H                       WS-CAMPOPOL             DELIMITED BY ' '            
H P H                       '='                     DELIMITED BY SIZE           
H P H                       WS-LEE-CDNUMPOL         DELIMITED BY SIZE           
H P H                       INTO WS-OUT-DESC                                    
H P H                       END-STRING                                          
H P H                     PERFORM 1570-ESCRIBE-DESCARTADA                       
H P H              ELSE                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3067-PROCESA-KSITRET' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'ERRDB2:'               DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H              MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
H P H              MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
H P H              MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
H P H              MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
H P H              MOVE '3067-PROCESA-KSITRET  ' TO CDPARRAF OF KAELCWEZ        
H P H                                                                           
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 MOVE 'S' TO SW-911-911                                    
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H              ELSE                                                         
H P H                 PERFORM 9999-GESTION-ERRORES                              
H P H              END-IF                                                       
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                                                                           
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H            SET WS-NO-PARA-INSERT      TO TRUE                             
H P H            IF WS-WRITE                                                    
H P H              ADD  WC-1                  TO WS-IERR                        
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3067-PROCESA-KSITRET' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'NOHAY '                DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H            EXEC SQL                                                       
H P H                CLOSE CURSOR-67                                            
H P H            END-EXEC                                                       
H P H        WHEN OTHER                                                         
H P H              SET WS-NO-PARA-INSERT      TO TRUE                           
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3067-PROCESA-KSITRET' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'ERRDB2:'               DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            STRING                                                         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            ' ERROR EN SQL :' W-QUERY-TEXT                    '\N'         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H          MOVE WC-COD                   TO CDERR    OF KAELCWEZ            
H P H          MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ            
H P H          MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ            
H P H          MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ            
H P H          MOVE '3067-PROCESA-KSITRET  ' TO CDPARRAF OF KAELCWEZ            
H P H                                                                           
H P H          IF SQLCODE = -911                                                
H P H              MOVE 'S' TO SW-911                                           
H P H              MOVE 'S' TO SW-911-911                                       
H P H              ADD 1 TO WS-CANT-ERRORES                                     
H P H          ELSE                                                             
H P H             PERFORM 9999-GESTION-ERRORES                                  
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                 IF  SQLCODE = WN-SQLCODE-OK                               
H P H                 AND WS-PARA-INSERT                                        
H P H      EXEC SQL                                                             
H P H         DELETE FROM KSITRET                                               
H P H         WHERE CDSINIES = :WS-TBL-SINOREC                                  
H P H      END-EXEC                                                             
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3067-PROCESA-KSITRET' TO WS-OUT-PARRAFO                
H P H              MOVE 'BORRAR CORRECTO    ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3067-PROCESA-KSITRET' TO WS-OUT-PARRAFO                
H P H              MOVE 'NO EXISTE BORRAR   ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H              MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
H P H              MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
H P H              MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
H P H              MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
H P H              MOVE '3067-PROCESA-KSITRET  ' TO CDPARRAF OF KAELCWEZ        
H P H                                                                           
H P H              PERFORM 9999-GESTION-ERRORES                                 
H P H                                                                           
H P H        WHEN OTHER                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3067-PROCESA-KSITRET' TO WS-OUT-PARRAFO                
H P H              MOVE 'ERR BORRAR DB2     ' TO WS-OUT-DESC                    
H P H              IF SQLCODE  = -911                                           
H P H                 MOVE '3067-PROCESA-KSITRET'  TO WS-OUT-PARRAFO            
H P H                 MOVE 'CONTENCION TABLA   '   TO WS-OUT-DESC               
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 mOVE 'S' TO SW-911                                        
H P H                 MOVE 'S' TO SW-911-911                                    
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 MOVE 'SI'                  TO WS-ROLLBACK                 
H P H                 MOVE SQLCODE               TO WS-OUT-SQLCODE              
H P H                 MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA               
H P H                 MOVE WS-TABLA-H            TO WS-OUT-TABLA                
H P H                 MOVE '3067-PROCESA-KSITRET' TO WS-OUT-PARRAFO             
H P H                    STRING                                                 
H P H                   'CONTENCIO:'             DELIMITED BY SIZE              
H P H                    WS-CAMPOPOL             DELIMITED BY ' '               
H P H                    '='                     DELIMITED BY SIZE              
H P H                    WS-LEE-CDNUMPOL         DELIMITED BY SIZE              
H P H                    INTO WS-OUT-DESC                                       
H P H                 END-STRING                                                
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H            STRING                                                         
H P H            'Z8883??????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            'Z8881??????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H              ELSE                                                         
H P H                 MOVE WC-COD              TO CDERR    OF KAELCWEZ          
H P H                 MOVE WC-DES01            TO DSARGU1  OF KAELCWEZ          
H P H                 MOVE WC-PROGRAMA         TO DSARGU2  OF KAELCWEZ          
H P H                 MOVE WS-ERPOLIZA         TO DSARGU3  OF KAELCWEZ          
H P H                 MOVE '3067-PROCESA-KSITRET'                               
H P H                                          TO CDPARRAF OF KAELCWEZ          
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H                 IF SQLCODE = -911                                         
H P H                    MOVE 'S' TO SW-911                                     
H P H                    MOVE 'S' TO SW-911-911                                 
H P H                    ADD 1 TO WS-CANT-ERRORES                               
H P H                 ELSE                                                      
H P H            STRING                                                         
H P H            'X9999??????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            'X9999??????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H                 PERFORM 9999-GESTION-ERRORES                              
H P H                 END-IF                                                    
H P H              END-IF                                                       
H P H      END-EVALUATE                                                         
H P H                 END-IF                                                    
H P H               END-IF                                                      
H P H              END-IF                                                       
H P H              IF WS-ROLLBACK = 'SI'                                        
H P H                 SET WS-NO-HAY-SINIESTROS TO TRUE                          
H P H                 MOVE 98 TO WS-ITBLS                                       
H P H              END-IF                                                       
H P H              ADD WC-1 TO WS-ITBLS.                                        
H P H *                                                                         
H P H  3068-PROCESA-KSITRNT.                                                    
H P H              MOVE 'KSITRNT'             TO WS-TABLA-T                     
H P H              MOVE 'KSITRNH'             TO WS-TABLA-H                     
H P H *                                                                         
H P H              MOVE 'KSITRNT'             TO WS-TIPO-TABLA                  
H P H              MOVE 'CDSINIES'            TO WS-CAMPOPOL                    
H P H                                                                           
H P H              IF TAB-ESP-SR                                                
H P H               IF WS-SI-HISTORIFICA                                        
H P H                 PERFORM 3300-INSERTA-ESP-SIN                              
H P H               END-IF                                                      
H P H              ELSE                                                         
H P H               IF WS-SI-HISTORIFICA                                        
H P H      EXEC SQL                                                             
H P H         DECLARE CURSOR-68 CURSOR FOR                                      
H P H            SELECT CDSINIES FROM KSITRNT                                   
H P H             WHERE CDSINIES = :WS-TBL-SINOREC                              
H P H             FETCH FIRST 1 ROWS ONLY                                       
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EXEC SQL                                                             
H P H          OPEN CURSOR-68                                                   
H P H      END-EXEC                                                             
H P H      PERFORM 3306-VALIDA-CODIGO                                           
H P H      EXEC SQL                                                             
H P H          FETCH CURSOR-68                                                  
H P H          INTO                                                             
H P H          :WS-SINOREC                                                      
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H             EXEC SQL                                                      
H P H                CLOSE CURSOR-68                                            
H P H             END-EXEC                                                      
H P H             SET WS-PARA-INSERT TO TRUE                                    
H P H      EXEC SQL                                                             
H P H         INSERT INTO KSITRNH                                               
H P H            (SELECT * FROM KSITRNT                                         
H P H             WHERE CDSINIES = :WS-TBL-SINOREC)                             
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3068-PROCESA-KSITRNT' TO WS-OUT-PARRAFO                
H P H              MOVE 'INSERT CORRECTO '    TO WS-OUT-DESC                    
H P H              MOVE WS-TBL-SINOREC        TO WS-OUT-DESC(18:12)             
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-CLAVE-DUPLICADA                                   
H P H              SET WS-DUPLICADOS   TO TRUE                                  
H P H              MOVE 'SI'                  TO WS-ROLLBACK                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3068-PROCESA-KSITRNT' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                'DUPLICADO:'             DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H              INTO WS-OUT-DESC                                             
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H            IF WS-WRITE                                                    
H P H              ADD  WC-1                  TO WS-IERR                        
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3068-PROCESA-KSITRNT' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'SIN '                  DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN OTHER                                                         
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                     SET WS-DUPLICADOS   TO TRUE                           
H P H                     MOVE 'SI'                  TO WS-ROLLBACK             
H P H                     MOVE SQLCODE               TO WS-OUT-SQLCODE          
H P H                     MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA           
H P H                     MOVE WS-TABLA-H            TO WS-OUT-TABLA            
H P H                     MOVE '3068-PROCESA-KSITRNT' TO WS-OUT-PARRAFO         
H P H                     STRING                                                
H P H                      'CONTENCIO:'             DELIMITED BY SIZE           
H P H                       WS-CAMPOPOL             DELIMITED BY ' '            
H P H                       '='                     DELIMITED BY SIZE           
H P H                       WS-LEE-CDNUMPOL         DELIMITED BY SIZE           
H P H                       INTO WS-OUT-DESC                                    
H P H                       END-STRING                                          
H P H                     PERFORM 1570-ESCRIBE-DESCARTADA                       
H P H              ELSE                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3068-PROCESA-KSITRNT' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'ERRDB2:'               DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H              MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
H P H              MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
H P H              MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
H P H              MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
H P H              MOVE '3068-PROCESA-KSITRNT  ' TO CDPARRAF OF KAELCWEZ        
H P H                                                                           
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 MOVE 'S' TO SW-911-911                                    
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H              ELSE                                                         
H P H                 PERFORM 9999-GESTION-ERRORES                              
H P H              END-IF                                                       
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                                                                           
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H            SET WS-NO-PARA-INSERT      TO TRUE                             
H P H            IF WS-WRITE                                                    
H P H              ADD  WC-1                  TO WS-IERR                        
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3068-PROCESA-KSITRNT' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'NOHAY '                DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H            EXEC SQL                                                       
H P H                CLOSE CURSOR-68                                            
H P H            END-EXEC                                                       
H P H        WHEN OTHER                                                         
H P H              SET WS-NO-PARA-INSERT      TO TRUE                           
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3068-PROCESA-KSITRNT' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'ERRDB2:'               DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            STRING                                                         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            ' ERROR EN SQL :' W-QUERY-TEXT                    '\N'         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H          MOVE WC-COD                   TO CDERR    OF KAELCWEZ            
H P H          MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ            
H P H          MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ            
H P H          MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ            
H P H          MOVE '3068-PROCESA-KSITRNT  ' TO CDPARRAF OF KAELCWEZ            
H P H                                                                           
H P H          IF SQLCODE = -911                                                
H P H              MOVE 'S' TO SW-911                                           
H P H              MOVE 'S' TO SW-911-911                                       
H P H              ADD 1 TO WS-CANT-ERRORES                                     
H P H          ELSE                                                             
H P H             PERFORM 9999-GESTION-ERRORES                                  
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                 IF  SQLCODE = WN-SQLCODE-OK                               
H P H                 AND WS-PARA-INSERT                                        
H P H      EXEC SQL                                                             
H P H         DELETE FROM KSITRNT                                               
H P H         WHERE CDSINIES = :WS-TBL-SINOREC                                  
H P H      END-EXEC                                                             
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3068-PROCESA-KSITRNT' TO WS-OUT-PARRAFO                
H P H              MOVE 'BORRAR CORRECTO    ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3068-PROCESA-KSITRNT' TO WS-OUT-PARRAFO                
H P H              MOVE 'NO EXISTE BORRAR   ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H              MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
H P H              MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
H P H              MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
H P H              MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
H P H              MOVE '3068-PROCESA-KSITRNT  ' TO CDPARRAF OF KAELCWEZ        
H P H                                                                           
H P H              PERFORM 9999-GESTION-ERRORES                                 
H P H                                                                           
H P H        WHEN OTHER                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3068-PROCESA-KSITRNT' TO WS-OUT-PARRAFO                
H P H              MOVE 'ERR BORRAR DB2     ' TO WS-OUT-DESC                    
H P H              IF SQLCODE  = -911                                           
H P H                 MOVE '3068-PROCESA-KSITRNT'  TO WS-OUT-PARRAFO            
H P H                 MOVE 'CONTENCION TABLA   '   TO WS-OUT-DESC               
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 mOVE 'S' TO SW-911                                        
H P H                 MOVE 'S' TO SW-911-911                                    
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 MOVE 'SI'                  TO WS-ROLLBACK                 
H P H                 MOVE SQLCODE               TO WS-OUT-SQLCODE              
H P H                 MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA               
H P H                 MOVE WS-TABLA-H            TO WS-OUT-TABLA                
H P H                 MOVE '3068-PROCESA-KSITRNT' TO WS-OUT-PARRAFO             
H P H                    STRING                                                 
H P H                   'CONTENCIO:'             DELIMITED BY SIZE              
H P H                    WS-CAMPOPOL             DELIMITED BY ' '               
H P H                    '='                     DELIMITED BY SIZE              
H P H                    WS-LEE-CDNUMPOL         DELIMITED BY SIZE              
H P H                    INTO WS-OUT-DESC                                       
H P H                 END-STRING                                                
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H            STRING                                                         
H P H            'Z8883??????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            'Z8881??????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H              ELSE                                                         
H P H                 MOVE WC-COD              TO CDERR    OF KAELCWEZ          
H P H                 MOVE WC-DES01            TO DSARGU1  OF KAELCWEZ          
H P H                 MOVE WC-PROGRAMA         TO DSARGU2  OF KAELCWEZ          
H P H                 MOVE WS-ERPOLIZA         TO DSARGU3  OF KAELCWEZ          
H P H                 MOVE '3068-PROCESA-KSITRNT'                               
H P H                                          TO CDPARRAF OF KAELCWEZ          
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H                 IF SQLCODE = -911                                         
H P H                    MOVE 'S' TO SW-911                                     
H P H                    MOVE 'S' TO SW-911-911                                 
H P H                    ADD 1 TO WS-CANT-ERRORES                               
H P H                 ELSE                                                      
H P H            STRING                                                         
H P H            'X9999??????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            'X9999??????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H                 PERFORM 9999-GESTION-ERRORES                              
H P H                 END-IF                                                    
H P H              END-IF                                                       
H P H      END-EVALUATE                                                         
H P H                 END-IF                                                    
H P H               END-IF                                                      
H P H              END-IF                                                       
H P H              IF WS-ROLLBACK = 'SI'                                        
H P H                 SET WS-NO-HAY-SINIESTROS TO TRUE                          
H P H                 MOVE 98 TO WS-ITBLS                                       
H P H              END-IF                                                       
H P H              ADD WC-1 TO WS-ITBLS.                                        
H P H *                                                                         
H P H  3069-PROCESA-KSVTBRT.                                                    
H P H              MOVE 'KSVTBRT'             TO WS-TABLA-T                     
H P H              MOVE 'KSVTBRH'             TO WS-TABLA-H                     
H P H *                                                                         
H P H              MOVE 'KSVTBRT'             TO WS-TIPO-TABLA                  
H P H              MOVE 'CDSINIES'            TO WS-CAMPOPOL                    
H P H                                                                           
H P H              IF TAB-ESP-SR                                                
H P H               IF WS-SI-HISTORIFICA                                        
H P H                 PERFORM 3300-INSERTA-ESP-SIN                              
H P H               END-IF                                                      
H P H              ELSE                                                         
H P H               IF WS-SI-HISTORIFICA                                        
H P H      EXEC SQL                                                             
H P H         DECLARE CURSOR-69 CURSOR FOR                                      
H P H            SELECT CDSINIES FROM KSVTBRT                                   
H P H             WHERE CDSINIES = :WS-TBL-SINOREC                              
H P H             FETCH FIRST 1 ROWS ONLY                                       
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EXEC SQL                                                             
H P H          OPEN CURSOR-69                                                   
H P H      END-EXEC                                                             
H P H      PERFORM 3306-VALIDA-CODIGO                                           
H P H      EXEC SQL                                                             
H P H          FETCH CURSOR-69                                                  
H P H          INTO                                                             
H P H          :WS-SINOREC                                                      
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H             EXEC SQL                                                      
H P H                CLOSE CURSOR-69                                            
H P H             END-EXEC                                                      
H P H             SET WS-PARA-INSERT TO TRUE                                    
H P H      EXEC SQL                                                             
H P H         INSERT INTO KSVTBRH                                               
H P H            (SELECT * FROM KSVTBRT                                         
H P H             WHERE CDSINIES = :WS-TBL-SINOREC)                             
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3069-PROCESA-KSVTBRT' TO WS-OUT-PARRAFO                
H P H              MOVE 'INSERT CORRECTO '    TO WS-OUT-DESC                    
H P H              MOVE WS-TBL-SINOREC        TO WS-OUT-DESC(18:12)             
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-CLAVE-DUPLICADA                                   
H P H              SET WS-DUPLICADOS   TO TRUE                                  
H P H              MOVE 'SI'                  TO WS-ROLLBACK                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3069-PROCESA-KSVTBRT' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                'DUPLICADO:'             DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H              INTO WS-OUT-DESC                                             
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H            IF WS-WRITE                                                    
H P H              ADD  WC-1                  TO WS-IERR                        
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3069-PROCESA-KSVTBRT' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'SIN '                  DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN OTHER                                                         
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                     SET WS-DUPLICADOS   TO TRUE                           
H P H                     MOVE 'SI'                  TO WS-ROLLBACK             
H P H                     MOVE SQLCODE               TO WS-OUT-SQLCODE          
H P H                     MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA           
H P H                     MOVE WS-TABLA-H            TO WS-OUT-TABLA            
H P H                     MOVE '3069-PROCESA-KSVTBRT' TO WS-OUT-PARRAFO         
H P H                     STRING                                                
H P H                      'CONTENCIO:'             DELIMITED BY SIZE           
H P H                       WS-CAMPOPOL             DELIMITED BY ' '            
H P H                       '='                     DELIMITED BY SIZE           
H P H                       WS-LEE-CDNUMPOL         DELIMITED BY SIZE           
H P H                       INTO WS-OUT-DESC                                    
H P H                       END-STRING                                          
H P H                     PERFORM 1570-ESCRIBE-DESCARTADA                       
H P H              ELSE                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3069-PROCESA-KSVTBRT' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'ERRDB2:'               DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H              MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
H P H              MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
H P H              MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
H P H              MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
H P H              MOVE '3069-PROCESA-KSVTBRT  ' TO CDPARRAF OF KAELCWEZ        
H P H                                                                           
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 MOVE 'S' TO SW-911-911                                    
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H              ELSE                                                         
H P H                 PERFORM 9999-GESTION-ERRORES                              
H P H              END-IF                                                       
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                                                                           
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H            SET WS-NO-PARA-INSERT      TO TRUE                             
H P H            IF WS-WRITE                                                    
H P H              ADD  WC-1                  TO WS-IERR                        
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3069-PROCESA-KSVTBRT' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'NOHAY '                DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H            EXEC SQL                                                       
H P H                CLOSE CURSOR-69                                            
H P H            END-EXEC                                                       
H P H        WHEN OTHER                                                         
H P H              SET WS-NO-PARA-INSERT      TO TRUE                           
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3069-PROCESA-KSVTBRT' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'ERRDB2:'               DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            STRING                                                         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            ' ERROR EN SQL :' W-QUERY-TEXT                    '\N'         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H          MOVE WC-COD                   TO CDERR    OF KAELCWEZ            
H P H          MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ            
H P H          MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ            
H P H          MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ            
H P H          MOVE '3069-PROCESA-KSVTBRT  ' TO CDPARRAF OF KAELCWEZ            
H P H                                                                           
H P H          IF SQLCODE = -911                                                
H P H              MOVE 'S' TO SW-911                                           
H P H              MOVE 'S' TO SW-911-911                                       
H P H              ADD 1 TO WS-CANT-ERRORES                                     
H P H          ELSE                                                             
H P H             PERFORM 9999-GESTION-ERRORES                                  
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                 IF  SQLCODE = WN-SQLCODE-OK                               
H P H                 AND WS-PARA-INSERT                                        
H P H      EXEC SQL                                                             
H P H         DELETE FROM KSVTBRT                                               
H P H         WHERE CDSINIES = :WS-TBL-SINOREC                                  
H P H      END-EXEC                                                             
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3069-PROCESA-KSVTBRT' TO WS-OUT-PARRAFO                
H P H              MOVE 'BORRAR CORRECTO    ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3069-PROCESA-KSVTBRT' TO WS-OUT-PARRAFO                
H P H              MOVE 'NO EXISTE BORRAR   ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H              MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
H P H              MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
H P H              MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
H P H              MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
H P H              MOVE '3069-PROCESA-KSVTBRT  ' TO CDPARRAF OF KAELCWEZ        
H P H                                                                           
H P H              PERFORM 9999-GESTION-ERRORES                                 
H P H                                                                           
H P H        WHEN OTHER                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3069-PROCESA-KSVTBRT' TO WS-OUT-PARRAFO                
H P H              MOVE 'ERR BORRAR DB2     ' TO WS-OUT-DESC                    
H P H              IF SQLCODE  = -911                                           
H P H                 MOVE '3069-PROCESA-KSVTBRT'  TO WS-OUT-PARRAFO            
H P H                 MOVE 'CONTENCION TABLA   '   TO WS-OUT-DESC               
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 mOVE 'S' TO SW-911                                        
H P H                 MOVE 'S' TO SW-911-911                                    
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 MOVE 'SI'                  TO WS-ROLLBACK                 
H P H                 MOVE SQLCODE               TO WS-OUT-SQLCODE              
H P H                 MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA               
H P H                 MOVE WS-TABLA-H            TO WS-OUT-TABLA                
H P H                 MOVE '3069-PROCESA-KSVTBRT' TO WS-OUT-PARRAFO             
H P H                    STRING                                                 
H P H                   'CONTENCIO:'             DELIMITED BY SIZE              
H P H                    WS-CAMPOPOL             DELIMITED BY ' '               
H P H                    '='                     DELIMITED BY SIZE              
H P H                    WS-LEE-CDNUMPOL         DELIMITED BY SIZE              
H P H                    INTO WS-OUT-DESC                                       
H P H                 END-STRING                                                
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H            STRING                                                         
H P H            'Z8883??????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            'Z8881??????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H              ELSE                                                         
H P H                 MOVE WC-COD              TO CDERR    OF KAELCWEZ          
H P H                 MOVE WC-DES01            TO DSARGU1  OF KAELCWEZ          
H P H                 MOVE WC-PROGRAMA         TO DSARGU2  OF KAELCWEZ          
H P H                 MOVE WS-ERPOLIZA         TO DSARGU3  OF KAELCWEZ          
H P H                 MOVE '3069-PROCESA-KSVTBRT'                               
H P H                                          TO CDPARRAF OF KAELCWEZ          
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H                 IF SQLCODE = -911                                         
H P H                    MOVE 'S' TO SW-911                                     
H P H                    MOVE 'S' TO SW-911-911                                 
H P H                    ADD 1 TO WS-CANT-ERRORES                               
H P H                 ELSE                                                      
H P H            STRING                                                         
H P H            'X9999??????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            'X9999??????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H                 PERFORM 9999-GESTION-ERRORES                              
H P H                 END-IF                                                    
H P H              END-IF                                                       
H P H      END-EVALUATE                                                         
H P H                 END-IF                                                    
H P H               END-IF                                                      
H P H              END-IF                                                       
H P H              IF WS-ROLLBACK = 'SI'                                        
H P H                 SET WS-NO-HAY-SINIESTROS TO TRUE                          
H P H                 MOVE 98 TO WS-ITBLS                                       
H P H              END-IF                                                       
H P H              ADD WC-1 TO WS-ITBLS.                                        
H P H *                                                                         
H P H  3070-PROCESA-KSVTCCT.                                                    
H P H              MOVE 'KSVTCCT'             TO WS-TABLA-T                     
H P H              MOVE 'KSVTCCH'             TO WS-TABLA-H                     
H P H *                                                                         
H P H              MOVE 'KSVTCCT'             TO WS-TIPO-TABLA                  
H P H              MOVE 'CDSINIES'            TO WS-CAMPOPOL                    
H P H                                                                           
H P H              IF TAB-ESP-SR                                                
H P H               IF WS-SI-HISTORIFICA                                        
H P H                 PERFORM 3300-INSERTA-ESP-SIN                              
H P H               END-IF                                                      
H P H              ELSE                                                         
H P H               IF WS-SI-HISTORIFICA                                        
H P H      EXEC SQL                                                             
H P H         DECLARE CURSOR-70 CURSOR FOR                                      
H P H            SELECT CDSINIES FROM KSVTCCT                                   
H P H             WHERE CDSINIES = :WS-TBL-SINOREC                              
H P H             FETCH FIRST 1 ROWS ONLY                                       
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EXEC SQL                                                             
H P H          OPEN CURSOR-70                                                   
H P H      END-EXEC                                                             
H P H      PERFORM 3306-VALIDA-CODIGO                                           
H P H      EXEC SQL                                                             
H P H          FETCH CURSOR-70                                                  
H P H          INTO                                                             
H P H          :WS-SINOREC                                                      
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H             EXEC SQL                                                      
H P H                CLOSE CURSOR-70                                            
H P H             END-EXEC                                                      
H P H             SET WS-PARA-INSERT TO TRUE                                    
H P H      EXEC SQL                                                             
H P H         INSERT INTO KSVTCCH                                               
H P H            (SELECT * FROM KSVTCCT                                         
H P H             WHERE CDSINIES = :WS-TBL-SINOREC)                             
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3070-PROCESA-KSVTCCT' TO WS-OUT-PARRAFO                
H P H              MOVE 'INSERT CORRECTO '    TO WS-OUT-DESC                    
H P H              MOVE WS-TBL-SINOREC        TO WS-OUT-DESC(18:12)             
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-CLAVE-DUPLICADA                                   
H P H              SET WS-DUPLICADOS   TO TRUE                                  
H P H              MOVE 'SI'                  TO WS-ROLLBACK                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3070-PROCESA-KSVTCCT' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                'DUPLICADO:'             DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H              INTO WS-OUT-DESC                                             
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H            IF WS-WRITE                                                    
H P H              ADD  WC-1                  TO WS-IERR                        
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3070-PROCESA-KSVTCCT' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'SIN '                  DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN OTHER                                                         
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                     SET WS-DUPLICADOS   TO TRUE                           
H P H                     MOVE 'SI'                  TO WS-ROLLBACK             
H P H                     MOVE SQLCODE               TO WS-OUT-SQLCODE          
H P H                     MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA           
H P H                     MOVE WS-TABLA-H            TO WS-OUT-TABLA            
H P H                     MOVE '3070-PROCESA-KSVTCCT' TO WS-OUT-PARRAFO         
H P H                     STRING                                                
H P H                      'CONTENCIO:'             DELIMITED BY SIZE           
H P H                       WS-CAMPOPOL             DELIMITED BY ' '            
H P H                       '='                     DELIMITED BY SIZE           
H P H                       WS-LEE-CDNUMPOL         DELIMITED BY SIZE           
H P H                       INTO WS-OUT-DESC                                    
H P H                       END-STRING                                          
H P H                     PERFORM 1570-ESCRIBE-DESCARTADA                       
H P H              ELSE                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3070-PROCESA-KSVTCCT' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'ERRDB2:'               DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H              MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
H P H              MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
H P H              MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
H P H              MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
H P H              MOVE '3070-PROCESA-KSVTCCT  ' TO CDPARRAF OF KAELCWEZ        
H P H                                                                           
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 MOVE 'S' TO SW-911-911                                    
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H              ELSE                                                         
H P H                 PERFORM 9999-GESTION-ERRORES                              
H P H              END-IF                                                       
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                                                                           
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H            SET WS-NO-PARA-INSERT      TO TRUE                             
H P H            IF WS-WRITE                                                    
H P H              ADD  WC-1                  TO WS-IERR                        
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3070-PROCESA-KSVTCCT' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'NOHAY '                DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H            EXEC SQL                                                       
H P H                CLOSE CURSOR-70                                            
H P H            END-EXEC                                                       
H P H        WHEN OTHER                                                         
H P H              SET WS-NO-PARA-INSERT      TO TRUE                           
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3070-PROCESA-KSVTCCT' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'ERRDB2:'               DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            STRING                                                         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            ' ERROR EN SQL :' W-QUERY-TEXT                    '\N'         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H          MOVE WC-COD                   TO CDERR    OF KAELCWEZ            
H P H          MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ            
H P H          MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ            
H P H          MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ            
H P H          MOVE '3070-PROCESA-KSVTCCT  ' TO CDPARRAF OF KAELCWEZ            
H P H                                                                           
H P H          IF SQLCODE = -911                                                
H P H              MOVE 'S' TO SW-911                                           
H P H              MOVE 'S' TO SW-911-911                                       
H P H              ADD 1 TO WS-CANT-ERRORES                                     
H P H          ELSE                                                             
H P H             PERFORM 9999-GESTION-ERRORES                                  
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                 IF  SQLCODE = WN-SQLCODE-OK                               
H P H                 AND WS-PARA-INSERT                                        
H P H      EXEC SQL                                                             
H P H         DELETE FROM KSVTCCT                                               
H P H         WHERE CDSINIES = :WS-TBL-SINOREC                                  
H P H      END-EXEC                                                             
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3070-PROCESA-KSVTCCT' TO WS-OUT-PARRAFO                
H P H              MOVE 'BORRAR CORRECTO    ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3070-PROCESA-KSVTCCT' TO WS-OUT-PARRAFO                
H P H              MOVE 'NO EXISTE BORRAR   ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H              MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
H P H              MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
H P H              MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
H P H              MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
H P H              MOVE '3070-PROCESA-KSVTCCT  ' TO CDPARRAF OF KAELCWEZ        
H P H                                                                           
H P H              PERFORM 9999-GESTION-ERRORES                                 
H P H                                                                           
H P H        WHEN OTHER                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3070-PROCESA-KSVTCCT' TO WS-OUT-PARRAFO                
H P H              MOVE 'ERR BORRAR DB2     ' TO WS-OUT-DESC                    
H P H              IF SQLCODE  = -911                                           
H P H                 MOVE '3070-PROCESA-KSVTCCT'  TO WS-OUT-PARRAFO            
H P H                 MOVE 'CONTENCION TABLA   '   TO WS-OUT-DESC               
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 mOVE 'S' TO SW-911                                        
H P H                 MOVE 'S' TO SW-911-911                                    
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 MOVE 'SI'                  TO WS-ROLLBACK                 
H P H                 MOVE SQLCODE               TO WS-OUT-SQLCODE              
H P H                 MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA               
H P H                 MOVE WS-TABLA-H            TO WS-OUT-TABLA                
H P H                 MOVE '3070-PROCESA-KSVTCCT' TO WS-OUT-PARRAFO             
H P H                    STRING                                                 
H P H                   'CONTENCIO:'             DELIMITED BY SIZE              
H P H                    WS-CAMPOPOL             DELIMITED BY ' '               
H P H                    '='                     DELIMITED BY SIZE              
H P H                    WS-LEE-CDNUMPOL         DELIMITED BY SIZE              
H P H                    INTO WS-OUT-DESC                                       
H P H                 END-STRING                                                
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H            STRING                                                         
H P H            'Z8883??????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            'Z8881??????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H              ELSE                                                         
H P H                 MOVE WC-COD              TO CDERR    OF KAELCWEZ          
H P H                 MOVE WC-DES01            TO DSARGU1  OF KAELCWEZ          
H P H                 MOVE WC-PROGRAMA         TO DSARGU2  OF KAELCWEZ          
H P H                 MOVE WS-ERPOLIZA         TO DSARGU3  OF KAELCWEZ          
H P H                 MOVE '3070-PROCESA-KSVTCCT'                               
H P H                                          TO CDPARRAF OF KAELCWEZ          
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H                 IF SQLCODE = -911                                         
H P H                    MOVE 'S' TO SW-911                                     
H P H                    MOVE 'S' TO SW-911-911                                 
H P H                    ADD 1 TO WS-CANT-ERRORES                               
H P H                 ELSE                                                      
H P H            STRING                                                         
H P H            'X9999??????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            'X9999??????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H                 PERFORM 9999-GESTION-ERRORES                              
H P H                 END-IF                                                    
H P H              END-IF                                                       
H P H      END-EVALUATE                                                         
H P H                 END-IF                                                    
H P H               END-IF                                                      
H P H              END-IF                                                       
H P H              IF WS-ROLLBACK = 'SI'                                        
H P H                 SET WS-NO-HAY-SINIESTROS TO TRUE                          
H P H                 MOVE 98 TO WS-ITBLS                                       
H P H              END-IF                                                       
H P H              ADD WC-1 TO WS-ITBLS.                                        
H P H *                                                                         
H P H  3071-PROCESA-KSVTCPT.                                                    
H P H              MOVE 'KSVTCPT'             TO WS-TABLA-T                     
H P H              MOVE 'KSVTCPH'             TO WS-TABLA-H                     
H P H *                                                                         
H P H              MOVE 'KSVTCPT'             TO WS-TIPO-TABLA                  
H P H              MOVE 'CDSINIES'            TO WS-CAMPOPOL                    
H P H                                                                           
H P H              IF TAB-ESP-SR                                                
H P H               IF WS-SI-HISTORIFICA                                        
H P H                 PERFORM 3300-INSERTA-ESP-SIN                              
H P H               END-IF                                                      
H P H              ELSE                                                         
H P H               IF WS-SI-HISTORIFICA                                        
H P H      EXEC SQL                                                             
H P H         DECLARE CURSOR-71 CURSOR FOR                                      
H P H            SELECT CDSINIES FROM KSVTCPT                                   
H P H             WHERE CDSINIES = :WS-TBL-SINOREC                              
H P H             FETCH FIRST 1 ROWS ONLY                                       
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EXEC SQL                                                             
H P H          OPEN CURSOR-71                                                   
H P H      END-EXEC                                                             
H P H      PERFORM 3306-VALIDA-CODIGO                                           
H P H      EXEC SQL                                                             
H P H          FETCH CURSOR-71                                                  
H P H          INTO                                                             
H P H          :WS-SINOREC                                                      
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H             EXEC SQL                                                      
H P H                CLOSE CURSOR-71                                            
H P H             END-EXEC                                                      
H P H             SET WS-PARA-INSERT TO TRUE                                    
H P H      EXEC SQL                                                             
H P H         INSERT INTO KSVTCPH                                               
H P H            (SELECT * FROM KSVTCPT                                         
H P H             WHERE CDSINIES = :WS-TBL-SINOREC)                             
H P H      END-EXEC                                                             
H P H                                                                           
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3071-PROCESA-KSVTCPT' TO WS-OUT-PARRAFO                
H P H              MOVE 'INSERT CORRECTO '    TO WS-OUT-DESC                    
H P H              MOVE WS-TBL-SINOREC        TO WS-OUT-DESC(18:12)             
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-CLAVE-DUPLICADA                                   
H P H              SET WS-DUPLICADOS   TO TRUE                                  
H P H              MOVE 'SI'                  TO WS-ROLLBACK                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3071-PROCESA-KSVTCPT' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                'DUPLICADO:'             DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H              INTO WS-OUT-DESC                                             
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H            IF WS-WRITE                                                    
H P H              ADD  WC-1                  TO WS-IERR                        
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3071-PROCESA-KSVTCPT' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'SIN '                  DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN OTHER                                                         
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                     SET WS-DUPLICADOS   TO TRUE                           
H P H                     MOVE 'SI'                  TO WS-ROLLBACK             
H P H                     MOVE SQLCODE               TO WS-OUT-SQLCODE          
H P H                     MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA           
H P H                     MOVE WS-TABLA-H            TO WS-OUT-TABLA            
H P H                     MOVE '3071-PROCESA-KSVTCPT' TO WS-OUT-PARRAFO         
H P H                     STRING                                                
H P H                      'CONTENCIO:'             DELIMITED BY SIZE           
H P H                       WS-CAMPOPOL             DELIMITED BY ' '            
H P H                       '='                     DELIMITED BY SIZE           
H P H                       WS-LEE-CDNUMPOL         DELIMITED BY SIZE           
H P H                       INTO WS-OUT-DESC                                    
H P H                       END-STRING                                          
H P H                     PERFORM 1570-ESCRIBE-DESCARTADA                       
H P H              ELSE                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3071-PROCESA-KSVTCPT' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'ERRDB2:'               DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H              MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
H P H              MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
H P H              MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
H P H              MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
H P H              MOVE '3071-PROCESA-KSVTCPT  ' TO CDPARRAF OF KAELCWEZ        
H P H                                                                           
H P H              IF SQLCODE = -911                                            
H P H                 MOVE 'S' TO SW-911                                        
H P H                 MOVE 'S' TO SW-911-911                                    
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H              ELSE                                                         
H P H                 PERFORM 9999-GESTION-ERRORES                              
H P H              END-IF                                                       
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                                                                           
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H            SET WS-NO-PARA-INSERT      TO TRUE                             
H P H            IF WS-WRITE                                                    
H P H              ADD  WC-1                  TO WS-IERR                        
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3071-PROCESA-KSVTCPT' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'NOHAY '                DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H            EXEC SQL                                                       
H P H                CLOSE CURSOR-71                                            
H P H            END-EXEC                                                       
H P H        WHEN OTHER                                                         
H P H              SET WS-NO-PARA-INSERT      TO TRUE                           
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-H            TO WS-OUT-TABLA                   
H P H              MOVE '3071-PROCESA-KSVTCPT' TO WS-OUT-PARRAFO                
H P H              STRING                                                       
H P H                 'ERRDB2:'               DELIMITED BY SIZE                 
H P H                 WS-CAMPOPOL             DELIMITED BY ' '                  
H P H                 '='                     DELIMITED BY SIZE                 
H P H                 WS-TBL-SINOREC          DELIMITED BY SIZE                 
H P H                INTO WS-OUT-DESC                                           
H P H              END-STRING                                                   
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            STRING                                                         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            ' ERROR EN SQL :' W-QUERY-TEXT                    '\N'         
H P H            '???????????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H          MOVE WC-COD                   TO CDERR    OF KAELCWEZ            
H P H          MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ            
H P H          MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ            
H P H          MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ            
H P H          MOVE '3071-PROCESA-KSVTCPT  ' TO CDPARRAF OF KAELCWEZ            
H P H                                                                           
H P H          IF SQLCODE = -911                                                
H P H              MOVE 'S' TO SW-911                                           
H P H              MOVE 'S' TO SW-911-911                                       
H P H              ADD 1 TO WS-CANT-ERRORES                                     
H P H          ELSE                                                             
H P H             PERFORM 9999-GESTION-ERRORES                                  
H P H          END-IF                                                           
H P H                                                                           
H P H      END-EVALUATE                                                         
H P H                 IF  SQLCODE = WN-SQLCODE-OK                               
H P H                 AND WS-PARA-INSERT                                        
H P H      EXEC SQL                                                             
H P H         DELETE FROM KSVTCPT                                               
H P H         WHERE CDSINIES = :WS-TBL-SINOREC                                  
H P H      END-EXEC                                                             
H P H      EVALUATE SQLCODE                                                     
H P H        WHEN  WN-SQLCODE-OK                                                
H P H            IF WS-WRITE                                                    
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3071-PROCESA-KSVTCPT' TO WS-OUT-PARRAFO                
H P H              MOVE 'BORRAR CORRECTO    ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H            END-IF                                                         
H P H        WHEN  WN-SQLCODE-NOT-FOUND                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3071-PROCESA-KSVTCPT' TO WS-OUT-PARRAFO                
H P H              MOVE 'NO EXISTE BORRAR   ' TO WS-OUT-DESC                    
H P H              PERFORM 1570-ESCRIBE-DESCARTADA                              
H P H              MOVE WC-COD                   TO CDERR    OF KAELCWEZ        
H P H              MOVE WC-DES01                 TO DSARGU1  OF KAELCWEZ        
H P H              MOVE WC-PROGRAMA              TO DSARGU2  OF KAELCWEZ        
H P H              MOVE WS-ERPOLIZA              TO DSARGU3  OF KAELCWEZ        
H P H              MOVE '3071-PROCESA-KSVTCPT  ' TO CDPARRAF OF KAELCWEZ        
H P H                                                                           
H P H              PERFORM 9999-GESTION-ERRORES                                 
H P H                                                                           
H P H        WHEN OTHER                                                         
H P H              ADD  WC-1                  TO WS-CANT-ERRORES                
H P H              MOVE 'SI'       TO WS-ROLLBACK                               
H P H              MOVE SQLCODE               TO WS-OUT-SQLCODE                 
H P H              MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA                  
H P H              MOVE WS-TABLA-T            TO WS-OUT-TABLA                   
H P H              MOVE '3071-PROCESA-KSVTCPT' TO WS-OUT-PARRAFO                
H P H              MOVE 'ERR BORRAR DB2     ' TO WS-OUT-DESC                    
H P H              IF SQLCODE  = -911                                           
H P H                 MOVE '3071-PROCESA-KSVTCPT'  TO WS-OUT-PARRAFO            
H P H                 MOVE 'CONTENCION TABLA   '   TO WS-OUT-DESC               
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 mOVE 'S' TO SW-911                                        
H P H                 MOVE 'S' TO SW-911-911                                    
H P H                 ADD 1 TO WS-CANT-ERRORES                                  
H P H                 SET WS-DUPLICADOS   TO TRUE                               
H P H                 MOVE 'SI'                  TO WS-ROLLBACK                 
H P H                 MOVE SQLCODE               TO WS-OUT-SQLCODE              
H P H                 MOVE WS-LEE-CDNUMPOL       TO WS-OUT-POLIZA               
H P H                 MOVE WS-TABLA-H            TO WS-OUT-TABLA                
H P H                 MOVE '3071-PROCESA-KSVTCPT' TO WS-OUT-PARRAFO             
H P H                    STRING                                                 
H P H                   'CONTENCIO:'             DELIMITED BY SIZE              
H P H                    WS-CAMPOPOL             DELIMITED BY ' '               
H P H                    '='                     DELIMITED BY SIZE              
H P H                    WS-LEE-CDNUMPOL         DELIMITED BY SIZE              
H P H                    INTO WS-OUT-DESC                                       
H P H                 END-STRING                                                
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H            STRING                                                         
H P H            'Z8883??????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            'Z8881??????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H              ELSE                                                         
H P H                 MOVE WC-COD              TO CDERR    OF KAELCWEZ          
H P H                 MOVE WC-DES01            TO DSARGU1  OF KAELCWEZ          
H P H                 MOVE WC-PROGRAMA         TO DSARGU2  OF KAELCWEZ          
H P H                 MOVE WS-ERPOLIZA         TO DSARGU3  OF KAELCWEZ          
H P H                 MOVE '3071-PROCESA-KSVTCPT'                               
H P H                                          TO CDPARRAF OF KAELCWEZ          
H P H                 PERFORM 1570-ESCRIBE-DESCARTADA                           
H P H                 IF SQLCODE = -911                                         
H P H                    MOVE 'S' TO SW-911                                     
H P H                    MOVE 'S' TO SW-911-911                                 
H P H                    ADD 1 TO WS-CANT-ERRORES                               
H P H                 ELSE                                                      
H P H            STRING                                                         
H P H            'X9999??????????????????????????????????????????' '\N'         
H P H            ' 3740-EJE ERROR EN SQL :' W-QUERY-TEXT   '\N'                 
H P H            'X9999??????????????????????????????????????????' '\N'         
H P H            DELIMITED BY SIZE                                              
H P H            INTO WS-CIFRASCONTROL                                          
H P H            CALL W-KMCLMCCB USING WS-CIFRASCONTROL                         
H P H                 PERFORM 9999-GESTION-ERRORES                              
H P H                 END-IF                                                    
H P H              END-IF                                                       
H P H      END-EVALUATE                                                         
H P H                 END-IF                                                    
H P H               END-IF                                                      
H P H              END-IF                                                       
H P H              IF WS-ROLLBACK = 'SI'                                        
H P H                 SET WS-NO-HAY-SINIESTROS TO TRUE                          
H P H                 MOVE 98 TO WS-ITBLS                            